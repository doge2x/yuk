// ==UserScript==
// @name         yuk
// @version      0.1.0
// @match        https://examination.xuetangx.com/exam/*
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==

(()=>{function o(r){(t=>{XMLHttpRequest.prototype.send=function(e){this.addEventListener("load",()=>{r.call(this,e)&&(XMLHttpRequest.prototype.send=t)}),t.apply(this,arguments)}})(XMLHttpRequest.prototype.send)}var s={getValue:GM_getValue,setValue:GM_setValue};function a(r,t,e,i){let n=s.getValue(r,null);if(n===null){for(n=self.prompt(`\u8BF7\u8F93\u5165${t}\uFF08${e}\uFF09`);!(n!==null&&i(n));)n=self.prompt(`\u65E0\u6548\u7684${t}\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165`);s.setValue(r,n)}return n}function p(r){document.querySelectorAll("div.header-title").forEach(t=>{let e=document.createElement("a");e.href="javascript:void(0);",e.onclick=r,e.innerHTML=t.innerHTML,t.innerHTML="",t.appendChild(e)})}function u(){return new Promise(r=>{o(function(){let t=new URL(this.responseURL);if(t.pathname=="/exam_room/show_paper"){let e=t.searchParams.get("exam_id");if(e===null)throw new Error("no `exam_id` in url");return r({id:parseInt(e),paper:JSON.parse(this.responseText)}),!0}return!1})})}u().then(r=>{p(()=>{let t=a("username","\u7528\u6237\u540D","\u7531\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210",e=>e.length>0&&e.length<32);console.log(t,r.id,r.paper.data.title),o(function(e){return new URL(this.responseURL).pathname==="/exam_room/answer_problem"&&JSON.parse(e).results.forEach(l=>{console.log(l.problem_id,l.result)}),!1})})});})();
