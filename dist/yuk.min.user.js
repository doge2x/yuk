// ==UserScript==
// @name         yuk-client
// @version      0.6.1
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(d){typeof define=="function"&&define.amd?define(d):d()})(function(){"use strict";var ir=Object.defineProperty,sr=Object.defineProperties;var or=Object.getOwnPropertyDescriptors;var It=Object.getOwnPropertySymbols;var lr=Object.prototype.hasOwnProperty,ur=Object.prototype.propertyIsEnumerable;var Fe=(d,v,p)=>v in d?ir(d,v,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[v]=p,He=(d,v)=>{for(var p in v||(v={}))lr.call(v,p)&&Fe(d,p,v[p]);if(It)for(var p of It(v))ur.call(v,p)&&Fe(d,p,v[p]);return d},xt=(d,v)=>sr(d,or(v));var C=(d,v,p)=>(Fe(d,typeof v!="symbol"?v+"":v,p),p);var d=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},v={},p={},Y={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";var e=function(l){return typeof l=="string"||typeof l=="number"||l===null};t.isJSONRPCID=e;var n=function(l){return l.jsonrpc===t.JSONRPC&&l.method!==void 0&&l.result===void 0&&l.error===void 0};t.isJSONRPCRequest=n;var r=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCRequest)};t.isJSONRPCRequests=r;var i=function(l){return l.jsonrpc===t.JSONRPC&&l.id!==void 0&&(l.result!==void 0||l.error!==void 0)};t.isJSONRPCResponse=i;var s=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCResponse)};t.isJSONRPCResponses=s,function(l){l[l.ParseError=-32700]="ParseError",l[l.InvalidRequest=-32600]="InvalidRequest",l[l.MethodNotFound=-32601]="MethodNotFound",l[l.InvalidParams=-32602]="InvalidParams",l[l.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));var o=function(l,a,u,c){var f={code:a,message:u};return c&&(f.data=c),{jsonrpc:t.JSONRPC,id:l,error:f}};t.createJSONRPCErrorResponse=o})(Y);var Z={};Object.defineProperty(Z,"__esModule",{value:!0}),Z.DefaultErrorCode=void 0,Z.DefaultErrorCode=0;var kt=d&&d.__awaiter||function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(c){try{u(r.next(c))}catch(f){o(f)}}function a(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(l,a)}u((r=r.apply(t,e||[])).next())})},Jt=d&&d.__generator||function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(c){return a([u,c])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(p,"__esModule",{value:!0}),p.JSONRPCClient=void 0;var ee=Y,Ce=Z,Dt=function(){function t(e,n){this._send=e,this.createID=n,this.idToResolveMap=new Map,this.id=0}return t.prototype._createID=function(){return this.createID?this.createID():++this.id},t.prototype.timeout=function(e,n){var r=this;n===void 0&&(n=function(o){return(0,ee.createJSONRPCErrorResponse)(o,Ce.DefaultErrorCode,"Request timeout")});var i=function(o,l){var a=setTimeout(function(){o.forEach(function(u){var c=r.idToResolveMap.get(u);c&&(r.idToResolveMap.delete(u),c(n(u)))})},e);return l().then(function(u){return clearTimeout(a),u},function(u){return clearTimeout(a),Promise.reject(u)})},s=function(o,l){var a=(Array.isArray(o)?o:[o]).map(function(u){return u.id}).filter(Ve);return i(a,function(){return r.requestAdvanced(o,l)})};return{request:function(o,l,a){var u=r._createID();return i([u],function(){return r.requestWithID(o,l,a,u)})},requestAdvanced:function(o,l){return s(o,l)}}},t.prototype.request=function(e,n,r){return this.requestWithID(e,n,r,this._createID())},t.prototype.requestWithID=function(e,n,r,i){return kt(this,void 0,void 0,function(){var s,o;return Jt(this,function(l){switch(l.label){case 0:return s={jsonrpc:ee.JSONRPC,method:e,params:n,id:i},[4,this.requestAdvanced(s,r)];case 1:return o=l.sent(),o.result!==void 0&&!o.error?[2,o.result]:o.result===void 0&&o.error?[2,Promise.reject(new Error(o.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},t.prototype.requestAdvanced=function(e,n){var r=this,i=Array.isArray(e);Array.isArray(e)||(e=[e]);var s=e.filter(function(a){return Ve(a.id)}),o=s.map(function(a){return new Promise(function(u){return r.idToResolveMap.set(a.id,u)})}),l=Promise.all(o).then(function(a){return i||!a.length?a:a[0]});return this.send(i?e:e[0],n).then(function(){return l},function(a){return s.forEach(function(u){r.receive((0,ee.createJSONRPCErrorResponse)(u.id,Ce.DefaultErrorCode,a&&a.message||"Failed to send a request"))}),l})},t.prototype.notify=function(e,n,r){this.send({jsonrpc:ee.JSONRPC,method:e,params:n},r).then(void 0,function(){})},t.prototype.send=function(e,n){return this._send(e,n)},t.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(n,r){return n((0,ee.createJSONRPCErrorResponse)(r,Ce.DefaultErrorCode,e))}),this.idToResolveMap.clear()},t.prototype.receive=function(e){var n=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var i=n.idToResolveMap.get(r.id);i&&(n.idToResolveMap.delete(r.id),i(r))})},t}();p.JSONRPCClient=Dt;var Ve=function(t){return t!=null},ce={},fe=d&&d.__assign||function(){return fe=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},fe.apply(this,arguments)},Ke=d&&d.__awaiter||function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(c){try{u(r.next(c))}catch(f){o(f)}}function a(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(l,a)}u((r=r.apply(t,e||[])).next())})},Ge=d&&d.__generator||function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(c){return a([u,c])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Tt=d&&d.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(ce,"__esModule",{value:!0}),ce.JSONRPCServer=void 0;var R=Y,zt=Z,Lt=function(){return(0,R.createJSONRPCErrorResponse)(null,R.JSONRPCErrorCode.ParseError,"Parse error")},jt=function(t){return(0,R.createJSONRPCErrorResponse)((0,R.isJSONRPCID)(t.id)?t.id:null,R.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},qt=function(t){return(0,R.createJSONRPCErrorResponse)(t,R.JSONRPCErrorCode.MethodNotFound,"Method not found")},Bt=function(){function t(e){e===void 0&&(e={});var n;this.mapErrorToJSONRPCErrorResponse=Ht,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=e.errorListener)!==null&&n!==void 0?n:console.warn}return t.prototype.addMethod=function(e,n){this.addMethodAdvanced(e,this.toJSONRPCMethod(n))},t.prototype.toJSONRPCMethod=function(e){return function(n,r){var i=e(n.params,r);return Promise.resolve(i).then(function(s){return Ft(n.id,s)})}},t.prototype.addMethodAdvanced=function(e,n){var r;this.nameToMethodDictionary=fe(fe({},this.nameToMethodDictionary),(r={},r[e]=n,r))},t.prototype.receiveJSON=function(e,n){var r=this.tryParseRequestJSON(e);return r?this.receive(r,n):Promise.resolve(Lt())},t.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},t.prototype.receive=function(e,n){return Array.isArray(e)?this.receiveMultiple(e,n):this.receiveSingle(e,n)},t.prototype.receiveMultiple=function(e,n){return Ke(this,void 0,void 0,function(){var r,i=this;return Ge(this,function(s){switch(s.label){case 0:return[4,Promise.all(e.map(function(o){return i.receiveSingle(o,n)}))];case 1:return r=s.sent().filter(Wt),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},t.prototype.receiveSingle=function(e,n){return Ke(this,void 0,void 0,function(){var r,i;return Ge(this,function(s){switch(s.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,R.isJSONRPCRequest)(e)?[3,1]:[2,jt(e)];case 1:return r?[4,this.callMethod(r,e,n)]:[3,3];case 2:return i=s.sent(),[2,Vt(e,i)];case 3:return e.id!==void 0?[2,qt(e.id)]:[2,null];case 4:return[2]}})})},t.prototype.applyMiddleware=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Tt([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},t.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},t.prototype.middlewareReducer=function(e,n){return function(r,i,s){return e(function(o,l){return n(r,o,l)},i,s)}},t.prototype.callMethod=function(e,n,r){var i=this,s=function(l,a){return e(l,a)},o=function(l){return i.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),l),Promise.resolve(i.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,l))};try{return(this.middleware||Ut)(s,n,r).then(void 0,o)}catch(l){return o(l)}},t.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,n){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,n):null},t}();ce.JSONRPCServer=Bt;var Wt=function(t){return t!==null},Ut=function(t,e,n){return t(e,n)},Ft=function(t,e){return t!==void 0?{jsonrpc:R.JSONRPC,id:t,result:e===void 0?null:e}:null},Ht=function(t,e){return(0,R.createJSONRPCErrorResponse)(t,zt.DefaultErrorCode,e&&e.message||"An unexpected error occurred")},Vt=function(t,e){return e||(t.id!==void 0?(0,R.createJSONRPCErrorResponse)(t.id,R.JSONRPCErrorCode.InternalError,"Internal error"):null)},de={},Kt=d&&d.__awaiter||function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(c){try{u(r.next(c))}catch(f){o(f)}}function a(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(l,a)}u((r=r.apply(t,e||[])).next())})},Gt=d&&d.__generator||function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(c){return a([u,c])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(de,"__esModule",{value:!0}),de.JSONRPCServerAndClient=void 0;var he=Y,Qt=function(){function t(e,n,r){r===void 0&&(r={});var i;this.server=e,this.client=n,this.errorListener=(i=r.errorListener)!==null&&i!==void 0?i:console.warn}return t.prototype.applyServerMiddleware=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,n)},t.prototype.addMethod=function(e,n){this.server.addMethod(e,n)},t.prototype.addMethodAdvanced=function(e,n){this.server.addMethodAdvanced(e,n)},t.prototype.timeout=function(e){return this.client.timeout(e)},t.prototype.request=function(e,n,r){return this.client.request(e,n,r)},t.prototype.requestAdvanced=function(e,n){return this.client.requestAdvanced(e,n)},t.prototype.notify=function(e,n,r){this.client.notify(e,n,r)},t.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},t.prototype.receiveAndSend=function(e,n,r){return Kt(this,void 0,void 0,function(){var i,s;return Gt(this,function(o){switch(o.label){case 0:return(0,he.isJSONRPCResponse)(e)||(0,he.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,he.isJSONRPCRequest)(e)||(0,he.isJSONRPCRequests)(e)?[4,this.server.receive(e,n)]:[3,3];case 2:return i=o.sent(),i?[2,this.client.send(i,r)]:[3,4];case 3:return s="Received an invalid JSON-RPC message",this.errorListener(s,e),[2,Promise.reject(new Error(s))];case 4:return[2]}})})},t}();de.JSONRPCServerAndClient=Qt,function(t){var e=d&&d.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),n=d&&d.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(p,t),n(Y,t),n(ce,t),n(de,t)}(v);const B={};let Xt=tt;const $e={},te=1,me=2,Qe={owned:null,cleanups:null,context:null,owner:null};var E=null;let _e=null,D=null,ne=null,$=null,T=null,Re=0;function Yt(t,e){const n=D,r=E,i=t.length===0?Qe:{owned:null,cleanups:null,context:null,owner:e||r};E=i,D=null;try{return Ee(()=>t(()=>Ae(i)),!0)}finally{D=n,E=r}}function b(t,e,n){const r=tn(t,e,!1,te);Ze(r)}function Zt(t){if(ne)return t();let e;const n=ne=[];try{e=t()}finally{ne=null}return Ee(()=>{for(let r=0;r<n.length;r+=1){const i=n[r];if(i.pending!==$e){const s=i.pending;i.pending=$e,Ye(i,s)}}},!1),e}function Xe(t){let e,n=D;return D=null,e=t(),D=n,e}function Ye(t,e,n){if(ne)return t.pending===$e&&ne.push(t),t.pending=e,e;if(t.comparator&&t.comparator(t.value,e))return e;let r=!1;return t.value=e,t.observers&&t.observers.length&&Ee(()=>{for(let i=0;i<t.observers.length;i+=1){const s=t.observers[i];r&&_e.disposed.has(s),(r&&!s.tState||!r&&!s.state)&&(s.pure?$.push(s):T.push(s),s.observers&&nt(s)),r||(s.state=te)}if($.length>1e6)throw $=[],new Error},!1),e}function Ze(t){if(!t.fn)return;Ae(t);const e=E,n=D,r=Re;D=E=t,en(t,t.value,r),D=n,E=e}function en(t,e,n){let r;try{r=t.fn(e)}catch(i){rt(i)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?Ye(t,r):t.value=r,t.updatedAt=n)}function tn(t,e,n,r=te,i){const s={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:E,context:null,pure:n};return E===null||E!==Qe&&(E.owned?E.owned.push(s):E.owned=[s]),s}function et(t){const e=_e;if(t.state===0||e)return;if(t.state===me||e)return Oe(t);if(t.suspense&&Xe(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Re);)(t.state||e)&&n.push(t);for(let r=n.length-1;r>=0;r--)if(t=n[r],t.state===te||e)Ze(t);else if(t.state===me||e){const i=$;$=null,Oe(t,n[0]),$=i}}function Ee(t,e){if($)return t();let n=!1;e||($=[]),T?n=!0:T=[],Re++;try{const r=t();return nn(n),r}catch(r){rt(r)}finally{$=null,n||(T=null)}}function nn(t){$&&(tt($),$=null),!t&&(T.length?Zt(()=>{Xt(T),T=null}):T=null)}function tt(t){for(let e=0;e<t.length;e++)et(t[e])}function Oe(t,e){const n=_e;t.state=0;for(let r=0;r<t.sources.length;r+=1){const i=t.sources[r];i.sources&&(i.state===te||n?i!==e&&et(i):(i.state===me||n)&&Oe(i,e))}}function nt(t){const e=_e;for(let n=0;n<t.observers.length;n+=1){const r=t.observers[n];(!r.state||e)&&(r.state=me,r.pure?$.push(r):T.push(r),r.observers&&nt(r))}}function Ae(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),i=n.observers;if(i&&i.length){const s=i.pop(),o=n.observerSlots.pop();r<i.length&&(s.sourceSlots[o]=r,i[r]=s,n.observerSlots[r]=o)}}if(t.owned){for(e=0;e<t.owned.length;e++)Ae(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function rt(t){throw t}function V(t,e){return Xe(()=>t(e||{}))}const rn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],sn=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...rn]),on=new Set(["innerHTML","textContent","innerText","children"]),ln={className:"class",htmlFor:"for"},it={class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"},st=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),un={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function an(t,e,n){let r=n.length,i=e.length,s=r,o=0,l=0,a=e[i-1].nextSibling,u=null;for(;o<i||l<s;){if(e[o]===n[l]){o++,l++;continue}for(;e[i-1]===n[s-1];)i--,s--;if(i===o){const c=s<r?l?n[l-1].nextSibling:n[s-l]:a;for(;l<s;)t.insertBefore(n[l++],c)}else if(s===l)for(;o<i;)(!u||!u.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[s-1]&&n[l]===e[i-1]){const c=e[--i].nextSibling;t.insertBefore(n[l++],e[o++].nextSibling),t.insertBefore(n[--s],c),e[i]=n[s]}else{if(!u){u=new Map;let f=l;for(;f<s;)u.set(n[f],f++)}const c=u.get(e[o]);if(c!=null)if(l<c&&c<s){let f=o,g=1,N;for(;++f<i&&f<s&&!((N=u.get(e[f]))==null||N!==c+g);)g++;if(g>c-l){const O=e[o];for(;l<c;)t.insertBefore(n[l++],O)}else t.replaceChild(n[l++],e[o++])}else o++;else e[o++].remove()}}}const ot="_$DX_DELEGATE";function re(t,e,n){let r;return Yt(i=>{r=i,e===document?t():h(e,t(),e.firstChild?null:void 0,n)}),()=>{r(),e.textContent=""}}function S(t,e,n){const r=document.createElement("template");r.innerHTML=t;let i=r.content.firstChild;return n&&(i=i.firstChild),i}function cn(t,e=window.document){const n=e[ot]||(e[ot]=new Set);for(let r=0,i=t.length;r<i;r++){const s=t[r];n.has(s)||(n.add(s),e.addEventListener(s,vn))}}function ge(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function fn(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function y(t,e){e==null?t.removeAttribute("class"):t.className=e}function dn(t,e,n,r){r?Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n:Array.isArray(n)?t.addEventListener(e,i=>n[0](n[1],i)):t.addEventListener(e,n)}function ve(t,e,n={}){const r=Object.keys(e||{}),i=Object.keys(n);let s,o;for(s=0,o=i.length;s<o;s++){const l=i[s];!l||l==="undefined"||e[l]||(lt(t,l,!1),delete n[l])}for(s=0,o=r.length;s<o;s++){const l=r[s],a=!!e[l];!l||l==="undefined"||n[l]===a||!a||(lt(t,l,!0),n[l]=a)}return n}function hn(t,e,n={}){const r=t.style,i=typeof n=="string";if(e==null&&i||typeof e=="string")return r.cssText=e;i&&(r.cssText=void 0,n={}),e||(e={});let s,o;for(o in n)e[o]==null&&r.removeProperty(o),delete n[o];for(o in e)s=e[o],s!==n[o]&&(r.setProperty(o,s),n[o]=s);return n}function mn(t,e,n,r){typeof e=="function"?b(i=>at(t,e(),i,n,r)):at(t,e,void 0,n,r)}function h(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return K(t,e,r,n);b(i=>K(t,e(),i,n),r)}function _n(t,e,n,r,i={},s=!1){e||(e={});for(const o in i)if(!(o in e)){if(o==="children")continue;ut(t,o,null,i[o],n,s)}for(const o in e){if(o==="children"){r||K(t,e.children);continue}const l=e[o];i[o]=ut(t,o,l,i[o],n,s)}}function gn(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function lt(t,e,n){const r=e.trim().split(/\s+/);for(let i=0,s=r.length;i<s;i++)t.classList.toggle(r[i],n)}function ut(t,e,n,r,i,s){let o,l,a;if(e==="style")return hn(t,n,r);if(e==="classList")return ve(t,n,r);if(n===r)return r;if(e==="ref")s||n(t);else if(e.slice(0,3)==="on:")t.addEventListener(e.slice(3),n);else if(e.slice(0,10)==="oncapture:")t.addEventListener(e.slice(10),n,!0);else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),c=st.has(u);dn(t,u,n,c),c&&cn([u])}else if((a=on.has(e))||!i&&(it[e]||(l=sn.has(e)))||(o=t.nodeName.includes("-")))e==="class"||e==="className"?y(t,n):o&&!l&&!a?t[gn(e)]=n:t[it[e]||e]=n;else{const u=i&&e.indexOf(":")>-1&&un[e.split(":")[0]];u?fn(t,u,e,n):ge(t,ln[e]||e,n)}return n}function vn(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}}),B.registry&&!B.done&&(B.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[e];if(r&&!n.disabled){const i=n[`${e}Data`];if(i!==void 0?r(i,t):r(t),t.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function at(t,e,n={},r,i){return e||(e={}),!i&&"children"in e&&b(()=>n.children=K(t,e.children,n.children)),e.ref&&e.ref(t),b(()=>_n(t,e,r,!0,n,!0)),n}function K(t,e,n,r,i){for(B.context&&!n&&(n=[...t.childNodes]);typeof n=="function";)n=n();if(e===n)return n;const s=typeof e,o=r!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,s==="string"||s==="number"){if(B.context)return n;if(s==="number"&&(e=e.toString()),o){let l=n[0];l&&l.nodeType===3?l.data=e:l=document.createTextNode(e),n=G(t,n,r,l)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||s==="boolean"){if(B.context)return n;n=G(t,n,r)}else{if(s==="function")return b(()=>{let l=e();for(;typeof l=="function";)l=l();n=K(t,l,n,r)}),()=>n;if(Array.isArray(e)){const l=[];if(Pe(l,e,i))return b(()=>n=K(t,l,n,r,!0)),()=>n;if(B.context){for(let a=0;a<l.length;a++)if(l[a].parentNode)return n=l}if(l.length===0){if(n=G(t,n,r),o)return n}else Array.isArray(n)?n.length===0?ct(t,l,r):an(t,n,l):(n&&G(t),ct(t,l));n=l}else if(e instanceof Node){if(B.context&&e.parentNode)return n=o?[e]:e;if(Array.isArray(n)){if(o)return n=G(t,n,r,e);G(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Pe(t,e,n){let r=!1;for(let i=0,s=e.length;i<s;i++){let o=e[i],l;if(o instanceof Node)t.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))r=Pe(t,o)||r;else if((l=typeof o)=="string")t.push(document.createTextNode(o));else if(l==="function")if(n){for(;typeof o=="function";)o=o();r=Pe(t,Array.isArray(o)?o:[o])||r}else t.push(o),r=!0;else t.push(document.createTextNode(o.toString()))}return r}function ct(t,e,n){for(let r=0,i=e.length;r<i;r++)t.insertBefore(e[r],n)}function G(t,e,n,r){if(n===void 0)return t.textContent="";const i=r||document.createTextNode("");if(e.length){let s=!1;for(let o=e.length-1;o>=0;o--){const l=e[o];if(i!==l){const a=l.parentNode===t;!s&&!o?a?t.replaceChild(i,l):t.insertBefore(i,n):a&&l.remove()}else s=!0}}else t.insertBefore(i,n);return[i]}var ft=`._mainBody_8f6zw_1{opacity:.5}._mainBody_8f6zw_1 *{font-size:.75rem;margin:0}._mainBody_8f6zw_1 button,._clickable_8f6zw_11{cursor:pointer}._stateWorkingOn_8f6zw_14{color:#00f}._stateSure_8f6zw_17{color:green}._stateNotSure_8f6zw_20{color:red}._answerMsg_8f6zw_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_8f6zw_23 ul{padding-left:1rem}._answerMsgName_8f6zw_32{font-weight:700}._answerMark_8f6zw_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_8f6zw_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_8f6zw_35 input{height:max-content;width:100%}._answerDetail_8f6zw_53 ._stateWorkingOn_8f6zw_14,._answerDetail_8f6zw_53 ._stateSure_8f6zw_17,._answerDetail_8f6zw_53 ._stateNotSure_8f6zw_20{font-weight:700}._answerDetail_8f6zw_53 ul{padding-left:1.5rem}._answerDetail_8f6zw_53 img{height:auto;width:80%}._answerDetailShortAnswer_8f6zw_65{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem}._settings_8f6zw_71{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_8f6zw_79{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_8f6zw_79 label{font-weight:700}._settingsEntry_8f6zw_79 input{height:max-content;text-align:right}._settingsSubmit_8f6zw_93{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_8f6zw_99{margin-right:.5rem}._about_8f6zw_102 p{margin-bottom:.25rem}._about_8f6zw_102 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_8f6zw_102 ul li{margin-bottom:.25rem}._uploadImg_8f6zw_112{display:flex;flex-direction:column}._uploadImg_8f6zw_112 img{width:100%;height:auto}._uploadImgImage_8f6zw_120{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_8f6zw_125{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`;const yn=S("<title> </title>"),wn=S("<style></style>");function dt(t,e){Me(t!=null,e!=null?e:"null value")}function ht(t,e,n){Me(e instanceof t,n!=null?n:"not HTMLElement")}function Me(t,e){if(t!==!0)throw Error(e!=null?e:"assertion failed")}function A(...t){return t}function Ie(t){const e=window.open("","",Object.entries(t).map(([r,i])=>`${r}=${i}`).join(","));dt(e);const n=()=>e.close();return window.addEventListener("unload",n),e.addEventListener("close",()=>window.removeEventListener("unload",n)),re(()=>[(()=>{const r=yn.cloneNode(!0),i=r.firstChild;return b(()=>i.data=t.title),r})(),(()=>{const r=wn.cloneNode(!0);return r.textContent=ft,r})()],e.document.head),e}function xe(t,...e){}function mt(t,e){const n=new URL(t,self.location.origin);for(const[r,i]of Object.entries(e!=null?e:{}))n.searchParams.set(r,i);return n}function _t(t){const e=GM_getValue(t);if(e!==void 0)return e.contents}function ie(t,e){GM_setValue(t,{contents:e})}function pn(){var n;const t=[{name:"202205231915_gm_value",up(){ie("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const r of["username","server","sync_answers","sort_problems"])ie(r,GM_getValue(r))}}],e=(n=_t("migrations"))!=null?n:[];for(const{name:r,idx:i}of e)if(r!==t[i].name)throw new Error("bad migrations");for(const{name:r,up:i}of t.slice(e.length))i();ie("migrations",t.map((r,i)=>({name:r.name,idx:i})))}class se{constructor(e,n){C(this,"_name");C(this,"_init");C(this,"inited",!1);C(this,"_cached");this._name=e,this._init=n}get(){if(!this.inited){const e=_t(this._name);e===void 0&&this._init!==void 0&&ie(this._name,this._init),this._cached=e!=null?e:this._init,this.inited=!0}return this._cached}set(e){e!==void 0&&(ie(this._name,e),this._cached=e)}}const ke=new se("username"),Je=new se("server"),De=new se("sync_answers",!0),Te=new se("sort_problems",!1),ze=new se("no_leave_check",!0);class bn{constructor(){C(this,"token");C(this,"client");C(this,"examId");C(this,"paper");C(this,"queue",new Map);C(this,"onmsg",[])}onmessage(e){this.onmsg.push(e)}updateQueue(e,n){let r=this.queue.get(e);r!==void 0?n(r):(r={},n(r),this.queue.set(e,r))}updateAnswer(e,n){this.updateQueue(e,r=>r.result=n)}updateState(e,n){this.updateQueue(e,r=>{var i;r.context=(i=r.context)!=null?i:{},r.context.state=n})}updateMsg(e,n){this.updateQueue(e,r=>{var i;r.context=(i=r.context)!=null?i:{},r.context.msg=n})}async watch(e){return new Promise((n,r)=>{const i=setInterval(()=>{this.sendQueue().catch(s=>{clearInterval(i),alert("\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5F02\u5E38"),r(s)})},e)})}async login(e,n){this.examId=e,this.paper=n}async sendQueue(){const e=De.get(),n=Je.get(),r=ke.get();if(e!==!0||this.queue.size<1||n===void 0||r===void 0||this.examId===void 0||this.paper===void 0)return;let i=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const o=new v.JSONRPCClient(l=>new Promise((a,u)=>{GM.xmlHttpRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(l),onload:c=>{c.status===200?(o.receive(JSON.parse(c.responseText)),a()):u(new Error(c.statusText))},onerror:c=>u(c.statusText)})}));this.client=o}if(this.token===void 0){xe(`login to server: ${r}, ${this.examId}`);const o=await this.client.request("login",[r,this.examId,this.paper]);this.token=o}const s=await this.client.request("answer_problem",[this.token,i.map(([o,{result:l,context:a}])=>({problem_id:o,result:l,context:a}))]);this.onmsg.forEach(o=>o(s))}}const z=new bn;function Sn(t){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const i=t.call(this,mt(r)),s=this.send;this.send=function(o){i!==void 0?i(o).then(l=>{s.call(this,l),this.send=s}).catch(xe):(s.call(this,o),this.send=s)},e.apply(this,arguments)}}var x=(t=>(t[t.SingleChoice=1]="SingleChoice",t[t.MultipleChoice=2]="MultipleChoice",t[t.Polling=3]="Polling",t[t.FillBlank=4]="FillBlank",t[t.ShortAnswer=5]="ShortAnswer",t[t.Judgement=6]="Judgement",t))(x||{}),P=(t=>(t[t.WorkingOn=0]="WorkingOn",t[t.Sure=1]="Sure",t[t.NotSure=2]="NotSure",t))(P||{}),m={mainBody:"_mainBody_8f6zw_1",clickable:"_clickable_8f6zw_11",stateWorkingOn:"_stateWorkingOn_8f6zw_14",stateSure:"_stateSure_8f6zw_17",stateNotSure:"_stateNotSure_8f6zw_20",answerMsg:"_answerMsg_8f6zw_23",answerMsgName:"_answerMsgName_8f6zw_32",answerMark:"_answerMark_8f6zw_35",answerDetail:"_answerDetail_8f6zw_53",answerDetailShortAnswer:"_answerDetailShortAnswer_8f6zw_65",settings:"_settings_8f6zw_71",settingsEntry:"_settingsEntry_8f6zw_79",settingsSubmit:"_settingsSubmit_8f6zw_93",settingsSubmitTip:"_settingsSubmitTip_8f6zw_99",about:"_about_8f6zw_102",uploadImg:"_uploadImg_8f6zw_112",uploadImgImage:"_uploadImgImage_8f6zw_120",uploadImgConfirm:"_uploadImgConfirm_8f6zw_125"};const M=Symbol("@ts-pattern/matcher"),ye="@ts-pattern/anonymous-select-key",Le=t=>Boolean(t&&typeof t=="object"),we=t=>t&&!!t[M],I=(t,e,n)=>{if(Le(t)){if(we(t)){const r=t[M](),{matched:i,selections:s}=r.match(e);return i&&s&&Object.keys(s).forEach(o=>n(o,s[o])),i}if(!Le(e))return!1;if(Array.isArray(t))return!!Array.isArray(e)&&t.length===e.length&&t.every((r,i)=>I(r,e[i],n));if(t instanceof Map)return e instanceof Map&&Array.from(t.keys()).every(r=>I(t.get(r),e.get(r),n));if(t instanceof Set){if(!(e instanceof Set))return!1;if(t.size===0)return e.size===0;if(t.size===1){const[r]=Array.from(t.values());return we(r)?Array.from(e.values()).every(i=>I(r,i,n)):e.has(r)}return Array.from(t.values()).every(r=>e.has(r))}return Object.keys(t).every(r=>{const i=t[r];return(r in e||we(s=i)&&s[M]().matcherType==="optional")&&I(i,e[r],n);var s})}return Object.is(e,t)},L=t=>{var e,n,r;return Le(t)?we(t)?(e=(n=(r=t[M]()).getSelectionKeys)==null?void 0:n.call(r))!=null?e:[]:Array.isArray(t)?oe(t,L):oe(Object.values(t),L):[]},oe=(t,e)=>t.reduce((n,r)=>n.concat(e(r)),[]);function gt(t){return{[M]:()=>({match:e=>{let n={};const r=(i,s)=>{n[i]=s};return e===void 0?(L(t).forEach(i=>r(i,void 0)),{matched:!0,selections:n}):{matched:I(t,e,r),selections:n}},getSelectionKeys:()=>L(t),matcherType:"optional"})}}function vt(t){return{[M]:()=>({match:e=>{if(!Array.isArray(e))return{matched:!1};let n={};const r=(i,s)=>{n[i]=(n[i]||[]).concat([s])};return{matched:e.every(i=>I(t,i,r)),selections:n}},getSelectionKeys:()=>L(t)})}}function yt(...t){return{[M]:()=>({match:e=>{let n={};const r=(i,s)=>{n[i]=s};return{matched:t.every(i=>I(i,e,r)),selections:n}},getSelectionKeys:()=>oe(t,L),matcherType:"and"})}}function wt(...t){return{[M]:()=>({match:e=>{let n={};const r=(i,s)=>{n[i]=s};return oe(t,L).forEach(i=>r(i,void 0)),{matched:t.some(i=>I(i,e,r)),selections:n}},getSelectionKeys:()=>oe(t,L),matcherType:"or"})}}function pt(t){return{[M]:()=>({match:e=>({matched:!I(t,e,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})}}function k(t){return{[M]:()=>({match:e=>({matched:Boolean(t(e))})})}}function bt(...t){const e=typeof t[0]=="string"?t[0]:void 0,n=t.length===2?t[1]:typeof t[0]=="string"?void 0:t[0];return{[M]:()=>({match:r=>{let i={[e!=null?e:ye]:r};return{matched:n===void 0||I(n,r,(s,o)=>{i[s]=o}),selections:i}},getSelectionKeys:()=>[e!=null?e:ye].concat(n===void 0?[]:L(n))})}}const St=k(function(t){return!0}),Nn=St,Cn=k(function(t){return typeof t=="string"}),$n=k(function(t){return typeof t=="number"}),Rn=k(function(t){return typeof t=="boolean"}),En=k(function(t){return typeof t=="bigint"}),On=k(function(t){return typeof t=="symbol"}),An=k(function(t){return t==null});var pe={__proto__:null,optional:gt,array:vt,intersection:yt,union:wt,not:pt,when:k,select:bt,any:St,_:Nn,string:Cn,number:$n,boolean:Rn,bigint:En,symbol:On,nullish:An,instanceOf:function(t){return k(function(e){return n=>n instanceof e}(t))},typed:function(){return{array:vt,optional:gt,intersection:yt,union:wt,not:pt,select:bt,when:k}}};const Pn=t=>new le(t,[]);class le{constructor(e,n){this.value=void 0,this.cases=void 0,this.value=e,this.cases=n}with(...e){const n=e[e.length-1],r=[e[0]],i=[];return e.length===3&&typeof e[1]=="function"?(r.push(e[0]),i.push(e[1])):e.length>2&&r.push(...e.slice(1,e.length-1)),new le(this.value,this.cases.concat([{match:s=>{let o={};const l=Boolean(r.some(a=>I(a,s,(u,c)=>{o[u]=c}))&&i.every(a=>a(s)));return{matched:l,value:l&&Object.keys(o).length?ye in o?o[ye]:o:s}},handler:n}]))}when(e,n){return new le(this.value,this.cases.concat([{match:r=>({matched:Boolean(e(r)),value:r}),handler:n}]))}otherwise(e){return new le(this.value,this.cases.concat([{match:n=>({matched:!0,value:n}),handler:e}])).run()}exhaustive(){return this.run()}run(){let e,n=this.value;for(const r of this.cases){const i=r.match(this.value);if(i.matched){n=i.value,e=r.handler;break}}if(!e){let r;try{r=JSON.stringify(this.value)}catch{r=this.value}throw new Error(`Pattern matching error: no pattern matches value ${r}`)}return e(n,this.value)}}class je{constructor(e){C(this,"t");this.t=e}then(e){return new je(e(this.t))}}function _(t){return new je(t)}function j(t){return function*(e){for(const n of e)yield t(n)}}function*qe(t){let e=0;for(const n of t)yield[e++,n]}function Mn(t){return function*(e){for(const n of e)t(n)&&(yield n)}}function In(t){return function*(e){for(const n of e){const r=t(n);r!==void 0&&(yield r)}}}function xn(t){return function*(e){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();for(;;){const i=n.next(),s=r.next();if(i.done!==!0&&s.done!==!0)yield[i.value,s.value];else return}}}function Q(t){return function(e){return Array.from(e).sort(t)}}function kn(t){for(const e of t)return e}function U(t,e){return function(n){let r=t;for(const i of n)r=e(r,i);return r}}function J(t){return Array.from(t)}function Be(t){return function(e){for(const n of e)t(n)}}const Jn=S('<div><fieldset><legend>\u6807\u8BB0</legend><input type="text" placeholder="\u7559\u8A00"><button type="button">\u6211\u6B63\u5728\u505A</button><button type="button">\u6211\u5F88\u786E\u5B9A</button><button type="button">\u6211\u4E0D\u786E\u5B9A</button></fieldset><div><fieldset><legend> \u7559\u8A00 </legend><ul></ul></fieldset><div></div></div></div>'),Dn=S("<li><span></span></li>"),Nt=S("<div><p><strong></strong></p><ul></ul></div>"),Ct=S("<li></li>"),Tn=S("<li><pre></pre><ul></ul></li>"),zn=S("<div></div>"),Ln=S("<ul></ul>"),jn=S("<li><a></a></li>"),qn=S("<p><strong></strong></p>");function $t(t){switch(t){case P.Sure:return 0;case P.WorkingOn:return 1;case P.NotSure:return 2}}function Rt([t,e],[n,r]){return Pn(A(e,r)).with(A(void 0,void 0),()=>t.localeCompare(n)).with(A(void 0,pe.not(void 0)),()=>1).with(A(pe.not(void 0),void 0),()=>-1).with(A(pe.not(void 0),pe.not(void 0)),([i,s])=>$t(s)-$t(i)).exhaustive()}function Et([t,e],[n,r]){var i,s;return Rt(A(t,(i=e.context)==null?void 0:i.state),A(n,(s=r.context)==null?void 0:s.state))}function Ot([t,e],[n,r]){return Rt(A(t,e==null?void 0:e.state),A(n,r==null?void 0:r.state))}function be(t){if(t!==void 0)switch(t){case P.WorkingOn:return m.stateWorkingOn;case P.NotSure:return m.stateNotSure;case P.Sure:return m.stateSure}}function At(t,e){return`${Math.floor(t*100/e)}%`}function We([t],[e]){return t.localeCompare(e)}class Ue{constructor(e,n){C(this,"_details",new Map);C(this,"_renderUI",()=>{});this._id=e;let r=n.querySelector(".item-type");ht(HTMLElement,r),r.classList.add(m.clickable),r.addEventListener("click",()=>{let i=r==null?void 0:r.getBoundingClientRect();this.showDetail({top:i==null?void 0:i.top,left:i==null?void 0:i.left})})}get details(){return this._details}showDetail(e){const n=Ie(He({title:"\u8BE6\u7EC6\u7B54\u6848",height:200,width:300},e)),r=this;re(()=>(()=>{const i=Jn.cloneNode(!0),s=i.firstChild,o=s.firstChild,l=o.nextSibling,a=l.nextSibling,u=a.nextSibling,c=u.nextSibling,f=s.nextSibling,g=f.firstChild,N=g.firstChild,O=N.nextSibling,X=g.nextSibling;return l.addEventListener("change",w=>z.updateMsg(r._id,w.currentTarget.value)),a.addEventListener("click",()=>z.updateState(r._id,P.WorkingOn)),u.addEventListener("click",()=>z.updateState(r._id,P.Sure)),c.addEventListener("click",()=>z.updateState(r._id,P.NotSure)),h(O,()=>_(r.details).then(Q(Et)).then(In(([w,{context:F}])=>{if(F===void 0)return;let q=F.msg;if(F.state===P.WorkingOn&&(q=q!=null?q:"\u6211\u6B63\u5728\u505A"),q!==void 0)return(()=>{const H=Dn.cloneNode(!0),ae=H.firstChild;return h(ae,`${w}: `),h(H,q,null),b(W=>{const Se=be(F.state),Ne=m.answerMsgName;return Se!==W._v$8&&y(H,W._v$8=Se),Ne!==W._v$9&&y(ae,W._v$9=Ne),W},{_v$8:void 0,_v$9:void 0}),H})()})).then(J).t),h(X,()=>r._renderUI()),b(w=>{const F=m.mainBody,q=m.answerMark,H=m.stateWorkingOn,ae=m.stateSure,W=m.stateNotSure,Se={[m.answerMsg]:!0},Ne={[m.answerDetail]:!0};return F!==w._v$&&y(i,w._v$=F),q!==w._v$2&&y(s,w._v$2=q),H!==w._v$3&&y(a,w._v$3=H),ae!==w._v$4&&y(u,w._v$4=ae),W!==w._v$5&&y(c,w._v$5=W),w._v$6=ve(g,Se,w._v$6),w._v$7=ve(X,Ne,w._v$7),w},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),i})(),n.document.body)}updateUI(){this._renderUI=this.renderUI()}updateAnswer(e,n){this._details.set(e,n)}}class Pt{constructor(e){this._ele=e}setContent(e){this._ele.setAttribute("title",e)}}class Bn extends Ue{constructor(e,n,r){super(e,n),this._choiceMap=r,this._tooltips=_(n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput")).then(i=>Array.from(i)).then(qe).then(U(new Map,(i,[s,o])=>i.set(String.fromCharCode(s+65),new Pt(o)))).t}renderUI(){const e=_(this.details).then(U(new Map,(n,[r,{answer:i,context:s}])=>{var o;if(i!==void 0)for(let l of i){l=this._choiceMap(l);const a=(o=n.get(l))!=null?o:[];return a.push([r,s]),n.set(l,a)}return n})).then(J).t.sort(We);return _(e).then(Be(([n,r])=>{var i;(i=this._tooltips.get(n))==null||i.setContent(At(r.length,this.details.size))})),()=>_(e).then(j(([n,r])=>(()=>{const i=Nt.cloneNode(!0),s=i.firstChild,o=s.firstChild,l=s.nextSibling;return h(o,n),h(l,()=>_(r).then(Q(Ot)).then(j(([a,u])=>(()=>{const c=Ct.cloneNode(!0);return h(c,a),b(()=>y(c,be(u==null?void 0:u.state))),c})())).then(J).t),i})())).then(J).t}}class Wn extends Ue{constructor(e,n){super(e,n),this._tooltips=_(n.querySelectorAll(".item-body .blank-item-dynamic")).then(Array.from).then(qe).then(U(new Map,(r,[i,s])=>r.set(String.fromCharCode(i+49),new Pt(s)))).t}renderUI(){const e=_(this.details).then(U(new Map,(n,[r,{answer:i,context:s}])=>i===void 0?n:_(i).then(Object.entries).then(U(n,(o,[l,a])=>{var f,g;a=a.trim();const u=(f=o.get(l))!=null?f:new Map,c=(g=u.get(a))!=null?g:[];return c.push([r,s]),o.set(l,u.set(a,c))})).t)).then(j(([n,r])=>A(n,_(r).then(Q(We)).t))).then(J).t.sort(We);return _(e).then(Be(([n,r])=>{var s;const i=_(r).then(j(([o,l])=>A(o,l.length))).then(Q(([o,l],[a,u])=>u-l)).then(kn).t;(s=this._tooltips.get(n))==null||s.setContent(i===void 0?"":`(${At(i[1],this.details.size)}) ${i[0]}`)})),()=>_(e).then(j(([n,r])=>(()=>{const i=Nt.cloneNode(!0),s=i.firstChild,o=s.firstChild,l=s.nextSibling;return h(o,`#${n}`),h(l,()=>_(r).then(j(([a,u])=>(()=>{const c=Tn.cloneNode(!0),f=c.firstChild,g=f.nextSibling;return h(f,a),h(g,()=>_(u).then(Q(Ot)).then(j(([N,O])=>(()=>{const X=Ct.cloneNode(!0);return h(X,N),b(()=>y(X,be(O==null?void 0:O.state))),X})())).then(J).t),c})())).then(J).t),i})())).then(J).t}}class Un extends Ue{renderUI(){return()=>_(this.details).then(Q(Et)).then(j(([e,{answer:n,context:r}])=>{var a;const i=n==null?void 0:n.content,s=(a=n==null?void 0:n.attachments)==null?void 0:a.filelist;let o,l;if(i!==void 0&&(o=(()=>{const u=zn.cloneNode(!0);return u.innerHTML=i,b(()=>y(u,m.answerDetailShortAnswer)),u})()),s!==void 0&&(l=(()=>{const u=Ln.cloneNode(!0);return h(u,()=>_(s).then(j(({fileUrl:c,fileName:f})=>(()=>{const g=jn.cloneNode(!0),N=g.firstChild;return ge(N,"href",c),h(N,f),g})())).then(J).t),u})()),!(o===void 0&&l===void 0))return[(()=>{const u=qn.cloneNode(!0),c=u.firstChild;return h(c,e),b(()=>y(u,be(r==null?void 0:r.state))),u})(),o,l]})).then(J).t}}const Fn=S("<div><label></label><input></div>"),Hn=S('<div><form><div><p><i> *\u66F4\u6539\u8BBE\u7F6E\u540E\u8BF7\u5237\u65B0\u9875\u9762 </i></p><button type="submit"> \u63D0\u4EA4 </button></div></form><div><p><strong> \u529F\u80FD\u7279\u6027\uFF1A </strong></p><ul></ul></div></div>'),Vn=S("<li><strong></strong></li>"),Kn=S("<div></div>");function ue(t){const e=xt(He({},t.extra),{name:t.name});return(()=>{const n=Fn.cloneNode(!0),r=n.firstChild,i=r.nextSibling;return h(r,()=>t.title),mn(i,e,!1,!1),b(s=>{const o=m.settingsEntry,l=t.name;return o!==s._v$&&y(n,s._v$=o),l!==s._v$2&&ge(r,"for",s._v$2=l),s},{_v$:void 0,_v$2:void 0}),n})()}function Gn(t){const e={};function n(i){return s=>e[i]=s.currentTarget.value}function r(i){return s=>e[i]=s.currentTarget.checked}return(()=>{const i=Hn.cloneNode(!0),s=i.firstChild,o=s.firstChild,l=o.firstChild,a=s.nextSibling,u=a.firstChild,c=u.nextSibling;return s.addEventListener("submit",f=>{f.preventDefault(),ke.set(e.username),Je.set(e.server),De.set(e.syncAnswers),Te.set(e.sortProblems),ze.set(e.noLeaveCheck),t.onSubmit()}),h(s,V(ue,{name:"username",title:"\u7528\u6237\u540D",get extra(){return{type:"text",pattern:"^[a-z][a-z0-9_]*$",title:"\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF",required:!0,value:ke.get(),onChange:n("username")}}}),o),h(s,V(ue,{name:"server",title:"\u670D\u52A1\u5668",get extra(){return{type:"url",required:!0,value:Je.get(),onChange:n("server")}}}),o),h(s,V(ue,{name:"sync_answers",title:"\u540C\u6B65\u7B54\u6848",get extra(){return{type:"checkbox",checked:De.get(),onChange:r("syncAnswers")}}}),o),h(s,V(ue,{name:"sort_problems",title:"\u6392\u5E8F\u9898\u76EE",get extra(){return{type:"checkbox",checked:Te.get(),onChange:r("sortProblems")}}}),o),h(s,V(ue,{name:"no_leave_check",title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B",get extra(){return{type:"checkbox",checked:ze.get(),onChange:r("noLeaveCheck")}}}),o),h(c,()=>[["\u540C\u6B65\u7B54\u6848\uFF1A","\u70B9\u51FB\u9898\u76EE\u663E\u793A\u8BE6\u7EC6\u7B54\u6848\uFF0C\u5728\u9009\u9879/\u586B\u7A7A\u5904\u60AC\u505C\u663E\u793A\u7B80\u7565\u7B54\u6848"],["\u6392\u5E8F\u9898\u76EE\uFF1A","\u6839\u636E ID \u5BF9\u9898\u76EE\u548C\u9009\u9879\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F"],["\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B\uFF1A","\u968F\u610F\u5207\u6362\u9875\u9762\u3001\u7A97\u53E3\u4E0D\u4F1A\u88AB\u53D1\u73B0"],["\u62E6\u622A\u4E0A\u4F20\u622A\u56FE\uFF1A","\u4EC5\u5F53\u7528\u6237\u786E\u8BA4\u540E\uFF0C\u624D\u4F1A\u4E0A\u4F20\u622A\u56FE"],["\u62E6\u622A\u5F02\u5E38\u72B6\u6001\uFF1A","\u5373\u4F7F\u672C\u5730\u663E\u793A\u5F02\u5E38\u4E5F\u4E0D\u4F1A\u63A8\u9001\u5230\u670D\u52A1\u5668"]].map(([f,g])=>(()=>{const N=Vn.cloneNode(!0),O=N.firstChild;return h(O,f),h(N,g,null),N})())),b(f=>{const g=m.settingsSubmit,N=m.settingsSubmitTip,O=m.about;return g!==f._v$3&&y(o,f._v$3=g),N!==f._v$4&&y(l,f._v$4=N),O!==f._v$5&&y(a,f._v$5=O),f},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),i})()}function Qn(){const t=Ie({title:"\u8BBE\u7F6E",width:400,height:300});re(()=>(()=>{const e=Kn.cloneNode(!0);return h(e,V(Gn,{onSubmit:()=>t.close()})),b(()=>y(e,m.mainBody)),e})(),t.document.body)}const Xn=S("<style></style>"),Yn=S('<div><div><button type="button">\u786E\u8BA4\u4E0A\u4F20</button><span><i>*\u5173\u95ED\u7A97\u53E3\u4EE5\u53D6\u6D88\u4E0A\u4F20</i></span></div><div><img></div></div>');class Zn{constructor(e){re(()=>(()=>{const i=Xn.cloneNode(!0);return i.textContent=ft,i})(),document.head);const n=document.body.querySelector(".header-title");ht(HTMLElement,n),n.classList.add(m.clickable),n.addEventListener("click",()=>Qn());let r=Array.from(document.body.querySelectorAll(".exam-main--body .subject-item"));Me(r.length===e.length,"number subject items mismatches problems"),this._details=_(r).then(xn(e)).then(U(new Map,(i,[s,o])=>{let l;switch(o.ProblemType){case x.SingleChoice:case x.MultipleChoice:case x.Judgement:case x.Polling:dt(o.Options,"null choices");const a=_(o.Options).then(qe).then(U(new Map,(u,[c,{key:f}])=>u.set(f,String.fromCharCode(65+c)))).t;l=new Bn(o.ProblemID,s,u=>{var c;return(c=a.get(u))!=null?c:u});break;case x.FillBlank:l=new Wn(o.ProblemID,s);break;case x.ShortAnswer:l=new Un(o.ProblemID,s);break}return i.set(o.ProblemID,l)})).t}updateAnswer({username:e,problem_id:n,result:r,context:i}){var s;(s=this._details.get(n))==null||s.updateAnswer(e,{answer:r,context:i})}updateUI(){this._details.forEach(e=>e.updateUI())}}function er(t,e){const n=Ie({title:"\u4E0A\u4F20\u56FE\u7247",width:400,height:300});re(()=>(()=>{const r=Yn.cloneNode(!0),i=r.firstChild,s=i.firstChild,o=i.nextSibling,l=o.firstChild;return s.addEventListener("click",()=>{n.close(),e()}),ge(l,"src",t),b(a=>{const u={[m.mainBody]:!0,[m.uploadImg]:!0},c=m.uploadImgConfirm,f=m.uploadImgImage;return a._v$=ve(r,u,a._v$),c!==a._v$2&&y(i,a._v$2=c),f!==a._v$3&&y(o,a._v$3=f),a},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),n.document.body)}function Mt(t){return t.forEach(e=>{switch(e.ProblemType){case x.SingleChoice:case x.MultipleChoice:case x.Polling:{e.Options.sort((r,i)=>r.key<i.key?-1:1);break}}}),t.sort((e,n)=>e.ProblemID-n.ProblemID),t}function tr(t){return Te.get()===!0&&(t.data.has_problem_dict===!0?t.data.problems=t.data.problems.sort((e,n)=>e.id-n.id).map(e=>(e.problems=Mt(e.problems),e)):t.data.problems=Mt(t.data.problems)),t}function nr(){document.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0)}async function rr(){_([1,2,3,4,5,6]).then(Mn(t=>t>2)).then(Be(console.log)),st.clear(),pn(),ze.get()===!0&&nr(),Sn(function(t){switch(t.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(tr(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return e}}})}}),this.addEventListener("load",()=>{const e=JSON.parse(this.responseText);let n=[];e.data.has_problem_dict===!0?e.data.problems.forEach(s=>{n=n.concat(s.problems)}):n=e.data.problems;const r=new Zn(n);z.onmessage(s=>{s.forEach(o=>r.updateAnswer(o)),r.updateUI()});const i=parseInt(t.searchParams.get("exam_id"));z.login(i,{title:e.data.title,problems:n}),fetch(mt("/exam_room/cache_results",{exam_id:i.toString()}).toString()).then(s=>s.json()).then(s=>s.data.results.forEach(({problem_id:o,result:l})=>z.updateAnswer(o,l))).catch(xe)});return;case"/exam_room/answer_problem":return async e=>{var n;if(typeof e=="string"){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:i,result:s})=>z.updateAnswer(i,s)))}return e};default:return t.hostname==="upload-z1.qiniup.com"?async e=>e instanceof FormData&&e.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>er(r.result,()=>n(e)),r.readAsDataURL(e.get("file"))}):e:void 0}}),await z.watch(1e4)}rr().catch(console.error)});
