// ==UserScript==
// @name         yuk-client
// @version      0.1.0
// @match        https://examination.xuetangx.com/exam/*
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.xmlHttpRequest
// @run-at       document-start
// ==/UserScript==

(()=>{"use strict";var e=[,(e,t,r)=>{r.r(t),r.d(t,{Client:()=>u});var n=r(2),o=r(8),i=r(9),s=r(10),a=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};class u{constructor(e,t){this.onmsg=[],this.queue=new Map,this.client=e,this.examId=t}static login(e){return a(this,void 0,void 0,(function*(){const t=new n.JSONRPCClient((e=>a(this,void 0,void 0,(function*(){const r=s.SERVER.value;void 0!==r&&(yield new Promise(((n,i)=>a(this,void 0,void 0,(function*(){yield o.default.xhr({url:r,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),onload:e=>{200===e.status?(t.receive(JSON.parse(e.responseText)),n()):i(new Error(e.statusText))},onerror:e=>i(e.statusText)})})))))}))));return new u(t,e)}))}watch(e){return a(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const n=setInterval((()=>{this.sendQueue().catch((e=>{clearInterval(n),r(e)}))}),e)}))}))}sendQueue(){return a(this,void 0,void 0,(function*(){if(this.queue.size<=0||void 0===s.USERNAME.value||void 0===s.SERVER.value)return;let e=[];for(const{problem_id:t,result:r}of this.queue.values())e.push({username:s.USERNAME.value,problem_id:t,result:r});this.queue.clear(),(0,i.devLog)("send answers",e);const t=yield this.client.request("answer_problem",[this.examId,e]);(0,i.devLog)("receive answers",t),this.onmsg.forEach((e=>e(t)))}))}answerProblem(e){return a(this,void 0,void 0,(function*(){e.forEach((e=>{this.queue.set(e.problem_id,e)}))}))}onmessage(e){this.onmsg.push(e)}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3),t),o(r(4),t),o(r(6),t),o(r(7),t)},function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.JSONRPCClient=void 0;var i=r(4),s=r(5),a=function(){function e(e,t){this._send=e,this.createID=t,this.idToResolveMap=new Map,this.id=0}return e.prototype._createID=function(){return this.createID?this.createID():++this.id},e.prototype.timeout=function(e,t){var r=this;void 0===t&&(t=function(e){return(0,i.createJSONRPCErrorResponse)(e,s.DefaultErrorCode,"Request timeout")});var n=function(n,o){var i=setTimeout((function(){n.forEach((function(e){var n=r.idToResolveMap.get(e);n&&(r.idToResolveMap.delete(e),n(t(e)))}))}),e);return o().then((function(e){return clearTimeout(i),e}),(function(e){return clearTimeout(i),Promise.reject(e)}))};return{request:function(e,t,o){var i=r._createID();return n([i],(function(){return r.requestWithID(e,t,o,i)}))},requestAdvanced:function(e,t){return function(e,t){var o=(Array.isArray(e)?e:[e]).map((function(e){return e.id})).filter(u);return n(o,(function(){return r.requestAdvanced(e,t)}))}(e,t)}}},e.prototype.request=function(e,t,r){return this.requestWithID(e,t,r,this._createID())},e.prototype.requestWithID=function(e,t,r,s){return n(this,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return n={jsonrpc:i.JSONRPC,method:e,params:t,id:s},[4,this.requestAdvanced(n,r)];case 1:return void 0===(a=o.sent()).result||a.error?void 0===a.result&&a.error?[2,Promise.reject(new Error(a.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]:[2,a.result]}}))}))},e.prototype.requestAdvanced=function(e,t){var r=this,n=Array.isArray(e);Array.isArray(e)||(e=[e]);var o=e.filter((function(e){return u(e.id)})),a=o.map((function(e){return new Promise((function(t){return r.idToResolveMap.set(e.id,t)}))})),c=Promise.all(a).then((function(e){return n||!e.length?e:e[0]}));return this.send(n?e:e[0],t).then((function(){return c}),(function(e){return o.forEach((function(t){r.receive((0,i.createJSONRPCErrorResponse)(t.id,s.DefaultErrorCode,e&&e.message||"Failed to send a request"))})),c}))},e.prototype.notify=function(e,t,r){this.send({jsonrpc:i.JSONRPC,method:e,params:t},r).then(void 0,(function(){}))},e.prototype.send=function(e,t){return this._send(e,t)},e.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach((function(t,r){return t((0,i.createJSONRPCErrorResponse)(r,s.DefaultErrorCode,e))})),this.idToResolveMap.clear()},e.prototype.receive=function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach((function(e){var r=t.idToResolveMap.get(e.id);r&&(t.idToResolveMap.delete(e.id),r(e))}))},e}();t.JSONRPCClient=a;var u=function(e){return null!=e}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";t.isJSONRPCID=function(e){return"string"==typeof e||"number"==typeof e||null===e};t.isJSONRPCRequest=function(e){return e.jsonrpc===t.JSONRPC&&void 0!==e.method&&void 0===e.result&&void 0===e.error};t.isJSONRPCRequests=function(e){return Array.isArray(e)&&e.every(t.isJSONRPCRequest)};t.isJSONRPCResponse=function(e){return e.jsonrpc===t.JSONRPC&&void 0!==e.id&&(void 0!==e.result||void 0!==e.error)};t.isJSONRPCResponses=function(e){return Array.isArray(e)&&e.every(t.isJSONRPCResponse)},function(e){e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));t.createJSONRPCErrorResponse=function(e,r,n,o){var i={code:r,message:n};return o&&(i.data=o),{jsonrpc:t.JSONRPC,id:e,error:i}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultErrorCode=void 0,t.DefaultErrorCode=0},function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.JSONRPCServer=void 0;var a=r(4),u=r(5),c=function(e){return(0,a.createJSONRPCErrorResponse)((0,a.isJSONRPCID)(e.id)?e.id:null,a.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},l=function(){function e(e){var t;void 0===e&&(e={}),this.mapErrorToJSONRPCErrorResponse=f,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=null!==(t=e.errorListener)&&void 0!==t?t:console.warn}return e.prototype.addMethod=function(e,t){this.addMethodAdvanced(e,this.toJSONRPCMethod(t))},e.prototype.toJSONRPCMethod=function(e){return function(t,r){var n=e(t.params,r);return Promise.resolve(n).then((function(e){return h(t.id,e)}))}},e.prototype.addMethodAdvanced=function(e,t){var r;this.nameToMethodDictionary=n(n({},this.nameToMethodDictionary),((r={})[e]=t,r))},e.prototype.receiveJSON=function(e,t){var r=this.tryParseRequestJSON(e);return r?this.receive(r,t):Promise.resolve((0,a.createJSONRPCErrorResponse)(null,a.JSONRPCErrorCode.ParseError,"Parse error"))},e.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch(e){return null}},e.prototype.receive=function(e,t){return Array.isArray(e)?this.receiveMultiple(e,t):this.receiveSingle(e,t)},e.prototype.receiveMultiple=function(e,t){return o(this,void 0,void 0,(function(){var r,n=this;return i(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.map((function(e){return n.receiveSingle(e,t)})))];case 1:return 1===(r=o.sent().filter(d)).length?[2,r[0]]:r.length?[2,r]:[2,null]}}))}))},e.prototype.receiveSingle=function(e,t){return o(this,void 0,void 0,(function(){var r,n;return i(this,(function(o){switch(o.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,a.isJSONRPCRequest)(e)?[3,1]:[2,c(e)];case 1:return r?[4,this.callMethod(r,e,t)]:[3,3];case 2:return n=o.sent(),[2,v(e,n)];case 3:return void 0!==e.id?[2,(i=e.id,(0,a.createJSONRPCErrorResponse)(i,a.JSONRPCErrorCode.MethodNotFound,"Method not found"))]:[2,null];case 4:return[2]}var i}))}))},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.middleware?this.middleware=this.combineMiddlewares(s([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},e.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},e.prototype.middlewareReducer=function(e,t){return function(r,n,o){return e((function(e,n){return t(r,e,n)}),n,o)}},e.prototype.callMethod=function(e,t,r){var n=this,o=function(e){return n.errorListener('An unexpected error occurred while executing "'.concat(t.method,'" JSON-RPC method:'),e),Promise.resolve(n.mapErrorToJSONRPCErrorResponseIfNecessary(t.id,e))};try{return(this.middleware||p)((function(t,r){return e(t,r)}),t,r).then(void 0,o)}catch(e){return o(e)}},e.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,t){return void 0!==e?this.mapErrorToJSONRPCErrorResponse(e,t):null},e}();t.JSONRPCServer=l;var d=function(e){return null!==e},p=function(e,t,r){return e(t,r)},h=function(e,t){return void 0!==e?{jsonrpc:a.JSONRPC,id:e,result:void 0===t?null:t}:null},f=function(e,t){return(0,a.createJSONRPCErrorResponse)(e,u.DefaultErrorCode,t&&t.message||"An unexpected error occurred")},v=function(e,t){return t||(void 0!==e.id?(0,a.createJSONRPCErrorResponse)(e.id,a.JSONRPCErrorCode.InternalError,"Internal error"):null)}},function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.JSONRPCServerAndClient=void 0;var i=r(4),s=function(){function e(e,t,r){var n;void 0===r&&(r={}),this.server=e,this.client=t,this.errorListener=null!==(n=r.errorListener)&&void 0!==n?n:console.warn}return e.prototype.applyServerMiddleware=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,t)},e.prototype.addMethod=function(e,t){this.server.addMethod(e,t)},e.prototype.addMethodAdvanced=function(e,t){this.server.addMethodAdvanced(e,t)},e.prototype.timeout=function(e){return this.client.timeout(e)},e.prototype.request=function(e,t,r){return this.client.request(e,t,r)},e.prototype.requestAdvanced=function(e,t){return this.client.requestAdvanced(e,t)},e.prototype.notify=function(e,t,r){this.client.notify(e,t,r)},e.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},e.prototype.receiveAndSend=function(e,t,r){return n(this,void 0,void 0,(function(){var n,s;return o(this,(function(o){switch(o.label){case 0:return(0,i.isJSONRPCResponse)(e)||(0,i.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,i.isJSONRPCRequest)(e)||(0,i.isJSONRPCRequests)(e)?[4,this.server.receive(e,t)]:[3,3];case 2:return(n=o.sent())?[2,this.client.send(n,r)]:[3,4];case 3:return s="Received an invalid JSON-RPC message",this.errorListener(s,e),[2,Promise.reject(new Error(s))];case 4:return[2]}}))}))},e}();t.JSONRPCServerAndClient=s},(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});const n={getValue:async e=>await GM.getValue(e),setValue:async(e,t)=>await GM.setValue(e,t),xhr:async e=>await GM.xmlHttpRequest(e)}},(e,t,r)=>{function n(e,...t){0}r.r(t),r.d(t,{devLog:()=>n})},(e,t,r)=>{r.r(t),r.d(t,{SERVER:()=>u,USERNAME:()=>a});var n=r(8),o=r(9),i=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};class s{constructor(e,t){this.name=e,this.validator=null!=t?t:()=>!0,n.default.getValue(this.name).then((e=>this.value=e)).catch((e=>(0,o.devLog)(e)))}updateValue(){return i(this,void 0,void 0,(function*(){let e,t=yield n.default.getValue(this.name);for(;e=void 0!==t?prompt(`Value of "${this.name}" is "${t}"`):prompt(`Input "${this.name}"`),e=""===e?null:e,null!==e&&!this.validator(e););null!==e&&(yield n.default.setValue(this.name,e),this.value=e)}))}}const a=new s("username",(e=>/[_\w][_\w\d]*/.test(e))),u=new s("server")},(e,t,r)=>{r.r(t),r.d(t,{hookXHR:()=>i,newURL:()=>o});var n=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};function o(e,t){const r=new URL(e,self.location.origin);for(const[e,n]of Object.entries(null!=t?t:{}))r.searchParams.set(e,n);return r}function i(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const n=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(i,s){e.call(this,o(s),new Promise((e=>{const t=this.send;this.send=function(r){e(r),t.apply(this,arguments),this.send=t}}))).then((e=>{t(e),XMLHttpRequest.prototype.open=n})).catch(r),n.apply(this,arguments)}}))}))}},(e,t,r)=>{var n;function o(e){return e===n.SingleChoice||e===n.MultipleChoice||e===n.Polling}r.r(t),r.d(t,{ProblemType:()=>n,isChoice:()=>o}),function(e){e[e.SingleChoice=1]="SingleChoice",e[e.MultipleChoice=2]="MultipleChoice",e[e.Polling=3]="Polling",e[e.FillBlank=4]="FillBlank",e[e.ShortAnswer=5]="ShortAnswer",e[e.Judgement=6]="Judgement"}(n||(n={}))},(e,t,r)=>{r.r(t),r.d(t,{UI:()=>d});var n=r(12),o=r(14),i=r(10);class s extends Map{constructor(e){super(),this.def=e}setWith(e,t){var r;super.set(e,t(null!==(r=super.get(e))&&void 0!==r?r:this.def()))}}function a(e){return`${Math.floor(100*e)}%`}class u{constructor(e){const t=document.createElement("div");t.classList.add(o.default.tooltip),e.after(t),this.tooltip=t;e.addEventListener("mouseover",(()=>this.tooltip.setAttribute("data-show",""))),e.addEventListener("mouseout",(()=>this.tooltip.removeAttribute("data-show"))),this.toggle(!0)}toggle(e){this.tooltip.style.visibility=e?"":"hidden"}set content(e){this.tooltip.textContent=e}}class c{constructor(e,t){this.results=new Map;const r=e.ProblemType,o=new Map;switch(r){case n.ProblemType.SingleChoice:case n.ProblemType.MultipleChoice:case n.ProblemType.Polling:case n.ProblemType.Judgement:t.querySelectorAll(".item-body div ul li").forEach(((t,r)=>{o.set(e.Options[r].key,new u(t))}));break;case n.ProblemType.FillBlank:t.querySelectorAll(".item-body div span input").forEach(((e,t)=>{o.set(`${t+1}`,new u(e))}))}this.type=r,this.options=o}updateResult(e,t){this.results.set(e,t)}updateUI(){switch(this.options.forEach((e=>e.content="")),this.type){case n.ProblemType.SingleChoice:case n.ProblemType.MultipleChoice:case n.ProblemType.Polling:case n.ProblemType.Judgement:const e=new s((()=>0));this.results.forEach((t=>{t.forEach((t=>{e.setWith(t,(e=>e+1))}))})),e.forEach(((e,t)=>{this.options.get(t).content=`[${a(e/this.results.size)}]`}));break;case n.ProblemType.FillBlank:const t=new s((()=>new s((()=>0))));this.results.forEach((e=>{Object.entries(e).forEach((([e,r])=>{t.setWith(e,(e=>(e.setWith(r,(e=>e+1)),e)))}))})),t.forEach(((e,t)=>{const[r,n]=[...e.entries()].sort((([e,t],[r,n])=>t-n)).pop();this.options.get(t).content=`[${a(n/this.results.size)}] ${r}`}))}}}function l(e,t){const r=document.createElement("span");return r.classList.add(o.default.buttonText),r.textContent=e,r.addEventListener("click",t),r}class d{constructor(e){const t=document.querySelector(".header-title");t.appendChild(l("U",(()=>i.USERNAME.updateValue()))),t.appendChild(l("S",(()=>i.SERVER.updateValue())));const r=new Map;document.querySelectorAll(".exam-main--body div .subject-item").forEach(((t,n)=>{const o=e.data.problems[n];r.set(o.problem_id,new c(o,t))})),this.problems=r}updateAnswer({username:e,problem_id:t,result:r}){var n;null===(n=this.problems.get(t))||void 0===n||n.updateResult(e,r)}updateUI(){this.problems.forEach((e=>e.updateUI()))}}},(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var n=r(15),o=r.n(n),i=r(16),s=r.n(i),a=r(17),u=r.n(a),c=r(18),l=r.n(c),d=r(19),p=r.n(d),h=r(20),f=r.n(h),v=r(21),y={};y.styleTagTransform=f(),y.setAttributes=l(),y.insert=u().bind(null,"head"),y.domAPI=s(),y.insertStyleElement=p();o()(v.default,y);const m=v.default&&v.default.locals?v.default.locals:void 0},e=>{var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var i={},s=[],a=0;a<e.length;a++){var u=e[a],c=n.base?u[0]+n.base:u[0],l=i[c]||0,d="".concat(c," ").concat(l);i[c]=l+1;var p=r(d),h={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var f=o(h,n);n.byIndex=a,t.splice(a,0,{identifier:d,updater:f,references:1})}s.push(d)}return s}function o(e,t){var r=t.domAPI(t);r.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,o){var i=n(e=e||[],o=o||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var a=r(i[s]);t[a].references--}for(var u=n(e,o),c=0;c<i.length;c++){var l=r(i[c]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}i=u}}},e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var o=void 0!==r.layer;o&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,o&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var i=r.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},e=>{var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var n=r(22),o=r.n(n),i=r(23),s=r.n(i)()(o());s.push([e.id,".__yuk_xrCwn7VvvG6kgp7rEzuu {\n  position: absolute;\n  visibility: hidden;\n  display: block;\n  z-index: 1;\n  color: rgba(0, 0, 0, 0.15);\n  background-color: white;\n  padding: 0.1rem;\n  border-radius: 0.3rem;\n  font-weight: bold;\n  font-size: 0.3rem;\n  left: 0;\n  bottom: 0;\n}\n\n.__yuk_xrCwn7VvvG6kgp7rEzuu[data-show] {\n  visibility: visible;\n}\n\n.__yuk_Pe8cc3UkSAB5IgoDkaOw {\n  cursor: pointer;\n  margin-left: 0.25rem;\n  text-decoration: underline;\n}\n",""]),s.locals={tooltip:"__yuk_xrCwn7VvvG6kgp7rEzuu",buttonText:"__yuk_Pe8cc3UkSAB5IgoDkaOw"};const a=s},e=>{e.exports=function(e){return e[1]}},e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var a=0;a<this.length;a++){var u=this[a][0];null!=u&&(s[u]=!0)}for(var c=0;c<e.length;c++){var l=[].concat(e[c]);n&&s[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),o&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=o):l[4]="".concat(o)),t.push(l))}},t}}],t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{sortPaper:()=>a});var e=r(1),t=r(11),o=r(12),i=r(13),s=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};function a(e){return e.data.problems.sort(((e,t)=>e.problem_id-t.problem_id)),e.data.problems.forEach((e=>{(0,o.isChoice)(e.ProblemType)&&e.Options.sort(((e,t)=>e.key<t.key?-1:1))})),e}(function(){return s(this,void 0,void 0,(function*(){const{client:r,examId:n,paper:o}=yield function(){return s(this,void 0,void 0,(function*(){return(0,t.hookXHR)((function(t){return new Promise((r=>{"/exam_room/show_paper"===t.pathname&&(this.addEventListener("readystatechange",(()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(a(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get:()=>e}})}})),this.addEventListener("load",(()=>{const n=t.searchParams.get("exam_id");r(e.Client.login(parseInt(n)).then((e=>({client:e,examId:n,paper:JSON.parse(this.responseText)}))))})))}))}))}))}(),u=new i.UI(o);r.onmessage((e=>{e.forEach((e=>u.updateAnswer(e))),u.updateUI()}));const c=yield fetch((0,t.newURL)("/exam_room/cache_results",{exam_id:n}).toString()).then((e=>e.json()));return yield r.answerProblem(c.data.results),new Promise(((e,n)=>s(this,void 0,void 0,(function*(){(0,t.hookXHR)(((e,t)=>s(this,void 0,void 0,(function*(){return new Promise((()=>s(this,void 0,void 0,(function*(){if("/exam_room/answer_problem"===e.pathname){const e=JSON.parse(yield t);yield r.answerProblem(e.results)}}))))})))).catch(n),r.watch(1e4).catch(n)}))))}))})().catch(console.error)})()})();