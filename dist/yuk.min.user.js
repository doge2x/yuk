// ==UserScript==
// @name         yuk-client
// @version      0.7.0
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(h){typeof define=="function"&&define.amd?define(h):h()})(function(){"use strict";var hr=Object.defineProperty,mr=Object.defineProperties;var gr=Object.getOwnPropertyDescriptors;var qt=Object.getOwnPropertySymbols;var _r=Object.prototype.hasOwnProperty,pr=Object.prototype.propertyIsEnumerable;var Ke=(h,C,R)=>C in h?hr(h,C,{enumerable:!0,configurable:!0,writable:!0,value:R}):h[C]=R,jt=(h,C)=>{for(var R in C||(C={}))_r.call(C,R)&&Ke(h,R,C[R]);if(qt)for(var R of qt(C))pr.call(C,R)&&Ke(h,R,C[R]);return h},Bt=(h,C)=>mr(h,gr(C));var x=(h,C,R)=>(Ke(h,typeof C!="symbol"?C+"":C,R),R);var h=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},C={},R={},ee={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";var e=function(l){return typeof l=="string"||typeof l=="number"||l===null};t.isJSONRPCID=e;var n=function(l){return l.jsonrpc===t.JSONRPC&&l.method!==void 0&&l.result===void 0&&l.error===void 0};t.isJSONRPCRequest=n;var r=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCRequest)};t.isJSONRPCRequests=r;var s=function(l){return l.jsonrpc===t.JSONRPC&&l.id!==void 0&&(l.result!==void 0||l.error!==void 0)};t.isJSONRPCResponse=s;var i=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCResponse)};t.isJSONRPCResponses=i,function(l){l[l.ParseError=-32700]="ParseError",l[l.InvalidRequest=-32600]="InvalidRequest",l[l.MethodNotFound=-32601]="MethodNotFound",l[l.InvalidParams=-32602]="InvalidParams",l[l.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));var o=function(l,c,u,a){var f={code:c,message:u};return a&&(f.data=a),{jsonrpc:t.JSONRPC,id:l,error:f}};t.createJSONRPCErrorResponse=o})(ee);var te={};Object.defineProperty(te,"__esModule",{value:!0}),te.DefaultErrorCode=void 0,te.DefaultErrorCode=0;var Wt=h&&h.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Ft=h&&h.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(R,"__esModule",{value:!0}),R.JSONRPCClient=void 0;var ne=ee,Ae=te,Ut=function(){function t(e,n){this._send=e,this.createID=n,this.idToResolveMap=new Map,this.id=0}return t.prototype._createID=function(){return this.createID?this.createID():++this.id},t.prototype.timeout=function(e,n){var r=this;n===void 0&&(n=function(o){return(0,ne.createJSONRPCErrorResponse)(o,Ae.DefaultErrorCode,"Request timeout")});var s=function(o,l){var c=setTimeout(function(){o.forEach(function(u){var a=r.idToResolveMap.get(u);a&&(r.idToResolveMap.delete(u),a(n(u)))})},e);return l().then(function(u){return clearTimeout(c),u},function(u){return clearTimeout(c),Promise.reject(u)})},i=function(o,l){var c=(Array.isArray(o)?o:[o]).map(function(u){return u.id}).filter(Qe);return s(c,function(){return r.requestAdvanced(o,l)})};return{request:function(o,l,c){var u=r._createID();return s([u],function(){return r.requestWithID(o,l,c,u)})},requestAdvanced:function(o,l){return i(o,l)}}},t.prototype.request=function(e,n,r){return this.requestWithID(e,n,r,this._createID())},t.prototype.requestWithID=function(e,n,r,s){return Wt(this,void 0,void 0,function(){var i,o;return Ft(this,function(l){switch(l.label){case 0:return i={jsonrpc:ne.JSONRPC,method:e,params:n,id:s},[4,this.requestAdvanced(i,r)];case 1:return o=l.sent(),o.result!==void 0&&!o.error?[2,o.result]:o.result===void 0&&o.error?[2,Promise.reject(new Error(o.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},t.prototype.requestAdvanced=function(e,n){var r=this,s=Array.isArray(e);Array.isArray(e)||(e=[e]);var i=e.filter(function(c){return Qe(c.id)}),o=i.map(function(c){return new Promise(function(u){return r.idToResolveMap.set(c.id,u)})}),l=Promise.all(o).then(function(c){return s||!c.length?c:c[0]});return this.send(s?e:e[0],n).then(function(){return l},function(c){return i.forEach(function(u){r.receive((0,ne.createJSONRPCErrorResponse)(u.id,Ae.DefaultErrorCode,c&&c.message||"Failed to send a request"))}),l})},t.prototype.notify=function(e,n,r){this.send({jsonrpc:ne.JSONRPC,method:e,params:n},r).then(void 0,function(){})},t.prototype.send=function(e,n){return this._send(e,n)},t.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(n,r){return n((0,ne.createJSONRPCErrorResponse)(r,Ae.DefaultErrorCode,e))}),this.idToResolveMap.clear()},t.prototype.receive=function(e){var n=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var s=n.idToResolveMap.get(r.id);s&&(n.idToResolveMap.delete(r.id),s(r))})},t}();R.JSONRPCClient=Ut;var Qe=function(t){return t!=null},me={},ge=h&&h.__assign||function(){return ge=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},ge.apply(this,arguments)},Xe=h&&h.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},ze=h&&h.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Ht=h&&h.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(me,"__esModule",{value:!0}),me.JSONRPCServer=void 0;var I=ee,Vt=te,Gt=function(){return(0,I.createJSONRPCErrorResponse)(null,I.JSONRPCErrorCode.ParseError,"Parse error")},Kt=function(t){return(0,I.createJSONRPCErrorResponse)((0,I.isJSONRPCID)(t.id)?t.id:null,I.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Qt=function(t){return(0,I.createJSONRPCErrorResponse)(t,I.JSONRPCErrorCode.MethodNotFound,"Method not found")},Xt=function(){function t(e){e===void 0&&(e={});var n;this.mapErrorToJSONRPCErrorResponse=en,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=e.errorListener)!==null&&n!==void 0?n:console.warn}return t.prototype.addMethod=function(e,n){this.addMethodAdvanced(e,this.toJSONRPCMethod(n))},t.prototype.toJSONRPCMethod=function(e){return function(n,r){var s=e(n.params,r);return Promise.resolve(s).then(function(i){return Zt(n.id,i)})}},t.prototype.addMethodAdvanced=function(e,n){var r;this.nameToMethodDictionary=ge(ge({},this.nameToMethodDictionary),(r={},r[e]=n,r))},t.prototype.receiveJSON=function(e,n){var r=this.tryParseRequestJSON(e);return r?this.receive(r,n):Promise.resolve(Gt())},t.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},t.prototype.receive=function(e,n){return Array.isArray(e)?this.receiveMultiple(e,n):this.receiveSingle(e,n)},t.prototype.receiveMultiple=function(e,n){return Xe(this,void 0,void 0,function(){var r,s=this;return ze(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(o){return s.receiveSingle(o,n)}))];case 1:return r=i.sent().filter(zt),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},t.prototype.receiveSingle=function(e,n){return Xe(this,void 0,void 0,function(){var r,s;return ze(this,function(i){switch(i.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,I.isJSONRPCRequest)(e)?[3,1]:[2,Kt(e)];case 1:return r?[4,this.callMethod(r,e,n)]:[3,3];case 2:return s=i.sent(),[2,tn(e,s)];case 3:return e.id!==void 0?[2,Qt(e.id)]:[2,null];case 4:return[2]}})})},t.prototype.applyMiddleware=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Ht([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},t.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},t.prototype.middlewareReducer=function(e,n){return function(r,s,i){return e(function(o,l){return n(r,o,l)},s,i)}},t.prototype.callMethod=function(e,n,r){var s=this,i=function(l,c){return e(l,c)},o=function(l){return s.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),l),Promise.resolve(s.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,l))};try{return(this.middleware||Yt)(i,n,r).then(void 0,o)}catch(l){return o(l)}},t.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,n){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,n):null},t}();me.JSONRPCServer=Xt;var zt=function(t){return t!==null},Yt=function(t,e,n){return t(e,n)},Zt=function(t,e){return t!==void 0?{jsonrpc:I.JSONRPC,id:t,result:e===void 0?null:e}:null},en=function(t,e){return(0,I.createJSONRPCErrorResponse)(t,Vt.DefaultErrorCode,e&&e.message||"An unexpected error occurred")},tn=function(t,e){return e||(t.id!==void 0?(0,I.createJSONRPCErrorResponse)(t.id,I.JSONRPCErrorCode.InternalError,"Internal error"):null)},_e={},nn=h&&h.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},rn=h&&h.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.JSONRPCServerAndClient=void 0;var pe=ee,sn=function(){function t(e,n,r){r===void 0&&(r={});var s;this.server=e,this.client=n,this.errorListener=(s=r.errorListener)!==null&&s!==void 0?s:console.warn}return t.prototype.applyServerMiddleware=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,n)},t.prototype.addMethod=function(e,n){this.server.addMethod(e,n)},t.prototype.addMethodAdvanced=function(e,n){this.server.addMethodAdvanced(e,n)},t.prototype.timeout=function(e){return this.client.timeout(e)},t.prototype.request=function(e,n,r){return this.client.request(e,n,r)},t.prototype.requestAdvanced=function(e,n){return this.client.requestAdvanced(e,n)},t.prototype.notify=function(e,n,r){this.client.notify(e,n,r)},t.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},t.prototype.receiveAndSend=function(e,n,r){return nn(this,void 0,void 0,function(){var s,i;return rn(this,function(o){switch(o.label){case 0:return(0,pe.isJSONRPCResponse)(e)||(0,pe.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,pe.isJSONRPCRequest)(e)||(0,pe.isJSONRPCRequests)(e)?[4,this.server.receive(e,n)]:[3,3];case 2:return s=o.sent(),s?[2,this.client.send(s,r)]:[3,4];case 3:return i="Received an invalid JSON-RPC message",this.errorListener(i,e),[2,Promise.reject(new Error(i))];case 4:return[2]}})})},t}();_e.JSONRPCServerAndClient=sn,function(t){var e=h&&h.__createBinding||(Object.create?function(r,s,i,o){o===void 0&&(o=i),Object.defineProperty(r,o,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]}),n=h&&h.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&e(s,r,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(R,t),n(ee,t),n(me,t),n(_e,t)}(C);const q={};function on(t){q.context=t}const ln=(t,e)=>t===e,un=Symbol("solid-track"),ve={equals:ln};let Ye=rt;const Q={},H=1,we=2,Ze={owned:null,cleanups:null,context:null,owner:null};var O=null;let re=null,N=null,ie=null,A=null,D=null,Me=0;function se(t,e){const n=N,r=O,s=t.length===0?Ze:{owned:null,cleanups:null,context:null,owner:e||r};O=s,N=null;try{return ke(()=>t(()=>Ie(s)),!0)}finally{N=n,O=r}}function et(t,e){e=e?Object.assign({},ve,e):ve;const n={value:t,observers:null,observerSlots:null,pending:Q,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.pending!==Q?n.pending:n.value)),Pe(n,s));return[nt.bind(n),r]}function E(t,e,n){const r=xe(t,e,!1,H);le(r)}function tt(t,e,n){Ye=hn;const r=xe(t,e,!1,H);r.user=!0,D?D.push(r):le(r)}function oe(t,e,n){n=n?Object.assign({},ve,n):ve;const r=xe(t,e,!0,0);return r.pending=Q,r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,le(r),nt.bind(r)}function an(t){if(ie)return t();let e;const n=ie=[];try{e=t()}finally{ie=null}return ke(()=>{for(let r=0;r<n.length;r+=1){const s=n[r];if(s.pending!==Q){const i=s.pending;s.pending=Q,Pe(s,i)}}},!1),e}function ye(t){let e,n=N;return N=null,e=t(),N=n,e}function cn(t){return O===null||(O.cleanups===null?O.cleanups=[t]:O.cleanups.push(t)),t}function nt(){const t=re;if(this.sources&&(this.state||t)){const e=A;A=null,this.state===H||t?le(this):be(this),A=e}if(N){const e=this.observers?this.observers.length:0;N.sources?(N.sources.push(this),N.sourceSlots.push(e)):(N.sources=[this],N.sourceSlots=[e]),this.observers?(this.observers.push(N),this.observerSlots.push(N.sources.length-1)):(this.observers=[N],this.observerSlots=[N.sources.length-1])}return this.value}function Pe(t,e,n){if(ie)return t.pending===Q&&ie.push(t),t.pending=e,e;if(t.comparator&&t.comparator(t.value,e))return e;let r=!1;return t.value=e,t.observers&&t.observers.length&&ke(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s];r&&re.disposed.has(i),(r&&!i.tState||!r&&!i.state)&&(i.pure?A.push(i):D.push(i),i.observers&&it(i)),r||(i.state=H)}if(A.length>1e6)throw A=[],new Error},!1),e}function le(t){if(!t.fn)return;Ie(t);const e=O,n=N,r=Me;N=O=t,fn(t,t.value,r),N=n,O=e}function fn(t,e,n){let r;try{r=t.fn(e)}catch(s){st(s)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?Pe(t,r):t.value=r,t.updatedAt=n)}function xe(t,e,n,r=H,s){const i={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:O,context:null,pure:n};return O===null||O!==Ze&&(O.owned?O.owned.push(i):O.owned=[i]),i}function ue(t){const e=re;if(t.state===0||e)return;if(t.state===we||e)return be(t);if(t.suspense&&ye(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Me);)(t.state||e)&&n.push(t);for(let r=n.length-1;r>=0;r--)if(t=n[r],t.state===H||e)le(t);else if(t.state===we||e){const s=A;A=null,be(t,n[0]),A=s}}function ke(t,e){if(A)return t();let n=!1;e||(A=[]),D?n=!0:D=[],Me++;try{const r=t();return dn(n),r}catch(r){st(r)}finally{A=null,n||(D=null)}}function dn(t){A&&(rt(A),A=null),!t&&(D.length?an(()=>{Ye(D),D=null}):D=null)}function rt(t){for(let e=0;e<t.length;e++)ue(t[e])}function hn(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:ue(s)}q.context&&on();const r=t.length;for(e=0;e<n;e++)ue(t[e]);for(e=r;e<t.length;e++)ue(t[e])}function be(t,e){const n=re;t.state=0;for(let r=0;r<t.sources.length;r+=1){const s=t.sources[r];s.sources&&(s.state===H||n?s!==e&&ue(s):(s.state===we||n)&&be(s,e))}}function it(t){const e=re;for(let n=0;n<t.observers.length;n+=1){const r=t.observers[n];(!r.state||e)&&(r.state=we,r.pure?A.push(r):D.push(r),r.observers&&it(r))}}function Ie(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),o=n.observerSlots.pop();r<s.length&&(i.sourceSlots[o]=r,s[r]=i,n.observerSlots[r]=o)}}if(t.owned){for(e=0;e<t.owned.length;e++)Ie(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function st(t){throw t}const mn=Symbol("fallback");function ot(t){for(let e=0;e<t.length;e++)t[e]()}function gn(t,e,n={}){let r=[],s=[],i=[],o=0,l=e.length>1?[]:null;return cn(()=>ot(i)),()=>{let c=t()||[],u,a;return c[un],ye(()=>{let d=c.length,m,_,M,L,K,k,P,g,S;if(d===0)o!==0&&(ot(i),i=[],r=[],s=[],o=0,l&&(l=[])),n.fallback&&(r=[mn],s[0]=se(B=>(i[0]=B,n.fallback())),o=1);else if(o===0){for(s=new Array(d),a=0;a<d;a++)r[a]=c[a],s[a]=se(f);o=d}else{for(M=new Array(d),L=new Array(d),l&&(K=new Array(d)),k=0,P=Math.min(o,d);k<P&&r[k]===c[k];k++);for(P=o-1,g=d-1;P>=k&&g>=k&&r[P]===c[g];P--,g--)M[g]=s[P],L[g]=i[P],l&&(K[g]=l[P]);for(m=new Map,_=new Array(g+1),a=g;a>=k;a--)S=c[a],u=m.get(S),_[a]=u===void 0?-1:u,m.set(S,a);for(u=k;u<=P;u++)S=r[u],a=m.get(S),a!==void 0&&a!==-1?(M[a]=s[u],L[a]=i[u],l&&(K[a]=l[u]),a=_[a],m.set(S,a)):i[u]();for(a=k;a<d;a++)a in M?(s[a]=M[a],i[a]=L[a],l&&(l[a]=K[a],l[a](a))):s[a]=se(f);s=s.slice(0,o=d),r=c.slice(0)}return s});function f(d){if(i[a]=d,l){const[m,_]=et(a);return l[a]=_,e(c[a],m)}return e(c[a])}}}function b(t,e){return ye(()=>t(e||{}))}function V(t){const e="fallback"in t&&{fallback:()=>t.fallback};return oe(gn(()=>t.each,t.children,e||void 0))}function Se(t){let e=!1;const n=oe(()=>t.when,void 0,{equals:(r,s)=>e?r===s:!r==!s});return oe(()=>{const r=n();if(r){const s=t.children;return(e=typeof s=="function"&&s.length>0)?ye(()=>s(r)):s}return t.fallback})}const _n=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],pn=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",..._n]),vn=new Set(["innerHTML","textContent","innerText","children"]),wn={className:"class",htmlFor:"for"},lt={class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"},yn=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),bn={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function Sn(t,e,n){let r=n.length,s=e.length,i=r,o=0,l=0,c=e[s-1].nextSibling,u=null;for(;o<s||l<i;){if(e[o]===n[l]){o++,l++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===o){const a=i<r?l?n[l-1].nextSibling:n[i-l]:c;for(;l<i;)t.insertBefore(n[l++],a)}else if(i===l)for(;o<s;)(!u||!u.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[i-1]&&n[l]===e[s-1]){const a=e[--s].nextSibling;t.insertBefore(n[l++],e[o++].nextSibling),t.insertBefore(n[--i],a),e[s]=n[i]}else{if(!u){u=new Map;let f=l;for(;f<i;)u.set(n[f],f++)}const a=u.get(e[o]);if(a!=null)if(l<a&&a<i){let f=o,d=1,m;for(;++f<s&&f<i&&!((m=u.get(e[f]))==null||m!==a+d);)d++;if(d>a-l){const _=e[o];for(;l<a;)t.insertBefore(n[l++],_)}else t.replaceChild(n[l++],e[o++])}else o++;else e[o++].remove()}}}const ut="_$DX_DELEGATE";function ae(t,e,n){let r;return se(s=>{r=s,e===document?t():p(e,t(),e.firstChild?null:void 0,n)}),()=>{r(),e.textContent=""}}function $(t,e,n){const r=document.createElement("template");r.innerHTML=t;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function Cn(t,e=window.document){const n=e[ut]||(e[ut]=new Set);for(let r=0,s=t.length;r<s;r++){const i=t[r];n.has(i)||(n.add(i),e.addEventListener(i,Mn))}}function Ce(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function Nn(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function y(t,e){e==null?t.removeAttribute("class"):t.className=e}function $n(t,e,n,r){r?Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n:Array.isArray(n)?t.addEventListener(e,s=>n[0](n[1],s)):t.addEventListener(e,n)}function at(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let i,o;for(i=0,o=s.length;i<o;i++){const l=s[i];!l||l==="undefined"||e[l]||(ct(t,l,!1),delete n[l])}for(i=0,o=r.length;i<o;i++){const l=r[i],c=!!e[l];!l||l==="undefined"||n[l]===c||!c||(ct(t,l,!0),n[l]=c)}return n}function Rn(t,e,n={}){const r=t.style,s=typeof n=="string";if(e==null&&s||typeof e=="string")return r.cssText=e;s&&(r.cssText=void 0,n={}),e||(e={});let i,o;for(o in n)e[o]==null&&r.removeProperty(o),delete n[o];for(o in e)i=e[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function En(t,e,n,r){typeof e=="function"?E(s=>dt(t,e(),s,n,r)):dt(t,e,void 0,n,r)}function p(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return X(t,e,r,n);E(s=>X(t,e(),s,n),r)}function On(t,e,n,r,s={},i=!1){e||(e={});for(const o in s)if(!(o in e)){if(o==="children")continue;ft(t,o,null,s[o],n,i)}for(const o in e){if(o==="children"){r||X(t,e.children);continue}const l=e[o];s[o]=ft(t,o,l,s[o],n,i)}}function An(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function ct(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,i=r.length;s<i;s++)t.classList.toggle(r[s],n)}function ft(t,e,n,r,s,i){let o,l,c;if(e==="style")return Rn(t,n,r);if(e==="classList")return at(t,n,r);if(n===r)return r;if(e==="ref")i||n(t);else if(e.slice(0,3)==="on:")t.addEventListener(e.slice(3),n);else if(e.slice(0,10)==="oncapture:")t.addEventListener(e.slice(10),n,!0);else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),a=yn.has(u);$n(t,u,n,a),a&&Cn([u])}else if((c=vn.has(e))||!s&&(lt[e]||(l=pn.has(e)))||(o=t.nodeName.includes("-")))e==="class"||e==="className"?y(t,n):o&&!l&&!c?t[An(e)]=n:t[lt[e]||e]=n;else{const u=s&&e.indexOf(":")>-1&&bn[e.split(":")[0]];u?Nn(t,u,e,n):Ce(t,wn[e]||e,n)}return n}function Mn(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}}),q.registry&&!q.done&&(q.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[e];if(r&&!n.disabled){const s=n[`${e}Data`];if(s!==void 0?r(s,t):r(t),t.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function dt(t,e,n={},r,s){return e||(e={}),!s&&"children"in e&&E(()=>n.children=X(t,e.children,n.children)),e.ref&&e.ref(t),E(()=>On(t,e,r,!0,n,!0)),n}function X(t,e,n,r,s){for(q.context&&!n&&(n=[...t.childNodes]);typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,o=r!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(q.context)return n;if(i==="number"&&(e=e.toString()),o){let l=n[0];l&&l.nodeType===3?l.data=e:l=document.createTextNode(e),n=z(t,n,r,l)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean"){if(q.context)return n;n=z(t,n,r)}else{if(i==="function")return E(()=>{let l=e();for(;typeof l=="function";)l=l();n=X(t,l,n,r)}),()=>n;if(Array.isArray(e)){const l=[];if(Je(l,e,s))return E(()=>n=X(t,l,n,r,!0)),()=>n;if(q.context){for(let c=0;c<l.length;c++)if(l[c].parentNode)return n=l}if(l.length===0){if(n=z(t,n,r),o)return n}else Array.isArray(n)?n.length===0?ht(t,l,r):Sn(t,n,l):(n&&z(t),ht(t,l));n=l}else if(e instanceof Node){if(q.context&&e.parentNode)return n=o?[e]:e;if(Array.isArray(n)){if(o)return n=z(t,n,r,e);z(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Je(t,e,n){let r=!1;for(let s=0,i=e.length;s<i;s++){let o=e[s],l;if(o instanceof Node)t.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))r=Je(t,o)||r;else if((l=typeof o)=="string")t.push(document.createTextNode(o));else if(l==="function")if(n){for(;typeof o=="function";)o=o();r=Je(t,Array.isArray(o)?o:[o])||r}else t.push(o),r=!0;else t.push(document.createTextNode(o.toString()))}return r}function ht(t,e,n){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function z(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;o>=0;o--){const l=e[o];if(s!==l){const c=l.parentNode===t;!i&&!o?c?t.replaceChild(s,l):t.insertBefore(s,n):c&&l.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}function mt(t){if(t!==null)return t}function Ne(t){return function(e){if(e===void 0)throw new Error(t!=null?t:"expect some value");return e}}function gt(t){return function(e){return e!==void 0?t(e):void 0}}function _t(t){return function(e){return e!==void 0||t!==void 0?[e,t]:void 0}}function pt(t){return function*(e){for(const n of e)yield t(n)}}function*vt(t){let e=0;for(const n of t)yield[e++,n]}function Pn(t){return function*(e){for(const n of e)t(n)&&(yield n)}}function wt(t){return function*(e){for(const n of e){const r=t(n);r!==void 0&&(yield r)}}}function xn(t){return function*(e){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();for(;;){const s=n.next(),i=r.next();if(s.done!==!0&&i.done!==!0)yield[s.value,i.value];else return}}}function Y(t){return function(e){return Array.from(e).sort(t)}}function kn(t){for(const e of t)return e}function G(t,e){return function(n){let r=t;for(const s of n)r=e(r,s);return r}}function In(t){let e=0;for(const n of t)e++;return e}function Z(t){return Array.from(t)}function yt(t){return function(e){for(const n of e)t(n)}}class De{constructor(e){x(this,"t");this.t=e}static from(e){return new De(e)}static unwrap(e){return e.t}}class $e{constructor(e){x(this,"_init");x(this,"_t");this._init=e}static from(e){return new $e(e)}force(){return this._t===void 0&&(this._t=De.from(this._init())),this._t.t}}class w{constructor(e){x(this,"_t");this._t=e}then(e){return new w(e(this._t))}static from(e){return new w(e)}unwrap(){return this._t}}var bt=`._mainBody_bsm4g_1{opacity:.5}._mainBody_bsm4g_1 *{font-size:.75rem;margin:0}._mainBody_bsm4g_1 button,._clickable_bsm4g_11{cursor:pointer}._stateWorkingOn_bsm4g_14{color:#00f}._stateSure_bsm4g_17{color:green}._stateNotSure_bsm4g_20{color:red}._answerMsg_bsm4g_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_bsm4g_23 ul{padding-left:1rem}._answerMsgName_bsm4g_32{font-weight:700}._answerMark_bsm4g_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_bsm4g_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_bsm4g_35 input{height:max-content;width:100%}._answerDetail_bsm4g_53 ._stateWorkingOn_bsm4g_14,._answerDetail_bsm4g_53 ._stateSure_bsm4g_17,._answerDetail_bsm4g_53 ._stateNotSure_bsm4g_20{font-weight:700}._answerDetail_bsm4g_53 ul{padding-left:1.5rem}._answerDetail_bsm4g_53 ul ul{padding-left:1rem}._answerDetail_bsm4g_53 img{height:auto;width:80%}._answerDetailShortAnswer_bsm4g_68{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem;min-width:min-content}._answerDetailFill_bsm4g_75{white-space:pre}._settings_bsm4g_78{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_bsm4g_86{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_bsm4g_86 label{font-weight:700}._settingsEntry_bsm4g_86 input{height:max-content;text-align:right}._settingsSubmit_bsm4g_100{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_bsm4g_106{margin-right:.5rem}._about_bsm4g_109 p{margin-bottom:.25rem}._about_bsm4g_109 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_bsm4g_109 ul li{margin-bottom:.25rem}._uploadImg_bsm4g_119{display:flex;flex-direction:column}._uploadImg_bsm4g_119 img{width:100%;height:auto}._uploadImgImage_bsm4g_127{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_bsm4g_132{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`;const Jn=$("<title> </title>"),Dn=$("<style></style>");function St(t,e,n){Ct(e instanceof t,n!=null?n:"not HTMLElement")}function Ct(t,e){if(t!==!0)throw Error(e!=null?e:"assertion failed")}function F(...t){return t}function Te(t){const e=w.from(window.open("","",Object.entries(t).map(([r,s])=>`${r}=${s}`).join(","))).then(mt).then(Ne("cannot open windows")).unwrap(),n=()=>e.close();return window.addEventListener("unload",n),e.addEventListener("close",()=>window.removeEventListener("unload",n)),ae(()=>[(()=>{const r=Jn.cloneNode(!0),s=r.firstChild;return E(()=>s.data=t.title),r})(),(()=>{const r=Dn.cloneNode(!0);return r.textContent=bt,r})()],e.document.head),e}function Le(t,...e){}function Nt(t,e){const n=new URL(t,self.location.origin);for(const[r,s]of Object.entries(e!=null?e:{}))n.searchParams.set(r,s);return n}function $t(t){const e=GM_getValue(t);if(e!==void 0)return e.contents}function ce(t,e){return GM_setValue(t,{contents:e}),e}function Tn(){var n;const t=[{name:"202205231915_gm_value",up(){ce("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const r of["username","server","sync_answers","sort_problems"])ce(r,GM_getValue(r))}}],e=(n=$t("migrations"))!=null?n:[];for(const{name:r,idx:s}of e)if(r!==t[s].name)throw new Error("bad migrations");for(const{name:r,up:s}of t.slice(e.length))s();ce("migrations",t.map((r,s)=>({name:r.name,idx:s})))}class fe{constructor(e,n){x(this,"_name");x(this,"_t");this._name=e,this._t=$e.from(()=>{const r=$t(this._name);return r===void 0&&n!==void 0?ce(this._name,n):r})}get(){return this._t.force()}set(e){e!==void 0&&(ce(this._name,e),this._t=$e.from(()=>e))}}const qe=new fe("username"),je=new fe("server"),Be=new fe("sync_answers",!0),We=new fe("sort_problems",!1),Fe=new fe("no_leave_check",!0);class Ln{constructor(){x(this,"token");x(this,"client");x(this,"examId");x(this,"paper");x(this,"queue",new Map);x(this,"onmsg",[])}onmessage(e){this.onmsg.push(e)}updateQueue(e,n){let r=this.queue.get(e);r!==void 0?n(r):(r={},n(r),this.queue.set(e,r))}updateAnswer(e,n){this.updateQueue(e,r=>r.result=n)}updateState(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.state=n})}updateMsg(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.msg=n})}async watch(e){return new Promise((n,r)=>{const s=setInterval(()=>{this.sendQueue().catch(i=>{clearInterval(s),alert("\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5F02\u5E38"),r(i)})},e)})}async login(e,n){this.examId=e,this.paper=n}async sendQueue(){const e=Be.get(),n=je.get(),r=qe.get();if(e!==!0||this.queue.size<1||n===void 0||r===void 0||this.examId===void 0||this.paper===void 0)return;const s=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const o=new C.JSONRPCClient(l=>new Promise((c,u)=>{GM.xmlHttpRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(l),onload:a=>{a.status===200?(o.receive(w.from(a.responseText).then(Ne("empty response")).then(JSON.parse).unwrap()),c()):u(new Error(a.statusText))},onerror:a=>u(a.statusText)})}));this.client=o}if(this.token===void 0){Le(`login to server: ${r}, ${this.examId}`);const o=await this.client.request("login",[r,this.examId,this.paper]);this.token=o}const i=await this.client.request("answer_problem",[this.token,s.map(([o,{result:l,context:c}])=>({problem_id:o,result:l,context:c}))]);this.onmsg.forEach(o=>o(i))}}const j=new Ln;function qn(t){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const s=t.call(this,Nt(r)),i=this.send;this.send=function(o){s!==void 0?s(o).then(l=>{i.call(this,l),this.send=i}).catch(Le):(i.call(this,o),this.send=i)},e.apply(this,arguments)}}var J=(t=>(t[t.SingleChoice=1]="SingleChoice",t[t.MultipleChoice=2]="MultipleChoice",t[t.Polling=3]="Polling",t[t.FillBlank=4]="FillBlank",t[t.ShortAnswer=5]="ShortAnswer",t[t.Judgement=6]="Judgement",t))(J||{}),T=(t=>(t[t.WorkingOn=0]="WorkingOn",t[t.Sure=1]="Sure",t[t.NotSure=2]="NotSure",t))(T||{}),v={mainBody:"_mainBody_bsm4g_1",clickable:"_clickable_bsm4g_11",stateWorkingOn:"_stateWorkingOn_bsm4g_14",stateSure:"_stateSure_bsm4g_17",stateNotSure:"_stateNotSure_bsm4g_20",answerMsg:"_answerMsg_bsm4g_23",answerMsgName:"_answerMsgName_bsm4g_32",answerMark:"_answerMark_bsm4g_35",answerDetail:"_answerDetail_bsm4g_53",answerDetailShortAnswer:"_answerDetailShortAnswer_bsm4g_68",answerDetailFill:"_answerDetailFill_bsm4g_75",settings:"_settings_bsm4g_78",settingsEntry:"_settingsEntry_bsm4g_86",settingsSubmit:"_settingsSubmit_bsm4g_100",settingsSubmitTip:"_settingsSubmitTip_bsm4g_106",about:"_about_bsm4g_109",uploadImg:"_uploadImg_bsm4g_119",uploadImgImage:"_uploadImgImage_bsm4g_127",uploadImgConfirm:"_uploadImgConfirm_bsm4g_132"};const jn=$('<div><fieldset><legend>\u6807\u8BB0</legend><input type="text" placeholder="\u7559\u8A00"><button type="button">\u6211\u6B63\u5728\u505A</button><button type="button">\u6211\u5F88\u786E\u5B9A</button><button type="button">\u6211\u4E0D\u786E\u5B9A</button></fieldset><div><div></div></div></div>'),Bn=$("<fieldset><legend> \u7559\u8A00 </legend><ul></ul></fieldset>"),Wn=$("<li><span></span></li>"),Rt=$("<ul></ul>"),Fn=$("<li></li>"),Un=$("<div><p><strong></strong></p></div>"),Hn=$("<div><p><strong></strong></p><ul></ul></div>"),Vn=$("<li><p></p></li>"),Gn=$("<p><strong></strong></p>"),Kn=$("<pre></pre>"),Qn=$("<li><a></a></li>");function Ue(t,e){return t===e?0:t<e?-1:1}function Et(t){switch(t){case T.Sure:return 0;case T.WorkingOn:return 1;case T.NotSure:return 2}}function Ot([t,e],[n,r]){if(e===void 0)return r===void 0?Ue(t,n):1;if(r===void 0)return-1;{const s=Et(r)-Et(e);return s===0?Ue(t,n):s}}function At([t,e],[n,r]){var s,i;return Ot(F(t,(s=e.context)==null?void 0:s.state),F(n,(i=r.context)==null?void 0:i.state))}function Xn([t,e],[n,r]){return Ot(F(t,e==null?void 0:e.state),F(n,r==null?void 0:r.state))}function He(t){if(t!==void 0)switch(t){case T.WorkingOn:return v.stateWorkingOn;case T.NotSure:return v.stateNotSure;case T.Sure:return v.stateSure}}function Mt(t,e){return`${Math.floor(t*100/e)}%`}function Ve([t],[e]){return Ue(t,e)}class Ge{constructor(e,n,r){x(this,"_details",new Map);this.updateUI=se(()=>{const[s,i]=et(new Map,{equals:!1}),o=()=>i(this._details),l=r(s),c=n.querySelector(".item-type");return St(HTMLElement,c),c.classList.add(v.clickable),c.addEventListener("click",()=>{const u=c==null?void 0:c.getBoundingClientRect(),a=Te({title:"\u8BE6\u7EC6\u7B54\u6848",height:300,width:350,top:u==null?void 0:u.top,left:u==null?void 0:u.left});ae(()=>(()=>{const f=jn.cloneNode(!0),d=f.firstChild,m=d.firstChild,_=m.nextSibling,M=_.nextSibling,L=M.nextSibling,K=L.nextSibling,k=d.nextSibling,P=k.firstChild;return _.addEventListener("change",g=>j.updateMsg(e,g.currentTarget.value)),M.addEventListener("click",()=>j.updateState(e,T.WorkingOn)),L.addEventListener("click",()=>j.updateState(e,T.Sure)),K.addEventListener("click",()=>j.updateState(e,T.NotSure)),p(k,()=>w.from(s()).then(Y(At)).then(wt(([g,{context:S}])=>w.from(S==null?void 0:S.state).then(_t(S==null?void 0:S.msg)).then(gt(([B,W])=>{const U=B===T.WorkingOn?W!=null?W:"\u6211\u6B63\u5728\u505A":W;return U===void 0||U===""?void 0:F(g,B,U)})).unwrap())).then(Z).then(g=>b(Se,{get when(){return g.length>0},get children(){return(()=>{const S=Bn.cloneNode(!0),B=S.firstChild,W=B.nextSibling;return p(W,b(V,{each:g,children:([U,Re,Ee])=>(()=>{const Oe=Wn.cloneNode(!0),Dt=Oe.firstChild;return p(Dt,`${U}: `),p(Oe,Ee,null),E(he=>{const Tt=He(Re),Lt=v.answerMsgName;return Tt!==he._v$7&&y(Oe,he._v$7=Tt),Lt!==he._v$8&&y(Dt,he._v$8=Lt),he},{_v$7:void 0,_v$8:void 0}),Oe})()})),E(()=>y(S,v.answerMsg)),S})()}})).unwrap(),P),p(P,b(l,{})),E(g=>{const S=v.mainBody,B=v.answerMark,W=v.stateWorkingOn,U=v.stateSure,Re=v.stateNotSure,Ee=v.answerDetail;return S!==g._v$&&y(f,g._v$=S),B!==g._v$2&&y(d,g._v$2=B),W!==g._v$3&&y(M,g._v$3=W),U!==g._v$4&&y(L,g._v$4=U),Re!==g._v$5&&y(K,g._v$5=Re),Ee!==g._v$6&&y(P,g._v$6=Ee),g},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),f})(),a.document.body)}),o})}updateAnswer(e,n){this._details.set(e,n)}}class Pt{constructor(e){this._ele=e}setContent(e){this._ele.setAttribute("title",e)}}function xt(t){t.forEach(e=>e.setContent(""))}function kt(t){return w.from(t).then(Pn(([,e])=>e.answer!==void 0)).then(In).unwrap()}function It({children:t}){return(()=>{const e=Rt.cloneNode(!0);return p(e,b(V,{get each(){return t.sort(Xn)},children:([n,r])=>(()=>{const s=Fn.cloneNode(!0);return p(s,n),E(()=>y(s,He(r==null?void 0:r.state))),s})()})),e})()}class zn extends Ge{constructor(e,n,r,s){const i=w.from(n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput")).then(o=>Array.from(o).entries()).then(G(new Map,(o,[l,c])=>o.set(r(l),new Pt(c)))).unwrap();super(e,n,o=>{const l=oe(()=>w.from(o()).then(G(new Map,(c,[u,{answer:a,context:f}])=>{var d;if(a!==void 0)for(let m of a){m=s(m);const _=(d=c.get(m))!=null?d:[];_.push([u,f]),c.set(m,_)}return c})).then(Y(Ve)).then(Z).unwrap());return tt(()=>{const c=kt(o());xt(i),w.from(l()).then(yt(([u,a])=>{var f;(f=i.get(u))==null||f.setContent(Mt(a.length,c))})).unwrap()}),()=>b(V,{get each(){return l()},children:([c,u])=>(()=>{const a=Un.cloneNode(!0),f=a.firstChild,d=f.firstChild;return p(d,c),p(a,b(It,{children:u}),null),a})()})})}}class Yn extends Ge{constructor(e,n){const r=w.from(n.querySelectorAll(".item-body .blank-item-dynamic")).then(Array.from).then(vt).then(G(new Map,(s,[i,o])=>s.set(String.fromCharCode(i+49),new Pt(o)))).unwrap();super(e,n,s=>{const i=()=>w.from(s()).then(G(new Map,(o,[l,{answer:c,context:u}])=>c===void 0?o:w.from(c).then(Object.entries).then(G(o,(a,[f,d])=>{var M,L;d=d.trim();const m=(M=a.get(f))!=null?M:new Map,_=(L=m.get(d))!=null?L:[];return _.push([l,u]),a.set(f,m.set(d,_))})).unwrap())).then(pt(([o,l])=>F(o,w.from(l).then(Y(Ve)).then(Z).unwrap()))).then(Y(Ve)).then(Z).unwrap();return tt(()=>{const o=kt(s());xt(r),w.from(i()).then(yt(([l,c])=>{var a;const u=w.from(c).then(pt(([f,d])=>F(f,d.length))).then(Y(([,f],[,d])=>d-f)).then(kn).unwrap();(a=r.get(l))==null||a.setContent(u===void 0?"":`(${Mt(u[1],o)}) ${u[0]}`)})).unwrap()}),()=>b(V,{get each(){return i()},children:([o,l])=>(()=>{const c=Hn.cloneNode(!0),u=c.firstChild,a=u.firstChild,f=u.nextSibling;return p(a,`#${o}`),p(f,b(V,{each:l,children:([d,m])=>b(Se,{when:d!=="",get children(){const _=Vn.cloneNode(!0),M=_.firstChild;return p(M,d),p(_,b(It,{children:m}),null),E(()=>y(M,v.answerDetailFill)),_}})})),c})()})})}}class Zn extends Ge{constructor(e,n){super(e,n,r=>{const s=oe(()=>w.from(r()).then(Y(At)).then(Z).unwrap());return()=>b(V,{get each(){return w.from(s()).then(wt(([i,{answer:o,context:l}])=>{var c;return w.from(o==null?void 0:o.content).then(_t((c=o==null?void 0:o.attachments)==null?void 0:c.filelist)).then(gt(([u,a])=>F(i,u,a,l==null?void 0:l.state))).unwrap()})).then(Z).unwrap()},children:([i,o,l,c])=>[(()=>{const u=Gn.cloneNode(!0),a=u.firstChild;return p(a,i),E(()=>y(u,He(c))),u})(),b(Se,{when:o,children:u=>(()=>{const a=Kn.cloneNode(!0);return a.innerHTML=u,E(()=>y(a,v.answerDetailShortAnswer)),a})()}),b(Se,{when:l,children:u=>(()=>{const a=Rt.cloneNode(!0);return p(a,b(V,{each:u,children:({fileUrl:f,fileName:d})=>(()=>{const m=Qn.cloneNode(!0),_=m.firstChild;return Ce(_,"href",f),p(_,d),m})()})),a})()})]})})}}const er=$("<div><label></label><input></div>"),tr=$('<div><form><div><p><i> *\u66F4\u6539\u8BBE\u7F6E\u540E\u8BF7\u5237\u65B0\u9875\u9762 </i></p><button type="submit"> \u63D0\u4EA4 </button></div></form><div><p><strong> \u529F\u80FD\u7279\u6027\uFF1A </strong></p><ul></ul></div></div>'),nr=$("<li><strong></strong></li>"),rr=$("<div></div>");function de(t){const e=Bt(jt({},t.extra),{name:t.name});return(()=>{const n=er.cloneNode(!0),r=n.firstChild,s=r.nextSibling;return p(r,()=>t.title),En(s,e,!1,!1),E(i=>{const o=v.settingsEntry,l=t.name;return o!==i._v$&&y(n,i._v$=o),l!==i._v$2&&Ce(r,"for",i._v$2=l),i},{_v$:void 0,_v$2:void 0}),n})()}function ir(t){const e={};function n(s){return i=>e[s]=i.currentTarget.value}function r(s){return i=>e[s]=i.currentTarget.checked}return(()=>{const s=tr.cloneNode(!0),i=s.firstChild,o=i.firstChild,l=o.firstChild,c=i.nextSibling,u=c.firstChild,a=u.nextSibling;return i.addEventListener("submit",f=>{f.preventDefault(),qe.set(e.username),je.set(e.server),Be.set(e.syncAnswers),We.set(e.sortProblems),Fe.set(e.noLeaveCheck),t.onSubmit()}),p(i,b(de,{name:"username",title:"\u7528\u6237\u540D",get extra(){return{type:"text",pattern:"^[a-z][a-z0-9_]*$",title:"\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF",required:!0,value:qe.get(),onChange:n("username")}}}),o),p(i,b(de,{name:"server",title:"\u670D\u52A1\u5668",get extra(){return{type:"url",required:!0,value:je.get(),onChange:n("server")}}}),o),p(i,b(de,{name:"sync_answers",title:"\u540C\u6B65\u7B54\u6848",get extra(){return{type:"checkbox",checked:Be.get(),onChange:r("syncAnswers")}}}),o),p(i,b(de,{name:"sort_problems",title:"\u6392\u5E8F\u9898\u76EE",get extra(){return{type:"checkbox",checked:We.get(),onChange:r("sortProblems")}}}),o),p(i,b(de,{name:"no_leave_check",title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B",get extra(){return{type:"checkbox",checked:Fe.get(),onChange:r("noLeaveCheck")}}}),o),p(a,()=>[["\u540C\u6B65\u7B54\u6848\uFF1A","\u70B9\u51FB\u9898\u76EE\u663E\u793A\u8BE6\u7EC6\u7B54\u6848\uFF0C\u5728\u9009\u9879/\u586B\u7A7A\u5904\u60AC\u505C\u663E\u793A\u7B80\u7565\u7B54\u6848"],["\u6392\u5E8F\u9898\u76EE\uFF1A","\u6839\u636E ID \u5BF9\u9898\u76EE\u548C\u9009\u9879\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F"],["\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B\uFF1A","\u968F\u610F\u5207\u6362\u9875\u9762\u3001\u7A97\u53E3\u4E0D\u4F1A\u88AB\u53D1\u73B0"],["\u62E6\u622A\u4E0A\u4F20\u622A\u56FE\uFF1A","\u4EC5\u5F53\u7528\u6237\u786E\u8BA4\u540E\uFF0C\u624D\u4F1A\u4E0A\u4F20\u622A\u56FE"],["\u62E6\u622A\u5F02\u5E38\u72B6\u6001\uFF1A","\u5373\u4F7F\u672C\u5730\u663E\u793A\u5F02\u5E38\u4E5F\u4E0D\u4F1A\u63A8\u9001\u5230\u670D\u52A1\u5668"]].map(([f,d])=>(()=>{const m=nr.cloneNode(!0),_=m.firstChild;return p(_,f),p(m,d,null),m})())),E(f=>{const d=v.settingsSubmit,m=v.settingsSubmitTip,_=v.about;return d!==f._v$3&&y(o,f._v$3=d),m!==f._v$4&&y(l,f._v$4=m),_!==f._v$5&&y(c,f._v$5=_),f},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),s})()}function sr(){const t=Te({title:"\u8BBE\u7F6E",width:350,height:300});ae(()=>(()=>{const e=rr.cloneNode(!0);return p(e,b(ir,{onSubmit:()=>t.close()})),E(()=>y(e,v.mainBody)),e})(),t.document.body)}const or=$("<style></style>"),lr=$('<div><div><button type="button">\u786E\u8BA4\u4E0A\u4F20</button><span><i>*\u5173\u95ED\u7A97\u53E3\u4EE5\u53D6\u6D88\u4E0A\u4F20</i></span></div><div><img></div></div>');class ur{constructor(e){ae(()=>(()=>{const s=or.cloneNode(!0);return s.textContent=bt,s})(),document.head);const n=document.body.querySelector(".header-title");St(HTMLElement,n),n.classList.add(v.clickable),n.addEventListener("click",()=>sr());const r=Array.from(document.body.querySelectorAll(".exam-main--body .subject-item"));Ct(r.length===e.length,"number subject items mismatches problems"),this._details=w.from(r).then(xn(e)).then(G(new Map,(s,[i,o])=>{let l;switch(o.ProblemType){case J.SingleChoice:case J.MultipleChoice:case J.Polling:case J.Judgement:{const c=o.ProblemType===J.Judgement?a=>["\u6B63\u786E","\u9519\u8BEF"][a]:a=>String.fromCharCode(65+a),u=o.ProblemType===J.Judgement?new Map([["true","\u6B63\u786E"],["false","\u9519\u8BEF"]]):w.from(o.Options).then(Ne("no Options")).then(vt).then(G(new Map,(a,[f,{key:d}])=>a.set(d,String.fromCharCode(65+f)))).unwrap();l=new zn(o.ProblemID,i,c,a=>{var f;return(f=u.get(a))!=null?f:a});break}case J.FillBlank:l=new Yn(o.ProblemID,i);break;case J.ShortAnswer:l=new Zn(o.ProblemID,i);break}return s.set(o.ProblemID,l)})).unwrap()}updateAnswer({username:e,problem_id:n,result:r,context:s}){var i;(i=this._details.get(n))==null||i.updateAnswer(e,{answer:r,context:s})}updateUI(){this._details.forEach(e=>e.updateUI())}}function ar(t,e){const n=Te({title:"\u4E0A\u4F20\u56FE\u7247",width:400,height:300});ae(()=>(()=>{const r=lr.cloneNode(!0),s=r.firstChild,i=s.firstChild,o=s.nextSibling,l=o.firstChild;return i.addEventListener("click",()=>{n.close(),e()}),Ce(l,"src",t),E(c=>{const u={[v.mainBody]:!0,[v.uploadImg]:!0},a=v.uploadImgConfirm,f=v.uploadImgImage;return c._v$=at(r,u,c._v$),a!==c._v$2&&y(s,c._v$2=a),f!==c._v$3&&y(o,c._v$3=f),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),n.document.body)}function Jt(t){return t.forEach(e=>{switch(e.ProblemType){case J.SingleChoice:case J.MultipleChoice:case J.Polling:{e.Options.sort((r,s)=>r.key<s.key?-1:1);break}}}),t.sort((e,n)=>e.ProblemID-n.ProblemID),t}function cr(t){return We.get()===!0&&(t.data.has_problem_dict===!0?t.data.problems=t.data.problems.sort((e,n)=>e.id-n.id).map(e=>(e.problems=Jt(e.problems),e)):t.data.problems=Jt(t.data.problems)),t}function fr(){document.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0)}async function dr(){Tn(),Fe.get()===!0&&fr(),qn(function(t){switch(t.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(cr(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return e}}})}}),this.addEventListener("load",()=>{const e=JSON.parse(this.responseText);let n=[];e.data.has_problem_dict===!0?e.data.problems.forEach(i=>{n=n.concat(i.problems)}):n=e.data.problems;const r=new ur(n);j.onmessage(i=>{i.forEach(o=>r.updateAnswer(o)),r.updateUI()});const s=parseInt(w.from(t.searchParams.get("exam_id")).then(mt).then(Ne("cannot found exam_id")).unwrap());j.login(s,{title:e.data.title,problems:n}),fetch(Nt("/exam_room/cache_results",{exam_id:s.toString()}).toString()).then(i=>i.json()).then(i=>i.data.results.forEach(({problem_id:o,result:l})=>j.updateAnswer(o,l))).catch(Le)});return;case"/exam_room/answer_problem":return async e=>{var n;if(typeof e=="string"){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:s,result:i})=>j.updateAnswer(s,i)))}return e};default:return t.hostname==="upload-z1.qiniup.com"?async e=>e instanceof FormData&&e.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>ar(r.result,()=>n(e)),r.readAsDataURL(e.get("file"))}):e:void 0}}),await j.watch(1e4)}dr().catch(console.error)});
