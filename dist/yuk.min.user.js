// ==UserScript==
// @name         yuk-client
// @version      0.8.0
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(g){typeof define=="function"&&define.amd?define(g):g()})(function(){"use strict";var ar=Object.defineProperty;var cr=(g,T,L)=>T in g?ar(g,T,{enumerable:!0,configurable:!0,writable:!0,value:L}):g[T]=L;var P=(g,T,L)=>(cr(g,typeof T!="symbol"?T+"":T,L),L);var g=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},T={},L={},ee={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";var e=function(o){return typeof o=="string"||typeof o=="number"||o===null};t.isJSONRPCID=e;var n=function(o){return o.jsonrpc===t.JSONRPC&&o.method!==void 0&&o.result===void 0&&o.error===void 0};t.isJSONRPCRequest=n;var r=function(o){return Array.isArray(o)&&o.every(t.isJSONRPCRequest)};t.isJSONRPCRequests=r;var s=function(o){return o.jsonrpc===t.JSONRPC&&o.id!==void 0&&(o.result!==void 0||o.error!==void 0)};t.isJSONRPCResponse=s;var i=function(o){return Array.isArray(o)&&o.every(t.isJSONRPCResponse)};t.isJSONRPCResponses=i,function(o){o[o.ParseError=-32700]="ParseError",o[o.InvalidRequest=-32600]="InvalidRequest",o[o.MethodNotFound=-32601]="MethodNotFound",o[o.InvalidParams=-32602]="InvalidParams",o[o.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));var l=function(o,c,u,a){var f={code:c,message:u};return a&&(f.data=a),{jsonrpc:t.JSONRPC,id:o,error:f}};t.createJSONRPCErrorResponse=l})(ee);var te={};Object.defineProperty(te,"__esModule",{value:!0}),te.DefaultErrorCode=void 0,te.DefaultErrorCode=0;var Lt=g&&g.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(l){l(i)})}return new(n||(n=Promise))(function(i,l){function o(a){try{u(r.next(a))}catch(f){l(f)}}function c(a){try{u(r.throw(a))}catch(f){l(f)}}function u(a){a.done?i(a.value):s(a.value).then(o,c)}u((r=r.apply(t,e||[])).next())})},jt=g&&g.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,l;return l={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function o(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(L,"__esModule",{value:!0}),L.JSONRPCClient=void 0;var ne=ee,Ae=te,qt=function(){function t(e,n){this._send=e,this.createID=n,this.idToResolveMap=new Map,this.id=0}return t.prototype._createID=function(){return this.createID?this.createID():++this.id},t.prototype.timeout=function(e,n){var r=this;n===void 0&&(n=function(l){return(0,ne.createJSONRPCErrorResponse)(l,Ae.DefaultErrorCode,"Request timeout")});var s=function(l,o){var c=setTimeout(function(){l.forEach(function(u){var a=r.idToResolveMap.get(u);a&&(r.idToResolveMap.delete(u),a(n(u)))})},e);return o().then(function(u){return clearTimeout(c),u},function(u){return clearTimeout(c),Promise.reject(u)})},i=function(l,o){var c=(Array.isArray(l)?l:[l]).map(function(u){return u.id}).filter(Qe);return s(c,function(){return r.requestAdvanced(l,o)})};return{request:function(l,o,c){var u=r._createID();return s([u],function(){return r.requestWithID(l,o,c,u)})},requestAdvanced:function(l,o){return i(l,o)}}},t.prototype.request=function(e,n,r){return this.requestWithID(e,n,r,this._createID())},t.prototype.requestWithID=function(e,n,r,s){return Lt(this,void 0,void 0,function(){var i,l;return jt(this,function(o){switch(o.label){case 0:return i={jsonrpc:ne.JSONRPC,method:e,params:n,id:s},[4,this.requestAdvanced(i,r)];case 1:return l=o.sent(),l.result!==void 0&&!l.error?[2,l.result]:l.result===void 0&&l.error?[2,Promise.reject(new Error(l.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},t.prototype.requestAdvanced=function(e,n){var r=this,s=Array.isArray(e);Array.isArray(e)||(e=[e]);var i=e.filter(function(c){return Qe(c.id)}),l=i.map(function(c){return new Promise(function(u){return r.idToResolveMap.set(c.id,u)})}),o=Promise.all(l).then(function(c){return s||!c.length?c:c[0]});return this.send(s?e:e[0],n).then(function(){return o},function(c){return i.forEach(function(u){r.receive((0,ne.createJSONRPCErrorResponse)(u.id,Ae.DefaultErrorCode,c&&c.message||"Failed to send a request"))}),o})},t.prototype.notify=function(e,n,r){this.send({jsonrpc:ne.JSONRPC,method:e,params:n},r).then(void 0,function(){})},t.prototype.send=function(e,n){return this._send(e,n)},t.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(n,r){return n((0,ne.createJSONRPCErrorResponse)(r,Ae.DefaultErrorCode,e))}),this.idToResolveMap.clear()},t.prototype.receive=function(e){var n=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var s=n.idToResolveMap.get(r.id);s&&(n.idToResolveMap.delete(r.id),s(r))})},t}();L.JSONRPCClient=qt;var Qe=function(t){return t!=null},me={},ge=g&&g.__assign||function(){return ge=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},ge.apply(this,arguments)},Xe=g&&g.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(l){l(i)})}return new(n||(n=Promise))(function(i,l){function o(a){try{u(r.next(a))}catch(f){l(f)}}function c(a){try{u(r.throw(a))}catch(f){l(f)}}function u(a){a.done?i(a.value):s(a.value).then(o,c)}u((r=r.apply(t,e||[])).next())})},ze=g&&g.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,l;return l={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function o(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Bt=g&&g.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(me,"__esModule",{value:!0}),me.JSONRPCServer=void 0;var x=ee,Ft=te,Wt=function(){return(0,x.createJSONRPCErrorResponse)(null,x.JSONRPCErrorCode.ParseError,"Parse error")},Ut=function(t){return(0,x.createJSONRPCErrorResponse)((0,x.isJSONRPCID)(t.id)?t.id:null,x.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Ht=function(t){return(0,x.createJSONRPCErrorResponse)(t,x.JSONRPCErrorCode.MethodNotFound,"Method not found")},Vt=function(){function t(e){e===void 0&&(e={});var n;this.mapErrorToJSONRPCErrorResponse=Xt,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=e.errorListener)!==null&&n!==void 0?n:console.warn}return t.prototype.addMethod=function(e,n){this.addMethodAdvanced(e,this.toJSONRPCMethod(n))},t.prototype.toJSONRPCMethod=function(e){return function(n,r){var s=e(n.params,r);return Promise.resolve(s).then(function(i){return Qt(n.id,i)})}},t.prototype.addMethodAdvanced=function(e,n){var r;this.nameToMethodDictionary=ge(ge({},this.nameToMethodDictionary),(r={},r[e]=n,r))},t.prototype.receiveJSON=function(e,n){var r=this.tryParseRequestJSON(e);return r?this.receive(r,n):Promise.resolve(Wt())},t.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},t.prototype.receive=function(e,n){return Array.isArray(e)?this.receiveMultiple(e,n):this.receiveSingle(e,n)},t.prototype.receiveMultiple=function(e,n){return Xe(this,void 0,void 0,function(){var r,s=this;return ze(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(l){return s.receiveSingle(l,n)}))];case 1:return r=i.sent().filter(Gt),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},t.prototype.receiveSingle=function(e,n){return Xe(this,void 0,void 0,function(){var r,s;return ze(this,function(i){switch(i.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,x.isJSONRPCRequest)(e)?[3,1]:[2,Ut(e)];case 1:return[4,this.callMethod(r,e,n)];case 2:return s=i.sent(),[2,zt(e,s)]}})})},t.prototype.applyMiddleware=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Bt([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},t.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},t.prototype.middlewareReducer=function(e,n){return function(r,s,i){return e(function(l,o){return n(r,l,o)},s,i)}},t.prototype.callMethod=function(e,n,r){var s=this,i=function(o,c){return e?e(o,c):o.id!==void 0?Promise.resolve(Ht(o.id)):Promise.resolve(null)},l=function(o){return s.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),o),Promise.resolve(s.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,o))};try{return(this.middleware||Kt)(i,n,r).then(void 0,l)}catch(o){return l(o)}},t.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,n){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,n):null},t}();me.JSONRPCServer=Vt;var Gt=function(t){return t!==null},Kt=function(t,e,n){return t(e,n)},Qt=function(t,e){return t!==void 0?{jsonrpc:x.JSONRPC,id:t,result:e===void 0?null:e}:null},Xt=function(t,e){return(0,x.createJSONRPCErrorResponse)(t,Ft.DefaultErrorCode,e&&e.message||"An unexpected error occurred")},zt=function(t,e){return e||(t.id!==void 0?(0,x.createJSONRPCErrorResponse)(t.id,x.JSONRPCErrorCode.InternalError,"Internal error"):null)},_e={},Yt=g&&g.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(l){l(i)})}return new(n||(n=Promise))(function(i,l){function o(a){try{u(r.next(a))}catch(f){l(f)}}function c(a){try{u(r.throw(a))}catch(f){l(f)}}function u(a){a.done?i(a.value):s(a.value).then(o,c)}u((r=r.apply(t,e||[])).next())})},Zt=g&&g.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,l;return l={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function o(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.JSONRPCServerAndClient=void 0;var ve=ee,en=function(){function t(e,n,r){r===void 0&&(r={});var s;this.server=e,this.client=n,this.errorListener=(s=r.errorListener)!==null&&s!==void 0?s:console.warn}return t.prototype.applyServerMiddleware=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,n)},t.prototype.addMethod=function(e,n){this.server.addMethod(e,n)},t.prototype.addMethodAdvanced=function(e,n){this.server.addMethodAdvanced(e,n)},t.prototype.timeout=function(e){return this.client.timeout(e)},t.prototype.request=function(e,n,r){return this.client.request(e,n,r)},t.prototype.requestAdvanced=function(e,n){return this.client.requestAdvanced(e,n)},t.prototype.notify=function(e,n,r){this.client.notify(e,n,r)},t.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},t.prototype.receiveAndSend=function(e,n,r){return Yt(this,void 0,void 0,function(){var s,i;return Zt(this,function(l){switch(l.label){case 0:return(0,ve.isJSONRPCResponse)(e)||(0,ve.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,ve.isJSONRPCRequest)(e)||(0,ve.isJSONRPCRequests)(e)?[4,this.server.receive(e,n)]:[3,3];case 2:return s=l.sent(),s?[2,this.client.send(s,r)]:[3,4];case 3:return i="Received an invalid JSON-RPC message",this.errorListener(i,e),[2,Promise.reject(new Error(i))];case 4:return[2]}})})},t}();_e.JSONRPCServerAndClient=en,function(t){var e=g&&g.__createBinding||(Object.create?function(r,s,i,l){l===void 0&&(l=i);var o=Object.getOwnPropertyDescriptor(s,i);(!o||("get"in o?!s.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,l,o)}:function(r,s,i,l){l===void 0&&(l=i),r[l]=s[i]}),n=g&&g.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&e(s,r,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(L,t),n(ee,t),n(me,t),n(_e,t)}(T);const j={};function tn(t){j.context=t}const nn=(t,e)=>t===e,rn=Symbol("solid-track"),pe={equals:nn};let Ye=rt;const Q={},H=1,we=2,Ze={owned:null,cleanups:null,context:null,owner:null};var R=null;let re=null,C=null,ie=null,E=null,I=null,Pe=0;function se(t,e){const n=C,r=R,s=t.length===0,i=s?Ze:{owned:null,cleanups:null,context:null,owner:e||r},l=s?t:()=>t(()=>Ie(i));R=i,C=null;try{return ke(l,!0)}finally{C=n,R=r}}function et(t,e){e=e?Object.assign({},pe,e):pe;const n={value:t,observers:null,observerSlots:null,pending:Q,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.pending!==Q?n.pending:n.value)),Me(n,s));return[nt.bind(n),r]}function $(t,e,n){const r=xe(t,e,!1,H);le(r)}function tt(t,e,n){Ye=an;const r=xe(t,e,!1,H);r.user=!0,I?I.push(r):le(r)}function oe(t,e,n){n=n?Object.assign({},pe,n):pe;const r=xe(t,e,!0,0);return r.pending=Q,r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,le(r),nt.bind(r)}function sn(t){if(ie)return t();let e;const n=ie=[];try{e=t()}finally{ie=null}return ke(()=>{for(let r=0;r<n.length;r+=1){const s=n[r];if(s.pending!==Q){const i=s.pending;s.pending=Q,Me(s,i)}}},!1),e}function ye(t){let e,n=C;return C=null,e=t(),C=n,e}function on(t){return R===null||(R.cleanups===null?R.cleanups=[t]:R.cleanups.push(t)),t}function nt(){const t=re;if(this.sources&&(this.state||t)){const e=E;E=null,this.state===H||t?le(this):be(this),E=e}if(C){const e=this.observers?this.observers.length:0;C.sources?(C.sources.push(this),C.sourceSlots.push(e)):(C.sources=[this],C.sourceSlots=[e]),this.observers?(this.observers.push(C),this.observerSlots.push(C.sources.length-1)):(this.observers=[C],this.observerSlots=[C.sources.length-1])}return this.value}function Me(t,e,n){if(ie)return t.pending===Q&&ie.push(t),t.pending=e,e;if(t.comparator&&t.comparator(t.value,e))return e;let r=!1;return t.value=e,t.observers&&t.observers.length&&ke(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s];r&&re.disposed.has(i),(r&&!i.tState||!r&&!i.state)&&(i.pure?E.push(i):I.push(i),i.observers&&it(i)),r||(i.state=H)}if(E.length>1e6)throw E=[],new Error},!1),e}function le(t){if(!t.fn)return;Ie(t);const e=R,n=C,r=Pe;C=R=t,ln(t,t.value,r),C=n,R=e}function ln(t,e,n){let r;try{r=t.fn(e)}catch(s){st(s)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?Me(t,r):t.value=r,t.updatedAt=n)}function xe(t,e,n,r=H,s){const i={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:R,context:null,pure:n};return R===null||R!==Ze&&(R.owned?R.owned.push(i):R.owned=[i]),i}function ue(t){const e=re;if(t.state===0||e)return;if(t.state===we||e)return be(t);if(t.suspense&&ye(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Pe);)(t.state||e)&&n.push(t);for(let r=n.length-1;r>=0;r--)if(t=n[r],t.state===H||e)le(t);else if(t.state===we||e){const s=E;E=null,be(t,n[0]),E=s}}function ke(t,e){if(E)return t();let n=!1;e||(E=[]),I?n=!0:I=[],Pe++;try{const r=t();return un(n),r}catch(r){E||(I=null),st(r)}}function un(t){E&&(rt(E),E=null),!t&&(I.length?sn(()=>{Ye(I),I=null}):I=null)}function rt(t){for(let e=0;e<t.length;e++)ue(t[e])}function an(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:ue(s)}j.context&&tn();const r=t.length;for(e=0;e<n;e++)ue(t[e]);for(e=r;e<t.length;e++)ue(t[e])}function be(t,e){const n=re;t.state=0;for(let r=0;r<t.sources.length;r+=1){const s=t.sources[r];s.sources&&(s.state===H||n?s!==e&&ue(s):(s.state===we||n)&&be(s,e))}}function it(t){const e=re;for(let n=0;n<t.observers.length;n+=1){const r=t.observers[n];(!r.state||e)&&(r.state=we,r.pure?E.push(r):I.push(r),r.observers&&it(r))}}function Ie(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),l=n.observerSlots.pop();r<s.length&&(i.sourceSlots[l]=r,s[r]=i,n.observerSlots[r]=l)}}if(t.owned){for(e=0;e<t.owned.length;e++)Ie(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function st(t){throw t}const cn=Symbol("fallback");function ot(t){for(let e=0;e<t.length;e++)t[e]()}function fn(t,e,n={}){let r=[],s=[],i=[],l=0,o=e.length>1?[]:null;return on(()=>ot(i)),()=>{let c=t()||[],u,a;return c[rn],ye(()=>{let d=c.length,h,v,O,J,K,M,A,m,S;if(d===0)l!==0&&(ot(i),i=[],r=[],s=[],l=0,o&&(o=[])),n.fallback&&(r=[cn],s[0]=se(B=>(i[0]=B,n.fallback())),l=1);else if(l===0){for(s=new Array(d),a=0;a<d;a++)r[a]=c[a],s[a]=se(f);l=d}else{for(O=new Array(d),J=new Array(d),o&&(K=new Array(d)),M=0,A=Math.min(l,d);M<A&&r[M]===c[M];M++);for(A=l-1,m=d-1;A>=M&&m>=M&&r[A]===c[m];A--,m--)O[m]=s[A],J[m]=i[A],o&&(K[m]=o[A]);for(h=new Map,v=new Array(m+1),a=m;a>=M;a--)S=c[a],u=h.get(S),v[a]=u===void 0?-1:u,h.set(S,a);for(u=M;u<=A;u++)S=r[u],a=h.get(S),a!==void 0&&a!==-1?(O[a]=s[u],J[a]=i[u],o&&(K[a]=o[u]),a=v[a],h.set(S,a)):i[u]();for(a=M;a<d;a++)a in O?(s[a]=O[a],i[a]=J[a],o&&(o[a]=K[a],o[a](a))):s[a]=se(f);s=s.slice(0,l=d),r=c.slice(0)}return s});function f(d){if(i[a]=d,o){const[h,v]=et(a);return o[a]=v,e(c[a],h)}return e(c[a])}}}function b(t,e){return ye(()=>t(e||{}))}function V(t){const e="fallback"in t&&{fallback:()=>t.fallback};return oe(fn(()=>t.each,t.children,e||void 0))}function Se(t){let e=!1;const n=oe(()=>t.when,void 0,{equals:(r,s)=>e?r===s:!r==!s});return oe(()=>{const r=n();if(r){const s=t.children;return(e=typeof s=="function"&&s.length>0)?ye(()=>s(r)):s}return t.fallback})}const dn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],hn=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...dn]),mn=new Set(["innerHTML","textContent","innerText","children"]),gn={className:"class",htmlFor:"for"},lt={class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"},_n=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),vn={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function pn(t,e,n){let r=n.length,s=e.length,i=r,l=0,o=0,c=e[s-1].nextSibling,u=null;for(;l<s||o<i;){if(e[l]===n[o]){l++,o++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===l){const a=i<r?o?n[o-1].nextSibling:n[i-o]:c;for(;o<i;)t.insertBefore(n[o++],a)}else if(i===o)for(;l<s;)(!u||!u.has(e[l]))&&e[l].remove(),l++;else if(e[l]===n[i-1]&&n[o]===e[s-1]){const a=e[--s].nextSibling;t.insertBefore(n[o++],e[l++].nextSibling),t.insertBefore(n[--i],a),e[s]=n[i]}else{if(!u){u=new Map;let f=o;for(;f<i;)u.set(n[f],f++)}const a=u.get(e[l]);if(a!=null)if(o<a&&a<i){let f=l,d=1,h;for(;++f<s&&f<i&&!((h=u.get(e[f]))==null||h!==a+d);)d++;if(d>a-o){const v=e[l];for(;o<a;)t.insertBefore(n[o++],v)}else t.replaceChild(n[o++],e[l++])}else l++;else e[l++].remove()}}}const ut="_$DX_DELEGATE";function ae(t,e,n){let r;return se(s=>{r=s,e===document?t():_(e,t(),e.firstChild?null:void 0,n)}),()=>{r(),e.textContent=""}}function N(t,e,n){const r=document.createElement("template");r.innerHTML=t;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function wn(t,e=window.document){const n=e[ut]||(e[ut]=new Set);for(let r=0,s=t.length;r<s;r++){const i=t[r];n.has(i)||(n.add(i),e.addEventListener(i,Rn))}}function Ce(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function yn(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function y(t,e){e==null?t.removeAttribute("class"):t.className=e}function bn(t,e,n,r){if(r)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const s=n[0];t.addEventListener(e,n[0]=i=>s.call(t,n[1],i))}else t.addEventListener(e,n)}function at(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let i,l;for(i=0,l=s.length;i<l;i++){const o=s[i];!o||o==="undefined"||e[o]||(ct(t,o,!1),delete n[o])}for(i=0,l=r.length;i<l;i++){const o=r[i],c=!!e[o];!o||o==="undefined"||n[o]===c||!c||(ct(t,o,!0),n[o]=c)}return n}function Sn(t,e,n={}){const r=t.style,s=typeof n=="string";if(e==null&&s||typeof e=="string")return r.cssText=e;s&&(r.cssText=void 0,n={}),e||(e={});let i,l;for(l in n)e[l]==null&&r.removeProperty(l),delete n[l];for(l in e)i=e[l],i!==n[l]&&(r.setProperty(l,i),n[l]=i);return n}function Cn(t,e,n,r){typeof e=="function"?$(s=>dt(t,e(),s,n,r)):dt(t,e,void 0,n,r)}function _(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return X(t,e,r,n);$(s=>X(t,e(),s,n),r)}function Nn(t,e,n,r,s={},i=!1){e||(e={});for(const l in s)if(!(l in e)){if(l==="children")continue;ft(t,l,null,s[l],n,i)}for(const l in e){if(l==="children"){r||X(t,e.children);continue}const o=e[l];s[l]=ft(t,l,o,s[l],n,i)}}function $n(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function ct(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,i=r.length;s<i;s++)t.classList.toggle(r[s],n)}function ft(t,e,n,r,s,i){let l,o,c;if(e==="style")return Sn(t,n,r);if(e==="classList")return at(t,n,r);if(n===r)return r;if(e==="ref")i||n(t);else if(e.slice(0,3)==="on:"){const u=e.slice(3);r&&t.removeEventListener(u,r),n&&t.addEventListener(u,n)}else if(e.slice(0,10)==="oncapture:"){const u=e.slice(10);r&&t.removeEventListener(u,r,!0),n&&t.addEventListener(u,n,!0)}else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),a=_n.has(u);if(!a&&r){const f=Array.isArray(r)?r[0]:r;t.removeEventListener(u,f)}(a||n)&&(bn(t,u,n,a),a&&wn([u]))}else if((c=mn.has(e))||!s&&(lt[e]||(o=hn.has(e)))||(l=t.nodeName.includes("-")))e==="class"||e==="className"?y(t,n):l&&!o&&!c?t[$n(e)]=n:t[lt[e]||e]=n;else{const u=s&&e.indexOf(":")>-1&&vn[e.split(":")[0]];u?yn(t,u,e,n):Ce(t,gn[e]||e,n)}return n}function Rn(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}}),j.registry&&!j.done&&(j.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[e];if(r&&!n.disabled){const s=n[`${e}Data`];if(s!==void 0?r.call(n,s,t):r.call(n,t),t.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function dt(t,e,n={},r,s){return e||(e={}),!s&&"children"in e&&$(()=>n.children=X(t,e.children,n.children)),e.ref&&e.ref(t),$(()=>Nn(t,e,r,!0,n,!0)),n}function X(t,e,n,r,s){for(j.context&&!n&&(n=[...t.childNodes]);typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,l=r!==void 0;if(t=l&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(j.context)return n;if(i==="number"&&(e=e.toString()),l){let o=n[0];o&&o.nodeType===3?o.data=e:o=document.createTextNode(e),n=z(t,n,r,o)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean"){if(j.context)return n;n=z(t,n,r)}else{if(i==="function")return $(()=>{let o=e();for(;typeof o=="function";)o=o();n=X(t,o,n,r)}),()=>n;if(Array.isArray(e)){const o=[],c=n&&Array.isArray(n);if(De(o,e,n,s))return $(()=>n=X(t,o,n,r,!0)),()=>n;if(j.context){for(let u=0;u<o.length;u++)if(o[u].parentNode)return n=o}if(o.length===0){if(n=z(t,n,r),l)return n}else c?n.length===0?ht(t,o,r):pn(t,n,o):(n&&z(t),ht(t,o));n=o}else if(e instanceof Node){if(j.context&&e.parentNode)return n=l?[e]:e;if(Array.isArray(n)){if(l)return n=z(t,n,r,e);z(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function De(t,e,n,r){let s=!1;for(let i=0,l=e.length;i<l;i++){let o=e[i],c=n&&n[i];if(o instanceof Node)t.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))s=De(t,o,c)||s;else if(typeof o=="function")if(r){for(;typeof o=="function";)o=o();s=De(t,Array.isArray(o)?o:[o],c)||s}else t.push(o),s=!0;else{const u=String(o);c&&c.nodeType===3&&c.data===u?t.push(c):t.push(document.createTextNode(u))}}return s}function ht(t,e,n){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function z(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let i=!1;for(let l=e.length-1;l>=0;l--){const o=e[l];if(s!==o){const c=o.parentNode===t;!i&&!l?c?t.replaceChild(s,o):t.insertBefore(s,n):c&&o.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}function mt(t){if(t!==null)return t}function Ne(t){return function(e){if(e===void 0)throw new Error(t!=null?t:"expect some value");return e}}function gt(t){return function(e){return e!==void 0?t(e):void 0}}function _t(t){return function(e){return e!==void 0||t!==void 0?[e,t]:void 0}}function vt(t){return function*(e){for(const n of e)yield t(n)}}function*pt(t){let e=0;for(const n of t)yield[e++,n]}function En(t){return function*(e){for(const n of e)t(n)&&(yield n)}}function wt(t){return function*(e){for(const n of e){const r=t(n);r!==void 0&&(yield r)}}}function On(t){return function*(e){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();for(;;){const s=n.next(),i=r.next();if(s.done!==!0&&i.done!==!0)yield[s.value,i.value];else return}}}function Y(t){return function(e){return Array.from(e).sort(t)}}function An(t){for(const e of t)return e}function G(t,e){return function(n){let r=t;for(const s of n)r=e(r,s);return r}}function Pn(t){let e=0;for(const n of t)e++;return e}function Z(t){return Array.from(t)}function yt(t){return function(e){for(const n of e)t(n)}}class Je{constructor(e){P(this,"t");this.t=e}static from(e){return new Je(e)}static unwrap(e){return e.t}}class $e{constructor(e){P(this,"_init");P(this,"_t");this._init=e}static from(e){return new $e(e)}force(){return this._t===void 0&&(this._t=Je.from(this._init())),this._t.t}}class w{constructor(e){P(this,"_t");this._t=e}then(e){return new w(e(this._t))}static from(e){return new w(e)}unwrap(){return this._t}}var bt=`._mainBody_bsm4g_1{opacity:.5}._mainBody_bsm4g_1 *{font-size:.75rem;margin:0}._mainBody_bsm4g_1 button,._clickable_bsm4g_11{cursor:pointer}._stateWorkingOn_bsm4g_14{color:#00f}._stateSure_bsm4g_17{color:green}._stateNotSure_bsm4g_20{color:red}._answerMsg_bsm4g_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_bsm4g_23 ul{padding-left:1rem}._answerMsgName_bsm4g_32{font-weight:700}._answerMark_bsm4g_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_bsm4g_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_bsm4g_35 input{height:max-content;width:100%}._answerDetail_bsm4g_53 ._stateWorkingOn_bsm4g_14,._answerDetail_bsm4g_53 ._stateSure_bsm4g_17,._answerDetail_bsm4g_53 ._stateNotSure_bsm4g_20{font-weight:700}._answerDetail_bsm4g_53 ul{padding-left:1.5rem}._answerDetail_bsm4g_53 ul ul{padding-left:1rem}._answerDetail_bsm4g_53 img{height:auto;width:80%}._answerDetailShortAnswer_bsm4g_68{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem;min-width:min-content}._answerDetailFill_bsm4g_75{white-space:pre}._settings_bsm4g_78{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_bsm4g_86{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_bsm4g_86 label{font-weight:700}._settingsEntry_bsm4g_86 input{height:max-content;text-align:right}._settingsSubmit_bsm4g_100{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_bsm4g_106{margin-right:.5rem}._about_bsm4g_109 p{margin-bottom:.25rem}._about_bsm4g_109 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_bsm4g_109 ul li{margin-bottom:.25rem}._uploadImg_bsm4g_119{display:flex;flex-direction:column}._uploadImg_bsm4g_119 img{width:100%;height:auto}._uploadImgImage_bsm4g_127{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_bsm4g_132{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`;const Mn=N("<title> </title>"),xn=N("<style></style>");function St(t,e,n){Ct(e instanceof t,n!=null?n:"not HTMLElement")}function Ct(t,e){if(t!==!0)throw Error(e!=null?e:"assertion failed")}function W(...t){return t}function Te(t){const e=w.from(window.open("","",Object.entries(t).map(([r,s])=>`${r}=${s}`).join(","))).then(mt).then(Ne("cannot open windows")).unwrap(),n=()=>e.close();return window.addEventListener("unload",n),e.addEventListener("close",()=>window.removeEventListener("unload",n)),ae(()=>[(()=>{const r=Mn.cloneNode(!0),s=r.firstChild;return $(()=>s.data=t.title),r})(),(()=>{const r=xn.cloneNode(!0);return r.textContent=bt,r})()],e.document.head),e}function Le(t,...e){}function Nt(t,e){const n=new URL(t,self.location.origin);for(const[r,s]of Object.entries(e!=null?e:{}))n.searchParams.set(r,s);return n}function $t(t){const e=GM_getValue(t);if(e!==void 0)return e.contents}function ce(t,e){return GM_setValue(t,{contents:e}),e}function kn(){var n;const t=[{name:"202205231915_gm_value",up(){ce("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const r of["username","server","sync_answers","sort_problems"])ce(r,GM_getValue(r))}}],e=(n=$t("migrations"))!=null?n:[];for(const{name:r,idx:s}of e)if(r!==t[s].name)throw new Error("bad migrations");for(const{name:r,up:s}of t.slice(e.length))s();ce("migrations",t.map((r,s)=>({name:r.name,idx:s})))}class fe{constructor(e,n){P(this,"_name");P(this,"_t");this._name=e,this._t=$e.from(()=>{const r=$t(this._name);return r===void 0&&n!==void 0?ce(this._name,n):r})}get(){return this._t.force()}set(e){e!==void 0&&(ce(this._name,e),this._t=$e.from(()=>e))}}const je=new fe("username"),qe=new fe("server"),Be=new fe("sync_answers",!0),Fe=new fe("sort_problems",!1),We=new fe("no_leave_check",!0);class In{constructor(){P(this,"token");P(this,"client");P(this,"examId");P(this,"paper");P(this,"queue",new Map);P(this,"onmsg",[])}onmessage(e){this.onmsg.push(e)}updateQueue(e,n){let r=this.queue.get(e);r!==void 0?n(r):(r={},n(r),this.queue.set(e,r))}updateAnswer(e,n){this.updateQueue(e,r=>r.result=n)}updateState(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.state=n})}updateMsg(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.msg=n})}async watch(e){return new Promise((n,r)=>{const s=setInterval(()=>{this.sendQueue().catch(i=>{clearInterval(s),alert(`\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5F02\u5E38: ${i}`),r(i)})},e)})}async login(e,n){this.examId=e,this.paper=n}async sendQueue(){const e=Be.get(),n=qe.get(),r=je.get();if(e!==!0||this.queue.size<1||n===void 0||r===void 0||this.examId===void 0||this.paper===void 0)return;const s=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const l=new T.JSONRPCClient(o=>new Promise((c,u)=>{GM.xmlHttpRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(o),onload:a=>{a.status===200?(l.receive(w.from(a.responseText).then(Ne("empty response")).then(JSON.parse).unwrap()),c()):u(new Error(a.statusText))},onerror:a=>u(a.statusText)})}));this.client=l}if(this.token===void 0){Le(`login to server: ${r}, ${this.examId}`);const l=await this.client.request("login",[r,this.examId,this.paper,"0.8.0"]);this.token=l}const i=await this.client.request("answer_problem",[this.token,s.map(([l,{result:o,context:c}])=>({problem_id:l,result:o,context:c}))]);this.onmsg.forEach(l=>l(i))}}const q=new In;function Dn(t){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const s=t.call(this,Nt(r)),i=this.send;this.send=function(l){s!==void 0?s(l).then(o=>{i.call(this,o),this.send=i}).catch(Le):(i.call(this,l),this.send=i)},e.apply(this,arguments)}}var k=(t=>(t[t.SingleChoice=1]="SingleChoice",t[t.MultipleChoice=2]="MultipleChoice",t[t.Polling=3]="Polling",t[t.FillBlank=4]="FillBlank",t[t.ShortAnswer=5]="ShortAnswer",t[t.Judgement=6]="Judgement",t))(k||{}),D=(t=>(t[t.WorkingOn=0]="WorkingOn",t[t.Sure=1]="Sure",t[t.NotSure=2]="NotSure",t))(D||{}),p={mainBody:"_mainBody_bsm4g_1",clickable:"_clickable_bsm4g_11",stateWorkingOn:"_stateWorkingOn_bsm4g_14",stateSure:"_stateSure_bsm4g_17",stateNotSure:"_stateNotSure_bsm4g_20",answerMsg:"_answerMsg_bsm4g_23",answerMsgName:"_answerMsgName_bsm4g_32",answerMark:"_answerMark_bsm4g_35",answerDetail:"_answerDetail_bsm4g_53",answerDetailShortAnswer:"_answerDetailShortAnswer_bsm4g_68",answerDetailFill:"_answerDetailFill_bsm4g_75",settings:"_settings_bsm4g_78",settingsEntry:"_settingsEntry_bsm4g_86",settingsSubmit:"_settingsSubmit_bsm4g_100",settingsSubmitTip:"_settingsSubmitTip_bsm4g_106",about:"_about_bsm4g_109",uploadImg:"_uploadImg_bsm4g_119",uploadImgImage:"_uploadImgImage_bsm4g_127",uploadImgConfirm:"_uploadImgConfirm_bsm4g_132"};const Jn=N('<div><fieldset><legend></legend><input type="text" placeholder="\u7559\u8A00"><button type="button">\u6211\u6B63\u5728\u505A</button><button type="button">\u6211\u5F88\u786E\u5B9A</button><button type="button">\u6211\u4E0D\u786E\u5B9A</button></fieldset><div><div></div></div></div>'),Tn=N("<fieldset><legend> \u7559\u8A00 </legend><ul></ul></fieldset>"),Ln=N("<li><span></span></li>"),Rt=N("<ul></ul>"),jn=N("<li></li>"),qn=N("<div><p><strong></strong></p></div>"),Bn=N("<div><p><strong></strong></p><ul></ul></div>"),Fn=N("<li><p></p></li>"),Wn=N("<p><strong></strong></p>"),Un=N("<div></div>"),Hn=N("<li><a></a></li>");function Ue(t,e){return t===e?0:t<e?-1:1}function Et(t){switch(t){case D.Sure:return 0;case D.WorkingOn:return 1;case D.NotSure:return 2}}function Ot([t,e],[n,r]){if(e===void 0)return r===void 0?Ue(t,n):1;if(r===void 0)return-1;{const s=Et(r)-Et(e);return s===0?Ue(t,n):s}}function At([t,e],[n,r]){var s,i;return Ot(W(t,(s=e.context)==null?void 0:s.state),W(n,(i=r.context)==null?void 0:i.state))}function Vn([t,e],[n,r]){return Ot(W(t,e==null?void 0:e.state),W(n,r==null?void 0:r.state))}function He(t){if(t!==void 0)switch(t){case D.WorkingOn:return p.stateWorkingOn;case D.NotSure:return p.stateNotSure;case D.Sure:return p.stateSure}}function Pt(t,e){return`${Math.floor(t*100/e)}%`}function Ve([t],[e]){return Ue(t,e)}class Ge{constructor(e,n,r){P(this,"_details",new Map);this.updateUI=se(()=>{const[s,i]=et(new Map,{equals:!1}),l=()=>i(this._details),o=r(s),c=n.querySelector(".item-type");return St(HTMLElement,c),c.classList.add(p.clickable),c.addEventListener("click",()=>{const u=c==null?void 0:c.getBoundingClientRect(),a=Te({title:"\u8BE6\u7EC6\u7B54\u6848",height:300,width:350,top:u==null?void 0:u.top,left:u==null?void 0:u.left});ae(()=>(()=>{const f=Jn.cloneNode(!0),d=f.firstChild,h=d.firstChild,v=h.nextSibling,O=v.nextSibling,J=O.nextSibling,K=J.nextSibling,M=d.nextSibling,A=M.firstChild;return _(h,()=>`\u6CE8\u518C\u4EBA\u6570: ${Ke(s())}`),v.addEventListener("change",m=>q.updateMsg(e,m.currentTarget.value)),O.addEventListener("click",()=>q.updateState(e,D.WorkingOn)),J.addEventListener("click",()=>q.updateState(e,D.Sure)),K.addEventListener("click",()=>q.updateState(e,D.NotSure)),_(M,()=>w.from(s()).then(Y(At)).then(wt(([m,{context:S}])=>w.from(S==null?void 0:S.state).then(_t(S==null?void 0:S.msg)).then(gt(([B,F])=>{const U=B===D.WorkingOn?F!=null?F:"\u6211\u6B63\u5728\u505A":F;return U===void 0||U===""?void 0:W(m,B,U)})).unwrap())).then(Z).then(m=>b(Se,{get when(){return m.length>0},get children(){return(()=>{const S=Tn.cloneNode(!0),B=S.firstChild,F=B.nextSibling;return _(F,b(V,{each:m,children:([U,Re,Ee])=>(()=>{const Oe=Ln.cloneNode(!0),Dt=Oe.firstChild;return _(Dt,`${U}: `),_(Oe,Ee,null),$(he=>{const Jt=He(Re),Tt=p.answerMsgName;return Jt!==he._v$7&&y(Oe,he._v$7=Jt),Tt!==he._v$8&&y(Dt,he._v$8=Tt),he},{_v$7:void 0,_v$8:void 0}),Oe})()})),$(()=>y(S,p.answerMsg)),S})()}})).unwrap(),A),_(A,b(o,{})),$(m=>{const S=p.mainBody,B=p.answerMark,F=p.stateWorkingOn,U=p.stateSure,Re=p.stateNotSure,Ee=p.answerDetail;return S!==m._v$&&y(f,m._v$=S),B!==m._v$2&&y(d,m._v$2=B),F!==m._v$3&&y(O,m._v$3=F),U!==m._v$4&&y(J,m._v$4=U),Re!==m._v$5&&y(K,m._v$5=Re),Ee!==m._v$6&&y(A,m._v$6=Ee),m},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),f})(),a.document.body)}),l})}updateAnswer(e,n){this._details.set(e,n)}}class Mt{constructor(e){this._ele=e}setContent(e){this._ele.setAttribute("title",e)}}function xt(t){t.forEach(e=>e.setContent(""))}function Ke(t){return w.from(t).then(En(([,e])=>e.answer!==void 0)).then(Pn).unwrap()}function kt({children:t}){return(()=>{const e=Rt.cloneNode(!0);return _(e,b(V,{get each(){return t.sort(Vn)},children:([n,r])=>(()=>{const s=jn.cloneNode(!0);return _(s,n),$(()=>y(s,He(r==null?void 0:r.state))),s})()})),e})()}class Gn extends Ge{constructor(e,n,r,s){const i=w.from(n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput")).then(l=>Array.from(l).entries()).then(G(new Map,(l,[o,c])=>l.set(r(o),new Mt(c)))).unwrap();super(e,n,l=>{const o=oe(()=>w.from(l()).then(G(new Map,(c,[u,{answer:a,context:f}])=>{var d;if(a!==void 0)for(let h of a){h=s(h);const v=(d=c.get(h))!=null?d:[];v.push([u,f]),c.set(h,v)}return c})).then(Y(Ve)).then(Z).unwrap());return tt(()=>{const c=Ke(l());xt(i),w.from(o()).then(yt(([u,a])=>{var f;(f=i.get(u))==null||f.setContent(Pt(a.length,c))})).unwrap()}),()=>b(V,{get each(){return o()},children:([c,u])=>(()=>{const a=qn.cloneNode(!0),f=a.firstChild,d=f.firstChild;return _(d,c),_(a,b(kt,{children:u}),null),a})()})})}}class Kn extends Ge{constructor(e,n){const r=w.from(n.querySelectorAll(".item-body .blank-item-dynamic")).then(Array.from).then(pt).then(G(new Map,(s,[i,l])=>s.set(String.fromCharCode(i+49),new Mt(l)))).unwrap();super(e,n,s=>{const i=()=>w.from(s()).then(G(new Map,(l,[o,{answer:c,context:u}])=>c===void 0?l:w.from(c).then(Object.entries).then(G(l,(a,[f,d])=>{var O,J;d=d.trim();const h=(O=a.get(f))!=null?O:new Map,v=(J=h.get(d))!=null?J:[];return v.push([o,u]),a.set(f,h.set(d,v))})).unwrap())).then(vt(([l,o])=>W(l,w.from(o).then(Y(Ve)).then(Z).unwrap()))).then(Y(Ve)).then(Z).unwrap();return tt(()=>{const l=Ke(s());xt(r),w.from(i()).then(yt(([o,c])=>{var a;const u=w.from(c).then(vt(([f,d])=>W(f,d.length))).then(Y(([,f],[,d])=>d-f)).then(An).unwrap();(a=r.get(o))==null||a.setContent(u===void 0?"":`(${Pt(u[1],l)}) ${u[0]}`)})).unwrap()}),()=>b(V,{get each(){return i()},children:([l,o])=>(()=>{const c=Bn.cloneNode(!0),u=c.firstChild,a=u.firstChild,f=u.nextSibling;return _(a,`#${l}`),_(f,b(V,{each:o,children:([d,h])=>b(Se,{when:d!=="",get children(){const v=Fn.cloneNode(!0),O=v.firstChild;return _(O,d),_(v,b(kt,{children:h}),null),$(()=>y(O,p.answerDetailFill)),v}})})),c})()})})}}class Qn extends Ge{constructor(e,n){super(e,n,r=>{const s=oe(()=>w.from(r()).then(Y(At)).then(Z).unwrap());return()=>b(V,{get each(){return w.from(s()).then(wt(([i,{answer:l,context:o}])=>{var c;return w.from(l==null?void 0:l.content).then(_t((c=l==null?void 0:l.attachments)==null?void 0:c.filelist)).then(gt(([u,a])=>W(i,u,a,o==null?void 0:o.state))).unwrap()})).then(Z).unwrap()},children:([i,l,o,c])=>[(()=>{const u=Wn.cloneNode(!0),a=u.firstChild;return _(a,i),$(()=>y(u,He(c))),u})(),b(Se,{when:l,children:u=>(()=>{const a=Un.cloneNode(!0);return a.innerHTML=u,$(()=>y(a,p.answerDetailShortAnswer)),a})()}),b(Se,{when:o,children:u=>(()=>{const a=Rt.cloneNode(!0);return _(a,b(V,{each:u,children:({fileUrl:f,fileName:d})=>(()=>{const h=Hn.cloneNode(!0),v=h.firstChild;return Ce(v,"href",f),_(v,d),h})()})),a})()})]})})}}const Xn=N("<div><label></label><input></div>"),zn=N('<div><form><div><p><i> *\u66F4\u6539\u8BBE\u7F6E\u540E\u8BF7\u5237\u65B0\u9875\u9762 </i></p><button type="submit"> \u63D0\u4EA4 </button></div></form><div><p><strong> \u529F\u80FD\u7279\u6027\uFF1A </strong></p><ul></ul></div></div>'),Yn=N("<li><strong></strong></li>"),Zn=N("<div></div>");function de(t){const e={...t.extra,name:t.name};return(()=>{const n=Xn.cloneNode(!0),r=n.firstChild,s=r.nextSibling;return _(r,()=>t.title),Cn(s,e,!1,!1),$(i=>{const l=p.settingsEntry,o=t.name;return l!==i._v$&&y(n,i._v$=l),o!==i._v$2&&Ce(r,"for",i._v$2=o),i},{_v$:void 0,_v$2:void 0}),n})()}function er(t){const e={};function n(s){return i=>e[s]=i.currentTarget.value}function r(s){return i=>e[s]=i.currentTarget.checked}return(()=>{const s=zn.cloneNode(!0),i=s.firstChild,l=i.firstChild,o=l.firstChild,c=i.nextSibling,u=c.firstChild,a=u.nextSibling;return i.addEventListener("submit",f=>{f.preventDefault(),je.set(e.username),qe.set(e.server),Be.set(e.syncAnswers),Fe.set(e.sortProblems),We.set(e.noLeaveCheck),t.onSubmit()}),_(i,b(de,{name:"username",title:"\u7528\u6237\u540D",get extra(){return{type:"text",pattern:"^[a-z][a-z0-9_]*$",title:"\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF",required:!0,value:je.get(),onChange:n("username")}}}),l),_(i,b(de,{name:"server",title:"\u670D\u52A1\u5668",get extra(){return{type:"url",required:!0,value:qe.get(),onChange:n("server")}}}),l),_(i,b(de,{name:"sync_answers",title:"\u540C\u6B65\u7B54\u6848",get extra(){return{type:"checkbox",checked:Be.get(),onChange:r("syncAnswers")}}}),l),_(i,b(de,{name:"sort_problems",title:"\u6392\u5E8F\u9898\u76EE",get extra(){return{type:"checkbox",checked:Fe.get(),onChange:r("sortProblems")}}}),l),_(i,b(de,{name:"no_leave_check",title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B",get extra(){return{type:"checkbox",checked:We.get(),onChange:r("noLeaveCheck")}}}),l),_(a,()=>[["\u540C\u6B65\u7B54\u6848\uFF1A","\u70B9\u51FB\u9898\u76EE\u663E\u793A\u8BE6\u7EC6\u7B54\u6848\uFF0C\u5728\u9009\u9879/\u586B\u7A7A\u5904\u60AC\u505C\u663E\u793A\u7B80\u7565\u7B54\u6848"],["\u6392\u5E8F\u9898\u76EE\uFF1A","\u6839\u636E ID \u5BF9\u9898\u76EE\u548C\u9009\u9879\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F"],["\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B\uFF1A","\u968F\u610F\u5207\u6362\u9875\u9762\u3001\u7A97\u53E3\u4E0D\u4F1A\u88AB\u53D1\u73B0"],["\u62E6\u622A\u4E0A\u4F20\u622A\u56FE\uFF1A","\u4EC5\u5F53\u7528\u6237\u786E\u8BA4\u540E\uFF0C\u624D\u4F1A\u4E0A\u4F20\u622A\u56FE"],["\u62E6\u622A\u5F02\u5E38\u72B6\u6001\uFF1A","\u5373\u4F7F\u672C\u5730\u663E\u793A\u5F02\u5E38\u4E5F\u4E0D\u4F1A\u63A8\u9001\u5230\u670D\u52A1\u5668"]].map(([f,d])=>(()=>{const h=Yn.cloneNode(!0),v=h.firstChild;return _(v,f),_(h,d,null),h})())),$(f=>{const d=p.settingsSubmit,h=p.settingsSubmitTip,v=p.about;return d!==f._v$3&&y(l,f._v$3=d),h!==f._v$4&&y(o,f._v$4=h),v!==f._v$5&&y(c,f._v$5=v),f},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),s})()}function tr(){const t=Te({title:"\u8BBE\u7F6E",width:350,height:300});ae(()=>(()=>{const e=Zn.cloneNode(!0);return _(e,b(er,{onSubmit:()=>t.close()})),$(()=>y(e,p.mainBody)),e})(),t.document.body)}const nr=N("<style></style>"),rr=N('<div><div><button type="button">\u786E\u8BA4\u4E0A\u4F20</button><span><i>*\u5173\u95ED\u7A97\u53E3\u4EE5\u53D6\u6D88\u4E0A\u4F20</i></span></div><div><img></div></div>');class ir{constructor(e){ae(()=>(()=>{const s=nr.cloneNode(!0);return s.textContent=bt,s})(),document.head);const n=document.body.querySelector(".header-title");St(HTMLElement,n),n.classList.add(p.clickable),n.addEventListener("click",()=>tr());const r=Array.from(document.body.querySelectorAll(".exam-main--body .subject-item"));Ct(r.length===e.length,"number subject items mismatches problems"),this._details=w.from(r).then(On(e)).then(G(new Map,(s,[i,l])=>{let o;switch(l.ProblemType){case k.SingleChoice:case k.MultipleChoice:case k.Polling:case k.Judgement:{const c=l.ProblemType===k.Judgement?a=>["\u6B63\u786E","\u9519\u8BEF"][a]:a=>String.fromCharCode(65+a),u=l.ProblemType===k.Judgement?new Map([["true","\u6B63\u786E"],["false","\u9519\u8BEF"]]):w.from(l.Options).then(Ne("no Options")).then(pt).then(G(new Map,(a,[f,{key:d}])=>a.set(d,String.fromCharCode(65+f)))).unwrap();o=new Gn(l.ProblemID,i,c,a=>{var f;return(f=u.get(a))!=null?f:a});break}case k.FillBlank:o=new Kn(l.ProblemID,i);break;case k.ShortAnswer:o=new Qn(l.ProblemID,i);break}return s.set(l.ProblemID,o)})).unwrap()}updateAnswer({username:e,problem_id:n,result:r,context:s}){var i;(i=this._details.get(n))==null||i.updateAnswer(e,{answer:r,context:s})}updateUI(){this._details.forEach(e=>e.updateUI())}}function sr(t,e){const n=Te({title:"\u4E0A\u4F20\u56FE\u7247",width:400,height:300});ae(()=>(()=>{const r=rr.cloneNode(!0),s=r.firstChild,i=s.firstChild,l=s.nextSibling,o=l.firstChild;return i.addEventListener("click",()=>{n.close(),e()}),Ce(o,"src",t),$(c=>{const u={[p.mainBody]:!0,[p.uploadImg]:!0},a=p.uploadImgConfirm,f=p.uploadImgImage;return c._v$=at(r,u,c._v$),a!==c._v$2&&y(s,c._v$2=a),f!==c._v$3&&y(l,c._v$3=f),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),n.document.body)}function It(t){return t.forEach(e=>{switch(e.ProblemType){case k.SingleChoice:case k.MultipleChoice:case k.Polling:{e.Options.sort((r,s)=>r.key<s.key?-1:1);break}}}),t.sort((e,n)=>e.ProblemID-n.ProblemID),t}function or(t){return Fe.get()===!0&&(t.data.has_problem_dict===!0?t.data.problems=t.data.problems.sort((e,n)=>e.id-n.id).map(e=>(e.problems=It(e.problems),e)):t.data.problems=It(t.data.problems)),t}function lr(){document.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0)}async function ur(){kn(),We.get()===!0&&lr(),Dn(function(t){switch(t.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(or(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return e}}})}}),this.addEventListener("load",()=>{const e=JSON.parse(this.responseText);let n=[];e.data.has_problem_dict===!0?e.data.problems.forEach(i=>{n=n.concat(i.problems)}):n=e.data.problems;const r=new ir(n);q.onmessage(i=>{i.forEach(l=>r.updateAnswer(l)),r.updateUI()});const s=parseInt(w.from(t.searchParams.get("exam_id")).then(mt).then(Ne("cannot found exam_id")).unwrap());q.login(s,{title:e.data.title,problems:n}),fetch(Nt("/exam_room/cache_results",{exam_id:s.toString()}).toString()).then(i=>i.json()).then(i=>i.data.results.forEach(({problem_id:l,result:o})=>q.updateAnswer(l,o))).catch(Le)});return;case"/exam_room/answer_problem":return async e=>{var n;if(typeof e=="string"){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:s,result:i})=>q.updateAnswer(s,i)))}return e};default:return t.hostname==="upload-z1.qiniup.com"?async e=>e instanceof FormData&&e.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>sr(r.result,()=>n(e)),r.readAsDataURL(e.get("file"))}):e:void 0}}),await q.watch(1e4)}ur().catch(console.error)});
