// ==UserScript==
// @name         yuk-client
// @version      0.6.1
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(m){typeof define=="function"&&define.amd?define(m):m()})(function(){"use strict";var Zn=Object.defineProperty,er=Object.defineProperties;var tr=Object.getOwnPropertyDescriptors;var Pt=Object.getOwnPropertySymbols;var nr=Object.prototype.hasOwnProperty,rr=Object.prototype.propertyIsEnumerable;var Qe=(m,w,C)=>w in m?Zn(m,w,{enumerable:!0,configurable:!0,writable:!0,value:C}):m[w]=C,xt=(m,w)=>{for(var C in w||(w={}))nr.call(w,C)&&Qe(m,C,w[C]);if(Pt)for(var C of Pt(w))rr.call(w,C)&&Qe(m,C,w[C]);return m},kt=(m,w)=>er(m,tr(w));var k=(m,w,C)=>(Qe(m,typeof w!="symbol"?w+"":w,C),C);var m=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},w={},C={},te={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";var e=function(l){return typeof l=="string"||typeof l=="number"||l===null};t.isJSONRPCID=e;var n=function(l){return l.jsonrpc===t.JSONRPC&&l.method!==void 0&&l.result===void 0&&l.error===void 0};t.isJSONRPCRequest=n;var r=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCRequest)};t.isJSONRPCRequests=r;var s=function(l){return l.jsonrpc===t.JSONRPC&&l.id!==void 0&&(l.result!==void 0||l.error!==void 0)};t.isJSONRPCResponse=s;var i=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCResponse)};t.isJSONRPCResponses=i,function(l){l[l.ParseError=-32700]="ParseError",l[l.InvalidRequest=-32600]="InvalidRequest",l[l.MethodNotFound=-32601]="MethodNotFound",l[l.InvalidParams=-32602]="InvalidParams",l[l.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));var o=function(l,c,u,a){var f={code:c,message:u};return a&&(f.data=a),{jsonrpc:t.JSONRPC,id:l,error:f}};t.createJSONRPCErrorResponse=o})(te);var ne={};Object.defineProperty(ne,"__esModule",{value:!0}),ne.DefaultErrorCode=void 0,ne.DefaultErrorCode=0;var It=m&&m.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Jt=m&&m.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(C,"__esModule",{value:!0}),C.JSONRPCClient=void 0;var re=te,Ae=ne,Dt=function(){function t(e,n){this._send=e,this.createID=n,this.idToResolveMap=new Map,this.id=0}return t.prototype._createID=function(){return this.createID?this.createID():++this.id},t.prototype.timeout=function(e,n){var r=this;n===void 0&&(n=function(o){return(0,re.createJSONRPCErrorResponse)(o,Ae.DefaultErrorCode,"Request timeout")});var s=function(o,l){var c=setTimeout(function(){o.forEach(function(u){var a=r.idToResolveMap.get(u);a&&(r.idToResolveMap.delete(u),a(n(u)))})},e);return l().then(function(u){return clearTimeout(c),u},function(u){return clearTimeout(c),Promise.reject(u)})},i=function(o,l){var c=(Array.isArray(o)?o:[o]).map(function(u){return u.id}).filter(Xe);return s(c,function(){return r.requestAdvanced(o,l)})};return{request:function(o,l,c){var u=r._createID();return s([u],function(){return r.requestWithID(o,l,c,u)})},requestAdvanced:function(o,l){return i(o,l)}}},t.prototype.request=function(e,n,r){return this.requestWithID(e,n,r,this._createID())},t.prototype.requestWithID=function(e,n,r,s){return It(this,void 0,void 0,function(){var i,o;return Jt(this,function(l){switch(l.label){case 0:return i={jsonrpc:re.JSONRPC,method:e,params:n,id:s},[4,this.requestAdvanced(i,r)];case 1:return o=l.sent(),o.result!==void 0&&!o.error?[2,o.result]:o.result===void 0&&o.error?[2,Promise.reject(new Error(o.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},t.prototype.requestAdvanced=function(e,n){var r=this,s=Array.isArray(e);Array.isArray(e)||(e=[e]);var i=e.filter(function(c){return Xe(c.id)}),o=i.map(function(c){return new Promise(function(u){return r.idToResolveMap.set(c.id,u)})}),l=Promise.all(o).then(function(c){return s||!c.length?c:c[0]});return this.send(s?e:e[0],n).then(function(){return l},function(c){return i.forEach(function(u){r.receive((0,re.createJSONRPCErrorResponse)(u.id,Ae.DefaultErrorCode,c&&c.message||"Failed to send a request"))}),l})},t.prototype.notify=function(e,n,r){this.send({jsonrpc:re.JSONRPC,method:e,params:n},r).then(void 0,function(){})},t.prototype.send=function(e,n){return this._send(e,n)},t.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(n,r){return n((0,re.createJSONRPCErrorResponse)(r,Ae.DefaultErrorCode,e))}),this.idToResolveMap.clear()},t.prototype.receive=function(e){var n=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var s=n.idToResolveMap.get(r.id);s&&(n.idToResolveMap.delete(r.id),s(r))})},t}();C.JSONRPCClient=Dt;var Xe=function(t){return t!=null},_e={},ge=m&&m.__assign||function(){return ge=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},ge.apply(this,arguments)},Ye=m&&m.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Ze=m&&m.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Tt=m&&m.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(_e,"__esModule",{value:!0}),_e.JSONRPCServer=void 0;var I=te,Lt=ne,jt=function(){return(0,I.createJSONRPCErrorResponse)(null,I.JSONRPCErrorCode.ParseError,"Parse error")},qt=function(t){return(0,I.createJSONRPCErrorResponse)((0,I.isJSONRPCID)(t.id)?t.id:null,I.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Bt=function(t){return(0,I.createJSONRPCErrorResponse)(t,I.JSONRPCErrorCode.MethodNotFound,"Method not found")},Wt=function(){function t(e){e===void 0&&(e={});var n;this.mapErrorToJSONRPCErrorResponse=Vt,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=e.errorListener)!==null&&n!==void 0?n:console.warn}return t.prototype.addMethod=function(e,n){this.addMethodAdvanced(e,this.toJSONRPCMethod(n))},t.prototype.toJSONRPCMethod=function(e){return function(n,r){var s=e(n.params,r);return Promise.resolve(s).then(function(i){return Ht(n.id,i)})}},t.prototype.addMethodAdvanced=function(e,n){var r;this.nameToMethodDictionary=ge(ge({},this.nameToMethodDictionary),(r={},r[e]=n,r))},t.prototype.receiveJSON=function(e,n){var r=this.tryParseRequestJSON(e);return r?this.receive(r,n):Promise.resolve(jt())},t.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},t.prototype.receive=function(e,n){return Array.isArray(e)?this.receiveMultiple(e,n):this.receiveSingle(e,n)},t.prototype.receiveMultiple=function(e,n){return Ye(this,void 0,void 0,function(){var r,s=this;return Ze(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(o){return s.receiveSingle(o,n)}))];case 1:return r=i.sent().filter(Ft),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},t.prototype.receiveSingle=function(e,n){return Ye(this,void 0,void 0,function(){var r,s;return Ze(this,function(i){switch(i.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,I.isJSONRPCRequest)(e)?[3,1]:[2,qt(e)];case 1:return r?[4,this.callMethod(r,e,n)]:[3,3];case 2:return s=i.sent(),[2,Gt(e,s)];case 3:return e.id!==void 0?[2,Bt(e.id)]:[2,null];case 4:return[2]}})})},t.prototype.applyMiddleware=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Tt([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},t.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},t.prototype.middlewareReducer=function(e,n){return function(r,s,i){return e(function(o,l){return n(r,o,l)},s,i)}},t.prototype.callMethod=function(e,n,r){var s=this,i=function(l,c){return e(l,c)},o=function(l){return s.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),l),Promise.resolve(s.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,l))};try{return(this.middleware||Ut)(i,n,r).then(void 0,o)}catch(l){return o(l)}},t.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,n){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,n):null},t}();_e.JSONRPCServer=Wt;var Ft=function(t){return t!==null},Ut=function(t,e,n){return t(e,n)},Ht=function(t,e){return t!==void 0?{jsonrpc:I.JSONRPC,id:t,result:e===void 0?null:e}:null},Vt=function(t,e){return(0,I.createJSONRPCErrorResponse)(t,Lt.DefaultErrorCode,e&&e.message||"An unexpected error occurred")},Gt=function(t,e){return e||(t.id!==void 0?(0,I.createJSONRPCErrorResponse)(t.id,I.JSONRPCErrorCode.InternalError,"Internal error"):null)},ve={},zt=m&&m.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Kt=m&&m.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(ve,"__esModule",{value:!0}),ve.JSONRPCServerAndClient=void 0;var pe=te,Qt=function(){function t(e,n,r){r===void 0&&(r={});var s;this.server=e,this.client=n,this.errorListener=(s=r.errorListener)!==null&&s!==void 0?s:console.warn}return t.prototype.applyServerMiddleware=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,n)},t.prototype.addMethod=function(e,n){this.server.addMethod(e,n)},t.prototype.addMethodAdvanced=function(e,n){this.server.addMethodAdvanced(e,n)},t.prototype.timeout=function(e){return this.client.timeout(e)},t.prototype.request=function(e,n,r){return this.client.request(e,n,r)},t.prototype.requestAdvanced=function(e,n){return this.client.requestAdvanced(e,n)},t.prototype.notify=function(e,n,r){this.client.notify(e,n,r)},t.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},t.prototype.receiveAndSend=function(e,n,r){return zt(this,void 0,void 0,function(){var s,i;return Kt(this,function(o){switch(o.label){case 0:return(0,pe.isJSONRPCResponse)(e)||(0,pe.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,pe.isJSONRPCRequest)(e)||(0,pe.isJSONRPCRequests)(e)?[4,this.server.receive(e,n)]:[3,3];case 2:return s=o.sent(),s?[2,this.client.send(s,r)]:[3,4];case 3:return i="Received an invalid JSON-RPC message",this.errorListener(i,e),[2,Promise.reject(new Error(i))];case 4:return[2]}})})},t}();ve.JSONRPCServerAndClient=Qt,function(t){var e=m&&m.__createBinding||(Object.create?function(r,s,i,o){o===void 0&&(o=i),Object.defineProperty(r,o,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]}),n=m&&m.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&e(s,r,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(C,t),n(te,t),n(_e,t),n(ve,t)}(w);const q={};function Xt(t){q.context=t}const Yt=(t,e)=>t===e,Zt=Symbol("solid-track"),ye={equals:Yt};let et=st;const Q={},V=1,we=2,tt={owned:null,cleanups:null,context:null,owner:null};var E=null;let ie=null,b=null,se=null,O=null,D=null,Me=0;function oe(t,e){const n=b,r=E,s=t.length===0?tt:{owned:null,cleanups:null,context:null,owner:e||r};E=s,b=null;try{return Je(()=>t(()=>De(s)),!0)}finally{b=n,E=r}}function nt(t,e){e=e?Object.assign({},ye,e):ye;const n={value:t,observers:null,observerSlots:null,pending:Q,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.pending!==Q?n.pending:n.value)),ke(n,s));return[it.bind(n),r]}function N(t,e,n){const r=Ie(t,e,!1,V);le(r)}function rt(t,e,n){et=sn;const r=Ie(t,e,!1,V);r.user=!0,D?D.push(r):le(r)}function Pe(t,e,n){n=n?Object.assign({},ye,n):ye;const r=Ie(t,e,!0,0);return r.pending=Q,r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,le(r),it.bind(r)}function en(t){if(se)return t();let e;const n=se=[];try{e=t()}finally{se=null}return Je(()=>{for(let r=0;r<n.length;r+=1){const s=n[r];if(s.pending!==Q){const i=s.pending;s.pending=Q,ke(s,i)}}},!1),e}function xe(t){let e,n=b;return b=null,e=t(),b=n,e}function tn(t){return E===null||(E.cleanups===null?E.cleanups=[t]:E.cleanups.push(t)),t}function it(){const t=ie;if(this.sources&&(this.state||t)){const e=O;O=null,this.state===V||t?le(this):be(this),O=e}if(b){const e=this.observers?this.observers.length:0;b.sources?(b.sources.push(this),b.sourceSlots.push(e)):(b.sources=[this],b.sourceSlots=[e]),this.observers?(this.observers.push(b),this.observerSlots.push(b.sources.length-1)):(this.observers=[b],this.observerSlots=[b.sources.length-1])}return this.value}function ke(t,e,n){if(se)return t.pending===Q&&se.push(t),t.pending=e,e;if(t.comparator&&t.comparator(t.value,e))return e;let r=!1;return t.value=e,t.observers&&t.observers.length&&Je(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s];r&&ie.disposed.has(i),(r&&!i.tState||!r&&!i.state)&&(i.pure?O.push(i):D.push(i),i.observers&&ot(i)),r||(i.state=V)}if(O.length>1e6)throw O=[],new Error},!1),e}function le(t){if(!t.fn)return;De(t);const e=E,n=b,r=Me;b=E=t,nn(t,t.value,r),b=n,E=e}function nn(t,e,n){let r;try{r=t.fn(e)}catch(s){lt(s)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?ke(t,r):t.value=r,t.updatedAt=n)}function Ie(t,e,n,r=V,s){const i={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:E,context:null,pure:n};return E===null||E!==tt&&(E.owned?E.owned.push(i):E.owned=[i]),i}function ue(t){const e=ie;if(t.state===0||e)return;if(t.state===we||e)return be(t);if(t.suspense&&xe(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Me);)(t.state||e)&&n.push(t);for(let r=n.length-1;r>=0;r--)if(t=n[r],t.state===V||e)le(t);else if(t.state===we||e){const s=O;O=null,be(t,n[0]),O=s}}function Je(t,e){if(O)return t();let n=!1;e||(O=[]),D?n=!0:D=[],Me++;try{const r=t();return rn(n),r}catch(r){lt(r)}finally{O=null,n||(D=null)}}function rn(t){O&&(st(O),O=null),!t&&(D.length?en(()=>{et(D),D=null}):D=null)}function st(t){for(let e=0;e<t.length;e++)ue(t[e])}function sn(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:ue(s)}q.context&&Xt();const r=t.length;for(e=0;e<n;e++)ue(t[e]);for(e=r;e<t.length;e++)ue(t[e])}function be(t,e){const n=ie;t.state=0;for(let r=0;r<t.sources.length;r+=1){const s=t.sources[r];s.sources&&(s.state===V||n?s!==e&&ue(s):(s.state===we||n)&&be(s,e))}}function ot(t){const e=ie;for(let n=0;n<t.observers.length;n+=1){const r=t.observers[n];(!r.state||e)&&(r.state=we,r.pure?O.push(r):D.push(r),r.observers&&ot(r))}}function De(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),o=n.observerSlots.pop();r<s.length&&(i.sourceSlots[o]=r,s[r]=i,n.observerSlots[r]=o)}}if(t.owned){for(e=0;e<t.owned.length;e++)De(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function lt(t){throw t}const on=Symbol("fallback");function ut(t){for(let e=0;e<t.length;e++)t[e]()}function ln(t,e,n={}){let r=[],s=[],i=[],o=0,l=e.length>1?[]:null;return tn(()=>ut(i)),()=>{let c=t()||[],u,a;return c[Zt],xe(()=>{let d=c.length,h,_,p,A,J,M,$,j,U;if(d===0)o!==0&&(ut(i),i=[],r=[],s=[],o=0,l&&(l=[])),n.fallback&&(r=[on],s[0]=oe(Re=>(i[0]=Re,n.fallback())),o=1);else if(o===0){for(s=new Array(d),a=0;a<d;a++)r[a]=c[a],s[a]=oe(f);o=d}else{for(p=new Array(d),A=new Array(d),l&&(J=new Array(d)),M=0,$=Math.min(o,d);M<$&&r[M]===c[M];M++);for($=o-1,j=d-1;$>=M&&j>=M&&r[$]===c[j];$--,j--)p[j]=s[$],A[j]=i[$],l&&(J[j]=l[$]);for(h=new Map,_=new Array(j+1),a=j;a>=M;a--)U=c[a],u=h.get(U),_[a]=u===void 0?-1:u,h.set(U,a);for(u=M;u<=$;u++)U=r[u],a=h.get(U),a!==void 0&&a!==-1?(p[a]=s[u],A[a]=i[u],l&&(J[a]=l[u]),a=_[a],h.set(U,a)):i[u]();for(a=M;a<d;a++)a in p?(s[a]=p[a],i[a]=A[a],l&&(l[a]=J[a],l[a](a))):s[a]=oe(f);s=s.slice(0,o=d),r=c.slice(0)}return s});function f(d){if(i[a]=d,l){const[h,_]=nt(a);return l[a]=_,e(c[a],h)}return e(c[a])}}}function P(t,e){return xe(()=>t(e||{}))}function F(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Pe(ln(()=>t.each,t.children,e||void 0))}const un=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],an=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...un]),cn=new Set(["innerHTML","textContent","innerText","children"]),fn={className:"class",htmlFor:"for"},at={class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"},dn=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),hn={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function mn(t,e,n){let r=n.length,s=e.length,i=r,o=0,l=0,c=e[s-1].nextSibling,u=null;for(;o<s||l<i;){if(e[o]===n[l]){o++,l++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===o){const a=i<r?l?n[l-1].nextSibling:n[i-l]:c;for(;l<i;)t.insertBefore(n[l++],a)}else if(i===l)for(;o<s;)(!u||!u.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[i-1]&&n[l]===e[s-1]){const a=e[--s].nextSibling;t.insertBefore(n[l++],e[o++].nextSibling),t.insertBefore(n[--i],a),e[s]=n[i]}else{if(!u){u=new Map;let f=l;for(;f<i;)u.set(n[f],f++)}const a=u.get(e[o]);if(a!=null)if(l<a&&a<i){let f=o,d=1,h;for(;++f<s&&f<i&&!((h=u.get(e[f]))==null||h!==a+d);)d++;if(d>a-l){const _=e[o];for(;l<a;)t.insertBefore(n[l++],_)}else t.replaceChild(n[l++],e[o++])}else o++;else e[o++].remove()}}}const ct="_$DX_DELEGATE";function ae(t,e,n){let r;return oe(s=>{r=s,e===document?t():g(e,t(),e.firstChild?null:void 0,n)}),()=>{r(),e.textContent=""}}function R(t,e,n){const r=document.createElement("template");r.innerHTML=t;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function _n(t,e=window.document){const n=e[ct]||(e[ct]=new Set);for(let r=0,s=t.length;r<s;r++){const i=t[r];n.has(i)||(n.add(i),e.addEventListener(i,Sn))}}function Se(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function gn(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function y(t,e){e==null?t.removeAttribute("class"):t.className=e}function vn(t,e,n,r){r?Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n:Array.isArray(n)?t.addEventListener(e,s=>n[0](n[1],s)):t.addEventListener(e,n)}function Ce(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let i,o;for(i=0,o=s.length;i<o;i++){const l=s[i];!l||l==="undefined"||e[l]||(ft(t,l,!1),delete n[l])}for(i=0,o=r.length;i<o;i++){const l=r[i],c=!!e[l];!l||l==="undefined"||n[l]===c||!c||(ft(t,l,!0),n[l]=c)}return n}function pn(t,e,n={}){const r=t.style,s=typeof n=="string";if(e==null&&s||typeof e=="string")return r.cssText=e;s&&(r.cssText=void 0,n={}),e||(e={});let i,o;for(o in n)e[o]==null&&r.removeProperty(o),delete n[o];for(o in e)i=e[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function yn(t,e,n,r){typeof e=="function"?N(s=>ht(t,e(),s,n,r)):ht(t,e,void 0,n,r)}function g(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return X(t,e,r,n);N(s=>X(t,e(),s,n),r)}function wn(t,e,n,r,s={},i=!1){e||(e={});for(const o in s)if(!(o in e)){if(o==="children")continue;dt(t,o,null,s[o],n,i)}for(const o in e){if(o==="children"){r||X(t,e.children);continue}const l=e[o];s[o]=dt(t,o,l,s[o],n,i)}}function bn(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function ft(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,i=r.length;s<i;s++)t.classList.toggle(r[s],n)}function dt(t,e,n,r,s,i){let o,l,c;if(e==="style")return pn(t,n,r);if(e==="classList")return Ce(t,n,r);if(n===r)return r;if(e==="ref")i||n(t);else if(e.slice(0,3)==="on:")t.addEventListener(e.slice(3),n);else if(e.slice(0,10)==="oncapture:")t.addEventListener(e.slice(10),n,!0);else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),a=dn.has(u);vn(t,u,n,a),a&&_n([u])}else if((c=cn.has(e))||!s&&(at[e]||(l=an.has(e)))||(o=t.nodeName.includes("-")))e==="class"||e==="className"?y(t,n):o&&!l&&!c?t[bn(e)]=n:t[at[e]||e]=n;else{const u=s&&e.indexOf(":")>-1&&hn[e.split(":")[0]];u?gn(t,u,e,n):Se(t,fn[e]||e,n)}return n}function Sn(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}}),q.registry&&!q.done&&(q.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[e];if(r&&!n.disabled){const s=n[`${e}Data`];if(s!==void 0?r(s,t):r(t),t.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function ht(t,e,n={},r,s){return e||(e={}),!s&&"children"in e&&N(()=>n.children=X(t,e.children,n.children)),e.ref&&e.ref(t),N(()=>wn(t,e,r,!0,n,!0)),n}function X(t,e,n,r,s){for(q.context&&!n&&(n=[...t.childNodes]);typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,o=r!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(q.context)return n;if(i==="number"&&(e=e.toString()),o){let l=n[0];l&&l.nodeType===3?l.data=e:l=document.createTextNode(e),n=Y(t,n,r,l)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean"){if(q.context)return n;n=Y(t,n,r)}else{if(i==="function")return N(()=>{let l=e();for(;typeof l=="function";)l=l();n=X(t,l,n,r)}),()=>n;if(Array.isArray(e)){const l=[];if(Te(l,e,s))return N(()=>n=X(t,l,n,r,!0)),()=>n;if(q.context){for(let c=0;c<l.length;c++)if(l[c].parentNode)return n=l}if(l.length===0){if(n=Y(t,n,r),o)return n}else Array.isArray(n)?n.length===0?mt(t,l,r):mn(t,n,l):(n&&Y(t),mt(t,l));n=l}else if(e instanceof Node){if(q.context&&e.parentNode)return n=o?[e]:e;if(Array.isArray(n)){if(o)return n=Y(t,n,r,e);Y(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Te(t,e,n){let r=!1;for(let s=0,i=e.length;s<i;s++){let o=e[s],l;if(o instanceof Node)t.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))r=Te(t,o)||r;else if((l=typeof o)=="string")t.push(document.createTextNode(o));else if(l==="function")if(n){for(;typeof o=="function";)o=o();r=Te(t,Array.isArray(o)?o:[o])||r}else t.push(o),r=!0;else t.push(document.createTextNode(o.toString()))}return r}function mt(t,e,n){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function Y(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;o>=0;o--){const l=e[o];if(s!==l){const c=l.parentNode===t;!i&&!o?c?t.replaceChild(s,l):t.insertBefore(s,n):c&&l.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}var _t=`._mainBody_o6t0e_1{opacity:.5}._mainBody_o6t0e_1 *{font-size:.75rem;margin:0}._mainBody_o6t0e_1 button,._clickable_o6t0e_11{cursor:pointer}._stateWorkingOn_o6t0e_14{color:#00f}._stateSure_o6t0e_17{color:green}._stateNotSure_o6t0e_20{color:red}._answerMsg_o6t0e_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_o6t0e_23 ul{padding-left:1rem}._answerMsgName_o6t0e_32{font-weight:700}._answerMark_o6t0e_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_o6t0e_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_o6t0e_35 input{height:max-content;width:100%}._answerDetail_o6t0e_53 ._stateWorkingOn_o6t0e_14,._answerDetail_o6t0e_53 ._stateSure_o6t0e_17,._answerDetail_o6t0e_53 ._stateNotSure_o6t0e_20{font-weight:700}._answerDetail_o6t0e_53 ul{padding-left:1.5rem}._answerDetail_o6t0e_53 img{height:auto;width:80%}._answerDetailShortAnswer_o6t0e_65{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem}._answerDetailFill_o6t0e_71{white-space:pre}._settings_o6t0e_74{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_o6t0e_82{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_o6t0e_82 label{font-weight:700}._settingsEntry_o6t0e_82 input{height:max-content;text-align:right}._settingsSubmit_o6t0e_96{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_o6t0e_102{margin-right:.5rem}._about_o6t0e_105 p{margin-bottom:.25rem}._about_o6t0e_105 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_o6t0e_105 ul li{margin-bottom:.25rem}._uploadImg_o6t0e_115{display:flex;flex-direction:column}._uploadImg_o6t0e_115 img{width:100%;height:auto}._uploadImgImage_o6t0e_123{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_o6t0e_128{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`;const Cn=R("<title> </title>"),Nn=R("<style></style>");function gt(t,e){Le(t!=null,e!=null?e:"null value")}function vt(t,e,n){Le(e instanceof t,n!=null?n:"not HTMLElement")}function Le(t,e){if(t!==!0)throw Error(e!=null?e:"assertion failed")}function Z(...t){return t}function je(t){const e=window.open("","",Object.entries(t).map(([r,s])=>`${r}=${s}`).join(","));gt(e);const n=()=>e.close();return window.addEventListener("unload",n),e.addEventListener("close",()=>window.removeEventListener("unload",n)),ae(()=>[(()=>{const r=Cn.cloneNode(!0),s=r.firstChild;return N(()=>s.data=t.title),r})(),(()=>{const r=Nn.cloneNode(!0);return r.textContent=_t,r})()],e.document.head),e}function qe(t,...e){}function pt(t,e){const n=new URL(t,self.location.origin);for(const[r,s]of Object.entries(e!=null?e:{}))n.searchParams.set(r,s);return n}function yt(t){const e=GM_getValue(t);if(e!==void 0)return e.contents}function ce(t,e){GM_setValue(t,{contents:e})}function $n(){var n;const t=[{name:"202205231915_gm_value",up(){ce("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const r of["username","server","sync_answers","sort_problems"])ce(r,GM_getValue(r))}}],e=(n=yt("migrations"))!=null?n:[];for(const{name:r,idx:s}of e)if(r!==t[s].name)throw new Error("bad migrations");for(const{name:r,up:s}of t.slice(e.length))s();ce("migrations",t.map((r,s)=>({name:r.name,idx:s})))}class fe{constructor(e,n){k(this,"_name");k(this,"_init");k(this,"inited",!1);k(this,"_cached");this._name=e,this._init=n}get(){if(!this.inited){const e=yt(this._name);e===void 0&&this._init!==void 0&&ce(this._name,this._init),this._cached=e!=null?e:this._init,this.inited=!0}return this._cached}set(e){e!==void 0&&(ce(this._name,e),this._cached=e)}}const Be=new fe("username"),We=new fe("server"),Fe=new fe("sync_answers",!0),Ue=new fe("sort_problems",!1),He=new fe("no_leave_check",!0);class Rn{constructor(){k(this,"token");k(this,"client");k(this,"examId");k(this,"paper");k(this,"queue",new Map);k(this,"onmsg",[])}onmessage(e){this.onmsg.push(e)}updateQueue(e,n){let r=this.queue.get(e);r!==void 0?n(r):(r={},n(r),this.queue.set(e,r))}updateAnswer(e,n){this.updateQueue(e,r=>r.result=n)}updateState(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.state=n})}updateMsg(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.msg=n})}async watch(e){return new Promise((n,r)=>{const s=setInterval(()=>{this.sendQueue().catch(i=>{clearInterval(s),alert("\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5F02\u5E38"),r(i)})},e)})}async login(e,n){this.examId=e,this.paper=n}async sendQueue(){const e=Fe.get(),n=We.get(),r=Be.get();if(e!==!0||this.queue.size<1||n===void 0||r===void 0||this.examId===void 0||this.paper===void 0)return;let s=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const o=new w.JSONRPCClient(l=>new Promise((c,u)=>{GM.xmlHttpRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(l),onload:a=>{a.status===200?(o.receive(JSON.parse(a.responseText)),c()):u(new Error(a.statusText))},onerror:a=>u(a.statusText)})}));this.client=o}if(this.token===void 0){qe(`login to server: ${r}, ${this.examId}`);const o=await this.client.request("login",[r,this.examId,this.paper]);this.token=o}const i=await this.client.request("answer_problem",[this.token,s.map(([o,{result:l,context:c}])=>({problem_id:o,result:l,context:c}))]);this.onmsg.forEach(o=>o(i))}}const B=new Rn;function En(t){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const s=t.call(this,pt(r)),i=this.send;this.send=function(o){s!==void 0?s(o).then(l=>{i.call(this,l),this.send=i}).catch(qe):(i.call(this,o),this.send=i)},e.apply(this,arguments)}}var T=(t=>(t[t.SingleChoice=1]="SingleChoice",t[t.MultipleChoice=2]="MultipleChoice",t[t.Polling=3]="Polling",t[t.FillBlank=4]="FillBlank",t[t.ShortAnswer=5]="ShortAnswer",t[t.Judgement=6]="Judgement",t))(T||{}),L=(t=>(t[t.WorkingOn=0]="WorkingOn",t[t.Sure=1]="Sure",t[t.NotSure=2]="NotSure",t))(L||{}),v={mainBody:"_mainBody_o6t0e_1",clickable:"_clickable_o6t0e_11",stateWorkingOn:"_stateWorkingOn_o6t0e_14",stateSure:"_stateSure_o6t0e_17",stateNotSure:"_stateNotSure_o6t0e_20",answerMsg:"_answerMsg_o6t0e_23",answerMsgName:"_answerMsgName_o6t0e_32",answerMark:"_answerMark_o6t0e_35",answerDetail:"_answerDetail_o6t0e_53",answerDetailShortAnswer:"_answerDetailShortAnswer_o6t0e_65",answerDetailFill:"_answerDetailFill_o6t0e_71",settings:"_settings_o6t0e_74",settingsEntry:"_settingsEntry_o6t0e_82",settingsSubmit:"_settingsSubmit_o6t0e_96",settingsSubmitTip:"_settingsSubmitTip_o6t0e_102",about:"_about_o6t0e_105",uploadImg:"_uploadImg_o6t0e_115",uploadImgImage:"_uploadImgImage_o6t0e_123",uploadImgConfirm:"_uploadImgConfirm_o6t0e_128"};class Ne{constructor(e){k(this,"_lazy");this._lazy=e}static from(e){return new Ne(()=>e)}then(e){return new Ne(()=>e(this.exec()))}exec(){return this._lazy()}}function x(t){return Ne.from(t)}function wt(t){return function*(e){for(const n of e)yield t(n)}}function*Ve(t){let e=0;for(const n of t)yield[e++,n]}function On(t){return function*(e){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();for(;;){const s=n.next(),i=r.next();if(s.done!==!0&&i.done!==!0)yield[s.value,i.value];else return}}}function ee(t){return function(e){return Array.from(e).sort(t)}}function An(t){for(const e of t)return e}function G(t,e){return function(n){let r=t;for(const s of n)r=e(r,s);return r}}function de(t){return Array.from(t)}function bt(t){return function(e){for(const n of e)t(n)}}const Mn=R('<div><fieldset><legend>\u6807\u8BB0</legend><input type="text" placeholder="\u7559\u8A00"><button type="button">\u6211\u6B63\u5728\u505A</button><button type="button">\u6211\u5F88\u786E\u5B9A</button><button type="button">\u6211\u4E0D\u786E\u5B9A</button></fieldset><div><fieldset><legend> \u7559\u8A00 </legend><ul></ul></fieldset><div></div></div></div>'),Pn=R("<li><span></span></li>"),St=R("<div><p><strong></strong></p><ul></ul></div>"),Ct=R("<li></li>"),xn=R("<li><p></p><ul></ul></li>"),kn=R("<div></div>"),In=R("<ul></ul>"),Jn=R("<li><a></a></li>"),Dn=R("<p><strong></strong></p>");function Ge(t,e){return t===e?0:t<e?-1:1}function Nt(t){switch(t){case L.Sure:return 0;case L.WorkingOn:return 1;case L.NotSure:return 2}}function $t([t,e],[n,r]){if(e===void 0)return r===void 0?Ge(t,n):1;if(r===void 0)return-1;{const s=Nt(r)-Nt(e);return s===0?Ge(t,n):s}}function Rt([t,e],[n,r]){var s,i;return $t(Z(t,(s=e.context)==null?void 0:s.state),Z(n,(i=r.context)==null?void 0:i.state))}function Et([t,e],[n,r]){return $t(Z(t,e==null?void 0:e.state),Z(n,r==null?void 0:r.state))}function $e(t){if(t!==void 0)switch(t){case L.WorkingOn:return v.stateWorkingOn;case L.NotSure:return v.stateNotSure;case L.Sure:return v.stateSure}}function Ot(t,e){return`${Math.floor(t*100/e)}%`}function ze([t],[e]){return Ge(t,e)}class Ke{constructor(e,n,r){k(this,"_details",new Map);this.updateUI=oe(()=>{const[s,i]=nt(new Map,{equals:!1}),o=()=>i(this._details),l=r(s);let c=n.querySelector(".item-type");return vt(HTMLElement,c),c.classList.add(v.clickable),c.addEventListener("click",()=>{let u=c==null?void 0:c.getBoundingClientRect();const a=je({title:"\u8BE6\u7EC6\u7B54\u6848",height:300,width:350,top:u==null?void 0:u.top,left:u==null?void 0:u.left});ae(()=>(()=>{const f=Mn.cloneNode(!0),d=f.firstChild,h=d.firstChild,_=h.nextSibling,p=_.nextSibling,A=p.nextSibling,J=A.nextSibling,M=d.nextSibling,$=M.firstChild,j=$.firstChild,U=j.nextSibling,Re=$.nextSibling;return _.addEventListener("change",S=>B.updateMsg(e,S.currentTarget.value)),p.addEventListener("click",()=>B.updateState(e,L.WorkingOn)),A.addEventListener("click",()=>B.updateState(e,L.Sure)),J.addEventListener("click",()=>B.updateState(e,L.NotSure)),g(U,P(F,{get each(){return x(s()).then(ee(Rt)).then(de).exec()},children:([S,{context:z}])=>{if(z===void 0)return;let W=z.msg;if(z.state===L.WorkingOn&&(W=W!=null?W:"\u6211\u6B63\u5728\u505A"),W!==void 0)return(()=>{const K=Pn.cloneNode(!0),me=K.firstChild;return g(me,`${S}: `),g(K,W,null),N(H=>{const Ee=$e(z.state),Oe=v.answerMsgName;return Ee!==H._v$8&&y(K,H._v$8=Ee),Oe!==H._v$9&&y(me,H._v$9=Oe),H},{_v$8:void 0,_v$9:void 0}),K})()}})),g(Re,P(l,{})),N(S=>{const z=v.mainBody,W=v.answerMark,K=v.stateWorkingOn,me=v.stateSure,H=v.stateNotSure,Ee={[v.answerMsg]:!0},Oe={[v.answerDetail]:!0};return z!==S._v$&&y(f,S._v$=z),W!==S._v$2&&y(d,S._v$2=W),K!==S._v$3&&y(p,S._v$3=K),me!==S._v$4&&y(A,S._v$4=me),H!==S._v$5&&y(J,S._v$5=H),S._v$6=Ce($,Ee,S._v$6),S._v$7=Ce(Re,Oe,S._v$7),S},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),f})(),a.document.body)}),o})}updateAnswer(e,n){this._details.set(e,n)}}class At{constructor(e){this._ele=e}setContent(e){this._ele.setAttribute("title",e)}}class Tn extends Ke{constructor(e,n,r){const s=x(n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput")).then(i=>Array.from(i)).then(Ve).then(G(new Map,(i,[o,l])=>i.set(String.fromCharCode(o+65),new At(l)))).exec();super(e,n,i=>{const o=Pe(()=>x(i()).then(G(new Map,(l,[c,{answer:u,context:a}])=>{var f;if(u!==void 0)for(let d of u){d=r(d);const h=(f=l.get(d))!=null?f:[];h.push([c,a]),l.set(d,h)}return l})).then(ee(ze)).then(de).exec());return rt(()=>{x(o()).then(bt(([l,c])=>{var u;(u=s.get(l))==null||u.setContent(Ot(c.length,i().size))}))}),()=>P(F,{get each(){return o()},children:([l,c])=>(()=>{const u=St.cloneNode(!0),a=u.firstChild,f=a.firstChild,d=a.nextSibling;return g(f,l),g(d,P(F,{get each(){return c.sort(Et)},children:([h,_])=>(()=>{const p=Ct.cloneNode(!0);return g(p,h),N(()=>y(p,$e(_==null?void 0:_.state))),p})()})),u})()})})}}class Ln extends Ke{constructor(e,n){const r=x(n.querySelectorAll(".item-body .blank-item-dynamic")).then(Array.from).then(Ve).then(G(new Map,(s,[i,o])=>s.set(String.fromCharCode(i+49),new At(o)))).exec();super(e,n,s=>{const i=()=>x(s()).then(G(new Map,(o,[l,{answer:c,context:u}])=>c===void 0?o:x(c).then(Object.entries).then(G(o,(a,[f,d])=>{var p,A;d=d.trim();const h=(p=a.get(f))!=null?p:new Map,_=(A=h.get(d))!=null?A:[];return _.push([l,u]),a.set(f,h.set(d,_))})).exec())).then(wt(([o,l])=>Z(o,x(l).then(ee(ze)).then(de).exec()))).then(ee(ze)).then(de).exec();return rt(()=>{x(i()).then(bt(([o,l])=>{var u;const c=x(l).then(wt(([a,f])=>Z(a,f.length))).then(ee(([a,f],[d,h])=>h-f)).then(An).exec();(u=r.get(o))==null||u.setContent(c===void 0?"":`(${Ot(c[1],s().size)}) ${c[0]}`)}))}),()=>P(F,{get each(){return i()},children:([o,l])=>(()=>{const c=St.cloneNode(!0),u=c.firstChild,a=u.firstChild,f=u.nextSibling;return g(a,`#${o}`),g(f,P(F,{each:l,children:([d,h])=>{if(d!=="")return(()=>{const _=xn.cloneNode(!0),p=_.firstChild,A=p.nextSibling;return g(p,d),g(A,P(F,{get each(){return h.sort(Et)},children:([J,M])=>(()=>{const $=Ct.cloneNode(!0);return g($,J),N(()=>y($,$e(M==null?void 0:M.state))),$})()})),N(()=>y(p,v.answerDetailFill)),_})()}})),c})()})})}}class jn extends Ke{constructor(e,n){super(e,n,r=>{const s=Pe(()=>x(r()).then(ee(Rt)).then(de).exec());return()=>P(F,{get each(){return s()},children:([i,{answer:o,context:l}])=>{var d;const c=o==null?void 0:o.content,u=(d=o==null?void 0:o.attachments)==null?void 0:d.filelist;let a,f;if(c!==void 0&&(a=(()=>{const h=kn.cloneNode(!0);return h.innerHTML=c,N(()=>y(h,v.answerDetailShortAnswer)),h})()),u!==void 0&&(f=(()=>{const h=In.cloneNode(!0);return g(h,P(F,{each:u,children:({fileUrl:_,fileName:p})=>(()=>{const A=Jn.cloneNode(!0),J=A.firstChild;return Se(J,"href",_),g(J,p),A})()})),h})()),!(a===void 0&&f===void 0))return[(()=>{const h=Dn.cloneNode(!0),_=h.firstChild;return g(_,i),N(()=>y(h,$e(l==null?void 0:l.state))),h})(),a,f]}})})}}const qn=R("<div><label></label><input></div>"),Bn=R('<div><form><div><p><i> *\u66F4\u6539\u8BBE\u7F6E\u540E\u8BF7\u5237\u65B0\u9875\u9762 </i></p><button type="submit"> \u63D0\u4EA4 </button></div></form><div><p><strong> \u529F\u80FD\u7279\u6027\uFF1A </strong></p><ul></ul></div></div>'),Wn=R("<li><strong></strong></li>"),Fn=R("<div></div>");function he(t){const e=kt(xt({},t.extra),{name:t.name});return(()=>{const n=qn.cloneNode(!0),r=n.firstChild,s=r.nextSibling;return g(r,()=>t.title),yn(s,e,!1,!1),N(i=>{const o=v.settingsEntry,l=t.name;return o!==i._v$&&y(n,i._v$=o),l!==i._v$2&&Se(r,"for",i._v$2=l),i},{_v$:void 0,_v$2:void 0}),n})()}function Un(t){const e={};function n(s){return i=>e[s]=i.currentTarget.value}function r(s){return i=>e[s]=i.currentTarget.checked}return(()=>{const s=Bn.cloneNode(!0),i=s.firstChild,o=i.firstChild,l=o.firstChild,c=i.nextSibling,u=c.firstChild,a=u.nextSibling;return i.addEventListener("submit",f=>{f.preventDefault(),Be.set(e.username),We.set(e.server),Fe.set(e.syncAnswers),Ue.set(e.sortProblems),He.set(e.noLeaveCheck),t.onSubmit()}),g(i,P(he,{name:"username",title:"\u7528\u6237\u540D",get extra(){return{type:"text",pattern:"^[a-z][a-z0-9_]*$",title:"\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF",required:!0,value:Be.get(),onChange:n("username")}}}),o),g(i,P(he,{name:"server",title:"\u670D\u52A1\u5668",get extra(){return{type:"url",required:!0,value:We.get(),onChange:n("server")}}}),o),g(i,P(he,{name:"sync_answers",title:"\u540C\u6B65\u7B54\u6848",get extra(){return{type:"checkbox",checked:Fe.get(),onChange:r("syncAnswers")}}}),o),g(i,P(he,{name:"sort_problems",title:"\u6392\u5E8F\u9898\u76EE",get extra(){return{type:"checkbox",checked:Ue.get(),onChange:r("sortProblems")}}}),o),g(i,P(he,{name:"no_leave_check",title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B",get extra(){return{type:"checkbox",checked:He.get(),onChange:r("noLeaveCheck")}}}),o),g(a,()=>[["\u540C\u6B65\u7B54\u6848\uFF1A","\u70B9\u51FB\u9898\u76EE\u663E\u793A\u8BE6\u7EC6\u7B54\u6848\uFF0C\u5728\u9009\u9879/\u586B\u7A7A\u5904\u60AC\u505C\u663E\u793A\u7B80\u7565\u7B54\u6848"],["\u6392\u5E8F\u9898\u76EE\uFF1A","\u6839\u636E ID \u5BF9\u9898\u76EE\u548C\u9009\u9879\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F"],["\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B\uFF1A","\u968F\u610F\u5207\u6362\u9875\u9762\u3001\u7A97\u53E3\u4E0D\u4F1A\u88AB\u53D1\u73B0"],["\u62E6\u622A\u4E0A\u4F20\u622A\u56FE\uFF1A","\u4EC5\u5F53\u7528\u6237\u786E\u8BA4\u540E\uFF0C\u624D\u4F1A\u4E0A\u4F20\u622A\u56FE"],["\u62E6\u622A\u5F02\u5E38\u72B6\u6001\uFF1A","\u5373\u4F7F\u672C\u5730\u663E\u793A\u5F02\u5E38\u4E5F\u4E0D\u4F1A\u63A8\u9001\u5230\u670D\u52A1\u5668"]].map(([f,d])=>(()=>{const h=Wn.cloneNode(!0),_=h.firstChild;return g(_,f),g(h,d,null),h})())),N(f=>{const d=v.settingsSubmit,h=v.settingsSubmitTip,_=v.about;return d!==f._v$3&&y(o,f._v$3=d),h!==f._v$4&&y(l,f._v$4=h),_!==f._v$5&&y(c,f._v$5=_),f},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),s})()}function Hn(){const t=je({title:"\u8BBE\u7F6E",width:350,height:300});ae(()=>(()=>{const e=Fn.cloneNode(!0);return g(e,P(Un,{onSubmit:()=>t.close()})),N(()=>y(e,v.mainBody)),e})(),t.document.body)}const Vn=R("<style></style>"),Gn=R('<div><div><button type="button">\u786E\u8BA4\u4E0A\u4F20</button><span><i>*\u5173\u95ED\u7A97\u53E3\u4EE5\u53D6\u6D88\u4E0A\u4F20</i></span></div><div><img></div></div>');class zn{constructor(e){ae(()=>(()=>{const s=Vn.cloneNode(!0);return s.textContent=_t,s})(),document.head);const n=document.body.querySelector(".header-title");vt(HTMLElement,n),n.classList.add(v.clickable),n.addEventListener("click",()=>Hn());let r=Array.from(document.body.querySelectorAll(".exam-main--body .subject-item"));Le(r.length===e.length,"number subject items mismatches problems"),this._details=x(r).then(On(e)).then(G(new Map,(s,[i,o])=>{let l;switch(o.ProblemType){case T.SingleChoice:case T.MultipleChoice:case T.Polling:case T.Judgement:gt(o.Options,"null choices");const c=o.ProblemType===T.Judgement?new Map([["true","\u6B63\u786E"],["false","\u9519\u8BEF"]]):x(o.Options).then(Ve).then(G(new Map,(u,[a,{key:f}])=>u.set(f,String.fromCharCode(65+a)))).exec();l=new Tn(o.ProblemID,i,u=>{var a;return(a=c.get(u))!=null?a:u});break;case T.FillBlank:l=new Ln(o.ProblemID,i);break;case T.ShortAnswer:l=new jn(o.ProblemID,i);break}return s.set(o.ProblemID,l)})).exec()}updateAnswer({username:e,problem_id:n,result:r,context:s}){var i;(i=this._details.get(n))==null||i.updateAnswer(e,{answer:r,context:s})}updateUI(){this._details.forEach(e=>e.updateUI())}}function Kn(t,e){const n=je({title:"\u4E0A\u4F20\u56FE\u7247",width:400,height:300});ae(()=>(()=>{const r=Gn.cloneNode(!0),s=r.firstChild,i=s.firstChild,o=s.nextSibling,l=o.firstChild;return i.addEventListener("click",()=>{n.close(),e()}),Se(l,"src",t),N(c=>{const u={[v.mainBody]:!0,[v.uploadImg]:!0},a=v.uploadImgConfirm,f=v.uploadImgImage;return c._v$=Ce(r,u,c._v$),a!==c._v$2&&y(s,c._v$2=a),f!==c._v$3&&y(o,c._v$3=f),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),n.document.body)}function Mt(t){return t.forEach(e=>{switch(e.ProblemType){case T.SingleChoice:case T.MultipleChoice:case T.Polling:{e.Options.sort((r,s)=>r.key<s.key?-1:1);break}}}),t.sort((e,n)=>e.ProblemID-n.ProblemID),t}function Qn(t){return Ue.get()===!0&&(t.data.has_problem_dict===!0?t.data.problems=t.data.problems.sort((e,n)=>e.id-n.id).map(e=>(e.problems=Mt(e.problems),e)):t.data.problems=Mt(t.data.problems)),t}function Xn(){document.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0)}async function Yn(){$n(),He.get()===!0&&Xn(),En(function(t){switch(t.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(Qn(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return e}}})}}),this.addEventListener("load",()=>{const e=JSON.parse(this.responseText);let n=[];e.data.has_problem_dict===!0?e.data.problems.forEach(i=>{n=n.concat(i.problems)}):n=e.data.problems;const r=new zn(n);B.onmessage(i=>{i.forEach(o=>r.updateAnswer(o)),r.updateUI()});const s=parseInt(t.searchParams.get("exam_id"));B.login(s,{title:e.data.title,problems:n}),fetch(pt("/exam_room/cache_results",{exam_id:s.toString()}).toString()).then(i=>i.json()).then(i=>i.data.results.forEach(({problem_id:o,result:l})=>B.updateAnswer(o,l))).catch(qe)});return;case"/exam_room/answer_problem":return async e=>{var n;if(typeof e=="string"){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:s,result:i})=>B.updateAnswer(s,i)))}return e};default:return t.hostname==="upload-z1.qiniup.com"?async e=>e instanceof FormData&&e.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>Kn(r.result,()=>n(e)),r.readAsDataURL(e.get("file"))}):e:void 0}}),await B.watch(1e4)}Yn().catch(console.error)});
