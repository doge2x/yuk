// ==UserScript==
// @name         yuk-client
// @version      0.6.1
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(v){typeof define=="function"&&define.amd?define(v):v()})(function(){"use strict";var Ci=Object.defineProperty,Ai=Object.defineProperties;var ki=Object.getOwnPropertyDescriptors;var pn=Object.getOwnPropertySymbols;var Vi=Object.prototype.hasOwnProperty,Ii=Object.prototype.propertyIsEnumerable;var lt=(v,y,O)=>y in v?Ci(v,y,{enumerable:!0,configurable:!0,writable:!0,value:O}):v[y]=O,gn=(v,y)=>{for(var O in y||(y={}))Vi.call(y,O)&&lt(v,O,y[O]);if(pn)for(var O of pn(y))Ii.call(y,O)&&lt(v,O,y[O]);return v},_n=(v,y)=>Ai(v,ki(y));var J=(v,y,O)=>(lt(v,typeof y!="symbol"?y+"":y,O),O);var v=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},y={},O={},Z={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createJSONRPCErrorResponse=e.JSONRPCErrorCode=e.isJSONRPCResponses=e.isJSONRPCResponse=e.isJSONRPCRequests=e.isJSONRPCRequest=e.isJSONRPCID=e.JSONRPC=void 0,e.JSONRPC="2.0";var t=function(o){return typeof o=="string"||typeof o=="number"||o===null};e.isJSONRPCID=t;var n=function(o){return o.jsonrpc===e.JSONRPC&&o.method!==void 0&&o.result===void 0&&o.error===void 0};e.isJSONRPCRequest=n;var r=function(o){return Array.isArray(o)&&o.every(e.isJSONRPCRequest)};e.isJSONRPCRequests=r;var i=function(o){return o.jsonrpc===e.JSONRPC&&o.id!==void 0&&(o.result!==void 0||o.error!==void 0)};e.isJSONRPCResponse=i;var a=function(o){return Array.isArray(o)&&o.every(e.isJSONRPCResponse)};e.isJSONRPCResponses=a,function(o){o[o.ParseError=-32700]="ParseError",o[o.InvalidRequest=-32600]="InvalidRequest",o[o.MethodNotFound=-32601]="MethodNotFound",o[o.InvalidParams=-32602]="InvalidParams",o[o.InternalError=-32603]="InternalError"}(e.JSONRPCErrorCode||(e.JSONRPCErrorCode={}));var u=function(o,s,c,d){var f={code:s,message:c};return d&&(f.data=d),{jsonrpc:e.JSONRPC,id:o,error:f}};e.createJSONRPCErrorResponse=u})(Z);var Q={};Object.defineProperty(Q,"__esModule",{value:!0}),Q.DefaultErrorCode=void 0,Q.DefaultErrorCode=0;var wn=v&&v.__awaiter||function(e,t,n,r){function i(a){return a instanceof n?a:new n(function(u){u(a)})}return new(n||(n=Promise))(function(a,u){function o(d){try{c(r.next(d))}catch(f){u(f)}}function s(d){try{c(r.throw(d))}catch(f){u(f)}}function c(d){d.done?a(d.value):i(d.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},yn=v&&v.__generator||function(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,u;return u={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function o(c){return function(d){return s([c,d])}}function s(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(a=c[0]&2?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){n.label=c[1];break}if(c[0]===6&&n.label<a[1]){n.label=a[1],a=c;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(c);break}a[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(d){c=[6,d],i=0}finally{r=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(O,"__esModule",{value:!0}),O.JSONRPCClient=void 0;var K=Z,be=Q,En=function(){function e(t,n){this._send=t,this.createID=n,this.idToResolveMap=new Map,this.id=0}return e.prototype._createID=function(){return this.createID?this.createID():++this.id},e.prototype.timeout=function(t,n){var r=this;n===void 0&&(n=function(u){return(0,K.createJSONRPCErrorResponse)(u,be.DefaultErrorCode,"Request timeout")});var i=function(u,o){var s=setTimeout(function(){u.forEach(function(c){var d=r.idToResolveMap.get(c);d&&(r.idToResolveMap.delete(c),d(n(c)))})},t);return o().then(function(c){return clearTimeout(s),c},function(c){return clearTimeout(s),Promise.reject(c)})},a=function(u,o){var s=(Array.isArray(u)?u:[u]).map(function(c){return c.id}).filter(dt);return i(s,function(){return r.requestAdvanced(u,o)})};return{request:function(u,o,s){var c=r._createID();return i([c],function(){return r.requestWithID(u,o,s,c)})},requestAdvanced:function(u,o){return a(u,o)}}},e.prototype.request=function(t,n,r){return this.requestWithID(t,n,r,this._createID())},e.prototype.requestWithID=function(t,n,r,i){return wn(this,void 0,void 0,function(){var a,u;return yn(this,function(o){switch(o.label){case 0:return a={jsonrpc:K.JSONRPC,method:t,params:n,id:i},[4,this.requestAdvanced(a,r)];case 1:return u=o.sent(),u.result!==void 0&&!u.error?[2,u.result]:u.result===void 0&&u.error?[2,Promise.reject(new Error(u.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},e.prototype.requestAdvanced=function(t,n){var r=this,i=Array.isArray(t);Array.isArray(t)||(t=[t]);var a=t.filter(function(s){return dt(s.id)}),u=a.map(function(s){return new Promise(function(c){return r.idToResolveMap.set(s.id,c)})}),o=Promise.all(u).then(function(s){return i||!s.length?s:s[0]});return this.send(i?t:t[0],n).then(function(){return o},function(s){return a.forEach(function(c){r.receive((0,K.createJSONRPCErrorResponse)(c.id,be.DefaultErrorCode,s&&s.message||"Failed to send a request"))}),o})},e.prototype.notify=function(t,n,r){this.send({jsonrpc:K.JSONRPC,method:t,params:n},r).then(void 0,function(){})},e.prototype.send=function(t,n){return this._send(t,n)},e.prototype.rejectAllPendingRequests=function(t){this.idToResolveMap.forEach(function(n,r){return n((0,K.createJSONRPCErrorResponse)(r,be.DefaultErrorCode,t))}),this.idToResolveMap.clear()},e.prototype.receive=function(t){var n=this;Array.isArray(t)||(t=[t]),t.forEach(function(r){var i=n.idToResolveMap.get(r.id);i&&(n.idToResolveMap.delete(r.id),i(r))})},e}();O.JSONRPCClient=En;var dt=function(e){return e!=null},oe={},ce=v&&v.__assign||function(){return ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ce.apply(this,arguments)},ft=v&&v.__awaiter||function(e,t,n,r){function i(a){return a instanceof n?a:new n(function(u){u(a)})}return new(n||(n=Promise))(function(a,u){function o(d){try{c(r.next(d))}catch(f){u(f)}}function s(d){try{c(r.throw(d))}catch(f){u(f)}}function c(d){d.done?a(d.value):i(d.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},vt=v&&v.__generator||function(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,u;return u={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function o(c){return function(d){return s([c,d])}}function s(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(a=c[0]&2?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){n.label=c[1];break}if(c[0]===6&&n.label<a[1]){n.label=a[1],a=c;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(c);break}a[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(d){c=[6,d],i=0}finally{r=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},Sn=v&&v.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))};Object.defineProperty(oe,"__esModule",{value:!0}),oe.JSONRPCServer=void 0;var k=Z,On=Q,bn=function(){return(0,k.createJSONRPCErrorResponse)(null,k.JSONRPCErrorCode.ParseError,"Parse error")},Mn=function(e){return(0,k.createJSONRPCErrorResponse)((0,k.isJSONRPCID)(e.id)?e.id:null,k.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Nn=function(e){return(0,k.createJSONRPCErrorResponse)(e,k.JSONRPCErrorCode.MethodNotFound,"Method not found")},Dn=function(){function e(t){t===void 0&&(t={});var n;this.mapErrorToJSONRPCErrorResponse=kn,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=t.errorListener)!==null&&n!==void 0?n:console.warn}return e.prototype.addMethod=function(t,n){this.addMethodAdvanced(t,this.toJSONRPCMethod(n))},e.prototype.toJSONRPCMethod=function(t){return function(n,r){var i=t(n.params,r);return Promise.resolve(i).then(function(a){return An(n.id,a)})}},e.prototype.addMethodAdvanced=function(t,n){var r;this.nameToMethodDictionary=ce(ce({},this.nameToMethodDictionary),(r={},r[t]=n,r))},e.prototype.receiveJSON=function(t,n){var r=this.tryParseRequestJSON(t);return r?this.receive(r,n):Promise.resolve(bn())},e.prototype.tryParseRequestJSON=function(t){try{return JSON.parse(t)}catch{return null}},e.prototype.receive=function(t,n){return Array.isArray(t)?this.receiveMultiple(t,n):this.receiveSingle(t,n)},e.prototype.receiveMultiple=function(t,n){return ft(this,void 0,void 0,function(){var r,i=this;return vt(this,function(a){switch(a.label){case 0:return[4,Promise.all(t.map(function(u){return i.receiveSingle(u,n)}))];case 1:return r=a.sent().filter(Rn),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},e.prototype.receiveSingle=function(t,n){return ft(this,void 0,void 0,function(){var r,i;return vt(this,function(a){switch(a.label){case 0:return r=this.nameToMethodDictionary[t.method],(0,k.isJSONRPCRequest)(t)?[3,1]:[2,Mn(t)];case 1:return r?[4,this.callMethod(r,t,n)]:[3,3];case 2:return i=a.sent(),[2,Vn(t,i)];case 3:return t.id!==void 0?[2,Nn(t.id)]:[2,null];case 4:return[2]}})})},e.prototype.applyMiddleware=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Sn([this.middleware],t,!0)):this.middleware=this.combineMiddlewares(t)},e.prototype.combineMiddlewares=function(t){return t.length?t.reduce(this.middlewareReducer):null},e.prototype.middlewareReducer=function(t,n){return function(r,i,a){return t(function(u,o){return n(r,u,o)},i,a)}},e.prototype.callMethod=function(t,n,r){var i=this,a=function(o,s){return t(o,s)},u=function(o){return i.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),o),Promise.resolve(i.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,o))};try{return(this.middleware||Cn)(a,n,r).then(void 0,u)}catch(o){return u(o)}},e.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(t,n){return t!==void 0?this.mapErrorToJSONRPCErrorResponse(t,n):null},e}();oe.JSONRPCServer=Dn;var Rn=function(e){return e!==null},Cn=function(e,t,n){return e(t,n)},An=function(e,t){return e!==void 0?{jsonrpc:k.JSONRPC,id:e,result:t===void 0?null:t}:null},kn=function(e,t){return(0,k.createJSONRPCErrorResponse)(e,On.DefaultErrorCode,t&&t.message||"An unexpected error occurred")},Vn=function(e,t){return t||(e.id!==void 0?(0,k.createJSONRPCErrorResponse)(e.id,k.JSONRPCErrorCode.InternalError,"Internal error"):null)},se={},In=v&&v.__awaiter||function(e,t,n,r){function i(a){return a instanceof n?a:new n(function(u){u(a)})}return new(n||(n=Promise))(function(a,u){function o(d){try{c(r.next(d))}catch(f){u(f)}}function s(d){try{c(r.throw(d))}catch(f){u(f)}}function c(d){d.done?a(d.value):i(d.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},Pn=v&&v.__generator||function(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,u;return u={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function o(c){return function(d){return s([c,d])}}function s(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(a=c[0]&2?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){n.label=c[1];break}if(c[0]===6&&n.label<a[1]){n.label=a[1],a=c;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(c);break}a[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(d){c=[6,d],i=0}finally{r=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(se,"__esModule",{value:!0}),se.JSONRPCServerAndClient=void 0;var le=Z,Jn=function(){function e(t,n,r){r===void 0&&(r={});var i;this.server=t,this.client=n,this.errorListener=(i=r.errorListener)!==null&&i!==void 0?i:console.warn}return e.prototype.applyServerMiddleware=function(){for(var t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(t=this.server).applyMiddleware.apply(t,n)},e.prototype.addMethod=function(t,n){this.server.addMethod(t,n)},e.prototype.addMethodAdvanced=function(t,n){this.server.addMethodAdvanced(t,n)},e.prototype.timeout=function(t){return this.client.timeout(t)},e.prototype.request=function(t,n,r){return this.client.request(t,n,r)},e.prototype.requestAdvanced=function(t,n){return this.client.requestAdvanced(t,n)},e.prototype.notify=function(t,n,r){this.client.notify(t,n,r)},e.prototype.rejectAllPendingRequests=function(t){this.client.rejectAllPendingRequests(t)},e.prototype.receiveAndSend=function(t,n,r){return In(this,void 0,void 0,function(){var i,a;return Pn(this,function(u){switch(u.label){case 0:return(0,le.isJSONRPCResponse)(t)||(0,le.isJSONRPCResponses)(t)?(this.client.receive(t),[3,4]):[3,1];case 1:return(0,le.isJSONRPCRequest)(t)||(0,le.isJSONRPCRequests)(t)?[4,this.server.receive(t,n)]:[3,3];case 2:return i=u.sent(),i?[2,this.client.send(i,r)]:[3,4];case 3:return a="Received an invalid JSON-RPC message",this.errorListener(a,t),[2,Promise.reject(new Error(a))];case 4:return[2]}})})},e}();se.JSONRPCServerAndClient=Jn,function(e){var t=v&&v.__createBinding||(Object.create?function(r,i,a,u){u===void 0&&(u=a),Object.defineProperty(r,u,{enumerable:!0,get:function(){return i[a]}})}:function(r,i,a,u){u===void 0&&(u=a),r[u]=i[a]}),n=v&&v.__exportStar||function(r,i){for(var a in r)a!=="default"&&!Object.prototype.hasOwnProperty.call(i,a)&&t(i,r,a)};Object.defineProperty(e,"__esModule",{value:!0}),n(O,e),n(Z,e),n(oe,e),n(se,e)}(y);function Me(e,...t){}function mt(e,t){const n=new URL(e,self.location.origin);for(const[r,i]of Object.entries(t!=null?t:{}))n.searchParams.set(r,i);return n}function H(e){const t=GM_getValue(e);if(t!==void 0)return t.contents}function R(e,t){GM_setValue(e,{contents:t})}function Ln(){var n;const e=[{name:"202205231915_gm_value",up(){R("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const r of["username","server","sync_answers","sort_problems"])R(r,GM_getValue(r))}}],t=(n=H("migrations"))!=null?n:[];for(const{name:r,idx:i}of t)if(r!==e[i].name)throw new Error("bad migrations");for(const{name:r,up:i}of e.slice(t.length))i();R("migrations",e.map((r,i)=>({name:r.name,idx:i})))}function ht(e,t,n){for(var r=new Array(n),i=0,a=t;i<n;)r[i]=e[a],i=i+1|0,a=a+1|0;return r}function j(e,t){for(;;){var n=t,r=e,i=r.length,a=i===0?1:i,u=n.length,o=a-u|0;if(o===0)return r.apply(null,n);if(o>=0)return function(s,c){return function(d){return j(s,c.concat([d]))}}(r,n);t=ht(n,a,-o|0),e=r.apply(null,ht(n,0,a))}}function F(e,t){var n=e.length;if(n===1)return e(t);switch(n){case 1:return e(t);case 2:return function(r){return e(t,r)};case 3:return function(r,i){return e(t,r,i)};case 4:return function(r,i,a){return e(t,r,i,a)};case 5:return function(r,i,a,u){return e(t,r,i,a,u)};case 6:return function(r,i,a,u,o){return e(t,r,i,a,u,o)};case 7:return function(r,i,a,u,o,s){return e(t,r,i,a,u,o,s)};default:return j(e,[t])}}function L(e){var t=e.length;return t===1?e:function(n){return F(e,n)}}function pt(e,t,n){var r=e.length;if(r===2)return e(t,n);switch(r){case 1:return j(e(t),[n]);case 2:return e(t,n);case 3:return function(i){return e(t,n,i)};case 4:return function(i,a){return e(t,n,i,a)};case 5:return function(i,a,u){return e(t,n,i,a,u)};case 6:return function(i,a,u,o){return e(t,n,i,a,u,o)};case 7:return function(i,a,u,o,s){return e(t,n,i,a,u,o,s)};default:return j(e,[t,n])}}function de(e){var t=e.length;return t===2?e:function(n,r){return pt(e,n,r)}}function gt(e,t,n,r){var i=e.length;if(i===3)return e(t,n,r);switch(i){case 1:return j(e(t),[n,r]);case 2:return j(e(t,n),[r]);case 3:return e(t,n,r);case 4:return function(a){return e(t,n,r,a)};case 5:return function(a,u){return e(t,n,r,a,u)};case 6:return function(a,u,o){return e(t,n,r,a,u,o)};case 7:return function(a,u,o,s){return e(t,n,r,a,u,o,s)};default:return j(e,[t,n,r])}}function _t(e){var t=e.length;return t===3?e:function(n,r,i){return gt(e,n,r,i)}}var Ne={contents:0};function zn(e){return Ne.contents=Ne.contents+1|0,e+("/"+Ne.contents)}var Tn=zn("CamlinternalLazy.Undefined");function Un(e,t){var n=t();return e.VAL=n,e.LAZY_DONE=!0,n}function $n(){throw{RE_EXN_ID:Tn,Error:new Error}}function ee(e){if(e.LAZY_DONE)return e.VAL;var t=e.VAL;e.VAL=$n;try{return Un(e,t)}catch(n){throw e.VAL=function(){throw n},n}}function te(e){return{LAZY_DONE:!0,VAL:e}}function g(e){return e===void 0?{BS_PRIVATE_NESTED_SOME_NONE:0}:e!==null&&e.BS_PRIVATE_NESTED_SOME_NONE!==void 0?{BS_PRIVATE_NESTED_SOME_NONE:e.BS_PRIVATE_NESTED_SOME_NONE+1|0}:e}function z(e){if(e!=null)return g(e)}function ne(e){if(e!==void 0)return g(e)}function _(e){if(!(e!==null&&e.BS_PRIVATE_NESTED_SOME_NONE!==void 0))return e;var t=e.BS_PRIVATE_NESTED_SOME_NONE;if(t!==0)return{BS_PRIVATE_NESTED_SOME_NONE:t-1|0}}var De="username",Re={contents:{LAZY_DONE:!1,VAL:function(){var e=H(De);if(e==null){R(De,void 0);return}else return g(e)}}};function qn(e){return ee(Re.contents)}function xn(e){var t=g(e);Re.contents=te(t),R(De,t)}var Ce={v:Re,get:qn,set:xn},Ae="server",ke={contents:{LAZY_DONE:!1,VAL:function(){var e=H(Ae);if(e==null){R(Ae,void 0);return}else return g(e)}}};function jn(e){return ee(ke.contents)}function Wn(e){var t=g(e);ke.contents=te(t),R(Ae,t)}var Ve={v:ke,get:jn,set:Wn},Ie="sync_answers",wt=!0,Pe={contents:{LAZY_DONE:!1,VAL:function(){var e=H(Ie);return e==null?(R(Ie,wt),wt):g(e)}}};function Bn(e){return ee(Pe.contents)}function Hn(e){var t=g(e);Pe.contents=te(t),R(Ie,t)}var Je={v:Pe,get:Bn,set:Hn},Le="no_leave_check",yt=!0,ze={contents:{LAZY_DONE:!1,VAL:function(){var e=H(Le);return e==null?(R(Le,yt),yt):g(e)}}};function Fn(e){return ee(ze.contents)}function Gn(e){var t=g(e);ze.contents=te(t),R(Le,t)}var Te={v:ze,get:Fn,set:Gn},Ue="sort_problems",Et=!1,$e={contents:{LAZY_DONE:!1,VAL:function(){var e=H(Ue);return e==null?(R(Ue,Et),Et):g(e)}}};function Yn(e){return ee($e.contents)}function Xn(e){var t=g(e);$e.contents=te(t),R(Ue,t)}var qe={v:$e,get:Yn,set:Xn};class re{constructor(t){J(this,"_value");this._value=t}get value(){return this._value.get()}}const xe=new re(Ce),St=new re(Ve),Zn=new re(Je),Qn=new re(qe),Kn=new re(Te);class er{constructor(){J(this,"token");J(this,"client");J(this,"examId");J(this,"paper");J(this,"queue",new Map);J(this,"onmsg",[])}onmessage(t){this.onmsg.push(t)}updateQueue(t,n){let r=this.queue.get(t);r!==void 0?n(r):(r={},n(r),this.queue.set(t,r))}updateAnswer(t,n){this.updateQueue(t,r=>r.result=n)}updateState(t,n){this.updateQueue(t,r=>{var i;r.context=(i=r.context)!=null?i:{},r.context.state=n})}updateMsg(t,n){this.updateQueue(t,r=>{var i;r.context=(i=r.context)!=null?i:{},r.context.msg=n})}async watch(t){return new Promise((n,r)=>{const i=setInterval(()=>{this.sendQueue().catch(a=>{clearInterval(i),alert("\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5F02\u5E38"),r(a)})},t)})}async login(t,n){this.examId=t,this.paper=n}async sendQueue(){if(Zn.value!==!0||this.queue.size<1||St.value===void 0||xe.value===void 0||this.examId===void 0||this.paper===void 0)return;let t=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const r=St.value,i=new y.JSONRPCClient(a=>new Promise((u,o)=>{GM.xmlHttpRequest({url:r,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(a),onload:s=>{s.status===200?(i.receive(JSON.parse(s.responseText)),u()):o(new Error(s.statusText))},onerror:s=>o(s.statusText)})}));this.client=i}if(this.token===void 0){Me(`login to server: ${xe.value}, ${this.examId}`);const r=await this.client.request("login",[xe.value,this.examId,this.paper]);this.token=r}const n=await this.client.request("answer_problem",[this.token,t.map(([r,{result:i,context:a}])=>({problem_id:r,result:i,context:a}))]);this.onmsg.forEach(r=>r(n))}}const M=new er;function tr(e){const t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const i=e.call(this,mt(r)),a=this.send;this.send=function(u){i!==void 0?i(u).then(o=>{a.call(this,o),this.send=a}).catch(Me):(a.call(this,u),this.send=a)},t.apply(this,arguments)}}var fe=(e=>(e[e.SingleChoice=1]="SingleChoice",e[e.MultipleChoice=2]="MultipleChoice",e[e.Polling=3]="Polling",e[e.FillBlank=4]="FillBlank",e[e.ShortAnswer=5]="ShortAnswer",e[e.Judgement=6]="Judgement",e))(fe||{});function ve(e){return Array.isArray(e)?new Array().concat(...e.map(ve)):e instanceof Node?[e]:e==null?[]:[document.createTextNode(String(e))]}function nr(e,t){for(const n of t)e.appendChild(n)}function rr(e,t){for(const[n,r]of Object.entries(t))n.startsWith("-")?e.style.setProperty(n,r):e.style[n]=r}function ir(e,t){for(const[n,r]of Object.entries(t))if(r!==void 0)switch(n){case"class":case"className":e.setAttribute("class",r);break;case"style":rr(e,r);break;case"dangerouslySetInnerHTML":e.innerHTML=r.__html;break;default:n.startsWith("on")?e.addEventListener(n.slice(2).toLowerCase(),r):n in e?e[n]=r:e.setAttribute(n,r)}}function me(e,t,...n){t=t!=null?t:{};let r=ve(n).concat(ve(t.children));if(typeof e=="function")return e(_n(gn({},t),{children:r}));{const i=document.createElement(e);return nr(i,r),ir(i,t!=null?t:{}),i}}function ar(e){return e instanceof Node?e:null}const ur={toArray:ve};var je=function(e,t){var n,r;r=t.length;var i=[];for(n=0;n<r-1;++n)i.push(t[n]);var a=t[r-1];for(n=0;n<a.length;++n)i.push(a[n]);return e.apply(null,i)};function T(e){return z(ar(e))}function or(e){return ur.toArray(e)}var cr={toArray:or};function sr(e,t,n){return je(me,[e,t,n])}function b(e,t){return me(e,t)}function lr(e,t,n){return je(me,[e,t!==void 0?_(t):void 0,n])}function dr(e,t,n){return je(me,[e,t!==void 0?_(t):void 0,n])}var l={createDOMElementVariadic:lr,createElement:dr};function fr(e,t){return e===t?0:e<t?-1:1}function vr(e,t){if(t>=0&&t<e.length)return g(e[t])}function mr(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=new Array(i),u=0;u<i;++u)a[u]=[e[u],t[u]];return a}function Ot(e,t){for(var n=e.length,r=t.length,i=new Array(n+r|0),a=0;a<n;++a)i[a]=e[a];for(var u=0;u<r;++u)i[n+u|0]=t[u];return i}function bt(e,t,n,r,i){if(r<=t){for(var a=0;a<i;++a)n[a+r|0]=e[a+t|0];return}for(var u=i-1|0;u>=0;--u)n[u+r|0]=e[u+t|0]}function hr(e,t){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=t(e[i]);return r}function C(e,t){return hr(e,L(t))}function pr(e,t){for(var n=e.length,r=new Array(n),i=0,a=0;a<n;++a){var u=e[a],o=t(u);o!==void 0&&(r[i]=_(o),i=i+1|0)}return r.length=i,r}function he(e,t){return pr(e,L(t))}function gr(e,t){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=t(i,e[i]);return r}function _r(e,t){return gr(e,de(t))}function wr(e,t,n){for(var r=t,i=0,a=e.length;i<a;++i)r=n(r,e[i]);return r}function We(e,t,n){return wr(e,t,de(n))}function yr(e,t,n){for(var r=t,i=0,a=e.length;i<a;++i)r=n(r,e[i],i);return r}function Mt(e,t,n){return yr(e,t,_t(n))}function Er(e,t,n){var r=e.length;if(r===0)return"";for(var i=r-1|0,a=0,u="";;){var o=u,s=a;if(s===i)return o+n(e[s]);u=o+(n(e[s])+t),a=s+1|0}}function Nt(e,t,n){return Er(e,t,L(n))}function Sr(e,t){if(e!==void 0)return t(_(e))}function U(e,t){return Sr(e,L(t))}function E(e){if(e!==void 0)return _(e);throw{RE_EXN_ID:"Not_found",Error:new Error}}function Or(e,t,n){return e!==void 0?n(_(e)):t}function ie(e,t,n){return Or(e,t,L(n))}function br(e,t){if(e!==void 0)return g(t(_(e)))}function G(e,t){return br(e,L(t))}function Mr(e,t){if(e!==void 0)return t(_(e))}function A(e,t){return Mr(e,L(t))}function $(e,t){return e!==void 0?_(e):t}function Nr(e){return e>12||e<1?12:e-1|0}function Dr(e){return Nr(e.nodeType)}function Dt(e){if(Dr(e)===0)return g(e)}var Rr=function(e){if(window.constructor.name!==void 0&&/^HTML\w*Element$/.test(e.constructor.name)||/^\[object HTML\w*Element\]$/.test(e.constructor.toString()))return e},Rt=function(e){var t=e.defaultView;if(t!=null){var n=t.HTMLDocument;if(n!=null&&e instanceof n)return e}},Ct=`._mainBody_8f6zw_1{opacity:.5}._mainBody_8f6zw_1 *{font-size:.75rem;margin:0}._mainBody_8f6zw_1 button,._clickable_8f6zw_11{cursor:pointer}._stateWorkingOn_8f6zw_14{color:#00f}._stateSure_8f6zw_17{color:green}._stateNotSure_8f6zw_20{color:red}._answerMsg_8f6zw_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_8f6zw_23 ul{padding-left:1rem}._answerMsgName_8f6zw_32{font-weight:700}._answerMark_8f6zw_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_8f6zw_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_8f6zw_35 input{height:max-content;width:100%}._answerDetail_8f6zw_53 ._stateWorkingOn_8f6zw_14,._answerDetail_8f6zw_53 ._stateSure_8f6zw_17,._answerDetail_8f6zw_53 ._stateNotSure_8f6zw_20{font-weight:700}._answerDetail_8f6zw_53 ul{padding-left:1.5rem}._answerDetail_8f6zw_53 img{height:auto;width:80%}._answerDetailShortAnswer_8f6zw_65{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem}._settings_8f6zw_71{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_8f6zw_79{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_8f6zw_79 label{font-weight:700}._settingsEntry_8f6zw_79 input{height:max-content;text-align:right}._settingsSubmit_8f6zw_93{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_8f6zw_99{margin-right:.5rem}._about_8f6zw_102 p{margin-bottom:.25rem}._about_8f6zw_102 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_8f6zw_102 ul li{margin-bottom:.25rem}._uploadImg_8f6zw_112{display:flex;flex-direction:column}._uploadImg_8f6zw_112 img{width:100%;height:auto}._uploadImgImage_8f6zw_120{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_8f6zw_125{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`,Cr=Ct;function Ar(e,t){return Nt(e,t,function(n){return n})}function At(e,t){return he(Array.prototype.slice.call(e.querySelectorAll(t)),Dt)}function kr(e){var t=e.children;return l.createDOMElementVariadic("ul",void 0,[cr.toArray(t).map(function(n){return l.createDOMElementVariadic("li",void 0,[n])})])}var q={make:kr};function ae(e,t,n,r,i,a){var u=E(z(window.open("","",Nt([["location","no"],["height",String(t)],["width",String(n)],["left",ie(r,"0",function(s){return String(s)})],["top",ie(i,"0",function(s){return String(s)})]],",",function(s){return s[0]+"="+s[1]}))));window.addEventListener("unload",function(s){u.close()});var o=E(Rt(u.document));return o.head.appendChild(E(T(l.createDOMElementVariadic("title",void 0,[e])))),o.head.appendChild(E(T(l.createDOMElementVariadic("style",void 0,[Cr])))),[u,E(z(o.body))]}var kt=fr;function Vr(e){for(var t=Object.keys(e),n=t.length,r=new Array(n),i=0;i<n;++i){var a=t[i];r[i]=[a,e[a]]}return r}function Ir(e,t){if(t===0)throw{RE_EXN_ID:"Division_by_zero",Error:new Error};return e/t|0}function Pr(e,t,n,r,i){for(;;){var a=n,u=t;if(a>=r)return a;var o=e[a];if(!i(o,u))return a;n=a+1|0,t=o}}function Jr(e,t){var n=e.length;if(n===0||n===1)return n;var r=e[0],i=e[1];if(t(r,i))for(var a=i,u=2;;){var o=u,s=a;if(o>=n)return o;var c=e[o];if(!t(s,c))return o;u=o+1|0,a=c}else return t(i,r)?-Pr(e,i,2,n,t)|0:1}function Vt(e,t,n,r,i,a,u,o,s){for(var c=t+n|0,d=i+a|0,f=t,S=e[t],D=i,w=r[i],h=o;;){var p=h,P=w,ue=D,Oe=S,ot=f;if(s(Oe,P)<=0){u[p]=Oe;var ct=ot+1|0;if(ct>=c)return bt(r,ue,u,p+1|0,d-ue|0);h=p+1|0,S=e[ct],f=ct;continue}u[p]=P;var st=ue+1|0;if(st>=d)return bt(e,ot,u,p+1|0,c-ot|0);h=p+1|0,w=r[st],D=st}}function It(e,t,n,r,i,a){for(var u=0;u<i;++u){for(var o=e[t+u|0],s=(r+u|0)-1|0;s>=r&&a(n[s],o)>0;)n[s+1|0]=n[s],s=s-1|0;n[s+1|0]=o}}function pe(e,t,n,r,i,a){if(i<=5)return It(e,t,n,r,i,a);var u=i/2|0,o=i-u|0;return pe(e,t+u|0,n,r+u|0,o,a),pe(e,t,e,t+o|0,u,a),Vt(e,t+o|0,u,n,r+u|0,o,n,r,a)}function Lr(e,t){var n=e.length;if(n<=5)return It(e,0,e,0,n,t);var r=n/2|0,i=n-r|0,a=new Array(i);return pe(e,r,a,0,i,t),pe(e,0,e,i,r,t),Vt(e,i,r,a,0,i,e,0,t)}function zr(e,t){var n=e.slice(0);return Lr(n,t),n}function ge(e,t){return zr(e,de(t))}function N(e){return e!==void 0?e.h:0}function V(e,t,n,r){var i=N(e),a=N(r);return{k:t,v:n,h:i>=a?i+1|0:a+1|0,l:e,r}}function I(e,t){return{k:e,v:t,h:1,l:void 0,r:void 0}}function Pt(e,t){return t!==void 0?e!==void 0?e.h>=t.h:!1:!0}function Be(e,t){return e.v===t?e:{k:e.k,v:t,h:e.h,l:e.l,r:e.r}}function x(e,t,n,r){var i=e!==void 0?e.h:0,a=r!==void 0?r.h:0;if(i>(a+2|0)){var u=e.l,o=e.r;return N(u)>=N(o)?V(u,e.k,e.v,V(o,t,n,r)):V(V(u,e.k,e.v,o.l),o.k,o.v,V(o.r,t,n,r))}if(a<=(i+2|0))return{k:t,v:n,h:i>=a?i+1|0:a+1|0,l:e,r};var s=r.l,c=r.r;return N(c)>=N(s)?V(V(e,t,n,s),r.k,r.v,c):V(V(e,t,n,s.l),s.k,s.v,V(s.r,r.k,r.v,c))}function Jt(e,t,n){var r=e.l;return r!==void 0?x(Jt(r,t,n),e.k,e.v,e.r):(t.contents=e.k,n.contents=e.v,e.r)}function Lt(e,t){for(;;){var n=e;if(n===void 0)return;Lt(n.l,t),t(n.k,n.v),e=n.r}}function Tr(e,t){return Lt(e,de(t))}function zt(e,t,n){for(;;){var r=t,i=e;if(i===void 0)return r;var a=i.k,u=i.v,o=i.l,s=i.r;t=n(zt(o,r,n),a,u),e=s}}function Ur(e,t,n){return zt(e,t,_t(n))}function _e(e){var t=e.l,n=e.r,r=t!==void 0?_e(t):0,i=n!==void 0?_e(n):0;return(1+r|0)+i|0}function $r(e){return e!==void 0?_e(e):0}function Tt(e,t,n){for(;;){var r=t,i=e,a=i.l,u=i.k,o=i.r,s=a!==void 0?Tt(a,r,n):r;n[s]=[u,i.v];var c=s+1|0;if(o===void 0)return c;t=c,e=o}}function qr(e){if(e===void 0)return[];var t=_e(e),n=new Array(t);return Tt(e,0,n),n}function He(e,t,n){switch(n){case 0:return;case 1:var r=e[t];return I(r[0],r[1]);case 2:var i=e[t],a=e[t-1|0],u=a,o=i;return{k:u[0],v:u[1],h:2,l:I(o[0],o[1]),r:void 0};case 3:var s=e[t],c=e[t-1|0],d=e[t-2|0],f=d,S=c,D=s;return{k:S[0],v:S[1],h:2,l:I(D[0],D[1]),r:I(f[0],f[1])};default:var w=n/2|0,h=He(e,t,w),p=e[t-w|0],P=He(e,(t-w|0)-1|0,(n-w|0)-1|0);return V(h,p[0],p[1],P)}}function Fe(e,t,n){switch(n){case 0:return;case 1:var r=e[t];return I(r[0],r[1]);case 2:var i=e[t],a=e[t+1|0],u=a,o=i;return{k:u[0],v:u[1],h:2,l:I(o[0],o[1]),r:void 0};case 3:var s=e[t],c=e[t+1|0],d=e[t+2|0],f=d,S=c,D=s;return{k:S[0],v:S[1],h:2,l:I(D[0],D[1]),r:I(f[0],f[1])};default:var w=n/2|0,h=Fe(e,t,w),p=e[t+w|0],P=Fe(e,(t+w|0)+1|0,(n-w|0)-1|0);return V(h,p[0],p[1],P)}}function Ge(e){var t=e.l;e.l=t.r,t.r=e;var n=N(e.l),r=N(e.r);e.h=(n>r?n:r)+1|0;var i=N(t.l),a=e.h;return t.h=(i>a?i:a)+1|0,t}function Ye(e){var t=e.r;e.r=t.l,t.l=e;var n=N(e.l),r=N(e.r);e.h=(n>r?n:r)+1|0;var i=N(t.r),a=e.h;return t.h=(i>a?i:a)+1|0,t}function xr(e){var t=e.l,n=Ye(t);return e.l=n,Ge(e)}function jr(e){var t=e.r,n=Ge(t);return e.r=n,Ye(e)}function we(e){var t=N(e.l),n=N(e.r);return e.h=(t>n?t:n)+1|0,e}function Wr(e){var t=e.l,n=e.r,r=N(t),i=N(n);if(r>(2+i|0)){var a=t.l,u=t.r;return Pt(a,u)?we(Ge(e)):we(xr(e))}if(i>(2+r|0)){var o=n.l,s=n.r;return Pt(s,o)?we(Ye(e)):we(jr(e))}return e.h=(r>i?r:i)+1|0,e}function Br(e,t){for(;;){var n=e;if(n===void 0)return;var r=n.k;if(t===r)return g(n.v);e=t<r?n.l:n.r}}function Hr(e,t){for(;;){var n=e;if(n!==void 0){var r=n.k;if(t===r)return n.v;e=t<r?n.l:n.r;continue}throw{RE_EXN_ID:"Not_found",Error:new Error}}}function Xe(e,t,n){if(e===void 0)return I(t,n);var r=e.k;if(t===r)return e.k=t,e.v=n,e;var i=e.l,a=e.r;if(t<r){var u=Xe(i,t,n);e.l=u}else e.r=Xe(a,t,n);return Wr(e)}function Fr(e){var t=e.length;if(t!==0){var n=Jr(e,function(u,o){return u[0]<o[0]}),r;n>=0?r=Fe(e,0,n):(n=-n|0,r=He(e,n-1|0,n));for(var i=n;i<t;++i){var a=e[i];r=Xe(r,a[0],a[1])}return r}}function W(e,t,n){if(e===void 0)return I(t,n);var r=e.k;if(t===r)return Be(e,n);var i=e.v;return t<r?x(W(e.l,t,n),r,i,e.r):x(e.l,r,i,W(e.r,t,n))}function Ze(e,t,n){if(e!==void 0){var r=e.k;if(t===r){var i=n(g(e.v));if(i!==void 0)return Be(e,_(i));var a=e.l,u=e.r;if(a===void 0)return u;if(u===void 0)return a;var o={contents:u.k},s={contents:u.v},c=Jt(u,o,s);return x(a,o.contents,s.contents,c)}var d=e.v,f=e.l,S=e.r;if(t<r){var D=Ze(f,t,n);return f===D?e:x(D,r,d,S)}var w=Ze(S,t,n);return S===w?e:x(f,r,d,w)}var h=n(void 0);return h!==void 0?I(t,_(h)):e}function Qe(e,t,n){return Ze(e,t,L(n))}var Ut=Ur,$t=$r,B=qr,Gr=Fr,qt=Br,Yr=Hr;const xt="_mainBody_8f6zw_1",jt="_clickable_8f6zw_11",Wt="_stateWorkingOn_8f6zw_14",Bt="_stateSure_8f6zw_17",Ht="_stateNotSure_8f6zw_20",Ft="_answerMsg_8f6zw_23",Gt="_answerMsgName_8f6zw_32",Yt="_answerMark_8f6zw_35",Xt="_answerDetail_8f6zw_53",Zt="_answerDetailShortAnswer_8f6zw_65",Qt="_settings_8f6zw_71",Kt="_settingsEntry_8f6zw_79",en="_settingsSubmit_8f6zw_93",tn="_settingsSubmitTip_8f6zw_99",nn="_about_8f6zw_102",rn="_uploadImg_8f6zw_112",an="_uploadImgImage_8f6zw_120",un="_uploadImgConfirm_8f6zw_125";var Xr={mainBody:xt,clickable:jt,stateWorkingOn:Wt,stateSure:Bt,stateNotSure:Ht,answerMsg:Ft,answerMsgName:Gt,answerMark:Yt,answerDetail:Xt,answerDetailShortAnswer:Zt,settings:Qt,settingsEntry:Kt,settingsSubmit:en,settingsSubmitTip:tn,about:nn,uploadImg:rn,uploadImgImage:an,uploadImgConfirm:un},Ke=Object.freeze(Object.defineProperty({__proto__:null,mainBody:xt,clickable:jt,stateWorkingOn:Wt,stateSure:Bt,stateNotSure:Ht,answerMsg:Ft,answerMsgName:Gt,answerMark:Yt,answerDetail:Xt,answerDetailShortAnswer:Zt,settings:Qt,settingsEntry:Kt,settingsSubmit:en,settingsSubmitTip:tn,about:nn,uploadImg:rn,uploadImgImage:an,uploadImgConfirm:un,default:Xr},Symbol.toStringTag,{value:"Module"})),m=Ke;function on(e,t){return String(Ir(Math.imul(e,100),t))+"%"}function et(e){return ge(e,function(t,n){return kt(t[0],n[0])})}function ye(e){return G(e,function(t){switch(t){case 0:return m.stateWorkingOn;case 1:return m.stateSure;case 2:return m.stateNotSure}})}function tt(e){return ye(A(e,function(t){return t.state}))}function cn(e){switch(e){case 0:return 1;case 1:return 0;case 2:return 2}}function sn(e,t){var n=t[1],r=e[1];return r!==void 0?n!==void 0?cn(n)-cn(r)|0:-1:n!==void 0?1:kt(e[0],t[0])}function ln(e){return ge(e,function(t,n){return sn([t[0],A(t[1],function(r){return r.state})],[n[0],A(n[1],function(r){return r.state})])})}function Ee(e){return ge(e,function(t,n){return sn([t[0],A(t[1].context,function(r){return r.state})],[n[0],A(n[1].context,function(r){return r.state})])})}function dn(e,t){e.ele.setAttribute("title",t)}function Zr(e,t){return{tooltips:Mt(At(e,".item-body .checkboxInput, .item-body .radioInput"),void 0,function(n,r,i){return W(n,String.fromCharCode(i+65|0),{ele:r})}),choiceMap:t}}function Qr(e,t){return C(et(C(B(Ut(e,void 0,function(n,r,i){var a=i.context;return ie(i.answer,n,function(u){return We(u,n,function(o,s){return Qe(o,s,function(c){return Ot($(c,[]),[[r,a]])})})})})),function(n){return[F(t.choiceMap,n[0]),n[1]]})),function(n){var r=n[1],i=n[0];return U(qt(t.tooltips,i),function(a){return dn(a,on(r.length,$t(e)))}),l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("p",void 0,[l.createDOMElementVariadic("strong",void 0,[i])]),b(q.make,{children:C(ln(r),function(a){var u={},o=tt(a[1]);return o!==void 0&&(u.className=_(o)),l.createDOMElementVariadic("p",g(u),[a[0]])})})])})}function fn(e,t,n){var r=ae("\u8BE6\u7EC6\u7B54\u6848",200,300,n,t);r[1].appendChild(E(T(l.createDOMElementVariadic("div",{className:m.mainBody},[l.createDOMElementVariadic("fieldset",{className:m.answerMark},[l.createDOMElementVariadic("legend",void 0,["\u6807\u8BB0"]),l.createDOMElementVariadic("input",{placeholder:"\u8F93\u5165\u7559\u8A00",type:"text",onChange:function(i){var a=i.target.value;M.updateMsg(e.id,a)}},[]),l.createDOMElementVariadic("button",{className:m.stateWorkingOn,type:"button",onClick:function(i){M.updateState(e.id,0)}},["\u6211\u6B63\u5728\u505A"]),l.createDOMElementVariadic("button",{className:m.stateSure,type:"button",onClick:function(i){M.updateState(e.id,1)}},["\u6211\u5F88\u786E\u5B9A"]),l.createDOMElementVariadic("button",{className:m.stateNotSure,type:"button",onClick:function(i){M.updateState(e.id,2)}},["\u6211\u4E0D\u786E\u5B9A"])]),e.detailHtml]))))}function Kr(e,t,n){var r={details:void 0,detailHtml:null,context:Zr(t,n),id:e},i=E(z(t.querySelector(".item-type")));return i.classList.add(m.clickable),i.addEventListener("click",function(a){var u=i.getBoundingClientRect();return fn(r,u.top|0,u.left|0)}),r}function ei(e,t,n){e.details=W(e.details,t,n)}function ti(e){e.detailHtml=l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("fieldset",{className:m.answerMsg},[l.createDOMElementVariadic("legend",void 0,["\u7559\u8A00"]),b(q.make,{children:C(he(Ee(B(e.details)),function(t){var n=t[0];return A(t[1].context,function(r){var i=r.state,a=i===0?$(r.msg,"\u6211\u6B63\u5728\u505A"):r.msg;return G(a,function(u){return[n,r.state,u]})})}),function(t){var n={},r=ye(t[1]);return r!==void 0&&(n.className=_(r)),l.createDOMElementVariadic("p",g(n),[l.createDOMElementVariadic("span",{className:m.answerMsgName},[t[0]+": "]),t[2]])})})]),l.createDOMElementVariadic("div",{className:m.answerDetail},[Qr(e.details,e.context)])])}var nt={showDetail:fn,make:Kr,updateAnswer:ei,updateUI:ti};function ni(e,t){return{tooltips:Mt(At(e,".item-body .blank-item-dynamic"),void 0,function(n,r,i){return W(n,String.fromCharCode(49+i|0),{ele:r})})}}function ri(e,t){return C(et(B(Ut(e,void 0,function(n,r,i){var a=i.context;return ie(i.answer,n,function(u){return We(Vr(u),n,function(o,s){var c=s[1];return Qe(o,s[0],function(d){return g(Qe($(d,void 0),c,function(f){return Ot($(f,[]),[[r,a]])}))})})})}))),function(n){var r=n[0],i=et(B(n[1]));return U(qt(t.tooltips,r),function(a){return dn(a,ie(vr(ge(C(i,function(u){return[u[0],u[1].length]}),function(u,o){return o[1]-u[1]|0}),0),"",function(u){return"("+on(u[1],$t(e))+") "+u[0]}))}),l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("p",void 0,[l.createDOMElementVariadic("strong",void 0,["#"+r])]),b(q.make,{children:C(i,function(a){return l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("p",void 0,[a[0]]),b(q.make,{children:C(ln(a[1]),function(u){var o={},s=tt(u[1]);return s!==void 0&&(o.className=_(s)),l.createDOMElementVariadic("p",g(o),[u[0]])})})])})})])})}function vn(e,t,n){var r=ae("\u8BE6\u7EC6\u7B54\u6848",200,300,n,t);r[1].appendChild(E(T(l.createDOMElementVariadic("div",{className:m.mainBody},[l.createDOMElementVariadic("fieldset",{className:m.answerMark},[l.createDOMElementVariadic("legend",void 0,["\u6807\u8BB0"]),l.createDOMElementVariadic("input",{placeholder:"\u8F93\u5165\u7559\u8A00",type:"text",onChange:function(i){var a=i.target.value;M.updateMsg(e.id,a)}},[]),l.createDOMElementVariadic("button",{className:m.stateWorkingOn,type:"button",onClick:function(i){M.updateState(e.id,0)}},["\u6211\u6B63\u5728\u505A"]),l.createDOMElementVariadic("button",{className:m.stateSure,type:"button",onClick:function(i){M.updateState(e.id,1)}},["\u6211\u5F88\u786E\u5B9A"]),l.createDOMElementVariadic("button",{className:m.stateNotSure,type:"button",onClick:function(i){M.updateState(e.id,2)}},["\u6211\u4E0D\u786E\u5B9A"])]),e.detailHtml]))))}function ii(e,t,n){var r={details:void 0,detailHtml:null,context:ni(t),id:e},i=E(z(t.querySelector(".item-type")));return i.classList.add(m.clickable),i.addEventListener("click",function(a){var u=i.getBoundingClientRect();return vn(r,u.top|0,u.left|0)}),r}function ai(e,t,n){e.details=W(e.details,t,n)}function ui(e){e.detailHtml=l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("fieldset",{className:m.answerMsg},[l.createDOMElementVariadic("legend",void 0,["\u7559\u8A00"]),b(q.make,{children:C(he(Ee(B(e.details)),function(t){var n=t[0];return A(t[1].context,function(r){var i=r.state,a=i===0?$(r.msg,"\u6211\u6B63\u5728\u505A"):r.msg;return G(a,function(u){return[n,r.state,u]})})}),function(t){var n={},r=ye(t[1]);return r!==void 0&&(n.className=_(r)),l.createDOMElementVariadic("p",g(n),[l.createDOMElementVariadic("span",{className:m.answerMsgName},[t[0]+": "]),t[2]])})})]),l.createDOMElementVariadic("div",{className:m.answerDetail},[ri(e.details,e.context)])])}var rt={showDetail:vn,make:ii,updateAnswer:ai,updateUI:ui};function Pi(e,t){}function oi(e,t){return C(Ee(B(e)),function(n){var r=n[1],i=r.answer,a={},u=tt(r.context);return u!==void 0&&(a.className=_(u)),l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("p",g(a),[l.createDOMElementVariadic("strong",void 0,[n[0]])]),l.createDOMElementVariadic("div",{className:m.answerDetailShortAnswer,dangerouslySetInnerHTML:{__html:$(A(i,function(o){return o.content}),"")}},[]),b(q.make,{children:C($(A(A(i,function(o){return o.attachments}),function(o){return o.filelist}),[]),function(o){return l.createDOMElementVariadic("a",{href:o.fileUrl},[o.fileName])})}),l.createDOMElementVariadic("div",void 0,[])])})}function mn(e,t,n){var r=ae("\u8BE6\u7EC6\u7B54\u6848",200,300,n,t);r[1].appendChild(E(T(l.createDOMElementVariadic("div",{className:m.mainBody},[l.createDOMElementVariadic("fieldset",{className:m.answerMark},[l.createDOMElementVariadic("legend",void 0,["\u6807\u8BB0"]),l.createDOMElementVariadic("input",{placeholder:"\u8F93\u5165\u7559\u8A00",type:"text",onChange:function(i){var a=i.target.value;M.updateMsg(e.id,a)}},[]),l.createDOMElementVariadic("button",{className:m.stateWorkingOn,type:"button",onClick:function(i){M.updateState(e.id,0)}},["\u6211\u6B63\u5728\u505A"]),l.createDOMElementVariadic("button",{className:m.stateSure,type:"button",onClick:function(i){M.updateState(e.id,1)}},["\u6211\u5F88\u786E\u5B9A"]),l.createDOMElementVariadic("button",{className:m.stateNotSure,type:"button",onClick:function(i){M.updateState(e.id,2)}},["\u6211\u4E0D\u786E\u5B9A"])]),e.detailHtml]))))}function ci(e,t,n){var r={details:void 0,detailHtml:null,context:void 0,id:e},i=E(z(t.querySelector(".item-type")));return i.classList.add(m.clickable),i.addEventListener("click",function(a){var u=i.getBoundingClientRect();return mn(r,u.top|0,u.left|0)}),r}function si(e,t,n){e.details=W(e.details,t,n)}function li(e){e.detailHtml=l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("fieldset",{className:m.answerMsg},[l.createDOMElementVariadic("legend",void 0,["\u7559\u8A00"]),b(q.make,{children:C(he(Ee(B(e.details)),function(t){var n=t[0];return A(t[1].context,function(r){var i=r.state,a=i===0?$(r.msg,"\u6211\u6B63\u5728\u505A"):r.msg;return G(a,function(u){return[n,r.state,u]})})}),function(t){var n={},r=ye(t[1]);return r!==void 0&&(n.className=_(r)),l.createDOMElementVariadic("p",g(n),[l.createDOMElementVariadic("span",{className:m.answerMsgName},[t[0]+": "]),t[2]])})})]),l.createDOMElementVariadic("div",{className:m.answerDetail},[oi(e.details,e.context)])])}var it={showDetail:mn,make:ci,updateAnswer:si,updateUI:li};function di(e){throw new Error(e)}var Y=Ke;function fi(e){var t=e.onSubmit,n=function(h){var p=h.name,P=h.title,ue=h.props,Oe=Object.assign(ue,{name:p});return l.createDOMElementVariadic("div",{className:Y.settingsEntry},[l.createDOMElementVariadic("label",{htmlFor:p},[P]),l.createDOMElementVariadic("input",g(Oe),[])])},r=function(h){var p=h.title,P=h.content;return l.createDOMElementVariadic("p",void 0,[l.createDOMElementVariadic("strong",void 0,[p]),P])},i={},a={title:"\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF",pattern:"^[a-z][a-z0-9_]*$",required:!0,type:"text",onChange:function(h){var p=h.target.value;i.username=p}},u=Ce.get(void 0);u!==void 0&&(a.value=_(u));var o={required:!0,type:"url",onChange:function(h){var p=h.target.value;i.server=p}},s=Ve.get(void 0);s!==void 0&&(o.value=_(s));var c={type:"checkbox",onChange:function(h){var p=h.target.checked;i.syncAnswers=p}},d=Je.get(void 0);d!==void 0&&(c.checked=_(d));var f={type:"checkbox",onChange:function(h){var p=h.target.checked;i.sortProblems=p}},S=qe.get(void 0);S!==void 0&&(f.checked=_(S));var D={type:"checkbox",onChange:function(h){var p=h.target.checked;i.noLeaveCheck=p}},w=Te.get(void 0);return w!==void 0&&(D.checked=_(w)),l.createDOMElementVariadic("div",void 0,[l.createDOMElementVariadic("form",{className:Y.settings,onSubmit:function(h){return h.preventDefault(),U(ne(i.username),Ce.set),U(ne(i.server),Ve.set),U(ne(i.syncAnswers),Je.set),U(ne(i.noLeaveCheck),Te.set),U(ne(i.sortProblems),qe.set),F(t,void 0)}},[b(n,{name:"username",title:"\u7528\u6237\u540D",props:a}),b(n,{name:"server",title:"\u670D\u52A1\u5668",props:o}),b(n,{name:"sync_answers",title:"\u540C\u6B65\u7B54\u6848",props:c}),b(n,{name:"sort_problems",title:"\u6392\u5E8F\u9898\u76EE",props:f}),b(n,{name:"no_leave_check",title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B",props:D}),l.createDOMElementVariadic("div",{className:Y.settingsSubmit},[l.createDOMElementVariadic("p",{className:Y.settingsSubmitTip},[l.createDOMElementVariadic("i",void 0,["*\u66F4\u6539\u8BBE\u7F6E\u540E\u8BF7\u5237\u65B0\u9875\u9762"])]),l.createDOMElementVariadic("button",{type:"submit"},["\u63D0\u4EA4"])])]),l.createDOMElementVariadic("div",{className:Y.about},[l.createDOMElementVariadic("p",void 0,[l.createDOMElementVariadic("strong",void 0,["\u529F\u80FD\u7279\u6027\uFF1A"])]),sr(q.make,{children:null},[b(r,{title:"\u540C\u6B65\u7B54\u6848\uFF1A",content:"\u70B9\u51FB\u9898\u76EE\u663E\u793A\u8BE6\u7EC6\u7B54\u6848\uFF0C\u5728\u9009\u9879/\u586B\u7A7A\u5904\u60AC\u505C\u663E\u793A\u7B80\u7565\u7B54\u6848"}),b(r,{title:"\u6392\u5E8F\u9898\u76EE\uFF1A",content:"\u6839\u636E ID \u5BF9\u9898\u76EE\u548C\u9009\u9879\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F"}),b(r,{title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B\uFF1A",content:"\u968F\u610F\u5207\u6362\u9875\u9762\u3001\u7A97\u53E3\u4E0D\u4F1A\u88AB\u53D1\u73B0"}),b(r,{title:"\u62E6\u622A\u4E0A\u4F20\u622A\u56FE\uFF1A",content:"\u4EC5\u5F53\u7528\u6237\u786E\u8BA4\u540E\uFF0C\u624D\u4F1A\u4E0A\u4F20\u622A\u56FE"}),b(r,{title:"\u62E6\u622A\u5F02\u5E38\u72B6\u6001\uFF1A",content:"\u5373\u4F7F\u672C\u5730\u663E\u793A\u5F02\u5E38\u4E5F\u4E0D\u4F1A\u63A8\u9001\u5230\u670D\u52A1\u5668"})])])])}function vi(e){var t=ae("\u8BBE\u7F6E",300,400,void 0,void 0),n=t[0];t[1].appendChild(E(T(l.createDOMElementVariadic("div",{className:Y.mainBody},[b(fi,{onSubmit:function(r){n.close()}})]))))}function mi(e,t){for(;;){var n=e;if(n===void 0)return;var r=n.k;if(t===r)return g(n.v);e=t<r?n.l:n.r}}function at(e,t,n){if(e===void 0)return I(t,n);var r=e.k;if(t===r)return Be(e,n);var i=e.v;return t<r?x(at(e.l,t,n),r,i,e.r):x(e.l,r,i,at(e.r,t,n))}var hi=Tr,pi=mi,gi=Rr,_i=Ct,X=Ke;function wi(e,t){var n=ae("\u4E0A\u4F20\u56FE\u7247",200,300,void 0,void 0),r=n[0];n[1].appendChild(E(T(l.createDOMElementVariadic("div",{className:Ar([X.mainBody,X.uploadImg]," ")},[l.createDOMElementVariadic("div",{className:X.uploadImgConfirm},[l.createDOMElementVariadic("button",{className:X.clickable,onClick:function(i){F(t,void 0),r.close()}},["\u786E\u8BA4\u4E0A\u4F20"]),l.createDOMElementVariadic("span",void 0,[l.createDOMElementVariadic("i",void 0,["*\u5173\u95ED\u7A97\u53E3\u4EE5\u53D6\u6D88\u4E0A\u4F20"])])]),l.createDOMElementVariadic("div",{className:X.uploadImgImage},[l.createDOMElementVariadic("img",{src:e},[])])]))))}function yi(e){if(e<=6&&1<=e)return e-1|0}function Se(e,t){return{updateUI:function(n){return F(e.updateUI,t)},updateAnswer:function(n,r){return gt(e.updateAnswer,t,n,{context:r.context,answer:G(r.answer,function(i){return i})})}}}function Ei(e){var t=E(A(Rt(document),function(u){return G(z(u.body),function(o){return[u.head,o]})})),n=t[1];t[0].appendChild(E(T(l.createDOMElementVariadic("style",void 0,[_i]))));var r=E(A(z(n.querySelector(".header-title")),gi));r.classList.add(X.clickable),r.addEventListener("click",function(u){return vi()});var i=C(Array.prototype.slice.call(n.querySelectorAll(".exam-main--body .subject-item")),function(u){return E(Dt(u))});i.length!==e.length&&di("wrong number of subject items");var a=We(mr(e,i),void 0,function(u,o){var s=o[1],c=o[0],d=E(yi(c.ProblemType)),f,S=0;if(d>=3)switch(d){case 3:f=Se({updateUI:rt.updateUI,updateAnswer:rt.updateAnswer},rt.make(c.ProblemID,s,void 0));break;case 4:f=Se({updateUI:it.updateUI,updateAnswer:it.updateAnswer},it.make(c.ProblemID,s,void 0));break;case 5:S=1;break}else S=1;if(S===1){var D=Gr(_r(E(c.Options),function(w,h){return[h.key,String.fromCharCode(65+w|0)]}));f=Se({updateUI:nt.updateUI,updateAnswer:nt.updateAnswer},nt.make(c.ProblemID,s,function(w){return Yr(D,w)}))}return at(u,c.ProblemID,f)});return{details:a}}function Si(e,t,n,r){return U(pi(e.details,t),function(i){return pt(i.updateAnswer,n,r)})}function Oi(e){return hi(e.details,function(t,n){return F(n.updateUI,void 0)})}var ut={unsafeConvertUpdateDetail:Se,make:Ei,updateAnswer:Si,updateUI:Oi};class bi{constructor(t){J(this,"inner");this.inner=ut.make(t)}updateAnswer({username:t,problem_id:n,result:r,context:i}){ut.updateAnswer(this.inner,n,t,{answer:r,context:i})}updateUI(){ut.updateUI(this.inner)}}function Mi(e,t){wi(e,t)}function hn(e){return e.forEach(t=>{switch(t.ProblemType){case fe.SingleChoice:case fe.MultipleChoice:case fe.Polling:{t.Options.sort((r,i)=>r.key<i.key?-1:1);break}}}),e.sort((t,n)=>t.ProblemID-n.ProblemID),e}function Ni(e){return Qn.value===!0&&(e.data.has_problem_dict===!0?e.data.problems=e.data.problems.sort((t,n)=>t.id-n.id).map(t=>(t.problems=hn(t.problems),t)):e.data.problems=hn(e.data.problems)),e}function Di(){document.addEventListener("visibilitychange",e=>{e.preventDefault(),e.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",e=>{e.preventDefault(),e.stopImmediatePropagation()},!0)}async function Ri(){Ln(),Kn.value===!0&&Di(),tr(function(e){switch(e.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const t=JSON.stringify(Ni(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return t}}})}}),this.addEventListener("load",()=>{const t=JSON.parse(this.responseText);let n=[];t.data.has_problem_dict===!0?t.data.problems.forEach(a=>{n=n.concat(a.problems)}):n=t.data.problems;const r=new bi(n);M.onmessage(a=>{a.forEach(u=>r.updateAnswer(u)),r.updateUI()});const i=parseInt(e.searchParams.get("exam_id"));M.login(i,{title:t.data.title,problems:n}),fetch(mt("/exam_room/cache_results",{exam_id:i.toString()}).toString()).then(a=>a.json()).then(a=>a.data.results.forEach(({problem_id:u,result:o})=>M.updateAnswer(u,o))).catch(Me)});return;case"/exam_room/answer_problem":return async t=>{var n;if(typeof t=="string"){const r=JSON.parse(t);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:i,result:a})=>M.updateAnswer(i,a)))}return t};default:return e.hostname==="upload-z1.qiniup.com"?async t=>t instanceof FormData&&t.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>Mi(r.result,()=>n(t)),r.readAsDataURL(t.get("file"))}):t:void 0}}),await M.watch(1e4)}Ri().catch(console.error)});
