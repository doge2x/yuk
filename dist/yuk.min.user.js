// ==UserScript==
// @name         yuk-client
// @version      0.7.0
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(m){typeof define=="function"&&define.amd?define(m):m()})(function(){"use strict";var tr=Object.defineProperty,nr=Object.defineProperties;var rr=Object.getOwnPropertyDescriptors;var xt=Object.getOwnPropertySymbols;var ir=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable;var Ke=(m,y,N)=>y in m?tr(m,y,{enumerable:!0,configurable:!0,writable:!0,value:N}):m[y]=N,kt=(m,y)=>{for(var N in y||(y={}))ir.call(y,N)&&Ke(m,N,y[N]);if(xt)for(var N of xt(y))sr.call(y,N)&&Ke(m,N,y[N]);return m},It=(m,y)=>nr(m,rr(y));var k=(m,y,N)=>(Ke(m,typeof y!="symbol"?y+"":y,N),N);var m=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},y={},N={},te={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";var e=function(l){return typeof l=="string"||typeof l=="number"||l===null};t.isJSONRPCID=e;var n=function(l){return l.jsonrpc===t.JSONRPC&&l.method!==void 0&&l.result===void 0&&l.error===void 0};t.isJSONRPCRequest=n;var r=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCRequest)};t.isJSONRPCRequests=r;var s=function(l){return l.jsonrpc===t.JSONRPC&&l.id!==void 0&&(l.result!==void 0||l.error!==void 0)};t.isJSONRPCResponse=s;var i=function(l){return Array.isArray(l)&&l.every(t.isJSONRPCResponse)};t.isJSONRPCResponses=i,function(l){l[l.ParseError=-32700]="ParseError",l[l.InvalidRequest=-32600]="InvalidRequest",l[l.MethodNotFound=-32601]="MethodNotFound",l[l.InvalidParams=-32602]="InvalidParams",l[l.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));var o=function(l,c,u,a){var f={code:c,message:u};return a&&(f.data=a),{jsonrpc:t.JSONRPC,id:l,error:f}};t.createJSONRPCErrorResponse=o})(te);var ne={};Object.defineProperty(ne,"__esModule",{value:!0}),ne.DefaultErrorCode=void 0,ne.DefaultErrorCode=0;var Jt=m&&m.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Dt=m&&m.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(N,"__esModule",{value:!0}),N.JSONRPCClient=void 0;var re=te,Ae=ne,Tt=function(){function t(e,n){this._send=e,this.createID=n,this.idToResolveMap=new Map,this.id=0}return t.prototype._createID=function(){return this.createID?this.createID():++this.id},t.prototype.timeout=function(e,n){var r=this;n===void 0&&(n=function(o){return(0,re.createJSONRPCErrorResponse)(o,Ae.DefaultErrorCode,"Request timeout")});var s=function(o,l){var c=setTimeout(function(){o.forEach(function(u){var a=r.idToResolveMap.get(u);a&&(r.idToResolveMap.delete(u),a(n(u)))})},e);return l().then(function(u){return clearTimeout(c),u},function(u){return clearTimeout(c),Promise.reject(u)})},i=function(o,l){var c=(Array.isArray(o)?o:[o]).map(function(u){return u.id}).filter(Qe);return s(c,function(){return r.requestAdvanced(o,l)})};return{request:function(o,l,c){var u=r._createID();return s([u],function(){return r.requestWithID(o,l,c,u)})},requestAdvanced:function(o,l){return i(o,l)}}},t.prototype.request=function(e,n,r){return this.requestWithID(e,n,r,this._createID())},t.prototype.requestWithID=function(e,n,r,s){return Jt(this,void 0,void 0,function(){var i,o;return Dt(this,function(l){switch(l.label){case 0:return i={jsonrpc:re.JSONRPC,method:e,params:n,id:s},[4,this.requestAdvanced(i,r)];case 1:return o=l.sent(),o.result!==void 0&&!o.error?[2,o.result]:o.result===void 0&&o.error?[2,Promise.reject(new Error(o.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},t.prototype.requestAdvanced=function(e,n){var r=this,s=Array.isArray(e);Array.isArray(e)||(e=[e]);var i=e.filter(function(c){return Qe(c.id)}),o=i.map(function(c){return new Promise(function(u){return r.idToResolveMap.set(c.id,u)})}),l=Promise.all(o).then(function(c){return s||!c.length?c:c[0]});return this.send(s?e:e[0],n).then(function(){return l},function(c){return i.forEach(function(u){r.receive((0,re.createJSONRPCErrorResponse)(u.id,Ae.DefaultErrorCode,c&&c.message||"Failed to send a request"))}),l})},t.prototype.notify=function(e,n,r){this.send({jsonrpc:re.JSONRPC,method:e,params:n},r).then(void 0,function(){})},t.prototype.send=function(e,n){return this._send(e,n)},t.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(n,r){return n((0,re.createJSONRPCErrorResponse)(r,Ae.DefaultErrorCode,e))}),this.idToResolveMap.clear()},t.prototype.receive=function(e){var n=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var s=n.idToResolveMap.get(r.id);s&&(n.idToResolveMap.delete(r.id),s(r))})},t}();N.JSONRPCClient=Tt;var Qe=function(t){return t!=null},ge={},ve=m&&m.__assign||function(){return ve=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},ve.apply(this,arguments)},Xe=m&&m.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},ze=m&&m.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Lt=m&&m.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(ge,"__esModule",{value:!0}),ge.JSONRPCServer=void 0;var I=te,qt=ne,jt=function(){return(0,I.createJSONRPCErrorResponse)(null,I.JSONRPCErrorCode.ParseError,"Parse error")},Bt=function(t){return(0,I.createJSONRPCErrorResponse)((0,I.isJSONRPCID)(t.id)?t.id:null,I.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Wt=function(t){return(0,I.createJSONRPCErrorResponse)(t,I.JSONRPCErrorCode.MethodNotFound,"Method not found")},Ft=function(){function t(e){e===void 0&&(e={});var n;this.mapErrorToJSONRPCErrorResponse=Gt,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=e.errorListener)!==null&&n!==void 0?n:console.warn}return t.prototype.addMethod=function(e,n){this.addMethodAdvanced(e,this.toJSONRPCMethod(n))},t.prototype.toJSONRPCMethod=function(e){return function(n,r){var s=e(n.params,r);return Promise.resolve(s).then(function(i){return Vt(n.id,i)})}},t.prototype.addMethodAdvanced=function(e,n){var r;this.nameToMethodDictionary=ve(ve({},this.nameToMethodDictionary),(r={},r[e]=n,r))},t.prototype.receiveJSON=function(e,n){var r=this.tryParseRequestJSON(e);return r?this.receive(r,n):Promise.resolve(jt())},t.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},t.prototype.receive=function(e,n){return Array.isArray(e)?this.receiveMultiple(e,n):this.receiveSingle(e,n)},t.prototype.receiveMultiple=function(e,n){return Xe(this,void 0,void 0,function(){var r,s=this;return ze(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(o){return s.receiveSingle(o,n)}))];case 1:return r=i.sent().filter(Ut),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},t.prototype.receiveSingle=function(e,n){return Xe(this,void 0,void 0,function(){var r,s;return ze(this,function(i){switch(i.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,I.isJSONRPCRequest)(e)?[3,1]:[2,Bt(e)];case 1:return r?[4,this.callMethod(r,e,n)]:[3,3];case 2:return s=i.sent(),[2,Kt(e,s)];case 3:return e.id!==void 0?[2,Wt(e.id)]:[2,null];case 4:return[2]}})})},t.prototype.applyMiddleware=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Lt([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},t.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},t.prototype.middlewareReducer=function(e,n){return function(r,s,i){return e(function(o,l){return n(r,o,l)},s,i)}},t.prototype.callMethod=function(e,n,r){var s=this,i=function(l,c){return e(l,c)},o=function(l){return s.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),l),Promise.resolve(s.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,l))};try{return(this.middleware||Ht)(i,n,r).then(void 0,o)}catch(l){return o(l)}},t.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,n){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,n):null},t}();ge.JSONRPCServer=Ft;var Ut=function(t){return t!==null},Ht=function(t,e,n){return t(e,n)},Vt=function(t,e){return t!==void 0?{jsonrpc:I.JSONRPC,id:t,result:e===void 0?null:e}:null},Gt=function(t,e){return(0,I.createJSONRPCErrorResponse)(t,qt.DefaultErrorCode,e&&e.message||"An unexpected error occurred")},Kt=function(t,e){return e||(t.id!==void 0?(0,I.createJSONRPCErrorResponse)(t.id,I.JSONRPCErrorCode.InternalError,"Internal error"):null)},pe={},Qt=m&&m.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(f){o(f)}}function c(a){try{u(r.throw(a))}catch(f){o(f)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Xt=m&&m.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(pe,"__esModule",{value:!0}),pe.JSONRPCServerAndClient=void 0;var we=te,zt=function(){function t(e,n,r){r===void 0&&(r={});var s;this.server=e,this.client=n,this.errorListener=(s=r.errorListener)!==null&&s!==void 0?s:console.warn}return t.prototype.applyServerMiddleware=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,n)},t.prototype.addMethod=function(e,n){this.server.addMethod(e,n)},t.prototype.addMethodAdvanced=function(e,n){this.server.addMethodAdvanced(e,n)},t.prototype.timeout=function(e){return this.client.timeout(e)},t.prototype.request=function(e,n,r){return this.client.request(e,n,r)},t.prototype.requestAdvanced=function(e,n){return this.client.requestAdvanced(e,n)},t.prototype.notify=function(e,n,r){this.client.notify(e,n,r)},t.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},t.prototype.receiveAndSend=function(e,n,r){return Qt(this,void 0,void 0,function(){var s,i;return Xt(this,function(o){switch(o.label){case 0:return(0,we.isJSONRPCResponse)(e)||(0,we.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,we.isJSONRPCRequest)(e)||(0,we.isJSONRPCRequests)(e)?[4,this.server.receive(e,n)]:[3,3];case 2:return s=o.sent(),s?[2,this.client.send(s,r)]:[3,4];case 3:return i="Received an invalid JSON-RPC message",this.errorListener(i,e),[2,Promise.reject(new Error(i))];case 4:return[2]}})})},t}();pe.JSONRPCServerAndClient=zt,function(t){var e=m&&m.__createBinding||(Object.create?function(r,s,i,o){o===void 0&&(o=i),Object.defineProperty(r,o,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]}),n=m&&m.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&e(s,r,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(N,t),n(te,t),n(ge,t),n(pe,t)}(y);const W={},Yt=(t,e)=>t===e,Zt=Symbol("solid-track"),ye={equals:Yt};let en=nt;const X={},V=1,be=2,Ye={owned:null,cleanups:null,context:null,owner:null};var O=null;let ie=null,b=null,se=null,A=null,q=null,Me=0;function oe(t,e){const n=b,r=O,s=t.length===0?Ye:{owned:null,cleanups:null,context:null,owner:e||r};O=s,b=null;try{return Ie(()=>t(()=>Je(s)),!0)}finally{b=n,O=r}}function Ze(t,e){e=e?Object.assign({},ye,e):ye;const n={value:t,observers:null,observerSlots:null,pending:X,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.pending!==X?n.pending:n.value)),xe(n,s));return[et.bind(n),r]}function tn(t,e,n){const r=ke(t,e,!0,V);le(r)}function $(t,e,n){const r=ke(t,e,!1,V);le(r)}function Pe(t,e,n){n=n?Object.assign({},ye,n):ye;const r=ke(t,e,!0,0);return r.pending=X,r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,le(r),et.bind(r)}function nn(t){if(se)return t();let e;const n=se=[];try{e=t()}finally{se=null}return Ie(()=>{for(let r=0;r<n.length;r+=1){const s=n[r];if(s.pending!==X){const i=s.pending;s.pending=X,xe(s,i)}}},!1),e}function Se(t){let e,n=b;return b=null,e=t(),b=n,e}function rn(t){return O===null||(O.cleanups===null?O.cleanups=[t]:O.cleanups.push(t)),t}function et(){const t=ie;if(this.sources&&(this.state||t)){const e=A;A=null,this.state===V||t?le(this):Ce(this),A=e}if(b){const e=this.observers?this.observers.length:0;b.sources?(b.sources.push(this),b.sourceSlots.push(e)):(b.sources=[this],b.sourceSlots=[e]),this.observers?(this.observers.push(b),this.observerSlots.push(b.sources.length-1)):(this.observers=[b],this.observerSlots=[b.sources.length-1])}return this.value}function xe(t,e,n){if(se)return t.pending===X&&se.push(t),t.pending=e,e;if(t.comparator&&t.comparator(t.value,e))return e;let r=!1;return t.value=e,t.observers&&t.observers.length&&Ie(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s];r&&ie.disposed.has(i),(r&&!i.tState||!r&&!i.state)&&(i.pure?A.push(i):q.push(i),i.observers&&rt(i)),r||(i.state=V)}if(A.length>1e6)throw A=[],new Error},!1),e}function le(t){if(!t.fn)return;Je(t);const e=O,n=b,r=Me;b=O=t,sn(t,t.value,r),b=n,O=e}function sn(t,e,n){let r;try{r=t.fn(e)}catch(s){it(s)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?xe(t,r):t.value=r,t.updatedAt=n)}function ke(t,e,n,r=V,s){const i={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:O,context:null,pure:n};return O===null||O!==Ye&&(O.owned?O.owned.push(i):O.owned=[i]),i}function tt(t){const e=ie;if(t.state===0||e)return;if(t.state===be||e)return Ce(t);if(t.suspense&&Se(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Me);)(t.state||e)&&n.push(t);for(let r=n.length-1;r>=0;r--)if(t=n[r],t.state===V||e)le(t);else if(t.state===be||e){const s=A;A=null,Ce(t,n[0]),A=s}}function Ie(t,e){if(A)return t();let n=!1;e||(A=[]),q?n=!0:q=[],Me++;try{const r=t();return on(n),r}catch(r){it(r)}finally{A=null,n||(q=null)}}function on(t){A&&(nt(A),A=null),!t&&(q.length?nn(()=>{en(q),q=null}):q=null)}function nt(t){for(let e=0;e<t.length;e++)tt(t[e])}function Ce(t,e){const n=ie;t.state=0;for(let r=0;r<t.sources.length;r+=1){const s=t.sources[r];s.sources&&(s.state===V||n?s!==e&&tt(s):(s.state===be||n)&&Ce(s,e))}}function rt(t){const e=ie;for(let n=0;n<t.observers.length;n+=1){const r=t.observers[n];(!r.state||e)&&(r.state=be,r.pure?A.push(r):q.push(r),r.observers&&rt(r))}}function Je(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),o=n.observerSlots.pop();r<s.length&&(i.sourceSlots[o]=r,s[r]=i,n.observerSlots[r]=o)}}if(t.owned){for(e=0;e<t.owned.length;e++)Je(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function it(t){throw t}function ln(){return Symbol.observable||"@@observable"}function st(t){const e=ln();return{subscribe(n){if(!(n instanceof Object)||n==null)throw new TypeError("Expected the observer to be an object.");const r="next"in n?n.next.bind(n):n;let s=!1;return tn(()=>{if(s)return;const i=t();Se(()=>r(i))}),{unsubscribe(){s=!0}}},[e](){return this}}}const un=Symbol("fallback");function ot(t){for(let e=0;e<t.length;e++)t[e]()}function an(t,e,n={}){let r=[],s=[],i=[],o=0,l=e.length>1?[]:null;return rn(()=>ot(i)),()=>{let c=t()||[],u,a;return c[Zt],Se(()=>{let d=c.length,h,_,w,M,J,P,R,L,U;if(d===0)o!==0&&(ot(i),i=[],r=[],s=[],o=0,l&&(l=[])),n.fallback&&(r=[un],s[0]=oe(Oe=>(i[0]=Oe,n.fallback())),o=1);else if(o===0){for(s=new Array(d),a=0;a<d;a++)r[a]=c[a],s[a]=oe(f);o=d}else{for(w=new Array(d),M=new Array(d),l&&(J=new Array(d)),P=0,R=Math.min(o,d);P<R&&r[P]===c[P];P++);for(R=o-1,L=d-1;R>=P&&L>=P&&r[R]===c[L];R--,L--)w[L]=s[R],M[L]=i[R],l&&(J[L]=l[R]);for(h=new Map,_=new Array(L+1),a=L;a>=P;a--)U=c[a],u=h.get(U),_[a]=u===void 0?-1:u,h.set(U,a);for(u=P;u<=R;u++)U=r[u],a=h.get(U),a!==void 0&&a!==-1?(w[a]=s[u],M[a]=i[u],l&&(J[a]=l[u]),a=_[a],h.set(U,a)):i[u]();for(a=P;a<d;a++)a in w?(s[a]=w[a],i[a]=M[a],l&&(l[a]=J[a],l[a](a))):s[a]=oe(f);s=s.slice(0,o=d),r=c.slice(0)}return s});function f(d){if(i[a]=d,l){const[h,_]=Ze(a);return l[a]=_,e(c[a],h)}return e(c[a])}}}function x(t,e){return Se(()=>t(e||{}))}function F(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Pe(an(()=>t.each,t.children,e||void 0))}const cn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],fn=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...cn]),dn=new Set(["innerHTML","textContent","innerText","children"]),hn={className:"class",htmlFor:"for"},lt={class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"},mn=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),_n={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function gn(t,e,n){let r=n.length,s=e.length,i=r,o=0,l=0,c=e[s-1].nextSibling,u=null;for(;o<s||l<i;){if(e[o]===n[l]){o++,l++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===o){const a=i<r?l?n[l-1].nextSibling:n[i-l]:c;for(;l<i;)t.insertBefore(n[l++],a)}else if(i===l)for(;o<s;)(!u||!u.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[i-1]&&n[l]===e[s-1]){const a=e[--s].nextSibling;t.insertBefore(n[l++],e[o++].nextSibling),t.insertBefore(n[--i],a),e[s]=n[i]}else{if(!u){u=new Map;let f=l;for(;f<i;)u.set(n[f],f++)}const a=u.get(e[o]);if(a!=null)if(l<a&&a<i){let f=o,d=1,h;for(;++f<s&&f<i&&!((h=u.get(e[f]))==null||h!==a+d);)d++;if(d>a-l){const _=e[o];for(;l<a;)t.insertBefore(n[l++],_)}else t.replaceChild(n[l++],e[o++])}else o++;else e[o++].remove()}}}const ut="_$DX_DELEGATE";function ue(t,e,n){let r;return oe(s=>{r=s,e===document?t():g(e,t(),e.firstChild?null:void 0,n)}),()=>{r(),e.textContent=""}}function E(t,e,n){const r=document.createElement("template");r.innerHTML=t;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function vn(t,e=window.document){const n=e[ut]||(e[ut]=new Set);for(let r=0,s=t.length;r<s;r++){const i=t[r];n.has(i)||(n.add(i),e.addEventListener(i,Nn))}}function Ne(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function pn(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function p(t,e){e==null?t.removeAttribute("class"):t.className=e}function wn(t,e,n,r){r?Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n:Array.isArray(n)?t.addEventListener(e,s=>n[0](n[1],s)):t.addEventListener(e,n)}function at(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let i,o;for(i=0,o=s.length;i<o;i++){const l=s[i];!l||l==="undefined"||e[l]||(ct(t,l,!1),delete n[l])}for(i=0,o=r.length;i<o;i++){const l=r[i],c=!!e[l];!l||l==="undefined"||n[l]===c||!c||(ct(t,l,!0),n[l]=c)}return n}function yn(t,e,n={}){const r=t.style,s=typeof n=="string";if(e==null&&s||typeof e=="string")return r.cssText=e;s&&(r.cssText=void 0,n={}),e||(e={});let i,o;for(o in n)e[o]==null&&r.removeProperty(o),delete n[o];for(o in e)i=e[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function bn(t,e,n,r){typeof e=="function"?$(s=>dt(t,e(),s,n,r)):dt(t,e,void 0,n,r)}function g(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return z(t,e,r,n);$(s=>z(t,e(),s,n),r)}function Sn(t,e,n,r,s={},i=!1){e||(e={});for(const o in s)if(!(o in e)){if(o==="children")continue;ft(t,o,null,s[o],n,i)}for(const o in e){if(o==="children"){r||z(t,e.children);continue}const l=e[o];s[o]=ft(t,o,l,s[o],n,i)}}function Cn(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function ct(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,i=r.length;s<i;s++)t.classList.toggle(r[s],n)}function ft(t,e,n,r,s,i){let o,l,c;if(e==="style")return yn(t,n,r);if(e==="classList")return at(t,n,r);if(n===r)return r;if(e==="ref")i||n(t);else if(e.slice(0,3)==="on:")t.addEventListener(e.slice(3),n);else if(e.slice(0,10)==="oncapture:")t.addEventListener(e.slice(10),n,!0);else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),a=mn.has(u);wn(t,u,n,a),a&&vn([u])}else if((c=dn.has(e))||!s&&(lt[e]||(l=fn.has(e)))||(o=t.nodeName.includes("-")))e==="class"||e==="className"?p(t,n):o&&!l&&!c?t[Cn(e)]=n:t[lt[e]||e]=n;else{const u=s&&e.indexOf(":")>-1&&_n[e.split(":")[0]];u?pn(t,u,e,n):Ne(t,hn[e]||e,n)}return n}function Nn(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}}),W.registry&&!W.done&&(W.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[e];if(r&&!n.disabled){const s=n[`${e}Data`];if(s!==void 0?r(s,t):r(t),t.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function dt(t,e,n={},r,s){return e||(e={}),!s&&"children"in e&&$(()=>n.children=z(t,e.children,n.children)),e.ref&&e.ref(t),$(()=>Sn(t,e,r,!0,n,!0)),n}function z(t,e,n,r,s){for(W.context&&!n&&(n=[...t.childNodes]);typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,o=r!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(W.context)return n;if(i==="number"&&(e=e.toString()),o){let l=n[0];l&&l.nodeType===3?l.data=e:l=document.createTextNode(e),n=Y(t,n,r,l)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean"){if(W.context)return n;n=Y(t,n,r)}else{if(i==="function")return $(()=>{let l=e();for(;typeof l=="function";)l=l();n=z(t,l,n,r)}),()=>n;if(Array.isArray(e)){const l=[];if(De(l,e,s))return $(()=>n=z(t,l,n,r,!0)),()=>n;if(W.context){for(let c=0;c<l.length;c++)if(l[c].parentNode)return n=l}if(l.length===0){if(n=Y(t,n,r),o)return n}else Array.isArray(n)?n.length===0?ht(t,l,r):gn(t,n,l):(n&&Y(t),ht(t,l));n=l}else if(e instanceof Node){if(W.context&&e.parentNode)return n=o?[e]:e;if(Array.isArray(n)){if(o)return n=Y(t,n,r,e);Y(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function De(t,e,n){let r=!1;for(let s=0,i=e.length;s<i;s++){let o=e[s],l;if(o instanceof Node)t.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))r=De(t,o)||r;else if((l=typeof o)=="string")t.push(document.createTextNode(o));else if(l==="function")if(n){for(;typeof o=="function";)o=o();r=De(t,Array.isArray(o)?o:[o])||r}else t.push(o),r=!0;else t.push(document.createTextNode(o.toString()))}return r}function ht(t,e,n){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function Y(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;o>=0;o--){const l=e[o];if(s!==l){const c=l.parentNode===t;!i&&!o?c?t.replaceChild(s,l):t.insertBefore(s,n):c&&l.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}function mt(t){if(t!==null)return t}function $e(t){return function(e){if(e===void 0)throw new Error(t!=null?t:"expect some value");return e}}function _t(t){return function*(e){for(const n of e)yield t(n)}}function*gt(t){let e=0;for(const n of t)yield[e++,n]}function $n(t){return function*(e){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();for(;;){const s=n.next(),i=r.next();if(s.done!==!0&&i.done!==!0)yield[s.value,i.value];else return}}}function Z(t){return function(e){return Array.from(e).sort(t)}}function Rn(t){for(const e of t)return e}function G(t,e){return function(n){let r=t;for(const s of n)r=e(r,s);return r}}function ae(t){return Array.from(t)}function vt(t){return function(e){for(const n of e)t(n)}}class Te{constructor(e){k(this,"t");this.t=e}static from(e){return new Te(e)}static unwrap(e){return e.t}}class Re{constructor(e){k(this,"_init");k(this,"_t");this._init=e}static from(e){return new Re(e)}force(){return this._t===void 0&&(this._t=Te.from(this._init())),this._t.t}}class S{constructor(e){k(this,"_t");this._t=e}then(e){return new S(e(this._t))}static from(e){return new S(e)}unwrap(){return this._t}}var pt=`._mainBody_1tr7e_1{opacity:.5}._mainBody_1tr7e_1 *{font-size:.75rem;margin:0}._mainBody_1tr7e_1 button,._clickable_1tr7e_11{cursor:pointer}._stateWorkingOn_1tr7e_14{color:#00f}._stateSure_1tr7e_17{color:green}._stateNotSure_1tr7e_20{color:red}._answerMsg_1tr7e_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_1tr7e_23 ul{padding-left:1rem}._answerMsgName_1tr7e_32{font-weight:700}._answerMark_1tr7e_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_1tr7e_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_1tr7e_35 input{height:max-content;width:100%}._answerDetail_1tr7e_53 ._stateWorkingOn_1tr7e_14,._answerDetail_1tr7e_53 ._stateSure_1tr7e_17,._answerDetail_1tr7e_53 ._stateNotSure_1tr7e_20{font-weight:700}._answerDetail_1tr7e_53 ul{padding-left:1.5rem}._answerDetail_1tr7e_53 img{height:auto;width:80%}._answerDetailShortAnswer_1tr7e_65{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem;min-width:min-content}._answerDetailFill_1tr7e_72{white-space:pre}._settings_1tr7e_75{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_1tr7e_83{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_1tr7e_83 label{font-weight:700}._settingsEntry_1tr7e_83 input{height:max-content;text-align:right}._settingsSubmit_1tr7e_97{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_1tr7e_103{margin-right:.5rem}._about_1tr7e_106 p{margin-bottom:.25rem}._about_1tr7e_106 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_1tr7e_106 ul li{margin-bottom:.25rem}._uploadImg_1tr7e_116{display:flex;flex-direction:column}._uploadImg_1tr7e_116 img{width:100%;height:auto}._uploadImgImage_1tr7e_124{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_1tr7e_129{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`;const En=E("<title> </title>"),On=E("<style></style>");function wt(t,e,n){yt(e instanceof t,n!=null?n:"not HTMLElement")}function yt(t,e){if(t!==!0)throw Error(e!=null?e:"assertion failed")}function ee(...t){return t}function Le(t){const e=S.from(window.open("","",Object.entries(t).map(([r,s])=>`${r}=${s}`).join(","))).then(mt).then($e("cannot open windows")).unwrap(),n=()=>e.close();return window.addEventListener("unload",n),e.addEventListener("close",()=>window.removeEventListener("unload",n)),ue(()=>[(()=>{const r=En.cloneNode(!0),s=r.firstChild;return $(()=>s.data=t.title),r})(),(()=>{const r=On.cloneNode(!0);return r.textContent=pt,r})()],e.document.head),e}function qe(t,...e){}function bt(t,e){const n=new URL(t,self.location.origin);for(const[r,s]of Object.entries(e!=null?e:{}))n.searchParams.set(r,s);return n}function St(t){const e=GM_getValue(t);if(e!==void 0)return e.contents}function ce(t,e){return GM_setValue(t,{contents:e}),e}function An(){var n;const t=[{name:"202205231915_gm_value",up(){ce("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const r of["username","server","sync_answers","sort_problems"])ce(r,GM_getValue(r))}}],e=(n=St("migrations"))!=null?n:[];for(const{name:r,idx:s}of e)if(r!==t[s].name)throw new Error("bad migrations");for(const{name:r,up:s}of t.slice(e.length))s();ce("migrations",t.map((r,s)=>({name:r.name,idx:s})))}class fe{constructor(e,n){k(this,"_name");k(this,"_t");this._name=e,this._t=Re.from(()=>{const r=St(this._name);return r===void 0&&n!==void 0?ce(this._name,n):r})}get(){return this._t.force()}set(e){e!==void 0&&(ce(this._name,e),this._t=Re.from(()=>e))}}const je=new fe("username"),Be=new fe("server"),We=new fe("sync_answers",!0),Fe=new fe("sort_problems",!1),Ue=new fe("no_leave_check",!0);class Mn{constructor(){k(this,"token");k(this,"client");k(this,"examId");k(this,"paper");k(this,"queue",new Map);k(this,"onmsg",[])}onmessage(e){this.onmsg.push(e)}updateQueue(e,n){let r=this.queue.get(e);r!==void 0?n(r):(r={},n(r),this.queue.set(e,r))}updateAnswer(e,n){this.updateQueue(e,r=>r.result=n)}updateState(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.state=n})}updateMsg(e,n){this.updateQueue(e,r=>{var s;r.context=(s=r.context)!=null?s:{},r.context.msg=n})}async watch(e){return new Promise((n,r)=>{const s=setInterval(()=>{this.sendQueue().catch(i=>{clearInterval(s),alert("\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5F02\u5E38"),r(i)})},e)})}async login(e,n){this.examId=e,this.paper=n}async sendQueue(){const e=We.get(),n=Be.get(),r=je.get();if(e!==!0||this.queue.size<1||n===void 0||r===void 0||this.examId===void 0||this.paper===void 0)return;const s=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const o=new y.JSONRPCClient(l=>new Promise((c,u)=>{GM.xmlHttpRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(l),onload:a=>{a.status===200?(o.receive(S.from(a.responseText).then($e("empty response")).then(JSON.parse).unwrap()),c()):u(new Error(a.statusText))},onerror:a=>u(a.statusText)})}));this.client=o}if(this.token===void 0){qe(`login to server: ${r}, ${this.examId}`);const o=await this.client.request("login",[r,this.examId,this.paper]);this.token=o}const i=await this.client.request("answer_problem",[this.token,s.map(([o,{result:l,context:c}])=>({problem_id:o,result:l,context:c}))]);this.onmsg.forEach(o=>o(i))}}const j=new Mn;function Pn(t){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const s=t.call(this,bt(r)),i=this.send;this.send=function(o){s!==void 0?s(o).then(l=>{i.call(this,l),this.send=i}).catch(qe):(i.call(this,o),this.send=i)},e.apply(this,arguments)}}var D=(t=>(t[t.SingleChoice=1]="SingleChoice",t[t.MultipleChoice=2]="MultipleChoice",t[t.Polling=3]="Polling",t[t.FillBlank=4]="FillBlank",t[t.ShortAnswer=5]="ShortAnswer",t[t.Judgement=6]="Judgement",t))(D||{}),T=(t=>(t[t.WorkingOn=0]="WorkingOn",t[t.Sure=1]="Sure",t[t.NotSure=2]="NotSure",t))(T||{}),v={mainBody:"_mainBody_1tr7e_1",clickable:"_clickable_1tr7e_11",stateWorkingOn:"_stateWorkingOn_1tr7e_14",stateSure:"_stateSure_1tr7e_17",stateNotSure:"_stateNotSure_1tr7e_20",answerMsg:"_answerMsg_1tr7e_23",answerMsgName:"_answerMsgName_1tr7e_32",answerMark:"_answerMark_1tr7e_35",answerDetail:"_answerDetail_1tr7e_53",answerDetailShortAnswer:"_answerDetailShortAnswer_1tr7e_65",answerDetailFill:"_answerDetailFill_1tr7e_72",settings:"_settings_1tr7e_75",settingsEntry:"_settingsEntry_1tr7e_83",settingsSubmit:"_settingsSubmit_1tr7e_97",settingsSubmitTip:"_settingsSubmitTip_1tr7e_103",about:"_about_1tr7e_106",uploadImg:"_uploadImg_1tr7e_116",uploadImgImage:"_uploadImgImage_1tr7e_124",uploadImgConfirm:"_uploadImgConfirm_1tr7e_129"};const xn=E('<div><fieldset><legend>\u6807\u8BB0</legend><input type="text" placeholder="\u7559\u8A00"><button type="button">\u6211\u6B63\u5728\u505A</button><button type="button">\u6211\u5F88\u786E\u5B9A</button><button type="button">\u6211\u4E0D\u786E\u5B9A</button></fieldset><div><fieldset><legend> \u7559\u8A00 </legend><ul></ul></fieldset><div></div></div></div>'),kn=E("<li><span></span></li>"),Ct=E("<div><p><strong></strong></p><ul></ul></div>"),Nt=E("<li></li>"),In=E("<li><p></p><ul></ul></li>"),Jn=E("<div></div>"),Dn=E("<ul></ul>"),Tn=E("<li><a></a></li>"),Ln=E("<p><strong></strong></p>");function He(t,e){return t===e?0:t<e?-1:1}function $t(t){switch(t){case T.Sure:return 0;case T.WorkingOn:return 1;case T.NotSure:return 2}}function Rt([t,e],[n,r]){if(e===void 0)return r===void 0?He(t,n):1;if(r===void 0)return-1;{const s=$t(r)-$t(e);return s===0?He(t,n):s}}function Et([t,e],[n,r]){var s,i;return Rt(ee(t,(s=e.context)==null?void 0:s.state),ee(n,(i=r.context)==null?void 0:i.state))}function Ot([t,e],[n,r]){return Rt(ee(t,e==null?void 0:e.state),ee(n,r==null?void 0:r.state))}function Ee(t){if(t!==void 0)switch(t){case T.WorkingOn:return v.stateWorkingOn;case T.NotSure:return v.stateNotSure;case T.Sure:return v.stateSure}}function At(t,e){return`${Math.floor(t*100/e)}%`}function Ve([t],[e]){return He(t,e)}class Ge{constructor(e,n,r){k(this,"_details",new Map);this.updateUI=oe(()=>{const[s,i]=Ze(new Map,{equals:!1}),o=()=>i(this._details),l=r(s),c=n.querySelector(".item-type");return wt(HTMLElement,c),c.classList.add(v.clickable),c.addEventListener("click",()=>{const u=c==null?void 0:c.getBoundingClientRect(),a=Le({title:"\u8BE6\u7EC6\u7B54\u6848",height:300,width:350,top:u==null?void 0:u.top,left:u==null?void 0:u.left});ue(()=>(()=>{const f=xn.cloneNode(!0),d=f.firstChild,h=d.firstChild,_=h.nextSibling,w=_.nextSibling,M=w.nextSibling,J=M.nextSibling,P=d.nextSibling,R=P.firstChild,L=R.firstChild,U=L.nextSibling,Oe=R.nextSibling;return _.addEventListener("change",C=>j.updateMsg(e,C.currentTarget.value)),w.addEventListener("click",()=>j.updateState(e,T.WorkingOn)),M.addEventListener("click",()=>j.updateState(e,T.Sure)),J.addEventListener("click",()=>j.updateState(e,T.NotSure)),g(U,x(F,{get each(){return S.from(s()).then(Z(Et)).then(ae).unwrap()},children:([C,{context:K}])=>{if(K===void 0)return;let B=K.msg;if(K.state===T.WorkingOn&&(B=B!=null?B:"\u6211\u6B63\u5728\u505A"),B!==void 0)return(()=>{const Q=kn.cloneNode(!0),he=Q.firstChild;return g(he,`${C}: `),g(Q,B,null),$(H=>{const me=Ee(K.state),_e=v.answerMsgName;return me!==H._v$8&&p(Q,H._v$8=me),_e!==H._v$9&&p(he,H._v$9=_e),H},{_v$8:void 0,_v$9:void 0}),Q})()}})),g(Oe,x(l,{})),$(C=>{const K=v.mainBody,B=v.answerMark,Q=v.stateWorkingOn,he=v.stateSure,H=v.stateNotSure,me=v.answerMsg,_e=v.answerDetail;return K!==C._v$&&p(f,C._v$=K),B!==C._v$2&&p(d,C._v$2=B),Q!==C._v$3&&p(w,C._v$3=Q),he!==C._v$4&&p(M,C._v$4=he),H!==C._v$5&&p(J,C._v$5=H),me!==C._v$6&&p(R,C._v$6=me),_e!==C._v$7&&p(Oe,C._v$7=_e),C},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),f})(),a.document.body)}),o})}updateAnswer(e,n){this._details.set(e,n)}}class Mt{constructor(e){this._ele=e}setContent(e){this._ele.setAttribute("title",e)}}class qn extends Ge{constructor(e,n,r){const s=S.from(n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput")).then(i=>Array.from(i).entries()).then(G(new Map,(i,[o,l])=>i.set(String.fromCharCode(o+65),new Mt(l)))).unwrap();super(e,n,i=>{const o=Pe(()=>S.from(i()).then(G(new Map,(l,[c,{answer:u,context:a}])=>{var f;if(u!==void 0)for(let d of u){d=r(d);const h=(f=l.get(d))!=null?f:[];h.push([c,a]),l.set(d,h)}return l})).then(Z(Ve)).then(ae).unwrap());return st(o).subscribe(l=>S.from(l).then(vt(([c,u])=>{var a;(a=s.get(c))==null||a.setContent(At(u.length,i().size))}))),()=>x(F,{get each(){return o()},children:([l,c])=>(()=>{const u=Ct.cloneNode(!0),a=u.firstChild,f=a.firstChild,d=a.nextSibling;return g(f,l),g(d,x(F,{get each(){return c.sort(Ot)},children:([h,_])=>(()=>{const w=Nt.cloneNode(!0);return g(w,h),$(()=>p(w,Ee(_==null?void 0:_.state))),w})()})),u})()})})}}class jn extends Ge{constructor(e,n){const r=S.from(n.querySelectorAll(".item-body .blank-item-dynamic")).then(Array.from).then(gt).then(G(new Map,(s,[i,o])=>s.set(String.fromCharCode(i+49),new Mt(o)))).unwrap();super(e,n,s=>{const i=()=>S.from(s()).then(G(new Map,(o,[l,{answer:c,context:u}])=>c===void 0?o:S.from(c).then(Object.entries).then(G(o,(a,[f,d])=>{var w,M;d=d.trim();const h=(w=a.get(f))!=null?w:new Map,_=(M=h.get(d))!=null?M:[];return _.push([l,u]),a.set(f,h.set(d,_))})).unwrap())).then(_t(([o,l])=>ee(o,S.from(l).then(Z(Ve)).then(ae).unwrap()))).then(Z(Ve)).then(ae).unwrap();return st(i).subscribe(o=>{S.from(o).then(vt(([l,c])=>{var a;const u=S.from(c).then(_t(([f,d])=>ee(f,d.length))).then(Z(([,f],[,d])=>d-f)).then(Rn).unwrap();(a=r.get(l))==null||a.setContent(u===void 0?"":`(${At(u[1],s().size)}) ${u[0]}`)}))}),()=>x(F,{get each(){return i()},children:([o,l])=>(()=>{const c=Ct.cloneNode(!0),u=c.firstChild,a=u.firstChild,f=u.nextSibling;return g(a,`#${o}`),g(f,x(F,{each:l,children:([d,h])=>{if(d!=="")return(()=>{const _=In.cloneNode(!0),w=_.firstChild,M=w.nextSibling;return g(w,d),g(M,x(F,{get each(){return h.sort(Ot)},children:([J,P])=>(()=>{const R=Nt.cloneNode(!0);return g(R,J),$(()=>p(R,Ee(P==null?void 0:P.state))),R})()})),$(()=>p(w,v.answerDetailFill)),_})()}})),c})()})})}}class Bn extends Ge{constructor(e,n){super(e,n,r=>{const s=Pe(()=>S.from(r()).then(Z(Et)).then(ae).unwrap());return()=>x(F,{get each(){return s()},children:([i,{answer:o,context:l}])=>{var d;const c=o==null?void 0:o.content,u=(d=o==null?void 0:o.attachments)==null?void 0:d.filelist;let a,f;if(c!==void 0&&(a=(()=>{const h=Jn.cloneNode(!0);return h.innerHTML=c,$(()=>p(h,v.answerDetailShortAnswer)),h})()),u!==void 0&&(f=(()=>{const h=Dn.cloneNode(!0);return g(h,x(F,{each:u,children:({fileUrl:_,fileName:w})=>(()=>{const M=Tn.cloneNode(!0),J=M.firstChild;return Ne(J,"href",_),g(J,w),M})()})),h})()),!(a===void 0&&f===void 0))return[(()=>{const h=Ln.cloneNode(!0),_=h.firstChild;return g(_,i),$(()=>p(h,Ee(l==null?void 0:l.state))),h})(),a,f]}})})}}const Wn=E("<div><label></label><input></div>"),Fn=E('<div><form><div><p><i> *\u66F4\u6539\u8BBE\u7F6E\u540E\u8BF7\u5237\u65B0\u9875\u9762 </i></p><button type="submit"> \u63D0\u4EA4 </button></div></form><div><p><strong> \u529F\u80FD\u7279\u6027\uFF1A </strong></p><ul></ul></div></div>'),Un=E("<li><strong></strong></li>"),Hn=E("<div></div>");function de(t){const e=It(kt({},t.extra),{name:t.name});return(()=>{const n=Wn.cloneNode(!0),r=n.firstChild,s=r.nextSibling;return g(r,()=>t.title),bn(s,e,!1,!1),$(i=>{const o=v.settingsEntry,l=t.name;return o!==i._v$&&p(n,i._v$=o),l!==i._v$2&&Ne(r,"for",i._v$2=l),i},{_v$:void 0,_v$2:void 0}),n})()}function Vn(t){const e={};function n(s){return i=>e[s]=i.currentTarget.value}function r(s){return i=>e[s]=i.currentTarget.checked}return(()=>{const s=Fn.cloneNode(!0),i=s.firstChild,o=i.firstChild,l=o.firstChild,c=i.nextSibling,u=c.firstChild,a=u.nextSibling;return i.addEventListener("submit",f=>{f.preventDefault(),je.set(e.username),Be.set(e.server),We.set(e.syncAnswers),Fe.set(e.sortProblems),Ue.set(e.noLeaveCheck),t.onSubmit()}),g(i,x(de,{name:"username",title:"\u7528\u6237\u540D",get extra(){return{type:"text",pattern:"^[a-z][a-z0-9_]*$",title:"\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF",required:!0,value:je.get(),onChange:n("username")}}}),o),g(i,x(de,{name:"server",title:"\u670D\u52A1\u5668",get extra(){return{type:"url",required:!0,value:Be.get(),onChange:n("server")}}}),o),g(i,x(de,{name:"sync_answers",title:"\u540C\u6B65\u7B54\u6848",get extra(){return{type:"checkbox",checked:We.get(),onChange:r("syncAnswers")}}}),o),g(i,x(de,{name:"sort_problems",title:"\u6392\u5E8F\u9898\u76EE",get extra(){return{type:"checkbox",checked:Fe.get(),onChange:r("sortProblems")}}}),o),g(i,x(de,{name:"no_leave_check",title:"\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B",get extra(){return{type:"checkbox",checked:Ue.get(),onChange:r("noLeaveCheck")}}}),o),g(a,()=>[["\u540C\u6B65\u7B54\u6848\uFF1A","\u70B9\u51FB\u9898\u76EE\u663E\u793A\u8BE6\u7EC6\u7B54\u6848\uFF0C\u5728\u9009\u9879/\u586B\u7A7A\u5904\u60AC\u505C\u663E\u793A\u7B80\u7565\u7B54\u6848"],["\u6392\u5E8F\u9898\u76EE\uFF1A","\u6839\u636E ID \u5BF9\u9898\u76EE\u548C\u9009\u9879\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F"],["\u62E6\u622A\u5207\u5C4F\u68C0\u6D4B\uFF1A","\u968F\u610F\u5207\u6362\u9875\u9762\u3001\u7A97\u53E3\u4E0D\u4F1A\u88AB\u53D1\u73B0"],["\u62E6\u622A\u4E0A\u4F20\u622A\u56FE\uFF1A","\u4EC5\u5F53\u7528\u6237\u786E\u8BA4\u540E\uFF0C\u624D\u4F1A\u4E0A\u4F20\u622A\u56FE"],["\u62E6\u622A\u5F02\u5E38\u72B6\u6001\uFF1A","\u5373\u4F7F\u672C\u5730\u663E\u793A\u5F02\u5E38\u4E5F\u4E0D\u4F1A\u63A8\u9001\u5230\u670D\u52A1\u5668"]].map(([f,d])=>(()=>{const h=Un.cloneNode(!0),_=h.firstChild;return g(_,f),g(h,d,null),h})())),$(f=>{const d=v.settingsSubmit,h=v.settingsSubmitTip,_=v.about;return d!==f._v$3&&p(o,f._v$3=d),h!==f._v$4&&p(l,f._v$4=h),_!==f._v$5&&p(c,f._v$5=_),f},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),s})()}function Gn(){const t=Le({title:"\u8BBE\u7F6E",width:350,height:300});ue(()=>(()=>{const e=Hn.cloneNode(!0);return g(e,x(Vn,{onSubmit:()=>t.close()})),$(()=>p(e,v.mainBody)),e})(),t.document.body)}const Kn=E("<style></style>"),Qn=E('<div><div><button type="button">\u786E\u8BA4\u4E0A\u4F20</button><span><i>*\u5173\u95ED\u7A97\u53E3\u4EE5\u53D6\u6D88\u4E0A\u4F20</i></span></div><div><img></div></div>');class Xn{constructor(e){ue(()=>(()=>{const s=Kn.cloneNode(!0);return s.textContent=pt,s})(),document.head);const n=document.body.querySelector(".header-title");wt(HTMLElement,n),n.classList.add(v.clickable),n.addEventListener("click",()=>Gn());const r=Array.from(document.body.querySelectorAll(".exam-main--body .subject-item"));yt(r.length===e.length,"number subject items mismatches problems"),this._details=S.from(r).then($n(e)).then(G(new Map,(s,[i,o])=>{let l;switch(o.ProblemType){case D.SingleChoice:case D.MultipleChoice:case D.Polling:case D.Judgement:{const c=o.ProblemType===D.Judgement?new Map([["true","\u6B63\u786E"],["false","\u9519\u8BEF"]]):S.from(o.Options).then($e("no Options")).then(gt).then(G(new Map,(u,[a,{key:f}])=>u.set(f,String.fromCharCode(65+a)))).unwrap();l=new qn(o.ProblemID,i,u=>{var a;return(a=c.get(u))!=null?a:u});break}case D.FillBlank:l=new jn(o.ProblemID,i);break;case D.ShortAnswer:l=new Bn(o.ProblemID,i);break}return s.set(o.ProblemID,l)})).unwrap()}updateAnswer({username:e,problem_id:n,result:r,context:s}){var i;(i=this._details.get(n))==null||i.updateAnswer(e,{answer:r,context:s})}updateUI(){this._details.forEach(e=>e.updateUI())}}function zn(t,e){const n=Le({title:"\u4E0A\u4F20\u56FE\u7247",width:400,height:300});ue(()=>(()=>{const r=Qn.cloneNode(!0),s=r.firstChild,i=s.firstChild,o=s.nextSibling,l=o.firstChild;return i.addEventListener("click",()=>{n.close(),e()}),Ne(l,"src",t),$(c=>{const u={[v.mainBody]:!0,[v.uploadImg]:!0},a=v.uploadImgConfirm,f=v.uploadImgImage;return c._v$=at(r,u,c._v$),a!==c._v$2&&p(s,c._v$2=a),f!==c._v$3&&p(o,c._v$3=f),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),n.document.body)}function Pt(t){return t.forEach(e=>{switch(e.ProblemType){case D.SingleChoice:case D.MultipleChoice:case D.Polling:{e.Options.sort((r,s)=>r.key<s.key?-1:1);break}}}),t.sort((e,n)=>e.ProblemID-n.ProblemID),t}function Yn(t){return Fe.get()===!0&&(t.data.has_problem_dict===!0?t.data.problems=t.data.problems.sort((e,n)=>e.id-n.id).map(e=>(e.problems=Pt(e.problems),e)):t.data.problems=Pt(t.data.problems)),t}function Zn(){document.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0)}async function er(){An(),Ue.get()===!0&&Zn(),Pn(function(t){switch(t.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(Yn(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return e}}})}}),this.addEventListener("load",()=>{const e=JSON.parse(this.responseText);let n=[];e.data.has_problem_dict===!0?e.data.problems.forEach(i=>{n=n.concat(i.problems)}):n=e.data.problems;const r=new Xn(n);j.onmessage(i=>{i.forEach(o=>r.updateAnswer(o)),r.updateUI()});const s=parseInt(S.from(t.searchParams.get("exam_id")).then(mt).then($e("cannot found exam_id")).unwrap());j.login(s,{title:e.data.title,problems:n}),fetch(bt("/exam_room/cache_results",{exam_id:s.toString()}).toString()).then(i=>i.json()).then(i=>i.data.results.forEach(({problem_id:o,result:l})=>j.updateAnswer(o,l))).catch(qe)});return;case"/exam_room/answer_problem":return async e=>{var n;if(typeof e=="string"){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:s,result:i})=>j.updateAnswer(s,i)))}return e};default:return t.hostname==="upload-z1.qiniup.com"?async e=>e instanceof FormData&&e.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>zn(r.result,()=>n(e)),r.readAsDataURL(e.get("file"))}):e:void 0}}),await j.watch(1e4)}er().catch(console.error)});
