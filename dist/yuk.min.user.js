// ==UserScript==
// @name         yuk-client
// @version      0.3.2
// @author       doge2x
// @namespace    https://github.com/doge2x/yuk
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==

(()=>{"use strict";var e=[,(e,t,n)=>{n.r(t),n.d(t,{Client:()=>l});var r=n(2),o=n(8),i=n(9),a=n(14),u=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))};class l{constructor(){this.onmsg=[],this.queue=new Map;const e=new r.JSONRPCClient((t=>u(this,void 0,void 0,(function*(){const n=a.SERVER.value;null!==n&&(yield new Promise(((r,i)=>u(this,void 0,void 0,(function*(){yield o.default.xhr({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(t),onload:t=>{200===t.status?(e.receive(JSON.parse(t.responseText)),r()):i(new Error(t.statusText))},onerror:e=>i(e.statusText)})})))))}))));this.client=e}watch(e){return u(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const r=setInterval((()=>{this.sendQueue().catch((e=>{clearInterval(r),alert("与服务器通信异常"),n(e)}))}),e)}))}))}sendQueue(){return u(this,void 0,void 0,(function*(){if(this.queue.size<1||null===a.USERNAME.value||null===a.SERVER.value||null===a.EXAM_ID.value||!1===a.SYNC_ANSWERS.value)return;let e=[...this.queue.values()];if(this.queue.clear(),null===a.TOKEN.value){(0,i.devLog)(`login to server: ${a.USERNAME.value}, ${a.EXAM_ID.value}`);const e=yield this.client.request("login",[a.USERNAME.value,a.EXAM_ID.value]);(0,i.devLog)("got token",e),a.TOKEN.value=e}this.postAnswers(a.TOKEN.value,e)}))}postAnswers(e,t){return u(this,void 0,void 0,(function*(){(0,i.devLog)("send answers",t);const n=yield this.client.request("answer_problem",[e,t]);(0,i.devLog)("receive answers",n),this.onmsg.forEach((e=>e(n)))}))}answerProblem(e){return u(this,void 0,void 0,(function*(){e.forEach((e=>{this.queue.set(e.problem_id,e)}))}))}onmessage(e){this.onmsg.push(e)}}},function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(3),t),o(n(4),t),o(n(6),t),o(n(7),t)},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.JSONRPCClient=void 0;var i=n(4),a=n(5),u=function(){function e(e,t){this._send=e,this.createID=t,this.idToResolveMap=new Map,this.id=0}return e.prototype._createID=function(){return this.createID?this.createID():++this.id},e.prototype.timeout=function(e,t){var n=this;void 0===t&&(t=function(e){return(0,i.createJSONRPCErrorResponse)(e,a.DefaultErrorCode,"Request timeout")});var r=function(r,o){var i=setTimeout((function(){r.forEach((function(e){var r=n.idToResolveMap.get(e);r&&(n.idToResolveMap.delete(e),r(t(e)))}))}),e);return o().then((function(e){return clearTimeout(i),e}),(function(e){return clearTimeout(i),Promise.reject(e)}))};return{request:function(e,t,o){var i=n._createID();return r([i],(function(){return n.requestWithID(e,t,o,i)}))},requestAdvanced:function(e,t){return function(e,t){var o=(Array.isArray(e)?e:[e]).map((function(e){return e.id})).filter(l);return r(o,(function(){return n.requestAdvanced(e,t)}))}(e,t)}}},e.prototype.request=function(e,t,n){return this.requestWithID(e,t,n,this._createID())},e.prototype.requestWithID=function(e,t,n,a){return r(this,void 0,void 0,(function(){var r,u;return o(this,(function(o){switch(o.label){case 0:return r={jsonrpc:i.JSONRPC,method:e,params:t,id:a},[4,this.requestAdvanced(r,n)];case 1:return void 0===(u=o.sent()).result||u.error?void 0===u.result&&u.error?[2,Promise.reject(new Error(u.error.message))]:[2,Promise.reject(new Error("An unexpected error occurred"))]:[2,u.result]}}))}))},e.prototype.requestAdvanced=function(e,t){var n=this,r=Array.isArray(e);Array.isArray(e)||(e=[e]);var o=e.filter((function(e){return l(e.id)})),u=o.map((function(e){return new Promise((function(t){return n.idToResolveMap.set(e.id,t)}))})),s=Promise.all(u).then((function(e){return r||!e.length?e:e[0]}));return this.send(r?e:e[0],t).then((function(){return s}),(function(e){return o.forEach((function(t){n.receive((0,i.createJSONRPCErrorResponse)(t.id,a.DefaultErrorCode,e&&e.message||"Failed to send a request"))})),s}))},e.prototype.notify=function(e,t,n){this.send({jsonrpc:i.JSONRPC,method:e,params:t},n).then(void 0,(function(){}))},e.prototype.send=function(e,t){return this._send(e,t)},e.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach((function(t,n){return t((0,i.createJSONRPCErrorResponse)(n,a.DefaultErrorCode,e))})),this.idToResolveMap.clear()},e.prototype.receive=function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach((function(e){var n=t.idToResolveMap.get(e.id);n&&(t.idToResolveMap.delete(e.id),n(e))}))},e}();t.JSONRPCClient=u;var l=function(e){return null!=e}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";t.isJSONRPCID=function(e){return"string"==typeof e||"number"==typeof e||null===e};t.isJSONRPCRequest=function(e){return e.jsonrpc===t.JSONRPC&&void 0!==e.method&&void 0===e.result&&void 0===e.error};t.isJSONRPCRequests=function(e){return Array.isArray(e)&&e.every(t.isJSONRPCRequest)};t.isJSONRPCResponse=function(e){return e.jsonrpc===t.JSONRPC&&void 0!==e.id&&(void 0!==e.result||void 0!==e.error)};t.isJSONRPCResponses=function(e){return Array.isArray(e)&&e.every(t.isJSONRPCResponse)},function(e){e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));t.createJSONRPCErrorResponse=function(e,n,r,o){var i={code:n,message:r};return o&&(i.data=o),{jsonrpc:t.JSONRPC,id:e,error:i}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultErrorCode=void 0,t.DefaultErrorCode=0},function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},a=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.JSONRPCServer=void 0;var u=n(4),l=n(5),s=function(e){return(0,u.createJSONRPCErrorResponse)((0,u.isJSONRPCID)(e.id)?e.id:null,u.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},c=function(){function e(e){var t;void 0===e&&(e={}),this.mapErrorToJSONRPCErrorResponse=h,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=null!==(t=e.errorListener)&&void 0!==t?t:console.warn}return e.prototype.addMethod=function(e,t){this.addMethodAdvanced(e,this.toJSONRPCMethod(t))},e.prototype.toJSONRPCMethod=function(e){return function(t,n){var r=e(t.params,n);return Promise.resolve(r).then((function(e){return p(t.id,e)}))}},e.prototype.addMethodAdvanced=function(e,t){var n;this.nameToMethodDictionary=r(r({},this.nameToMethodDictionary),((n={})[e]=t,n))},e.prototype.receiveJSON=function(e,t){var n=this.tryParseRequestJSON(e);return n?this.receive(n,t):Promise.resolve((0,u.createJSONRPCErrorResponse)(null,u.JSONRPCErrorCode.ParseError,"Parse error"))},e.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch(e){return null}},e.prototype.receive=function(e,t){return Array.isArray(e)?this.receiveMultiple(e,t):this.receiveSingle(e,t)},e.prototype.receiveMultiple=function(e,t){return o(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.map((function(e){return r.receiveSingle(e,t)})))];case 1:return 1===(n=o.sent().filter(d)).length?[2,n[0]]:n.length?[2,n]:[2,null]}}))}))},e.prototype.receiveSingle=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return n=this.nameToMethodDictionary[e.method],(0,u.isJSONRPCRequest)(e)?[3,1]:[2,s(e)];case 1:return n?[4,this.callMethod(n,e,t)]:[3,3];case 2:return r=o.sent(),[2,v(e,r)];case 3:return void 0!==e.id?[2,(i=e.id,(0,u.createJSONRPCErrorResponse)(i,u.JSONRPCErrorCode.MethodNotFound,"Method not found"))]:[2,null];case 4:return[2]}var i}))}))},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.middleware?this.middleware=this.combineMiddlewares(a([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},e.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},e.prototype.middlewareReducer=function(e,t){return function(n,r,o){return e((function(e,r){return t(n,e,r)}),r,o)}},e.prototype.callMethod=function(e,t,n){var r=this,o=function(e){return r.errorListener('An unexpected error occurred while executing "'.concat(t.method,'" JSON-RPC method:'),e),Promise.resolve(r.mapErrorToJSONRPCErrorResponseIfNecessary(t.id,e))};try{return(this.middleware||f)((function(t,n){return e(t,n)}),t,n).then(void 0,o)}catch(e){return o(e)}},e.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,t){return void 0!==e?this.mapErrorToJSONRPCErrorResponse(e,t):null},e}();t.JSONRPCServer=c;var d=function(e){return null!==e},f=function(e,t,n){return e(t,n)},p=function(e,t){return void 0!==e?{jsonrpc:u.JSONRPC,id:e,result:void 0===t?null:t}:null},h=function(e,t){return(0,u.createJSONRPCErrorResponse)(e,l.DefaultErrorCode,t&&t.message||"An unexpected error occurred")},v=function(e,t){return t||(void 0!==e.id?(0,u.createJSONRPCErrorResponse)(e.id,u.JSONRPCErrorCode.InternalError,"Internal error"):null)}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.JSONRPCServerAndClient=void 0;var i=n(4),a=function(){function e(e,t,n){var r;void 0===n&&(n={}),this.server=e,this.client=t,this.errorListener=null!==(r=n.errorListener)&&void 0!==r?r:console.warn}return e.prototype.applyServerMiddleware=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.server).applyMiddleware.apply(e,t)},e.prototype.addMethod=function(e,t){this.server.addMethod(e,t)},e.prototype.addMethodAdvanced=function(e,t){this.server.addMethodAdvanced(e,t)},e.prototype.timeout=function(e){return this.client.timeout(e)},e.prototype.request=function(e,t,n){return this.client.request(e,t,n)},e.prototype.requestAdvanced=function(e,t){return this.client.requestAdvanced(e,t)},e.prototype.notify=function(e,t,n){this.client.notify(e,t,n)},e.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},e.prototype.receiveAndSend=function(e,t,n){return r(this,void 0,void 0,(function(){var r,a;return o(this,(function(o){switch(o.label){case 0:return(0,i.isJSONRPCResponse)(e)||(0,i.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,i.isJSONRPCRequest)(e)||(0,i.isJSONRPCRequests)(e)?[4,this.server.receive(e,t)]:[3,3];case 2:return(r=o.sent())?[2,this.client.send(r,n)]:[3,4];case 3:return a="Received an invalid JSON-RPC message",this.errorListener(a,e),[2,Promise.reject(new Error(a))];case 4:return[2]}}))}))},e}();t.JSONRPCServerAndClient=a},(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r={getValue:e=>GM_getValue(e),setValue:(e,t)=>GM_setValue(e,t),xhr:async e=>await GM.xmlHttpRequest(e)}},(e,t,n)=>{n.r(t),n.d(t,{Map2:()=>a,devLog:()=>i,newURL:()=>s,openWin:()=>l,percent:()=>u});var r=n(10),o=n(13);function i(e,...t){0}class a extends Map{constructor(e){super(),this.def=e}setWith(e,t){var n;super.set(e,t(null!==(n=super.get(e))&&void 0!==n?n:this.def()))}}function u(e){return`${Math.floor(100*e)}%`}function l(e,t){t=null!=t?t:{};const n=window.open(void 0,void 0,Object.entries({location:"no",height:t.height,width:t.width,left:t.left,top:t.top,resizable:"yes",menubar:"no",scrollbars:"yes",status:"no",titlebar:"no",toolbar:"no"}).map((([e,t])=>`${e}=${t}`)).join(","));return window.addEventListener("unload",(()=>n.close())),n.document.head.append(o.default.createElement(o.default.Fragment,null,o.default.createElement("title",null,e),o.default.createElement("style",null,r.default.toString()))),n}function s(e,t){const n=new URL(e,self.location.origin);for(const[e,r]of Object.entries(null!=t?t:{}))n.searchParams.set(e,r);return n}},(e,t,n)=>{n.r(t),n.d(t,{about:()=>m,answerDetail:()=>s,answerDetailShortAnswer:()=>d,answerDetailTitle:()=>c,clickable:()=>l,default:()=>_,mainBody:()=>u,settings:()=>f,settingsEntry:()=>p,settingsSubmit:()=>h,settingsSubmitTip:()=>v,uploadImg:()=>E,uploadImgConfirm:()=>g,uploadImgImage:()=>y});var r=n(11),o=n.n(r),i=n(12),a=n.n(i)()(o());a.push([e.id,".KtSQfh45DkzY1g4GTjHG {\n  font-size: 0.75rem;\n  opacity: 0.5;\n}\n.nl0fbl1STsJ1E_ijRd86 {\n  cursor: pointer;\n}\n.E2WC5WHEPccqZwiUT6nE p {\n  margin: 0;\n}\n.E2WC5WHEPccqZwiUT6nE ul {\n  margin: 0;\n  padding-left: 1.5rem;\n}\n.E2WC5WHEPccqZwiUT6nE img {\n  height: auto;\n  width: 80%;\n}\n.r7r59h_4Cl6wDjEogUvK {\n  font-weight: bold;\n}\n.yZjHuTE6p_FgmbomqPFx {\n  border-style: groove;\n  border-width: thin;\n  margin: 0.2rem;\n  padding: 0.2rem;\n  min-height: min-content;\n  min-width: min-content;\n  max-width: 35rem;\n}\n._o1gebpEn7x9Td7Hes6g {\n  display: flex;\n  flex-direction: column;\n}\n.YalNJJWiNdYPl5FzO1a_ {\n  display: flex;\n  flex-direction: row;\n  margin-bottom: 0.5rem;\n  justify-content: space-between;\n  align-items: center;\n}\n.YalNJJWiNdYPl5FzO1a_ label {\n  font-weight: bold;\n}\n.YalNJJWiNdYPl5FzO1a_ input {\n  height: fit-content;\n  text-align: right;\n}\n.GkQ9CK5Dl58odGzSBLOP {\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n  align-items: end;\n}\n.CY2oPnMnonyamRy15TxZ {\n  margin-bottom: 0.5rem;\n}\n.GkQ9CK5Dl58odGzSBLOP button {\n  cursor: pointer;\n}\n.ssrv8ndZGNgvTL1Osr92 p {\n  margin-bottom: 0.25rem;\n}\n.ssrv8ndZGNgvTL1Osr92 ul {\n  padding-left: 1.5rem;\n  margin: 0 0 0.25rem 0;\n}\n.ssrv8ndZGNgvTL1Osr92 ul li {\n  margin-bottom: 0.25rem;\n}\n.UJVcq5yyVfeOtVL0dWlT {\n  display: flex;\n  flex-direction: column;\n}\n.UJVcq5yyVfeOtVL0dWlT img {\n  width: 100%;\n  height: auto;\n}\n.SB_KxqWR3Sju8ih5VCQj {\n  border-style: groove;\n  border-width: thin;\n  padding: 0.5rem;\n}\n.YM_eQySt5C11IITqy_br {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n",""]);var u="KtSQfh45DkzY1g4GTjHG",l="nl0fbl1STsJ1E_ijRd86",s="E2WC5WHEPccqZwiUT6nE",c="r7r59h_4Cl6wDjEogUvK",d="yZjHuTE6p_FgmbomqPFx",f="_o1gebpEn7x9Td7Hes6g",p="YalNJJWiNdYPl5FzO1a_",h="GkQ9CK5Dl58odGzSBLOP",v="CY2oPnMnonyamRy15TxZ",m="ssrv8ndZGNgvTL1Osr92",E="UJVcq5yyVfeOtVL0dWlT",y="SB_KxqWR3Sju8ih5VCQj",g="YM_eQySt5C11IITqy_br";const _=a},e=>{e.exports=function(e){return e[1]}},e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var u=0;u<this.length;u++){var l=this[u][0];null!=l&&(a[l]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);r&&a[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},(e,t,n)=>{function r(e){return Array.isArray(e)?(new Array).concat(...e.map(r)):e instanceof Node?[e]:null==e?[]:[document.createTextNode(String(e))]}function o(e,t){for(const n of t)e.appendChild(n)}function i(e,t){for(const[n,r]of Object.entries(t))n.startsWith("-")?e.style.setProperty(n,r):e.style[n]=r}function a(e,t,...n){let a=r(n);if("function"==typeof e)return e(Object.assign(Object.assign({},t),{children:a}));{const n=document.createElement(e);return o(n,a),function(e,t){for(const[n,r]of Object.entries(t))if(void 0!==r)switch(n){case"class":case"className":e.setAttribute("class",r);break;case"style":i(e,r);break;case"dangerouslySetInnerHTML":e.innerHTML=r.__html;break;default:n.startsWith("on")?e.addEventListener(n.slice(2).toLowerCase(),r):e.setAttribute(n,r)}}(n,null!=t?t:{}),n}}function u(e){let t=document.createDocumentFragment();return o(t,r(e.children)),t}n.r(t),n.d(t,{Children:()=>l,Fragment:()=>u,createElement:()=>a,default:()=>s});const l={toArray:r},s={createElement:a,Fragment:u}},(e,t,n)=>{n.r(t),n.d(t,{EXAM_ID:()=>f,NO_LEAVE_CHECK:()=>c,SERVER:()=>u,SORT_PROBLEMS:()=>s,SYNC_ANSWERS:()=>l,TOKEN:()=>d,USERNAME:()=>a});var r=n(8);class o{constructor(e){this._value=null,this._value=null!=e?e:null}get value(){return this._value}set value(e){this._value=e}}class i extends o{constructor(e,t){super(),this.name=e;let n=r.default.getValue(e);void 0===n&&(n=t),this.value=null!=n?n:null}get value(){return super.value}set value(e){r.default.setValue(this.name,e),super.value=e}}const a=new i("username"),u=new i("server"),l=new i("sync_answers",!0),s=new i("sort_problems",!0),c=new i("no_leave_check",!0),d=new o,f=new o},(e,t,n)=>{n.r(t),n.d(t,{hookXHR:()=>o});var r=n(9);function o(e){const t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,o){const i=e.call(this,(0,r.newURL)(o)),a=this.send;this.send=function(e){void 0!==i?i(e).then((e=>{a.call(this,e),this.send=a})).catch(r.devLog):(a.call(this,e),this.send=a)},t.apply(this,arguments)}}},(e,t,n)=>{var r;function o(e){return e===r.SingleChoice||e===r.MultipleChoice||e===r.Polling}n.r(t),n.d(t,{ProblemType:()=>r,isChoice:()=>o}),function(e){e[e.SingleChoice=1]="SingleChoice",e[e.MultipleChoice=2]="MultipleChoice",e[e.Polling=3]="Polling",e[e.FillBlank=4]="FillBlank",e[e.ShortAnswer=5]="ShortAnswer",e[e.Judgement=6]="Judgement"}(r||(r={}))},(e,t,n)=>{n.r(t),n.d(t,{CHOICE_MAP:()=>l,UI:()=>s,showConfirmUpload:()=>c});var r=n(18),o=n(13),i=n(19),a=n(9),u=n(10);const l=new a.Map2((()=>new Map));class s{constructor(e){document.head.append(o.default.createElement(o.default.Fragment,null,o.default.createElement("style",null,u.default.toString())));const t=document.body.querySelector(".header-title");t.classList.add(u.clickable),t.addEventListener("click",(()=>{(0,i.showSettings)()}));let n=[];!0===e.data.has_problem_dict?e.data.problems.forEach((e=>{n=n.concat(e.problems)})):n=e.data.problems;const a=new Map;document.body.querySelectorAll(".exam-main--body .subject-item").forEach(((e,t)=>{const o=n[t];a.set(o.problem_id,new r.ProblemCard(o,l.get(o.problem_id),e))})),this.problems=a}updateAnswer({username:e,problem_id:t,result:n}){var r;null===(r=this.problems.get(t))||void 0===r||r.updateResult(e,n)}updateUI(){this.problems.forEach((e=>e.updateUI()))}}function c(e,t){const n=(0,a.openWin)("上传图片",{width:300,height:200});n.document.body.append(o.default.createElement("div",{className:[u.uploadImg,u.mainBody].join(" ")},o.default.createElement("div",{className:[u.uploadImgConfirm].join(" ")},o.default.createElement("button",{"on-click":()=>{t(),n.close()},className:[u.clickable].join(" ")},"确认上传"),o.default.createElement("span",null,o.default.createElement("i",null,"*关闭窗口以取消上传"))),o.default.createElement("div",{className:[u.uploadImgImage].join(" ")},o.default.createElement("img",{src:e}))))}},(e,t,n)=>{n.r(t),n.d(t,{ProblemCard:()=>s});var r=n(16),o=n(9),i=n(13),a=n(10);class u{constructor(e){if(!(e instanceof HTMLElement))throw new Error("not a html element");this.ele=e}get content(){return this.ele.title}set content(e){this.ele.title=e}}function l(e){return`${Math.floor(100*e)}%`}class s{constructor(e,t,n){this.results=new Map;const o=e.ProblemType,i=new Map,l=n.querySelector(".item-type");switch(l.classList.add(a.clickable),l.addEventListener("click",(()=>this.showAll(l.getBoundingClientRect()))),o){case r.ProblemType.SingleChoice:case r.ProblemType.MultipleChoice:case r.ProblemType.Polling:case r.ProblemType.Judgement:n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput").forEach(((t,n)=>{i.set(e.Options[n].key,new u(t))}));break;case r.ProblemType.FillBlank:n.querySelectorAll(".item-body .blank-item-dynamic").forEach(((e,t)=>{i.set(`${t+1}`,new u(e))}))}this.type=o,this.options=i,this.choiceMap=t}showAll({left:e,top:t}){const n=(0,o.openWin)("详细答案",{height:150,width:200,left:e,top:t}),u=i.default.createElement("div",{className:[a.mainBody,a.answerDetail].join(" ")});function l(e){return i.default.createElement("p",{className:!0===e.title?a.answerDetailTitle:""},e.children)}function s(e){return i.default.createElement("ul",null,Array.isArray(e.children)?e.children.map((e=>i.default.createElement("li",null,e))):e.children)}switch(n.document.body.append(u),this.type){case r.ProblemType.SingleChoice:case r.ProblemType.MultipleChoice:case r.ProblemType.Polling:case r.ProblemType.Judgement:const e=new o.Map2((()=>[]));this.results.forEach(((t,n)=>{t.forEach((t=>{this.type===r.ProblemType.Judgement?t="true"===t?"正确":"错误":(0,r.isChoice)(this.type)&&(t=this.choiceMap.get(t)),e.setWith(t,(e=>(e.push(n),e)))}))})),[...e.entries()].sort((([e],[t])=>e<t?-1:1)).forEach((([e,t])=>{u.appendChild(i.default.createElement("div",null,i.default.createElement(l,{title:!0},e),i.default.createElement(s,null,t.sort().map((e=>i.default.createElement(l,null,e))))))}));break;case r.ProblemType.FillBlank:const t=new o.Map2((()=>new o.Map2((()=>[]))));this.results.forEach(((e,n)=>{Object.entries(e).forEach((([e,r])=>{t.setWith(e,(e=>(e.setWith(r,(e=>(e.push(n),e))),e)))}))})),[...t.entries()].sort((([e],[t])=>e<t?-1:1)).forEach((([e,t])=>{u.appendChild(i.default.createElement("div",null,i.default.createElement(l,{title:!0},`#${e}`),i.default.createElement(s,null,[...t].sort((([e],[t])=>e<t?-1:1)).map((([e,t])=>i.default.createElement(i.default.Fragment,null,i.default.createElement(l,null,e),i.default.createElement(s,null,t.sort().map((e=>i.default.createElement(l,null,e))))))))))}));break;case r.ProblemType.ShortAnswer:u.appendChild(i.default.createElement(s,null,[...this.results.entries()].sort((([e],[t])=>e<t?-1:1)).filter((([e,t])=>"content"in t)).map((([e,t])=>{var n,r;return i.default.createElement(i.default.Fragment,null,i.default.createElement(l,{title:!0},e),i.default.createElement("div",null,i.default.createElement("div",{className:a.answerDetailShortAnswer,dangerouslySetInnerHTML:{__html:t.content}}),i.default.createElement(s,null,(null!==(r=null===(n=t.attachments)||void 0===n?void 0:n.filelist)&&void 0!==r?r:[]).map((e=>i.default.createElement("a",{href:e.fileUrl},e.fileName))))))}))))}}updateResult(e,t){this.results.set(e,t)}updateUI(){switch(this.options.forEach((e=>e.content="")),this.type){case r.ProblemType.SingleChoice:case r.ProblemType.MultipleChoice:case r.ProblemType.Polling:case r.ProblemType.Judgement:const e=new o.Map2((()=>0));this.results.forEach((t=>{t.forEach((t=>{e.setWith(t,(e=>e+1))}))})),e.forEach(((e,t)=>{this.options.get(t).content=`${l(e/this.results.size)}`}));break;case r.ProblemType.FillBlank:const t=new o.Map2((()=>new o.Map2((()=>0))));this.results.forEach((e=>{Object.entries(e).forEach((([e,n])=>{t.setWith(e,(e=>(e.setWith(n,(e=>e+1)),e)))}))})),t.forEach(((e,t)=>{const[n,r]=[...e.entries()].sort((([e,t],[n,r])=>t-r)).pop();this.options.get(t).content=`(${l(r/this.results.size)}) ${n}`}))}}}},(e,t,n)=>{n.r(t),n.d(t,{showSettings:()=>u});var r=n(9),o=n(13),i=n(20),a=n(10);function u(){(0,r.openWin)("设置",{height:300,width:400}).document.body.appendChild(o.default.createElement("div",{className:[a.mainBody,a.settings].join(" ")},i.make()))}},(e,t,n)=>{n.r(t),n.d(t,{Entry:()=>d,React:()=>{},ReactDOMRe:()=>{},TitleText:()=>p,UList:()=>v,make:()=>m,style:()=>s});var r=n(21),o=n(23),i=n(26),a=n(24),u=n(10),l=n(14),s=u;function c(e){var t,n=e.name,r=e.title,i=e.ty,u=e.required,l=e.pattern,c={title:r,name:n,type:(t=0===i.TAG?["text",i._0,void 0]:["checkbox",void 0,i._0])[0]},d=t[2];void 0!==d&&(c.checked=a.valFromOption(d)),void 0!==l&&(c.pattern=a.valFromOption(l)),void 0!==u&&(c.required=a.valFromOption(u));var f=t[1];return void 0!==f&&(c.value=a.valFromOption(f)),o.DOMRe.createDOMElementVariadic("div",{className:s.settingsEntry},[o.DOMRe.createDOMElementVariadic("label",{htmlFor:n},[r]),o.DOMRe.createDOMElementVariadic("input",a.some(c),[])])}var d={make:c};function f(e){var t=e.title,n=e.content;return o.DOMRe.createDOMElementVariadic("p",void 0,[o.DOMRe.createDOMElementVariadic("strong",void 0,[t]),i.getWithDefault(i.map(n,(function(e){return e})),null)])}var p={make:f};function h(e){var t=e.children;return o.DOMRe.createDOMElementVariadic("ul",void 0,[r._1(o.Children.toArray,t).map((function(e){return o.DOMRe.createDOMElementVariadic("li",void 0,[e])}))])}var v={make:h};function m(e){return o.DOMRe.createDOMElementVariadic("div",void 0,[o.DOMRe.createDOMElementVariadic("form",{onSubmit:function(e){return(e=>{e.preventDefault();const t=new FormData(this);l.USERNAME.value=t.get("username"),l.SERVER.value=t.get("server"),l.NO_LEAVE_CHECK.value="on"===t.get("no_leave_check"),l.SORT_PROBLEMS.value="on"===t.get("sort_problems"),l.SYNC_ANSWERS.value="on"===t.get("sync_answers")})(e)}},[o.createElement(c,{name:"username",title:"用户名",ty:{TAG:0,_0:l.USERNAME.value}}),o.createElement(c,{name:"server",title:"服务器",ty:{TAG:0,_0:l.SERVER.value}}),o.createElement(c,{name:"sync_answers",title:"同步答案",ty:{TAG:1,_0:l.SYNC_ANSWERS.value}}),o.createElement(c,{name:"sort_problems",title:"排序答案",ty:{TAG:1,_0:l.SORT_PROBLEMS.value}}),o.createElement(c,{name:"no_leave_check",title:"拦截切屏检测",ty:{TAG:1,_0:l.NO_LEAVE_CHECK.value}}),o.DOMRe.createDOMElementVariadic("div",{className:s.settingsSubmit},[o.DOMRe.createDOMElementVariadic("div",{className:s.settingsSubmitTip},[o.DOMRe.createDOMElementVariadic("i",void 0,["*更改设置后请刷新页面"])]),o.DOMRe.createDOMElementVariadic("div",void 0,[o.DOMRe.createDOMElementVariadic("button",void 0,["提交"])])])]),o.DOMRe.createDOMElementVariadic("div",{className:s.about},[o.createElement(f,{title:"功能特性："}),o.createElementVariadic(h,{children:null},[o.createElement(f,{title:"同步答案：",content:"点击题目显示详细答案，在选项/填空处悬停显示简略答案"}),o.createElement(f,{title:"排序题目：",content:"根据 ID 对题目和选项进行重新排序"}),o.createElement(f,{title:"拦截切屏检测：",content:"随意切换页面、窗口不会被发现"}),o.createElement(f,{title:"拦截上传截图：",content:"仅当用户确认后，才会上传截图"}),o.createElement(f,{title:"拦截异常状态：",content:"即使本地显示异常也不会推送到服务器"})])])])}},(e,t,n)=>{n.r(t),n.d(t,{_1:()=>i,_2:()=>u,_3:()=>s,_4:()=>d,_5:()=>p,_6:()=>v,_7:()=>E,_8:()=>g,__1:()=>a,__2:()=>l,__3:()=>c,__4:()=>f,__5:()=>h,__6:()=>m,__7:()=>y,__8:()=>_,app:()=>o});var r=n(22);function o(e,t){for(;;){var n=t,i=e,a=i.length,u=0===a?1:a,l=u-n.length|0;if(0===l)return i.apply(null,n);if(l>=0)return function(e,t){return function(n){return o(e,t.concat([n]))}}(i,n);t=r.sub(n,u,0|-l),e=i.apply(null,r.sub(n,0,u))}}function i(e,t){var n=e.length;if(1===n)return e(t);switch(n){case 1:return e(t);case 2:return function(n){return e(t,n)};case 3:return function(n,r){return e(t,n,r)};case 4:return function(n,r,o){return e(t,n,r,o)};case 5:return function(n,r,o,i){return e(t,n,r,o,i)};case 6:return function(n,r,o,i,a){return e(t,n,r,o,i,a)};case 7:return function(n,r,o,i,a,u){return e(t,n,r,o,i,a,u)};default:return o(e,[t])}}function a(e){return 1===e.length?e:function(t){return i(e,t)}}function u(e,t,n){var r=e.length;if(2===r)return e(t,n);switch(r){case 1:return o(e(t),[n]);case 2:return e(t,n);case 3:return function(r){return e(t,n,r)};case 4:return function(r,o){return e(t,n,r,o)};case 5:return function(r,o,i){return e(t,n,r,o,i)};case 6:return function(r,o,i,a){return e(t,n,r,o,i,a)};case 7:return function(r,o,i,a,u){return e(t,n,r,o,i,a,u)};default:return o(e,[t,n])}}function l(e){return 2===e.length?e:function(t,n){return u(e,t,n)}}function s(e,t,n,r){var i=e.length;if(3===i)return e(t,n,r);switch(i){case 1:return o(e(t),[n,r]);case 2:return o(e(t,n),[r]);case 3:return e(t,n,r);case 4:return function(o){return e(t,n,r,o)};case 5:return function(o,i){return e(t,n,r,o,i)};case 6:return function(o,i,a){return e(t,n,r,o,i,a)};case 7:return function(o,i,a,u){return e(t,n,r,o,i,a,u)};default:return o(e,[t,n,r])}}function c(e){return 3===e.length?e:function(t,n,r){return s(e,t,n,r)}}function d(e,t,n,r,i){var a=e.length;if(4===a)return e(t,n,r,i);switch(a){case 1:return o(e(t),[n,r,i]);case 2:return o(e(t,n),[r,i]);case 3:return o(e(t,n,r),[i]);case 4:return e(t,n,r,i);case 5:return function(o){return e(t,n,r,i,o)};case 6:return function(o,a){return e(t,n,r,i,o,a)};case 7:return function(o,a,u){return e(t,n,r,i,o,a,u)};default:return o(e,[t,n,r,i])}}function f(e){return 4===e.length?e:function(t,n,r,o){return d(e,t,n,r,o)}}function p(e,t,n,r,i,a){var u=e.length;if(5===u)return e(t,n,r,i,a);switch(u){case 1:return o(e(t),[n,r,i,a]);case 2:return o(e(t,n),[r,i,a]);case 3:return o(e(t,n,r),[i,a]);case 4:return o(e(t,n,r,i),[a]);case 5:return e(t,n,r,i,a);case 6:return function(o){return e(t,n,r,i,a,o)};case 7:return function(o,u){return e(t,n,r,i,a,o,u)};default:return o(e,[t,n,r,i,a])}}function h(e){return 5===e.length?e:function(t,n,r,o,i){return p(e,t,n,r,o,i)}}function v(e,t,n,r,i,a,u){var l=e.length;if(6===l)return e(t,n,r,i,a,u);switch(l){case 1:return o(e(t),[n,r,i,a,u]);case 2:return o(e(t,n),[r,i,a,u]);case 3:return o(e(t,n,r),[i,a,u]);case 4:return o(e(t,n,r,i),[a,u]);case 5:return o(e(t,n,r,i,a),[u]);case 6:return e(t,n,r,i,a,u);case 7:return function(o){return e(t,n,r,i,a,u,o)};default:return o(e,[t,n,r,i,a,u])}}function m(e){return 6===e.length?e:function(t,n,r,o,i,a){return v(e,t,n,r,o,i,a)}}function E(e,t,n,r,i,a,u,l){var s=e.length;if(7===s)return e(t,n,r,i,a,u,l);switch(s){case 1:return o(e(t),[n,r,i,a,u,l]);case 2:return o(e(t,n),[r,i,a,u,l]);case 3:return o(e(t,n,r),[i,a,u,l]);case 4:return o(e(t,n,r,i),[a,u,l]);case 5:return o(e(t,n,r,i,a),[u,l]);case 6:return o(e(t,n,r,i,a,u),[l]);case 7:return e(t,n,r,i,a,u,l);default:return o(e,[t,n,r,i,a,u,l])}}function y(e){return 7===e.length?e:function(t,n,r,o,i,a,u){return E(e,t,n,r,o,i,a,u)}}function g(e,t,n,r,i,a,u,l,s){var c=e.length;if(8===c)return e(t,n,r,i,a,u,l,s);switch(c){case 1:return o(e(t),[n,r,i,a,u,l,s]);case 2:return o(e(t,n),[r,i,a,u,l,s]);case 3:return o(e(t,n,r),[i,a,u,l,s]);case 4:return o(e(t,n,r,i),[a,u,l,s]);case 5:return o(e(t,n,r,i,a),[u,l,s]);case 6:return o(e(t,n,r,i,a,u),[l,s]);case 7:return o(e(t,n,r,i,a,u,l),[s]);default:return o(e,[t,n,r,i,a,u,l,s])}}function _(e){return 8===e.length?e:function(t,n,r,o,i,a,u,l){return g(e,t,n,r,o,i,a,u,l)}}},(e,t,n)=>{function r(e,t,n){for(var r=new Array(n),o=0,i=t;o<n;)r[o]=e[i],o=o+1|0,i=i+1|0;return r}function o(e){var t=function(e,t){for(;;){var n=t,r=e;if(!n)return r;t=n.tl,e=n.hd.length+r|0}}(0,e),n=new Array(t);return function(e,t,n){for(;;){var r=n,o=t;if(!r)return;for(var i=r.hd,a=i.length,u=o,l=0;l<a;)e[u]=i[l],u=u+1|0,l=l+1|0;n=r.tl,t=u}}(n,0,e),n}function i(e,t,n){if(t<0||t>=e.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};e[t]=n}function a(e,t){if(t<0||t>=e.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error};return e[t]}function u(e,t){for(var n=new Array(e),r=0;r<e;++r)n[r]=t;return n}function l(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=0;return t}function s(e,t,n,r,o){if(r<=t)for(var i=0;i<o;++i)n[i+r|0]=e[i+t|0];else for(var a=o-1|0;a>=0;--a)n[a+r|0]=e[a+t|0]}function c(e){return e.slice(0)}n.r(t),n.d(t,{blit:()=>s,concat:()=>o,dup:()=>c,get:()=>a,make:()=>u,make_float:()=>l,set:()=>i,sub:()=>r})},(e,t,n)=>{n.r(t),n.d(t,{Children:()=>a,DOMRe:()=>c,Props:()=>{},createDOMElementVariadic:()=>u,createElement:()=>s,createElementVariadic:()=>l});var r=n(13),o=n(24),i=n(25),a={_recks:r,toArray:r.Children.toArray};function u(e,t,n){return i.spliceApply(r.createElement,[e,void 0!==t?o.valFromOption(t):void 0,n])}function l(e,t,n){return i.spliceApply(r.createElement,[e,t,n])}function s(e,t){return r.createElement(e,t)}var c={createDOMElementVariadic:u}},(e,t,n)=>{function r(e){return void 0!==e.BS_PRIVATE_NESTED_SOME_NONE}function o(e){return void 0===e?{BS_PRIVATE_NESTED_SOME_NONE:0}:null!==e&&void 0!==e.BS_PRIVATE_NESTED_SOME_NONE?{BS_PRIVATE_NESTED_SOME_NONE:e.BS_PRIVATE_NESTED_SOME_NONE+1|0}:e}function i(e){return null==e?void 0:o(e)}function a(e){return void 0===e?void 0:o(e)}function u(e){return null===e?void 0:o(e)}function l(e){if(null===e||void 0===e.BS_PRIVATE_NESTED_SOME_NONE)return e;var t=e.BS_PRIVATE_NESTED_SOME_NONE;return 0===t?void 0:{BS_PRIVATE_NESTED_SOME_NONE:t-1|0}}function s(e){return void 0===e?void 0:l(e)}function c(e){return void 0!==e?e.VAL:e}n.r(t),n.d(t,{isNested:()=>r,null_to_opt:()=>u,nullable_to_opt:()=>i,option_get:()=>s,option_unwrap:()=>c,some:()=>o,undefined_to_opt:()=>a,valFromOption:()=>l})},(e,t,n)=>{n.r(t),n.d(t,{spliceApply:()=>r,spliceObjApply:()=>o});var r=function(e,t){var n,r;r=t.length;var o=[];for(n=0;n<r-1;++n)o.push(t[n]);var i=t[r-1];for(n=0;n<i.length;++n)o.push(i[n]);return e.apply(null,o)},o=function(e,t,n){var r,o;o=n.length;var i=[];for(r=0;r<o-1;++r)i.push(n[r]);var a=n[o-1];for(r=0;r<a.length;++r)i.push(a[r]);return e[t].apply(e,i)}},(e,t,n)=>{n.r(t),n.d(t,{cmp:()=>O,cmpU:()=>b,eq:()=>_,eqU:()=>g,flatMap:()=>v,flatMapU:()=>h,forEach:()=>l,forEachU:()=>u,getExn:()=>s,getWithDefault:()=>m,isNone:()=>y,isSome:()=>E,keep:()=>a,keepU:()=>i,map:()=>p,mapU:()=>f,mapWithDefault:()=>d,mapWithDefaultU:()=>c});var r=n(21),o=n(24);function i(e,t){if(void 0!==e&&t(o.valFromOption(e)))return e}function a(e,t){return i(e,r.__1(t))}function u(e,t){if(void 0!==e)return t(o.valFromOption(e))}function l(e,t){return u(e,r.__1(t))}function s(e){if(void 0!==e)return o.valFromOption(e);throw{RE_EXN_ID:"Not_found",Error:new Error}}function c(e,t,n){return void 0!==e?n(o.valFromOption(e)):t}function d(e,t,n){return c(e,t,r.__1(n))}function f(e,t){if(void 0!==e)return o.some(t(o.valFromOption(e)))}function p(e,t){return f(e,r.__1(t))}function h(e,t){if(void 0!==e)return t(o.valFromOption(e))}function v(e,t){return h(e,r.__1(t))}function m(e,t){return void 0!==e?o.valFromOption(e):t}function E(e){return void 0!==e}function y(e){return void 0===e}function g(e,t,n){return void 0!==e?void 0!==t&&n(o.valFromOption(e),o.valFromOption(t)):void 0===t}function _(e,t,n){return g(e,t,r.__2(n))}function b(e,t,n){return void 0!==e?void 0!==t?n(o.valFromOption(e),o.valFromOption(t)):1:void 0!==t?-1:0}function O(e,t,n){return b(e,t,r.__2(n))}}],t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r);var e=n(1),t=n(15),o=n(16),i=n(17),a=n(9),u=n(14),l=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))};function s(e){return!0===u.SORT_PROBLEMS.value&&e.sort(((e,t)=>e.problem_id-t.problem_id)),e.forEach((e=>{if((0,o.isChoice)(e.ProblemType)){const t=e.Options;!0===u.SORT_PROBLEMS.value&&t.sort(((e,t)=>e.key<t.key?-1:1)),t.forEach(((t,n)=>{i.CHOICE_MAP.setWith(e.problem_id,(e=>e.set(t.key,String.fromCharCode(65+n))))}))}})),e}(function(){return l(this,void 0,void 0,(function*(){!0===u.NO_LEAVE_CHECK.value&&(document.addEventListener("visibilitychange",(e=>{e.preventDefault(),e.stopImmediatePropagation()}),!0),window.addEventListener("visibilitychange",(e=>{e.preventDefault(),e.stopImmediatePropagation()}),!0));const n=new e.Client;(0,t.hookXHR)((function(e){switch(e.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",(()=>{if(this.readyState==XMLHttpRequest.DONE){const t=JSON.stringify((!0===(e=JSON.parse(this.responseText)).data.has_problem_dict?e.data.problems=e.data.problems.sort(((e,t)=>e.id-t.id)).map((e=>(e.problems=s(e.problems),e))):e.data.problems=s(e.data.problems),(0,a.devLog)(i.CHOICE_MAP),e));Object.defineProperties(this,{responseText:{get:()=>t}})}var e})),this.addEventListener("load",(()=>{const t=JSON.parse(this.responseText);(0,a.devLog)("intercept paper",t);const r=new i.UI(t);n.onmessage((e=>{e.forEach((e=>r.updateAnswer(e))),r.updateUI()})),(()=>l(this,void 0,void 0,(function*(){u.EXAM_ID.value=parseInt(e.searchParams.get("exam_id"));const t=yield fetch((0,a.newURL)("/exam_room/cache_results",{exam_id:u.EXAM_ID.value.toString()}).toString()).then((e=>e.json()));n.answerProblem(t.data.results)})))().catch(a.devLog)}));break;case"/exam_room/answer_problem":return e=>l(this,void 0,void 0,(function*(){var t;if("string"==typeof e){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise((()=>{}))}else"results"in r&&((0,a.devLog)("intercept answers",r),n.answerProblem(null!==(t=r.results)&&void 0!==t?t:[]).catch(a.devLog))}return e}));default:if("upload-z1.qiniup.com"===e.hostname)return e=>l(this,void 0,void 0,(function*(){return e instanceof FormData&&e.get("file")instanceof File?new Promise((t=>{const n=new FileReader;n.onload=()=>(0,i.showConfirmUpload)(n.result,(()=>t(e))),n.readAsDataURL(e.get("file"))})):e}))}})),yield n.watch(1e4)}))})().catch(console.error)})()})();