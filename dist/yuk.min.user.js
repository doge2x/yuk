// ==UserScript==
// @name         yuk-client
// @version      0.8.0
// @author       doge2x
// @icon         https://www.yuketang.cn/static/images/favicon.ico
// @match        https://examination.xuetangx.com/*
// @grant        GM.xmlHttpRequest
// @grant        GM_getValue
// @grant        GM_setValue
// @run-at       document-start
// ==/UserScript==
(function(g){typeof define=="function"&&define.amd?define(g):g()})(function(){"use strict";var or=Object.defineProperty;var ur=(g,T,L)=>T in g?or(g,T,{enumerable:!0,configurable:!0,writable:!0,value:L}):g[T]=L;var k=(g,T,L)=>(ur(g,typeof T!="symbol"?T+"":T,L),L);var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},T={},L={},te={};(function(t){var e=g&&g.__extends||function(){var f=function(m,_){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,M){b.__proto__=M}||function(b,M){for(var S in M)Object.prototype.hasOwnProperty.call(M,S)&&(b[S]=M[S])},f(m,_)};return function(m,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");f(m,_);function b(){this.constructor=m}m.prototype=_===null?Object.create(_):(b.prototype=_.prototype,new b)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.createJSONRPCNotification=t.createJSONRPCRequest=t.createJSONRPCSuccessResponse=t.createJSONRPCErrorResponse=t.JSONRPCErrorCode=t.JSONRPCErrorException=t.isJSONRPCResponses=t.isJSONRPCResponse=t.isJSONRPCRequests=t.isJSONRPCRequest=t.isJSONRPCID=t.JSONRPC=void 0,t.JSONRPC="2.0";var n=function(f){return typeof f=="string"||typeof f=="number"||f===null};t.isJSONRPCID=n;var r=function(f){return f.jsonrpc===t.JSONRPC&&f.method!==void 0&&f.result===void 0&&f.error===void 0};t.isJSONRPCRequest=r;var s=function(f){return Array.isArray(f)&&f.every(t.isJSONRPCRequest)};t.isJSONRPCRequests=s;var i=function(f){return f.jsonrpc===t.JSONRPC&&f.id!==void 0&&(f.result!==void 0||f.error!==void 0)};t.isJSONRPCResponse=i;var o=function(f){return Array.isArray(f)&&f.every(t.isJSONRPCResponse)};t.isJSONRPCResponses=o;var l=function(f,m,_){var b={code:f,message:m};return _!=null&&(b.data=_),b},c=function(f){e(m,f);function m(_,b,M){var S=f.call(this,_)||this;return Object.setPrototypeOf(S,m.prototype),S.code=b,S.data=M,S}return m.prototype.toObject=function(){return l(this.code,this.message,this.data)},m}(Error);t.JSONRPCErrorException=c,function(f){f[f.ParseError=-32700]="ParseError",f[f.InvalidRequest=-32600]="InvalidRequest",f[f.MethodNotFound=-32601]="MethodNotFound",f[f.InvalidParams=-32602]="InvalidParams",f[f.InternalError=-32603]="InternalError"}(t.JSONRPCErrorCode||(t.JSONRPCErrorCode={}));var u=function(f,m,_,b){return{jsonrpc:t.JSONRPC,id:f,error:l(m,_,b)}};t.createJSONRPCErrorResponse=u;var a=function(f,m){return{jsonrpc:t.JSONRPC,id:f,result:m??null}};t.createJSONRPCSuccessResponse=a;var d=function(f,m,_){return{jsonrpc:t.JSONRPC,id:f,method:m,params:_}};t.createJSONRPCRequest=d;var h=function(f,m){return{jsonrpc:t.JSONRPC,method:f,params:m}};t.createJSONRPCNotification=h})(te);var ne={};Object.defineProperty(ne,"__esModule",{value:!0}),ne.DefaultErrorCode=void 0,ne.DefaultErrorCode=0;var It=g&&g.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(d){o(d)}}function c(a){try{u(r.throw(a))}catch(d){o(d)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},xt=g&&g.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(L,"__esModule",{value:!0}),L.JSONRPCClient=void 0;var Q=te,Ee=ne,Dt=function(){function t(e,n){this._send=e,this.createID=n,this.idToResolveMap=new Map,this.id=0}return t.prototype._createID=function(){return this.createID?this.createID():++this.id},t.prototype.timeout=function(e,n){var r=this;n===void 0&&(n=function(o){return(0,Q.createJSONRPCErrorResponse)(o,Ee.DefaultErrorCode,"Request timeout")});var s=function(o,l){var c=setTimeout(function(){o.forEach(function(u){var a=r.idToResolveMap.get(u);a&&(r.idToResolveMap.delete(u),a(n(u)))})},e);return l().then(function(u){return clearTimeout(c),u},function(u){return clearTimeout(c),Promise.reject(u)})},i=function(o,l){var c=(Array.isArray(o)?o:[o]).map(function(u){return u.id}).filter(Ve);return s(c,function(){return r.requestAdvanced(o,l)})};return{request:function(o,l,c){var u=r._createID();return s([u],function(){return r.requestWithID(o,l,c,u)})},requestAdvanced:function(o,l){return i(o,l)}}},t.prototype.request=function(e,n,r){return this.requestWithID(e,n,r,this._createID())},t.prototype.requestWithID=function(e,n,r,s){return It(this,void 0,void 0,function(){var i,o;return xt(this,function(l){switch(l.label){case 0:return i=(0,Q.createJSONRPCRequest)(s,e,n),[4,this.requestAdvanced(i,r)];case 1:return o=l.sent(),o.result!==void 0&&!o.error?[2,o.result]:o.result===void 0&&o.error?[2,Promise.reject(new Q.JSONRPCErrorException(o.error.message,o.error.code,o.error.data))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},t.prototype.requestAdvanced=function(e,n){var r=this,s=Array.isArray(e);Array.isArray(e)||(e=[e]);var i=e.filter(function(c){return Ve(c.id)}),o=i.map(function(c){return new Promise(function(u){return r.idToResolveMap.set(c.id,u)})}),l=Promise.all(o).then(function(c){return s||!c.length?c:c[0]});return this.send(s?e:e[0],n).then(function(){return l},function(c){return i.forEach(function(u){r.receive((0,Q.createJSONRPCErrorResponse)(u.id,Ee.DefaultErrorCode,c&&c.message||"Failed to send a request"))}),l})},t.prototype.notify=function(e,n,r){var s=(0,Q.createJSONRPCNotification)(e,n);this.send(s,r).then(void 0,function(){})},t.prototype.send=function(e,n){return this._send(e,n)},t.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(n,r){return n((0,Q.createJSONRPCErrorResponse)(r,Ee.DefaultErrorCode,e))}),this.idToResolveMap.clear()},t.prototype.receive=function(e){var n=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var s=n.idToResolveMap.get(r.id);s&&(n.idToResolveMap.delete(r.id),s(r))})},t}();L.JSONRPCClient=Dt;var Ve=function(t){return t!=null},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});var de={},he=g&&g.__assign||function(){return he=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},he.apply(this,arguments)},He=g&&g.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(d){o(d)}}function c(a){try{u(r.throw(a))}catch(d){o(d)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Ke=g&&g.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Tt=g&&g.__spreadArray||function(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(de,"__esModule",{value:!0}),de.JSONRPCServer=void 0;var I=te,Lt=ne,jt=function(){return(0,I.createJSONRPCErrorResponse)(null,I.JSONRPCErrorCode.ParseError,"Parse error")},qt=function(t){return(0,I.createJSONRPCErrorResponse)((0,I.isJSONRPCID)(t.id)?t.id:null,I.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Bt=function(t){return(0,I.createJSONRPCErrorResponse)(t,I.JSONRPCErrorCode.MethodNotFound,"Method not found")},Ft=function(){function t(e){e===void 0&&(e={});var n;this.mapErrorToJSONRPCErrorResponse=Gt,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(n=e.errorListener)!==null&&n!==void 0?n:console.warn}return t.prototype.hasMethod=function(e){return!!this.nameToMethodDictionary[e]},t.prototype.addMethod=function(e,n){this.addMethodAdvanced(e,this.toJSONRPCMethod(n))},t.prototype.toJSONRPCMethod=function(e){return function(n,r){var s=e(n.params,r);return Promise.resolve(s).then(function(i){return Vt(n.id,i)})}},t.prototype.addMethodAdvanced=function(e,n){var r;this.nameToMethodDictionary=he(he({},this.nameToMethodDictionary),(r={},r[e]=n,r))},t.prototype.receiveJSON=function(e,n){var r=this.tryParseRequestJSON(e);return r?this.receive(r,n):Promise.resolve(jt())},t.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},t.prototype.receive=function(e,n){return Array.isArray(e)?this.receiveMultiple(e,n):this.receiveSingle(e,n)},t.prototype.receiveMultiple=function(e,n){return He(this,void 0,void 0,function(){var r,s=this;return Ke(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(o){return s.receiveSingle(o,n)}))];case 1:return r=i.sent().filter(Wt),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},t.prototype.receiveSingle=function(e,n){return He(this,void 0,void 0,function(){var r,s;return Ke(this,function(i){switch(i.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,I.isJSONRPCRequest)(e)?[3,1]:[2,qt(e)];case 1:return[4,this.callMethod(r,e,n)];case 2:return s=i.sent(),[2,Ht(e,s)]}})})},t.prototype.applyMiddleware=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middleware?this.middleware=this.combineMiddlewares(Tt([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},t.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},t.prototype.middlewareReducer=function(e,n){return function(r,s,i){return e(function(o,l){return n(r,o,l)},s,i)}},t.prototype.callMethod=function(e,n,r){var s=this,i=function(l,c){return e?e(l,c):l.id!==void 0?Promise.resolve(Bt(l.id)):Promise.resolve(null)},o=function(l){return s.errorListener('An unexpected error occurred while executing "'.concat(n.method,'" JSON-RPC method:'),l),Promise.resolve(s.mapErrorToJSONRPCErrorResponseIfNecessary(n.id,l))};try{return(this.middleware||Ut)(i,n,r).then(void 0,o)}catch(l){return o(l)}},t.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,n){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,n):null},t}();de.JSONRPCServer=Ft;var Wt=function(t){return t!==null},Ut=function(t,e,n){return t(e,n)},Vt=function(t,e){return t!==void 0?(0,I.createJSONRPCSuccessResponse)(t,e):null},Gt=function(t,e){var n,r=(n=e==null?void 0:e.message)!==null&&n!==void 0?n:"An unexpected error occurred",s=Lt.DefaultErrorCode,i;return e instanceof I.JSONRPCErrorException&&(s=e.code,i=e.data),(0,I.createJSONRPCErrorResponse)(t,s,r,i)},Ht=function(t,e){return e||(t.id!==void 0?(0,I.createJSONRPCErrorResponse)(t.id,I.JSONRPCErrorCode.InternalError,"Internal error"):null)},me={},Kt=g&&g.__awaiter||function(t,e,n,r){function s(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(a){try{u(r.next(a))}catch(d){o(d)}}function c(a){try{u(r.throw(a))}catch(d){o(d)}}function u(a){a.done?i(a.value):s(a.value).then(l,c)}u((r=r.apply(t,e||[])).next())})},Qt=g&&g.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(a){return c([u,a])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(r=1,s&&(i=u[0]&2?s.return:u[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,u[1])).done)return i;switch(s=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(a){u=[6,a],s=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(me,"__esModule",{value:!0}),me.JSONRPCServerAndClient=void 0;var ge=te,Xt=function(){function t(e,n,r){r===void 0&&(r={});var s;this.server=e,this.client=n,this.errorListener=(s=r.errorListener)!==null&&s!==void 0?s:console.warn}return t.prototype.applyServerMiddleware=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,n)},t.prototype.hasMethod=function(e){return this.server.hasMethod(e)},t.prototype.addMethod=function(e,n){this.server.addMethod(e,n)},t.prototype.addMethodAdvanced=function(e,n){this.server.addMethodAdvanced(e,n)},t.prototype.timeout=function(e){return this.client.timeout(e)},t.prototype.request=function(e,n,r){return this.client.request(e,n,r)},t.prototype.requestAdvanced=function(e,n){return this.client.requestAdvanced(e,n)},t.prototype.notify=function(e,n,r){this.client.notify(e,n,r)},t.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},t.prototype.receiveAndSend=function(e,n,r){return Kt(this,void 0,void 0,function(){var s,i;return Qt(this,function(o){switch(o.label){case 0:return(0,ge.isJSONRPCResponse)(e)||(0,ge.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,ge.isJSONRPCRequest)(e)||(0,ge.isJSONRPCRequests)(e)?[4,this.server.receive(e,n)]:[3,3];case 2:return s=o.sent(),s?[2,this.client.send(s,r)]:[3,4];case 3:return i="Received an invalid JSON-RPC message",this.errorListener(i,e),[2,Promise.reject(new Error(i))];case 4:return[2]}})})},t}();me.JSONRPCServerAndClient=Xt,function(t){var e=g&&g.__createBinding||(Object.create?function(r,s,i,o){o===void 0&&(o=i);var l=Object.getOwnPropertyDescriptor(s,i);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,o,l)}:function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]}),n=g&&g.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&e(s,r,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(L,t),n(Ge,t),n(te,t),n(de,t),n(me,t)}(T);const zt=(t,e)=>t===e,Yt=Symbol("solid-track"),_e={equals:zt};let Qe=tt;const F=1,ve=2,Xe={owned:null,cleanups:null,context:null,owner:null};var P=null;let Pe=null,R=null,A=null,j=null,pe=0;function re(t,e){const n=R,r=P,s=t.length===0,i=s?Xe:{owned:null,cleanups:null,context:null,owner:e===void 0?r:e},o=s?t:()=>t(()=>V(()=>be(i)));P=i,R=null;try{return oe(o,!0)}finally{R=n,P=r}}function ze(t,e){e=e?Object.assign({},_e,e):_e;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),et(n,s));return[Ze.bind(n),r]}function E(t,e,n){const r=Ae(t,e,!1,F);se(r)}function Ye(t,e,n){Qe=nn;const r=Ae(t,e,!1,F);(!n||!n.render)&&(r.user=!0),j?j.push(r):se(r)}function ie(t,e,n){n=n?Object.assign({},_e,n):_e;const r=Ae(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,se(r),Ze.bind(r)}function V(t){if(R===null)return t();const e=R;R=null;try{return t()}finally{R=e}}function Zt(t){return P===null||(P.cleanups===null?P.cleanups=[t]:P.cleanups.push(t)),t}function Ze(){if(this.sources&&this.state)if(this.state===F)se(this);else{const t=A;A=null,oe(()=>ye(this),!1),A=t}if(R){const t=this.observers?this.observers.length:0;R.sources?(R.sources.push(this),R.sourceSlots.push(t)):(R.sources=[this],R.sourceSlots=[t]),this.observers?(this.observers.push(R),this.observerSlots.push(R.sources.length-1)):(this.observers=[R],this.observerSlots=[R.sources.length-1])}return this.value}function et(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&oe(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s],o=Pe&&Pe.running;o&&Pe.disposed.has(i),(o?!i.tState:!i.state)&&(i.pure?A.push(i):j.push(i),i.observers&&nt(i)),o||(i.state=F)}if(A.length>1e6)throw A=[],new Error},!1)),e}function se(t){if(!t.fn)return;be(t);const e=P,n=R,r=pe;R=P=t,en(t,t.value,r),R=n,P=e}function en(t,e,n){let r;try{r=t.fn(e)}catch(s){return t.pure&&(t.state=F,t.owned&&t.owned.forEach(be),t.owned=null),t.updatedAt=n+1,rt(s)}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?et(t,r):t.value=r,t.updatedAt=n)}function Ae(t,e,n,r=F,s){const i={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:P,context:null,pure:n};return P===null||P!==Xe&&(P.owned?P.owned.push(i):P.owned=[i]),i}function we(t){if(t.state===0)return;if(t.state===ve)return ye(t);if(t.suspense&&V(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<pe);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===F)se(t);else if(t.state===ve){const r=A;A=null,oe(()=>ye(t,e[0]),!1),A=r}}function oe(t,e){if(A)return t();let n=!1;e||(A=[]),j?n=!0:j=[],pe++;try{const r=t();return tn(n),r}catch(r){n||(j=null),A=null,rt(r)}}function tn(t){if(A&&(tt(A),A=null),t)return;const e=j;j=null,e.length&&oe(()=>Qe(e),!1)}function tt(t){for(let e=0;e<t.length;e++)we(t[e])}function nn(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:we(r)}for(e=0;e<n;e++)we(t[e])}function ye(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const s=r.state;s===F?r!==e&&(!r.updatedAt||r.updatedAt<pe)&&we(r):s===ve&&ye(r,e)}}}function nt(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=ve,n.pure?A.push(n):j.push(n),n.observers&&nt(n))}}function be(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),o=n.observerSlots.pop();r<s.length&&(i.sourceSlots[o]=r,s[r]=i,n.observerSlots[r]=o)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)be(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function rt(t){throw t}const rn=Symbol("fallback");function it(t){for(let e=0;e<t.length;e++)t[e]()}function sn(t,e,n={}){let r=[],s=[],i=[],o=0,l=e.length>1?[]:null;return Zt(()=>it(i)),()=>{let c=t()||[],u,a;return c[Yt],V(()=>{let h=c.length,f,m,_,b,M,S,J,v,$;if(h===0)o!==0&&(it(i),i=[],r=[],s=[],o=0,l&&(l=[])),n.fallback&&(r=[rn],s[0]=re(B=>(i[0]=B,n.fallback())),o=1);else if(o===0){for(s=new Array(h),a=0;a<h;a++)r[a]=c[a],s[a]=re(d);o=h}else{for(_=new Array(h),b=new Array(h),l&&(M=new Array(h)),S=0,J=Math.min(o,h);S<J&&r[S]===c[S];S++);for(J=o-1,v=h-1;J>=S&&v>=S&&r[J]===c[v];J--,v--)_[v]=s[J],b[v]=i[J],l&&(M[v]=l[J]);for(f=new Map,m=new Array(v+1),a=v;a>=S;a--)$=c[a],u=f.get($),m[a]=u===void 0?-1:u,f.set($,a);for(u=S;u<=J;u++)$=r[u],a=f.get($),a!==void 0&&a!==-1?(_[a]=s[u],b[a]=i[u],l&&(M[a]=l[u]),a=m[a],f.set($,a)):i[u]();for(a=S;a<h;a++)a in _?(s[a]=_[a],i[a]=b[a],l&&(l[a]=M[a],l[a](a))):s[a]=re(d);s=s.slice(0,o=h),r=c.slice(0)}return s});function d(h){if(i[a]=h,l){const[f,m]=ze(a);return l[a]=m,e(c[a],f)}return e(c[a])}}}function N(t,e){return V(()=>t(e||{}))}const on=t=>`Stale read from <${t}>.`;function G(t){const e="fallback"in t&&{fallback:()=>t.fallback};return ie(sn(()=>t.each,t.children,e||void 0))}function Se(t){const e=t.keyed,n=ie(()=>t.when,void 0,{equals:(r,s)=>e?r===s:!r==!s});return ie(()=>{const r=n();if(r){const s=t.children;return typeof s=="function"&&s.length>0?V(()=>s(e?r:()=>{if(!V(n))throw on("Show");return t.when})):s}return t.fallback},void 0,void 0)}const un=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],ln=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...un]),an=new Set(["innerHTML","textContent","innerText","children"]),cn=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),fn=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function dn(t,e){const n=fn[t];return typeof n=="object"?n[e]?n.$:void 0:n}const hn=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),mn={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function gn(t,e,n){let r=n.length,s=e.length,i=r,o=0,l=0,c=e[s-1].nextSibling,u=null;for(;o<s||l<i;){if(e[o]===n[l]){o++,l++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===o){const a=i<r?l?n[l-1].nextSibling:n[i-l]:c;for(;l<i;)t.insertBefore(n[l++],a)}else if(i===l)for(;o<s;)(!u||!u.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[i-1]&&n[l]===e[s-1]){const a=e[--s].nextSibling;t.insertBefore(n[l++],e[o++].nextSibling),t.insertBefore(n[--i],a),e[s]=n[i]}else{if(!u){u=new Map;let d=l;for(;d<i;)u.set(n[d],d++)}const a=u.get(e[o]);if(a!=null)if(l<a&&a<i){let d=o,h=1,f;for(;++d<s&&d<i&&!((f=u.get(e[d]))==null||f!==a+h);)h++;if(h>a-l){const m=e[o];for(;l<a;)t.insertBefore(n[l++],m)}else t.replaceChild(n[l++],e[o++])}else o++;else e[o++].remove()}}}const st="_$DX_DELEGATE";function ue(t,e,n,r={}){let s;return re(i=>{s=i,e===document?t():p(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{s(),e.textContent=""}}function O(t,e,n){let r;const s=()=>{const o=document.createElement("template");return o.innerHTML=t,n?o.content.firstChild.firstChild:o.content.firstChild},i=e?()=>(r||(r=s())).cloneNode(!0):()=>V(()=>document.importNode(r||(r=s()),!0));return i.cloneNode=i,i}function _n(t,e=window.document){const n=e[st]||(e[st]=new Set);for(let r=0,s=t.length;r<s;r++){const i=t[r];n.has(i)||(n.add(i),e.addEventListener(i,Cn))}}function X(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function vn(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function C(t,e){e==null?t.removeAttribute("class"):t.className=e}function pn(t,e,n,r){if(r)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const s=n[0];t.addEventListener(e,n[0]=i=>s.call(t,n[1],i))}else t.addEventListener(e,n)}function ot(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let i,o;for(i=0,o=s.length;i<o;i++){const l=s[i];!l||l==="undefined"||e[l]||(ut(t,l,!1),delete n[l])}for(i=0,o=r.length;i<o;i++){const l=r[i],c=!!e[l];!l||l==="undefined"||n[l]===c||!c||(ut(t,l,!0),n[l]=c)}return n}function wn(t,e,n){if(!e)return n?X(t,"style"):e;const r=t.style;if(typeof e=="string")return r.cssText=e;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),e||(e={});let s,i;for(i in n)e[i]==null&&r.removeProperty(i),delete n[i];for(i in e)s=e[i],s!==n[i]&&(r.setProperty(i,s),n[i]=s);return n}function yn(t,e={},n,r){const s={};return r||E(()=>s.children=z(t,e.children,s.children)),E(()=>e.ref&&e.ref(t)),E(()=>bn(t,e,n,!0,s,!0)),s}function p(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return z(t,e,r,n);E(s=>z(t,e(),s,n),r)}function bn(t,e,n,r,s={},i=!1){e||(e={});for(const o in s)if(!(o in e)){if(o==="children")continue;s[o]=lt(t,o,null,s[o],n,i)}for(const o in e){if(o==="children"){r||z(t,e.children);continue}const l=e[o];s[o]=lt(t,o,l,s[o],n,i)}}function Sn(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function ut(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,i=r.length;s<i;s++)t.classList.toggle(r[s],n)}function lt(t,e,n,r,s,i){let o,l,c,u,a;if(e==="style")return wn(t,n,r);if(e==="classList")return ot(t,n,r);if(n===r)return r;if(e==="ref")i||n(t);else if(e.slice(0,3)==="on:"){const d=e.slice(3);r&&t.removeEventListener(d,r),n&&t.addEventListener(d,n)}else if(e.slice(0,10)==="oncapture:"){const d=e.slice(10);r&&t.removeEventListener(d,r,!0),n&&t.addEventListener(d,n,!0)}else if(e.slice(0,2)==="on"){const d=e.slice(2).toLowerCase(),h=hn.has(d);if(!h&&r){const f=Array.isArray(r)?r[0]:r;t.removeEventListener(d,f)}(h||n)&&(pn(t,d,n,h),h&&_n([d]))}else if(e.slice(0,5)==="attr:")X(t,e.slice(5),n);else if((a=e.slice(0,5)==="prop:")||(c=an.has(e))||!s&&((u=dn(e,t.tagName))||(l=ln.has(e)))||(o=t.nodeName.includes("-")))a&&(e=e.slice(5),l=!0),e==="class"||e==="className"?C(t,n):o&&!l&&!c?t[Sn(e)]=n:t[u||e]=n;else{const d=s&&e.indexOf(":")>-1&&mn[e.split(":")[0]];d?vn(t,d,e,n):X(t,cn[e]||e,n)}return n}function Cn(t){const e=`$$${t.type}`;let n=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==n&&Object.defineProperty(t,"target",{configurable:!0,value:n}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return n||document}});n;){const r=n[e];if(r&&!n.disabled){const s=n[`${e}Data`];if(s!==void 0?r.call(n,s,t):r.call(n,t),t.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function z(t,e,n,r,s){for(;typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,o=r!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,i==="string"||i==="number")if(i==="number"&&(e=e.toString()),o){let l=n[0];l&&l.nodeType===3?l.data=e:l=document.createTextNode(e),n=Y(t,n,r,l)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e;else if(e==null||i==="boolean")n=Y(t,n,r);else{if(i==="function")return E(()=>{let l=e();for(;typeof l=="function";)l=l();n=z(t,l,n,r)}),()=>n;if(Array.isArray(e)){const l=[],c=n&&Array.isArray(n);if(Me(l,e,n,s))return E(()=>n=z(t,l,n,r,!0)),()=>n;if(l.length===0){if(n=Y(t,n,r),o)return n}else c?n.length===0?at(t,l,r):gn(t,n,l):(n&&Y(t),at(t,l));n=l}else if(e instanceof Node){if(Array.isArray(n)){if(o)return n=Y(t,n,r,e);Y(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}else console.warn("Unrecognized value. Skipped inserting",e)}return n}function Me(t,e,n,r){let s=!1;for(let i=0,o=e.length;i<o;i++){let l=e[i],c=n&&n[i];if(l instanceof Node)t.push(l);else if(!(l==null||l===!0||l===!1))if(Array.isArray(l))s=Me(t,l,c)||s;else if(typeof l=="function")if(r){for(;typeof l=="function";)l=l();s=Me(t,Array.isArray(l)?l:[l],Array.isArray(c)?c:[c])||s}else t.push(l),s=!0;else{const u=String(l);c&&c.nodeType===3?(c.data=u,t.push(c)):t.push(document.createTextNode(u))}}return s}function at(t,e,n=null){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function Y(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;o>=0;o--){const l=e[o];if(s!==l){const c=l.parentNode===t;!i&&!o?c?t.replaceChild(s,l):t.insertBefore(s,n):c&&l.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}function ct(t){if(t!==null)return t}function Ce(t){return function(e){if(e===void 0)throw new Error(t??"expect some value");return e}}function ft(t){return function(e){return e!==void 0?t(e):void 0}}function dt(t){return function(e){return e!==void 0||t!==void 0?[e,t]:void 0}}function ht(t){return function*(e){for(const n of e)yield t(n)}}function*mt(t){let e=0;for(const n of t)yield[e++,n]}function Rn(t){return function*(e){for(const n of e)t(n)&&(yield n)}}function gt(t){return function*(e){for(const n of e){const r=t(n);r!==void 0&&(yield r)}}}function Nn(t){return function*(e){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();for(;;){const s=n.next(),i=r.next();if(s.done!==!0&&i.done!==!0)yield[s.value,i.value];else return}}}function Z(t){return function(e){return Array.from(e).sort(t)}}function $n(t){for(const e of t)return e}function H(t,e){return function(n){let r=t;for(const s of n)r=e(r,s);return r}}function On(t){let e=0;for(const n of t)e++;return e}function ee(t){return Array.from(t)}function _t(t){return function(e){for(const n of e)t(n)}}class Je{constructor(e){k(this,"t");this.t=e}static from(e){return new Je(e)}static unwrap(e){return e.t}}class Re{constructor(e){k(this,"_init");k(this,"_t");this._init=e}static from(e){return new Re(e)}force(){return this._t===void 0&&(this._t=Je.from(this._init())),this._t.t}}class y{constructor(e){k(this,"_t");this._t=e}then(e){return new y(e(this._t))}static from(e){return new y(e)}unwrap(){return this._t}}const vt=`._mainBody_bsm4g_1{opacity:.5}._mainBody_bsm4g_1 *{font-size:.75rem;margin:0}._mainBody_bsm4g_1 button,._clickable_bsm4g_11{cursor:pointer}._stateWorkingOn_bsm4g_14{color:#00f}._stateSure_bsm4g_17{color:green}._stateNotSure_bsm4g_20{color:red}._answerMsg_bsm4g_23{border-style:groove;border-width:thin;opacity:.75;margin-bottom:.5rem}._answerMsg_bsm4g_23 ul{padding-left:1rem}._answerMsgName_bsm4g_32{font-weight:700}._answerMark_bsm4g_35{display:flex;justify-content:end;align-items:center;border-style:groove;border-width:thin;margin-bottom:.5rem;opacity:.75}._answerMark_bsm4g_35 button{padding:0;margin-left:.5rem;white-space:nowrap}._answerMark_bsm4g_35 input{height:max-content;width:100%}._answerDetail_bsm4g_53 ._stateWorkingOn_bsm4g_14,._answerDetail_bsm4g_53 ._stateSure_bsm4g_17,._answerDetail_bsm4g_53 ._stateNotSure_bsm4g_20{font-weight:700}._answerDetail_bsm4g_53 ul{padding-left:1.5rem}._answerDetail_bsm4g_53 ul ul{padding-left:1rem}._answerDetail_bsm4g_53 img{height:auto;width:80%}._answerDetailShortAnswer_bsm4g_68{border-style:groove;border-width:thin;margin:.2rem;padding:.2rem;min-width:min-content}._answerDetailFill_bsm4g_75{white-space:pre}._settings_bsm4g_78{border-style:groove;border-width:thin;display:flex;flex-direction:column;padding:.5rem;margin-bottom:.5rem}._settingsEntry_bsm4g_86{display:flex;flex-direction:row;margin-bottom:.5rem;justify-content:space-between;align-items:center}._settingsEntry_bsm4g_86 label{font-weight:700}._settingsEntry_bsm4g_86 input{height:max-content;text-align:right}._settingsSubmit_bsm4g_100{display:flex;flex-direction:row;align-items:center;justify-content:end}._settingsSubmitTip_bsm4g_106{margin-right:.5rem}._about_bsm4g_109 p{margin-bottom:.25rem}._about_bsm4g_109 ul{padding-left:1.5rem;margin-bottom:.25rem}._about_bsm4g_109 ul li{margin-bottom:.25rem}._uploadImg_bsm4g_119{display:flex;flex-direction:column}._uploadImg_bsm4g_119 img{width:100%;height:auto}._uploadImgImage_bsm4g_127{border-style:groove;border-width:thin;padding:.5rem}._uploadImgConfirm_bsm4g_132{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem}
`,En=O("<title> "),Pn=O("<style>");function pt(t,e,n){wt(e instanceof t,n??"not HTMLElement")}function wt(t,e){if(t!==!0)throw Error(e??"assertion failed")}function W(...t){return t}function ke(t){const e=y.from(window.open("","",Object.entries(t).map(([r,s])=>`${r}=${s}`).join(","))).then(ct).then(Ce("cannot open windows")).unwrap(),n=()=>e.close();return window.addEventListener("unload",n),e.addEventListener("close",()=>window.removeEventListener("unload",n)),ue(()=>[(()=>{const r=En(),s=r.firstChild;return E(()=>s.data=t.title),r})(),(()=>{const r=Pn();return r.textContent=vt,r})()],e.document.head),e}function Ie(t,...e){}function yt(t,e){const n=new URL(t,self.location.origin);for(const[r,s]of Object.entries(e??{}))n.searchParams.set(r,s);return n}function bt(t){const e=GM_getValue(t);if(e!==void 0)return e.contents}function le(t,e){return GM_setValue(t,{contents:e}),e}function An(){const t=[{name:"202205231915_gm_value",up(){le("no_leave_check",GM_getValue("nol_eavecheck")),GM_setValue("nol_eavecheck",void 0);for(const n of["username","server","sync_answers","sort_problems"])le(n,GM_getValue(n))}}],e=bt("migrations")??[];for(const{name:n,idx:r}of e)if(n!==t[r].name)throw new Error("bad migrations");for(const{name:n,up:r}of t.slice(e.length))r();le("migrations",t.map((n,r)=>({name:n.name,idx:r})))}class ae{constructor(e,n){k(this,"_name");k(this,"_t");this._name=e,this._t=Re.from(()=>{const r=bt(this._name);return r===void 0&&n!==void 0?le(this._name,n):r})}get(){return this._t.force()}set(e){e!==void 0&&(le(this._name,e),this._t=Re.from(()=>e))}}const xe=new ae("username"),De=new ae("server"),Te=new ae("sync_answers",!0),Le=new ae("sort_problems",!1),je=new ae("no_leave_check",!0);class Mn{constructor(){k(this,"token");k(this,"client");k(this,"examId");k(this,"paper");k(this,"queue",new Map);k(this,"onmsg",[])}onmessage(e){this.onmsg.push(e)}updateQueue(e,n){let r=this.queue.get(e);r!==void 0?n(r):(r={},n(r),this.queue.set(e,r))}updateAnswer(e,n){this.updateQueue(e,r=>r.result=n)}updateState(e,n){this.updateQueue(e,r=>{r.context=r.context??{},r.context.state=n})}updateMsg(e,n){this.updateQueue(e,r=>{r.context=r.context??{},r.context.msg=n})}async watch(e){return new Promise((n,r)=>{const s=setInterval(()=>{this.sendQueue().catch(i=>{clearInterval(s),alert(`与服务器通信异常: ${i}`),r(i)})},e)})}async login(e,n){this.examId=e,this.paper=n}async sendQueue(){const e=Te.get(),n=De.get(),r=xe.get();if(e!==!0||this.queue.size<1||n===void 0||r===void 0||this.examId===void 0||this.paper===void 0)return;const s=[...this.queue.entries()];if(this.queue.clear(),this.client===void 0){const o=new T.JSONRPCClient(l=>new Promise((c,u)=>{GM.xmlHttpRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(l),onload:a=>{a.status===200?(o.receive(y.from(a.responseText).then(Ce("empty response")).then(JSON.parse).unwrap()),c()):u(new Error(a.statusText))},onerror:a=>u(a.statusText)})}));this.client=o}if(this.token===void 0){Ie(`login to server: ${r}, ${this.examId}`);const o=await this.client.request("login",[r,this.examId,this.paper,"0.8.0"]);this.token=o}const i=await this.client.request("answer_problem",[this.token,s.map(([o,{result:l,context:c}])=>({problem_id:o,result:l,context:c}))]);this.onmsg.forEach(o=>o(i))}}const q=new Mn;function Jn(t){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,r){const s=t.call(this,yt(r)),i=this.send;this.send=function(o){s!==void 0?s(o).then(l=>{i.call(this,l),this.send=i}).catch(Ie):(i.call(this,o),this.send=i)},e.apply(this,arguments)}}var x=(t=>(t[t.SingleChoice=1]="SingleChoice",t[t.MultipleChoice=2]="MultipleChoice",t[t.Polling=3]="Polling",t[t.FillBlank=4]="FillBlank",t[t.ShortAnswer=5]="ShortAnswer",t[t.Judgement=6]="Judgement",t))(x||{}),D=(t=>(t[t.WorkingOn=0]="WorkingOn",t[t.Sure=1]="Sure",t[t.NotSure=2]="NotSure",t))(D||{});const w={mainBody:"_mainBody_bsm4g_1",clickable:"_clickable_bsm4g_11",stateWorkingOn:"_stateWorkingOn_bsm4g_14",stateSure:"_stateSure_bsm4g_17",stateNotSure:"_stateNotSure_bsm4g_20",answerMsg:"_answerMsg_bsm4g_23",answerMsgName:"_answerMsgName_bsm4g_32",answerMark:"_answerMark_bsm4g_35",answerDetail:"_answerDetail_bsm4g_53",answerDetailShortAnswer:"_answerDetailShortAnswer_bsm4g_68",answerDetailFill:"_answerDetailFill_bsm4g_75",settings:"_settings_bsm4g_78",settingsEntry:"_settingsEntry_bsm4g_86",settingsSubmit:"_settingsSubmit_bsm4g_100",settingsSubmitTip:"_settingsSubmitTip_bsm4g_106",about:"_about_bsm4g_109",uploadImg:"_uploadImg_bsm4g_119",uploadImgImage:"_uploadImgImage_bsm4g_127",uploadImgConfirm:"_uploadImgConfirm_bsm4g_132"},kn=O('<div><fieldset><legend></legend><input type="text" placeholder="留言"><button type="button">我正在做</button><button type="button">我很确定</button><button type="button">我不确定</button></fieldset><div><div>'),In=O("<fieldset><legend> 留言 </legend><ul>"),xn=O("<li><span>"),St=O("<ul>"),Dn=O("<li>"),Tn=O("<div><p><strong>"),Ln=O("<div><p><strong></strong></p><ul>"),jn=O("<li><p>"),qn=O("<p><strong>"),Bn=O("<div>"),Fn=O("<li><a>");function qe(t,e){return t===e?0:t<e?-1:1}function Ct(t){switch(t){case D.Sure:return 0;case D.WorkingOn:return 1;case D.NotSure:return 2}}function Rt([t,e],[n,r]){if(e===void 0)return r===void 0?qe(t,n):1;if(r===void 0)return-1;{const s=Ct(r)-Ct(e);return s===0?qe(t,n):s}}function Nt([t,e],[n,r]){var s,i;return Rt(W(t,(s=e.context)==null?void 0:s.state),W(n,(i=r.context)==null?void 0:i.state))}function Wn([t,e],[n,r]){return Rt(W(t,e==null?void 0:e.state),W(n,r==null?void 0:r.state))}function Be(t){if(t!==void 0)switch(t){case D.WorkingOn:return w.stateWorkingOn;case D.NotSure:return w.stateNotSure;case D.Sure:return w.stateSure}}function $t(t,e){return`${Math.floor(t*100/e)}%`}function Fe([t],[e]){return qe(t,e)}class We{constructor(e,n,r){k(this,"_details",new Map);this.updateUI=re(()=>{const[s,i]=ze(new Map,{equals:!1}),o=()=>i(this._details),l=r(s),c=n.querySelector(".item-type");return pt(HTMLElement,c),c.classList.add(w.clickable),c.addEventListener("click",()=>{const u=c==null?void 0:c.getBoundingClientRect(),a=ke({title:"详细答案",height:300,width:350,top:u==null?void 0:u.top,left:u==null?void 0:u.left});ue(()=>(()=>{const d=kn(),h=d.firstChild,f=h.firstChild,m=f.nextSibling,_=m.nextSibling,b=_.nextSibling,M=b.nextSibling,S=h.nextSibling,J=S.firstChild;return p(f,()=>`注册人数: ${Ue(s())}`),m.addEventListener("change",v=>q.updateMsg(e,v.currentTarget.value)),_.addEventListener("click",()=>q.updateState(e,D.WorkingOn)),b.addEventListener("click",()=>q.updateState(e,D.Sure)),M.addEventListener("click",()=>q.updateState(e,D.NotSure)),p(S,()=>y.from(s()).then(Z(Nt)).then(gt(([v,{context:$}])=>y.from($==null?void 0:$.state).then(dt($==null?void 0:$.msg)).then(ft(([B,K])=>{const U=B===D.WorkingOn?K??"我正在做":K;return U===void 0||U===""?void 0:W(v,B,U)})).unwrap())).then(ee).then(v=>N(Se,{get when(){return v.length>0},get children(){return(()=>{const $=In(),B=$.firstChild,K=B.nextSibling;return p(K,N(G,{each:v,children:([U,Ne,$e])=>(()=>{const Oe=xn(),Mt=Oe.firstChild;return p(Mt,`${U}: `),p(Oe,$e,null),E(fe=>{const Jt=Be(Ne),kt=w.answerMsgName;return Jt!==fe._v$7&&C(Oe,fe._v$7=Jt),kt!==fe._v$8&&C(Mt,fe._v$8=kt),fe},{_v$7:void 0,_v$8:void 0}),Oe})()})),E(()=>C($,w.answerMsg)),$})()}})).unwrap(),J),p(J,N(l,{})),E(v=>{const $=w.mainBody,B=w.answerMark,K=w.stateWorkingOn,U=w.stateSure,Ne=w.stateNotSure,$e=w.answerDetail;return $!==v._v$&&C(d,v._v$=$),B!==v._v$2&&C(h,v._v$2=B),K!==v._v$3&&C(_,v._v$3=K),U!==v._v$4&&C(b,v._v$4=U),Ne!==v._v$5&&C(M,v._v$5=Ne),$e!==v._v$6&&C(J,v._v$6=$e),v},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),d})(),a.document.body)}),o})}updateAnswer(e,n){this._details.set(e,n)}}class Ot{constructor(e){this._ele=e}setContent(e){this._ele.setAttribute("title",e)}}function Et(t){t.forEach(e=>e.setContent(""))}function Ue(t){return y.from(t).then(Rn(([,e])=>e.answer!==void 0)).then(On).unwrap()}function Pt({children:t}){return(()=>{const e=St();return p(e,N(G,{get each(){return t.sort(Wn)},children:([n,r])=>(()=>{const s=Dn();return p(s,n),E(()=>C(s,Be(r==null?void 0:r.state))),s})()})),e})()}class Un extends We{constructor(e,n,r,s){const i=y.from(n.querySelectorAll(".item-body .checkboxInput, .item-body .radioInput")).then(o=>Array.from(o).entries()).then(H(new Map,(o,[l,c])=>o.set(r(l),new Ot(c)))).unwrap();super(e,n,o=>{const l=ie(()=>y.from(o()).then(H(new Map,(c,[u,{answer:a,context:d}])=>{if(a!==void 0)for(let h of a){h=s(h);const f=c.get(h)??[];f.push([u,d]),c.set(h,f)}return c})).then(Z(Fe)).then(ee).unwrap());return Ye(()=>{const c=Ue(o());Et(i),y.from(l()).then(_t(([u,a])=>{var d;(d=i.get(u))==null||d.setContent($t(a.length,c))})).unwrap()}),()=>N(G,{get each(){return l()},children:([c,u])=>(()=>{const a=Tn(),d=a.firstChild,h=d.firstChild;return p(h,c),p(a,N(Pt,{children:u}),null),a})()})})}}class Vn extends We{constructor(e,n){const r=y.from(n.querySelectorAll(".item-body .blank-item-dynamic")).then(Array.from).then(mt).then(H(new Map,(s,[i,o])=>s.set(String.fromCharCode(i+49),new Ot(o)))).unwrap();super(e,n,s=>{const i=()=>y.from(s()).then(H(new Map,(o,[l,{answer:c,context:u}])=>c===void 0?o:y.from(c).then(Object.entries).then(H(o,(a,[d,h])=>{h=h.trim();const f=a.get(d)??new Map,m=f.get(h)??[];return m.push([l,u]),a.set(d,f.set(h,m))})).unwrap())).then(ht(([o,l])=>W(o,y.from(l).then(Z(Fe)).then(ee).unwrap()))).then(Z(Fe)).then(ee).unwrap();return Ye(()=>{const o=Ue(s());Et(r),y.from(i()).then(_t(([l,c])=>{var a;const u=y.from(c).then(ht(([d,h])=>W(d,h.length))).then(Z(([,d],[,h])=>h-d)).then($n).unwrap();(a=r.get(l))==null||a.setContent(u===void 0?"":`(${$t(u[1],o)}) ${u[0]}`)})).unwrap()}),()=>N(G,{get each(){return i()},children:([o,l])=>(()=>{const c=Ln(),u=c.firstChild,a=u.firstChild,d=u.nextSibling;return p(a,`#${o}`),p(d,N(G,{each:l,children:([h,f])=>N(Se,{when:h!=="",get children(){const m=jn(),_=m.firstChild;return p(_,h),p(m,N(Pt,{children:f}),null),E(()=>C(_,w.answerDetailFill)),m}})})),c})()})})}}class Gn extends We{constructor(e,n){super(e,n,r=>{const s=ie(()=>y.from(r()).then(Z(Nt)).then(ee).unwrap());return()=>N(G,{get each(){return y.from(s()).then(gt(([i,{answer:o,context:l}])=>{var c;return y.from(o==null?void 0:o.content).then(dt((c=o==null?void 0:o.attachments)==null?void 0:c.filelist)).then(ft(([u,a])=>W(i,u,a,l==null?void 0:l.state))).unwrap()})).then(ee).unwrap()},children:([i,o,l,c])=>[(()=>{const u=qn(),a=u.firstChild;return p(a,i),E(()=>C(u,Be(c))),u})(),N(Se,{when:o,children:u=>(()=>{const a=Bn();return E(d=>{const h=w.answerDetailShortAnswer,f=u();return h!==d._v$9&&C(a,d._v$9=h),f!==d._v$10&&(a.innerHTML=d._v$10=f),d},{_v$9:void 0,_v$10:void 0}),a})()}),N(Se,{when:l,children:u=>(()=>{const a=St();return p(a,N(G,{get each(){return u()},children:({fileUrl:d,fileName:h})=>(()=>{const f=Fn(),m=f.firstChild;return X(m,"href",d),p(m,h),f})()})),a})()})]})})}}const Hn=O("<div><label></label><input>"),Kn=O('<div><form><div><p><i> *更改设置后请刷新页面 </i></p><button type="submit"> 提交 </button></div></form><div><p><strong> 功能特性： </strong></p><ul>'),Qn=O("<li><strong>"),Xn=O("<div>");function ce(t){const e={...t.extra,name:t.name};return(()=>{const n=Hn(),r=n.firstChild,s=r.nextSibling;return p(r,()=>t.title),yn(s,e,!1,!1),E(i=>{const o=w.settingsEntry,l=t.name;return o!==i._v$&&C(n,i._v$=o),l!==i._v$2&&X(r,"for",i._v$2=l),i},{_v$:void 0,_v$2:void 0}),n})()}function zn(t){const e={};function n(s){return i=>e[s]=i.currentTarget.value}function r(s){return i=>e[s]=i.currentTarget.checked}return(()=>{const s=Kn(),i=s.firstChild,o=i.firstChild,l=o.firstChild,c=i.nextSibling,u=c.firstChild,a=u.nextSibling;return i.addEventListener("submit",d=>{d.preventDefault(),xe.set(e.username),De.set(e.server),Te.set(e.syncAnswers),Le.set(e.sortProblems),je.set(e.noLeaveCheck),t.onSubmit()}),p(i,N(ce,{name:"username",title:"用户名",get extra(){return{type:"text",pattern:"^[a-z][a-z0-9_]*$",title:"小写字母、数字、下划线",required:!0,value:xe.get(),onChange:n("username")}}}),o),p(i,N(ce,{name:"server",title:"服务器",get extra(){return{type:"url",required:!0,value:De.get(),onChange:n("server")}}}),o),p(i,N(ce,{name:"sync_answers",title:"同步答案",get extra(){return{type:"checkbox",checked:Te.get(),onChange:r("syncAnswers")}}}),o),p(i,N(ce,{name:"sort_problems",title:"排序题目",get extra(){return{type:"checkbox",checked:Le.get(),onChange:r("sortProblems")}}}),o),p(i,N(ce,{name:"no_leave_check",title:"拦截切屏检测",get extra(){return{type:"checkbox",checked:je.get(),onChange:r("noLeaveCheck")}}}),o),p(a,()=>[["同步答案：","点击题目显示详细答案，在选项/填空处悬停显示简略答案"],["排序题目：","根据 ID 对题目和选项进行重新排序"],["拦截切屏检测：","随意切换页面、窗口不会被发现"],["拦截上传截图：","仅当用户确认后，才会上传截图"],["拦截异常状态：","即使本地显示异常也不会推送到服务器"]].map(([d,h])=>(()=>{const f=Qn(),m=f.firstChild;return p(m,d),p(f,h,null),f})())),E(d=>{const h=w.settingsSubmit,f=w.settingsSubmitTip,m=w.about;return h!==d._v$3&&C(o,d._v$3=h),f!==d._v$4&&C(l,d._v$4=f),m!==d._v$5&&C(c,d._v$5=m),d},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),s})()}function Yn(){const t=ke({title:"设置",width:350,height:300});ue(()=>(()=>{const e=Xn();return p(e,N(zn,{onSubmit:()=>t.close()})),E(()=>C(e,w.mainBody)),e})(),t.document.body)}const Zn=O("<style>"),er=O('<div><div><button type="button">确认上传</button><span><i>*关闭窗口以取消上传</i></span></div><div><img>');class tr{constructor(e){ue(()=>(()=>{const s=Zn();return s.textContent=vt,s})(),document.head);const n=document.body.querySelector(".header-title");pt(HTMLElement,n),n.classList.add(w.clickable),n.addEventListener("click",()=>Yn());const r=Array.from(document.body.querySelectorAll(".exam-main--body .subject-item"));wt(r.length===e.length,"number subject items mismatches problems"),this._details=y.from(r).then(Nn(e)).then(H(new Map,(s,[i,o])=>{let l;switch(o.ProblemType){case x.SingleChoice:case x.MultipleChoice:case x.Polling:case x.Judgement:{const c=o.ProblemType===x.Judgement?a=>["正确","错误"][a]:a=>String.fromCharCode(65+a),u=o.ProblemType===x.Judgement?new Map([["true","正确"],["false","错误"]]):y.from(o.Options).then(Ce("no Options")).then(mt).then(H(new Map,(a,[d,{key:h}])=>a.set(h,String.fromCharCode(65+d)))).unwrap();l=new Un(o.ProblemID,i,c,a=>u.get(a)??a);break}case x.FillBlank:l=new Vn(o.ProblemID,i);break;case x.ShortAnswer:l=new Gn(o.ProblemID,i);break}return s.set(o.ProblemID,l)})).unwrap()}updateAnswer({username:e,problem_id:n,result:r,context:s}){var i;(i=this._details.get(n))==null||i.updateAnswer(e,{answer:r,context:s})}updateUI(){this._details.forEach(e=>e.updateUI())}}function nr(t,e){const n=ke({title:"上传图片",width:400,height:300});ue(()=>(()=>{const r=er(),s=r.firstChild,i=s.firstChild,o=s.nextSibling,l=o.firstChild;return i.addEventListener("click",()=>{n.close(),e()}),X(l,"src",t),E(c=>{const u={[w.mainBody]:!0,[w.uploadImg]:!0},a=w.uploadImgConfirm,d=w.uploadImgImage;return c._v$=ot(r,u,c._v$),a!==c._v$2&&C(s,c._v$2=a),d!==c._v$3&&C(o,c._v$3=d),c},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})(),n.document.body)}function At(t){return t.forEach(e=>{switch(e.ProblemType){case x.SingleChoice:case x.MultipleChoice:case x.Polling:{e.Options.sort((r,s)=>r.key<s.key?-1:1);break}}}),t.sort((e,n)=>e.ProblemID-n.ProblemID),t}function rr(t){return Le.get()===!0&&(t.data.has_problem_dict===!0?t.data.problems=t.data.problems.sort((e,n)=>e.id-n.id).map(e=>(e.problems=At(e.problems),e)):t.data.problems=At(t.data.problems)),t}function ir(){document.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0),window.addEventListener("visibilitychange",t=>{t.preventDefault(),t.stopImmediatePropagation()},!0)}async function sr(){An(),je.get()===!0&&ir(),Jn(function(t){switch(t.pathname){case"/exam_room/show_paper":this.addEventListener("readystatechange",()=>{if(this.readyState==XMLHttpRequest.DONE){const e=JSON.stringify(rr(JSON.parse(this.responseText)));Object.defineProperties(this,{responseText:{get(){return e}}})}}),this.addEventListener("load",()=>{const e=JSON.parse(this.responseText);let n=[];e.data.has_problem_dict===!0?e.data.problems.forEach(i=>{n=n.concat(i.problems)}):n=e.data.problems;const r=new tr(n);q.onmessage(i=>{i.forEach(o=>r.updateAnswer(o)),r.updateUI()});const s=parseInt(y.from(t.searchParams.get("exam_id")).then(ct).then(Ce("cannot found exam_id")).unwrap());q.login(s,{title:e.data.title,problems:n}),fetch(yt("/exam_room/cache_results",{exam_id:s.toString()}).toString()).then(i=>i.json()).then(i=>i.data.results.forEach(({problem_id:o,result:l})=>q.updateAnswer(o,l))).catch(Ie)});return;case"/exam_room/answer_problem":return async e=>{var n;if(typeof e=="string"){const r=JSON.parse(e);if("action"in r)switch(r.action){case 1:case 17:break;default:return console.log("intercept action",r),new Promise(()=>{})}else"results"in r&&((n=r.results)==null||n.forEach(({problem_id:s,result:i})=>q.updateAnswer(s,i)))}return e};default:return t.hostname==="upload-z1.qiniup.com"?async e=>e instanceof FormData&&e.get("file")instanceof File?new Promise(n=>{const r=new FileReader;r.onload=()=>nr(r.result,()=>n(e)),r.readAsDataURL(e.get("file"))}):e:void 0}}),await q.watch(1e4)}sr().catch(console.error)});
